//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/GeoGebraiOSARC/GeoGebraiOSARC/javasources/com/vividsolutions/jts/operation/buffer/BufferInputLineSimplifier.java
//


#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "com/vividsolutions/jts/algorithm/CGAlgorithms.h"
#include "com/vividsolutions/jts/geom/Coordinate.h"
#include "com/vividsolutions/jts/geom/CoordinateList.h"
#include "com/vividsolutions/jts/operation/buffer/BufferInputLineSimplifier.h"
#include "java/lang/Math.h"

@interface ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier () {
 @public
  IOSObjectArray *inputLine_;
  jdouble distanceTol_;
  IOSBooleanArray *isDeleted_;
  jint angleOrientation_;
}

- (jboolean)deleteShallowConcavities;

- (jint)findNextValidIndexWithInt:(jint)index;

- (IOSObjectArray *)collapseLine;

- (jboolean)isShallowConcavityWithComVividsolutionsJtsGeomCoordinate:(ComVividsolutionsJtsGeomCoordinate *)p0
                              withComVividsolutionsJtsGeomCoordinate:(ComVividsolutionsJtsGeomCoordinate *)p1
                              withComVividsolutionsJtsGeomCoordinate:(ComVividsolutionsJtsGeomCoordinate *)p2
                                                          withDouble:(jdouble)distanceTol;

@end

J2OBJC_FIELD_SETTER(ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier, inputLine_, IOSObjectArray *)
J2OBJC_FIELD_SETTER(ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier, isDeleted_, IOSBooleanArray *)

__attribute__((unused)) static jboolean ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_deleteShallowConcavities(ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier *self);

__attribute__((unused)) static jint ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_findNextValidIndexWithInt_(ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier *self, jint index);

__attribute__((unused)) static IOSObjectArray *ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_collapseLine(ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier *self);

__attribute__((unused)) static jboolean ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_isShallowConcavityWithComVividsolutionsJtsGeomCoordinate_withComVividsolutionsJtsGeomCoordinate_withComVividsolutionsJtsGeomCoordinate_withDouble_(ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier *self, ComVividsolutionsJtsGeomCoordinate *p0, ComVividsolutionsJtsGeomCoordinate *p1, ComVividsolutionsJtsGeomCoordinate *p2, jdouble distanceTol);

@implementation ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier

+ (IOSObjectArray *)simplifyWithComVividsolutionsJtsGeomCoordinateArray:(IOSObjectArray *)inputLine
                                                             withDouble:(jdouble)distanceTol {
  return ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_simplifyWithComVividsolutionsJtsGeomCoordinateArray_withDouble_(inputLine, distanceTol);
}

- (instancetype)initWithComVividsolutionsJtsGeomCoordinateArray:(IOSObjectArray *)inputLine {
  ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_initWithComVividsolutionsJtsGeomCoordinateArray_(self, inputLine);
  return self;
}

- (IOSObjectArray *)simplifyWithDouble:(jdouble)distanceTol {
  self->distanceTol_ = JavaLangMath_absWithDouble_(distanceTol);
  if (distanceTol < 0) angleOrientation_ = ComVividsolutionsJtsAlgorithmCGAlgorithms_CLOCKWISE;
  isDeleted_ = [IOSBooleanArray newArrayWithLength:((IOSObjectArray *) nil_chk(inputLine_))->size_];
  jboolean isChanged = NO;
  do {
    isChanged = ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_deleteShallowConcavities(self);
  }
  while (isChanged);
  return ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_collapseLine(self);
}

- (jboolean)deleteShallowConcavities {
  return ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_deleteShallowConcavities(self);
}

- (jint)findNextValidIndexWithInt:(jint)index {
  return ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_findNextValidIndexWithInt_(self, index);
}

- (IOSObjectArray *)collapseLine {
  return ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_collapseLine(self);
}

- (jboolean)isShallowConcavityWithComVividsolutionsJtsGeomCoordinate:(ComVividsolutionsJtsGeomCoordinate *)p0
                              withComVividsolutionsJtsGeomCoordinate:(ComVividsolutionsJtsGeomCoordinate *)p1
                              withComVividsolutionsJtsGeomCoordinate:(ComVividsolutionsJtsGeomCoordinate *)p2
                                                          withDouble:(jdouble)distanceTol {
  return ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_isShallowConcavityWithComVividsolutionsJtsGeomCoordinate_withComVividsolutionsJtsGeomCoordinate_withComVividsolutionsJtsGeomCoordinate_withDouble_(self, p0, p1, p2, distanceTol);
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "simplifyWithComVividsolutionsJtsGeomCoordinateArray:withDouble:", "simplify", "[Lcom.vividsolutions.jts.geom.Coordinate;", 0x9, NULL, NULL },
    { "initWithComVividsolutionsJtsGeomCoordinateArray:", "BufferInputLineSimplifier", NULL, 0x1, NULL, NULL },
    { "simplifyWithDouble:", "simplify", "[Lcom.vividsolutions.jts.geom.Coordinate;", 0x1, NULL, NULL },
    { "deleteShallowConcavities", NULL, "Z", 0x2, NULL, NULL },
    { "findNextValidIndexWithInt:", "findNextValidIndex", "I", 0x2, NULL, NULL },
    { "collapseLine", NULL, "[Lcom.vividsolutions.jts.geom.Coordinate;", 0x2, NULL, NULL },
    { "isShallowConcavityWithComVividsolutionsJtsGeomCoordinate:withComVividsolutionsJtsGeomCoordinate:withComVividsolutionsJtsGeomCoordinate:withDouble:", "isShallowConcavity", "Z", 0x2, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "inputLine_", NULL, 0x2, "[Lcom.vividsolutions.jts.geom.Coordinate;", NULL, NULL,  },
    { "distanceTol_", NULL, 0x2, "D", NULL, NULL,  },
    { "isDeleted_", NULL, 0x2, "[Z", NULL, NULL,  },
    { "angleOrientation_", NULL, 0x2, "I", NULL, NULL,  },
  };
  static const J2ObjcClassInfo _ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier = { 2, "BufferInputLineSimplifier", "com.vividsolutions.jts.operation.buffer", NULL, 0x1, 7, methods, 4, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier;
}

@end

IOSObjectArray *ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_simplifyWithComVividsolutionsJtsGeomCoordinateArray_withDouble_(IOSObjectArray *inputLine, jdouble distanceTol) {
  ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_initialize();
  ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier *simp = new_ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_initWithComVividsolutionsJtsGeomCoordinateArray_(inputLine);
  return [simp simplifyWithDouble:distanceTol];
}

void ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_initWithComVividsolutionsJtsGeomCoordinateArray_(ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier *self, IOSObjectArray *inputLine) {
  (void) NSObject_init(self);
  self->angleOrientation_ = ComVividsolutionsJtsAlgorithmCGAlgorithms_COUNTERCLOCKWISE;
  self->inputLine_ = inputLine;
}

ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier *new_ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_initWithComVividsolutionsJtsGeomCoordinateArray_(IOSObjectArray *inputLine) {
  ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier *self = [ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier alloc];
  ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_initWithComVividsolutionsJtsGeomCoordinateArray_(self, inputLine);
  return self;
}

jboolean ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_deleteShallowConcavities(ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier *self) {
  jint index = 1;
  jint maxIndex = ((IOSObjectArray *) nil_chk(self->inputLine_))->size_ - 1;
  jint midIndex = ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_findNextValidIndexWithInt_(self, index);
  jint lastIndex = ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_findNextValidIndexWithInt_(self, midIndex);
  jboolean isChanged = NO;
  while (lastIndex < maxIndex) {
    if (ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_isShallowConcavityWithComVividsolutionsJtsGeomCoordinate_withComVividsolutionsJtsGeomCoordinate_withComVividsolutionsJtsGeomCoordinate_withDouble_(self, IOSObjectArray_Get(self->inputLine_, index), IOSObjectArray_Get(self->inputLine_, midIndex), IOSObjectArray_Get(self->inputLine_, lastIndex), self->distanceTol_)) {
      *IOSBooleanArray_GetRef(nil_chk(self->isDeleted_), midIndex) = YES;
      isChanged = YES;
    }
    index = lastIndex;
    midIndex = ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_findNextValidIndexWithInt_(self, index);
    lastIndex = ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_findNextValidIndexWithInt_(self, midIndex);
  }
  return isChanged;
}

jint ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_findNextValidIndexWithInt_(ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier *self, jint index) {
  jint next = index + 1;
  while (next < ((IOSObjectArray *) nil_chk(self->inputLine_))->size_ - 1 && IOSBooleanArray_Get(nil_chk(self->isDeleted_), next)) next++;
  return next;
}

IOSObjectArray *ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_collapseLine(ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier *self) {
  ComVividsolutionsJtsGeomCoordinateList *coordList = new_ComVividsolutionsJtsGeomCoordinateList_init();
  for (jint i = 0; i < ((IOSObjectArray *) nil_chk(self->inputLine_))->size_; i++) {
    if (!IOSBooleanArray_Get(nil_chk(self->isDeleted_), i)) [coordList addWithId:IOSObjectArray_Get(self->inputLine_, i)];
  }
  return [coordList toCoordinateArray];
}

jboolean ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier_isShallowConcavityWithComVividsolutionsJtsGeomCoordinate_withComVividsolutionsJtsGeomCoordinate_withComVividsolutionsJtsGeomCoordinate_withDouble_(ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier *self, ComVividsolutionsJtsGeomCoordinate *p0, ComVividsolutionsJtsGeomCoordinate *p1, ComVividsolutionsJtsGeomCoordinate *p2, jdouble distanceTol) {
  jint orientation = ComVividsolutionsJtsAlgorithmCGAlgorithms_computeOrientationWithComVividsolutionsJtsGeomCoordinate_withComVividsolutionsJtsGeomCoordinate_withComVividsolutionsJtsGeomCoordinate_(p0, p1, p2);
  jboolean isAngleToSimplify = orientation == self->angleOrientation_;
  if (!isAngleToSimplify) return NO;
  jdouble dist = ComVividsolutionsJtsAlgorithmCGAlgorithms_distancePointLineWithComVividsolutionsJtsGeomCoordinate_withComVividsolutionsJtsGeomCoordinate_withComVividsolutionsJtsGeomCoordinate_(p1, p0, p2);
  return dist < distanceTol;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ComVividsolutionsJtsOperationBufferBufferInputLineSimplifier)
