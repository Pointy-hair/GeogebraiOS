//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/GeogebraiOS/GeogebraiOS/sources/org/geogebra/common/geogebra3D/euclidian3D/plots/FastBucketPQ.java
//


#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/io/PrintStream.h"
#include "java/lang/NullPointerException.h"
#include "java/lang/System.h"
#include "java/util/Iterator.h"
#include "java/util/LinkedList.h"
#include "org/geogebra/common/geogebra3D/euclidian3D/plots/BucketAssigner.h"
#include "org/geogebra/common/geogebra3D/euclidian3D/plots/DynamicMeshElement2.h"
#include "org/geogebra/common/geogebra3D/euclidian3D/plots/DynamicMeshTriList2.h"
#include "org/geogebra/common/geogebra3D/euclidian3D/plots/FastBucketPQ.h"

#define OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_DEFAULT_BUCKET_AMT 2048

@interface OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ ()

- (jint)getIndexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)el;

- (jboolean)addToZeroBucketWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)obj;

@end

J2OBJC_STATIC_FIELD_GETTER(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ, DEFAULT_BUCKET_AMT, jint)

__attribute__((unused)) static jint OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_getIndexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ *self, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *el);

__attribute__((unused)) static jboolean OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_addToZeroBucketWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ *self, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *obj);

@implementation OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ

- (instancetype)initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner:(id<OrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner>)ba
                                                                      withBoolean:(jboolean)reverse {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner_withBoolean_(self, ba, reverse);
  return self;
}

- (instancetype)initWithInt:(jint)bucketAmt
withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner:(id<OrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner>)ba
                withBoolean:(jboolean)reverse {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_initWithInt_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner_withBoolean_(self, bucketAmt, ba, reverse);
  return self;
}

- (jint)getIndexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)el {
  return OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_getIndexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_(self, el);
}

- (jboolean)addToZeroBucketWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)obj {
  return OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_addToZeroBucketWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_(self, obj);
}

- (jboolean)addWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)obj {
  if (((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk(obj))->cullInfo_ == OrgGeogebraCommonGeogebra3DEuclidian3DPlotsCullInfo2Enum_get_OUT()) return OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_addToZeroBucketWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_(self, obj);
  if (obj->bucket_owner_ != nil) return NO;
  jint bucketIndex = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_getIndexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_(self, obj);
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_set_bucket_prev_(obj, IOSObjectArray_Get(nil_chk(backs_), bucketIndex));
  if (IOSObjectArray_Get(backs_, bucketIndex) != nil) OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_set_bucket_next_(nil_chk(IOSObjectArray_Get(backs_, bucketIndex)), obj);
  IOSObjectArray_Set(backs_, bucketIndex, obj);
  if (IOSObjectArray_Get(nil_chk(buckets_), bucketIndex) == nil) IOSObjectArray_Set(buckets_, bucketIndex, obj);
  if (bucketIndex > maxBucket_) maxBucket_ = bucketIndex;
  obj->bucket_index_ = bucketIndex;
  count_++;
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_set_bucket_owner_(obj, self);
  return YES;
}

- (jboolean)removeWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)elem {
  if (elem == nil || elem->bucket_owner_ != self) return NO;
  jint bi = ((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk(elem))->bucket_index_;
  if (elem->bucket_next_ != nil) OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_set_bucket_prev_(elem->bucket_next_, elem->bucket_prev_);
  if (elem->bucket_prev_ != nil) OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_set_bucket_next_(elem->bucket_prev_, elem->bucket_next_);
  if (IOSObjectArray_Get(nil_chk(buckets_), bi) == elem) IOSObjectArray_Set(buckets_, bi, elem->bucket_next_);
  if (IOSObjectArray_Get(nil_chk(backs_), bi) == elem) IOSObjectArray_Set(backs_, bi, elem->bucket_prev_);
  while (maxBucket_ > 0 && IOSObjectArray_Get(buckets_, maxBucket_) == nil) maxBucket_--;
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_set_bucket_next_(elem, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_set_bucket_prev_(elem, nil));
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_set_bucket_owner_(elem, nil);
  count_--;
  return YES;
}

- (void)debugErrorTest {
  jdouble maxError = -100;
  jint buck = -1;
  jdouble frontError = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk([self peek])) getError];
  for (jint i = 0; i <= maxBucket_; i++) {
    OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *e = IOSObjectArray_Get(nil_chk(buckets_), i);
    while (e != nil) {
      jdouble err = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk(e)) getError];
      if (err > maxError) {
        maxError = err;
        buck = i;
      }
      e = e->bucket_next_;
    }
  }
  [((JavaIoPrintStream *) nil_chk(JavaLangSystem_get_out_())) printlnWithNSString:JreStrcat("$D$I$D", @"Maximum error: ", maxError, @"\tBucket: ", buck, @"\tFront error: ", frontError)];
}

- (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)peek {
  return IOSObjectArray_Get(nil_chk(buckets_), maxBucket_);
}

- (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)poll {
  if (maxBucket_ == 0) return nil;
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *elem = IOSObjectArray_Get(nil_chk(buckets_), maxBucket_);
  [self removeWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:elem];
  return elem;
}

- (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)forcePoll {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *elem = IOSObjectArray_Get(nil_chk(buckets_), maxBucket_);
  [self removeWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:elem];
  return elem;
}

- (void)recalculateWithInt:(jint)currentVersion
withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshTriList2:(id<OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshTriList2>)triList {
  JavaUtilLinkedList *list = [new_JavaUtilLinkedList_init() autorelease];
  for (jint i = 0; i <= maxBucket_; i++) {
    OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *e = IOSObjectArray_Get(nil_chk(buckets_), i);
    while (e != nil) {
      if (((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk(e))->lastVersion_ != currentVersion) [list addWithId:e];
      e = e->bucket_next_;
    }
  }
  id<JavaUtilIterator> it = [list iterator];
  while ([((id<JavaUtilIterator>) nil_chk(it)) hasNext]) {
    OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *a = [it next];
    [((id<OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshTriList2>) nil_chk(triList)) reinsertWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:a withInt:currentVersion];
  }
}

- (jint)size {
  return count_;
}

- (void)dealloc {
  RELEASE_(buckets_);
  RELEASE_(backs_);
  RELEASE_(bucketAssigner_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner:withBoolean:", "FastBucketPQ", NULL, 0x4, NULL, NULL },
    { "initWithInt:withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner:withBoolean:", "FastBucketPQ", NULL, 0x1, NULL, NULL },
    { "getIndexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:", "getIndex", "I", 0x2, NULL, NULL },
    { "addToZeroBucketWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:", "addToZeroBucket", "Z", 0x2, NULL, NULL },
    { "addWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:", "add", "Z", 0x1, NULL, NULL },
    { "removeWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:", "remove", "Z", 0x1, NULL, NULL },
    { "debugErrorTest", NULL, "V", 0x1, NULL, NULL },
    { "peek", NULL, "Lorg.geogebra.common.geogebra3D.euclidian3D.plots.DynamicMeshElement2;", 0x1, NULL, NULL },
    { "poll", NULL, "Lorg.geogebra.common.geogebra3D.euclidian3D.plots.DynamicMeshElement2;", 0x1, NULL, NULL },
    { "forcePoll", NULL, "Lorg.geogebra.common.geogebra3D.euclidian3D.plots.DynamicMeshElement2;", 0x1, NULL, NULL },
    { "recalculateWithInt:withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshTriList2:", "recalculate", "V", 0x1, NULL, NULL },
    { "size", NULL, "I", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "DEFAULT_BUCKET_AMT_", NULL, 0x1a, "I", NULL, NULL, .constantValue.asInt = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_DEFAULT_BUCKET_AMT },
    { "buckets_", NULL, 0x4, "[Lorg.geogebra.common.geogebra3D.euclidian3D.plots.DynamicMeshElement2;", NULL, NULL,  },
    { "backs_", NULL, 0x4, "[Lorg.geogebra.common.geogebra3D.euclidian3D.plots.DynamicMeshElement2;", NULL, NULL,  },
    { "bucketAssigner_", NULL, 0x4, "Lorg.geogebra.common.geogebra3D.euclidian3D.plots.BucketAssigner;", NULL, "Lorg/geogebra/common/geogebra3D/euclidian3D/plots/BucketAssigner<Lorg/geogebra/common/geogebra3D/euclidian3D/plots/DynamicMeshElement2;>;",  },
    { "bucketAmt_", NULL, 0x14, "I", NULL, NULL,  },
    { "count_", NULL, 0x4, "I", NULL, NULL,  },
    { "maxBucket_", NULL, 0x4, "I", NULL, NULL,  },
    { "reverse_", NULL, 0x14, "Z", NULL, NULL,  },
  };
  static const J2ObjcClassInfo _OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ = { 2, "FastBucketPQ", "org.geogebra.common.geogebra3D.euclidian3D.plots", NULL, 0x1, 12, methods, 8, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ;
}

@end

void OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner_withBoolean_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ *self, id<OrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner> ba, jboolean reverse) {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_initWithInt_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner_withBoolean_(self, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_DEFAULT_BUCKET_AMT, ba, reverse);
}

OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ *new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner_withBoolean_(id<OrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner> ba, jboolean reverse) {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ *self = [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ alloc];
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner_withBoolean_(self, ba, reverse);
  return self;
}

void OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_initWithInt_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner_withBoolean_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ *self, jint bucketAmt, id<OrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner> ba, jboolean reverse) {
  NSObject_init(self);
  self->maxBucket_ = 0;
  self->bucketAmt_ = bucketAmt;
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_setAndConsume_buckets_(self, [IOSObjectArray newArrayWithLength:bucketAmt type:OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_class_()]);
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_setAndConsume_backs_(self, [IOSObjectArray newArrayWithLength:bucketAmt type:OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_class_()]);
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_set_bucketAssigner_(self, ba);
  self->reverse_ = reverse;
}

OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ *new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_initWithInt_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner_withBoolean_(jint bucketAmt, id<OrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner> ba, jboolean reverse) {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ *self = [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ alloc];
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_initWithInt_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner_withBoolean_(self, bucketAmt, ba, reverse);
  return self;
}

jint OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_getIndexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ *self, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *el) {
  jint i = [((id<OrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner>) nil_chk(self->bucketAssigner_)) getBucketIndexWithId:el withInt:self->bucketAmt_];
  return self->reverse_ ? self->bucketAmt_ - 1 - i : i;
}

jboolean OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_addToZeroBucketWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ *self, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *obj) {
  if (nil == obj) @throw [new_JavaLangNullPointerException_init() autorelease];
  if (((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk(obj))->bucket_owner_ != nil) return NO;
  jint bucketIndex = 0;
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_set_bucket_prev_(obj, IOSObjectArray_Get(nil_chk(self->backs_), bucketIndex));
  if (IOSObjectArray_Get(self->backs_, bucketIndex) != nil) OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_set_bucket_next_(nil_chk(IOSObjectArray_Get(self->backs_, bucketIndex)), obj);
  IOSObjectArray_Set(self->backs_, bucketIndex, obj);
  if (IOSObjectArray_Get(nil_chk(self->buckets_), bucketIndex) == nil) IOSObjectArray_Set(self->buckets_, bucketIndex, obj);
  if (bucketIndex > self->maxBucket_) self->maxBucket_ = bucketIndex;
  obj->bucket_index_ = bucketIndex;
  self->count_++;
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_set_bucket_owner_(obj, self);
  return YES;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ)
