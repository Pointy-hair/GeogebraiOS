//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/GeoGebraiOSARC/GeoGebraiOSARC/javasources/org/geogebra/common/geogebra3D/euclidian3D/plots/SurfaceMesh2.java
//


#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/PrintStream.h"
#include "java/lang/Double.h"
#include "java/lang/Exception.h"
#include "java/lang/Math.h"
#include "java/lang/RuntimeException.h"
#include "java/lang/System.h"
#include "java/lang/UnsupportedOperationException.h"
#include "java/util/Iterator.h"
#include "java/util/LinkedList.h"
#include "org/geogebra/common/geogebra3D/euclidian3D/plots/DynamicMesh2.h"
#include "org/geogebra/common/geogebra3D/euclidian3D/plots/DynamicMeshElement2.h"
#include "org/geogebra/common/geogebra3D/euclidian3D/plots/DynamicMeshTriList2.h"
#include "org/geogebra/common/geogebra3D/euclidian3D/plots/FastBucketPQ.h"
#include "org/geogebra/common/geogebra3D/euclidian3D/plots/Octree.h"
#include "org/geogebra/common/geogebra3D/euclidian3D/plots/SurfaceMesh2.h"
#include "org/geogebra/common/geogebra3D/euclidian3D/plots/TriList.h"
#include "org/geogebra/common/geogebra3D/euclidian3D/plots/TriListElem.h"
#include "org/geogebra/common/geogebra3D/euclidian3D/plots/TriangleOctree.h"
#include "org/geogebra/common/geogebra3D/euclidian3D/plots/java/nio/FloatBuffer.h"
#include "org/geogebra/common/kernel/Matrix/Coords.h"
#include "org/geogebra/common/kernel/geos/GeoElement.h"
#include "org/geogebra/common/kernel/kernelND/SurfaceEvaluable.h"

@interface OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 () {
 @public
  jdouble area_;
  IOSObjectArray *triangles_;
  OrgGeogebraCommonKernelMatrixCoords *normal_;
}

- (void)init__ OBJC_METHOD_FAMILY_NONE;

- (OrgGeogebraCommonKernelMatrixCoords *)approxNormalWithDouble:(jdouble)u
                                                     withDouble:(jdouble)v;

- (OrgGeogebraCommonKernelMatrixCoords *)calcVertexWithDouble:(jdouble)u
                                                   withDouble:(jdouble)v;

- (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)getOtherParentWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)p;

@end

J2OBJC_FIELD_SETTER(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2, triangles_, IOSObjectArray *)
J2OBJC_FIELD_SETTER(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2, normal_, OrgGeogebraCommonKernelMatrixCoords *)

__attribute__((unused)) static void OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_init__(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *self);

__attribute__((unused)) static OrgGeogebraCommonKernelMatrixCoords *OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_approxNormalWithDouble_withDouble_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *self, jdouble u, jdouble v);

__attribute__((unused)) static OrgGeogebraCommonKernelMatrixCoords *OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_calcVertexWithDouble_withDouble_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *self, jdouble u, jdouble v);

__attribute__((unused)) static OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_getOtherParentWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *self, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *p);

#define OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_maxLevel 20

@interface OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 () {
 @public
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsOctree *octree_;
  jdouble maxErrorCoeff_;
  id<OrgGeogebraCommonKernelKernelNDSurfaceEvaluable> function_;
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *root_;
  jdouble desiredMaxError_;
}

- (void)initMeshWithDouble:(jdouble)xMin
                withDouble:(jdouble)xMax
                withDouble:(jdouble)yMin
                withDouble:(jdouble)yMax OBJC_METHOD_FAMILY_NONE;

@end

J2OBJC_FIELD_SETTER(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2, octree_, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsOctree *)
J2OBJC_FIELD_SETTER(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2, function_, id<OrgGeogebraCommonKernelKernelNDSurfaceEvaluable>)
J2OBJC_FIELD_SETTER(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2, root_, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *)

J2OBJC_STATIC_FIELD_GETTER(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2, maxLevel, jint)

__attribute__((unused)) static void OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_initMeshWithDouble_withDouble_withDouble_withDouble_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 *self, jdouble xMin, jdouble xMax, jdouble yMin, jdouble yMax);

#define OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_asymptoteThreshold 0.0

@interface OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2 () {
 @public
  jint currentVersion_;
}

- (jchar)getFlagsWithFloatArray:(IOSFloatArray *)v
                 withFloatArray:(IOSFloatArray *)n;

- (void)calcFloatsWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *)d
                                                                         withInt:(jint)j
                                                                  withFloatArray:(IOSFloatArray *)v
                                                                  withFloatArray:(IOSFloatArray *)n;

@end

J2OBJC_STATIC_FIELD_GETTER(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2, asymptoteThreshold, jdouble)

__attribute__((unused)) static jchar OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_getFlagsWithFloatArray_withFloatArray_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2 *self, IOSFloatArray *v, IOSFloatArray *n);

__attribute__((unused)) static void OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_calcFloatsWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withFloatArray_withFloatArray_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2 *self, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *d, jint j, IOSFloatArray *v, IOSFloatArray *n);

@implementation OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2

- (instancetype)initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 *)mesh
                                                                        withInt:(jint)level
                                                                     withDouble:(jdouble)pa1
                                                                     withDouble:(jdouble)pa2
                                                                    withBoolean:(jboolean)isClipped
                                                                        withInt:(jint)version_ {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_withInt_withDouble_withDouble_withBoolean_withInt_(self, mesh, level, pa1, pa2, isClipped, version_);
  return self;
}

- (instancetype)initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 *)mesh
                 withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *)parent0
                                                                        withInt:(jint)index0
                 withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *)parent1
                                                                        withInt:(jint)index1
                 withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *)ancestor0
                 withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *)ancestor1
                                                                        withInt:(jint)level
                                                                        withInt:(jint)version_ {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withInt_(self, mesh, parent0, index0, parent1, index1, ancestor0, ancestor1, level, version_);
  return self;
}

- (void)init__ {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_init__(self);
}

- (OrgGeogebraCommonKernelMatrixCoords *)approxNormalWithDouble:(jdouble)u
                                                     withDouble:(jdouble)v {
  return OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_approxNormalWithDouble_withDouble_(self, u, v);
}

- (void)calcMainVertexWithDouble:(jdouble)u
                      withDouble:(jdouble)v {
  id<OrgGeogebraCommonKernelKernelNDSurfaceEvaluable> function = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 *) nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 *) check_class_cast(mesh_, [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 class])))) getFunction];
  OrgGeogebraCommonKernelMatrixCoords *f = [((id<OrgGeogebraCommonKernelKernelNDSurfaceEvaluable>) nil_chk(function)) evaluatePointWithDouble:u withDouble:v];
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *a0 = IOSObjectArray_Get(nil_chk(ancestors_), 0);
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *a1 = IOSObjectArray_Get(ancestors_, 1);
  jboolean v2def = [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk([((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(a0)) getVertexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:self])) isDefined];
  jboolean v3def = [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk([((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(a1)) getVertexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:self])) isDefined];
  if (v2def != v3def) {
    jdouble ui = u;
    jdouble vi = v;
    jdouble du = (IOSDoubleArray_Get(nil_chk(a1->params_), 0) - IOSDoubleArray_Get(a0->params_, 0)) * 0.25;
    jdouble dv = (IOSDoubleArray_Get(a1->params_, 1) - IOSDoubleArray_Get(a0->params_, 1)) * 0.25;
    jboolean dir = v2def;
    OrgGeogebraCommonKernelMatrixCoords *lo = [a0 getVertexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:self];
    OrgGeogebraCommonKernelMatrixCoords *hi = [a1 getVertexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:self];
    if (dir ^ [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(f)) isDefined]) {
      hi = f;
      ui -= du;
      vi -= dv;
    }
    else {
      lo = f;
      ui += du;
      vi += dv;
    }
    f = [function evaluatePointWithDouble:ui withDouble:vi];
    for (jint i = 0; i < 30; i++) {
      du *= 0.5;
      dv *= 0.5;
      if (dir ^ [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(f)) isDefined]) {
        hi = f;
        ui -= du;
        vi -= dv;
      }
      else {
        lo = f;
        ui += du;
        vi += dv;
      }
      f = [function evaluatePointWithDouble:ui withDouble:vi];
    }
    alt_ = hi;
    f = lo;
    ancestorDiff_ = [IOSDoubleArray newArrayWithDoubles:(jdouble[]){ IOSDoubleArray_Get(a1->params_, 0) - IOSDoubleArray_Get(a0->params_, 0), IOSDoubleArray_Get(a1->params_, 1) - IOSDoubleArray_Get(a0->params_, 1) } count:2];
    *IOSDoubleArray_GetRef(params_, 0) = ui;
    *IOSDoubleArray_GetRef(params_, 1) = vi;
    originalParams_ = [IOSDoubleArray newArrayWithDoubles:(jdouble[]){ u, v } count:2];
  }
  else {
    jfloat d = 1e-6f;
    if (![((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(f)) isFinite] || ![f isDefined]) {
      f = [function evaluatePointWithDouble:u + d withDouble:v];
      if (![((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(f)) isFinite] || ![f isDefined]) {
        f = [function evaluatePointWithDouble:u withDouble:v + d];
        if (![((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(f)) isFinite] || ![f isDefined]) {
          f = [function evaluatePointWithDouble:u - d withDouble:v];
          if (![((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(f)) isFinite] || ![f isDefined]) f = [function evaluatePointWithDouble:u withDouble:v - d];
        }
      }
    }
  }
  vertex_ = f;
}

- (OrgGeogebraCommonKernelMatrixCoords *)calcVertexWithDouble:(jdouble)u
                                                   withDouble:(jdouble)v {
  return OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_calcVertexWithDouble_withDouble_(self, u, v);
}

- (jboolean)childCreatedWithInt:(jint)i {
  return IOSObjectArray_Get(nil_chk(children_), i) != nil;
}

- (void)createChildWithInt:(jint)i {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *parent = nil;
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *otherParent = nil;
  jint index;
  if (i < 2) {
    parent = (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(IOSObjectArray_Get(nil_chk(parents_), 0), [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]);
    if (i == 0) index = IOSIntArray_Get(nil_chk(indices_), 0) + 1;
    else index = IOSIntArray_Get(nil_chk(indices_), 0) - 1;
  }
  else {
    parent = (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(IOSObjectArray_Get(nil_chk(parents_), 1), [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]);
    if (i == 2) index = IOSIntArray_Get(nil_chk(indices_), 1) + 1;
    else index = IOSIntArray_Get(nil_chk(indices_), 1) - 1;
  }
  if (parent != nil) otherParent = (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast([parent getChildWithInt:index & 3], [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]);
  jint parentIndex = i / 2;
  jint ancestorIndex = i == 1 || i == 2 ? 1 : 0;
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *a0 = (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(IOSObjectArray_Get(nil_chk(parents_), parentIndex), [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]);
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *a1 = IOSObjectArray_Get(nil_chk(ancestors_), ancestorIndex);
  jint otherIndex = i == 0 || i == 2 ? 1 : 0;
  if (otherParent != nil && IOSObjectArray_Get(otherParent->parents_, 1) == parent) otherIndex |= 2;
  if (i == 1 || i == 3) (void) IOSObjectArray_Set(nil_chk(children_), i, new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withInt_((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 *) check_class_cast(mesh_, [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 class]), otherParent, otherIndex, self, i, a0, a1, level_ + 1, lastVersion_));
  else (void) IOSObjectArray_Set(nil_chk(children_), i, new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withInt_((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 *) check_class_cast(mesh_, [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 class]), self, i, otherParent, otherIndex, a0, a1, level_ + 1, lastVersion_));
  if (otherParent != nil) [(otherParent) setChildWithInt:otherIndex withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:IOSObjectArray_Get(nil_chk(children_), i)];
}

- (void)cullChildren {
  if (![self isSplit]) {
    return;
  }
  for (jint i = 0; i < 4; i += 2) {
    OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *child = (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast([self getChildWithInt:i], [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]);
    if (child != nil) {
      if (self == [child getParentWithInt:0]) {
        if ([child childCreatedWithInt:0]) [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk([child getChildWithInt:0])) updateCullInfo];
        if ([child childCreatedWithInt:1]) [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk([child getChildWithInt:1])) updateCullInfo];
      }
      else {
        if ([child childCreatedWithInt:2]) [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk([child getChildWithInt:2])) updateCullInfo];
        if ([child childCreatedWithInt:3]) [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk([child getChildWithInt:3])) updateCullInfo];
      }
    }
  }
}

- (void)freeTriangleWithInt:(jint)j {
  (void) IOSObjectArray_Set(nil_chk(triangles_), j, nil);
}

- (void)generateError {
  OrgGeogebraCommonKernelMatrixCoords *p0 = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(IOSObjectArray_Get(nil_chk(parents_), 0), [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class])))) getVertexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:self];
  OrgGeogebraCommonKernelMatrixCoords *p1 = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(IOSObjectArray_Get(parents_, 1), [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class])))) getVertexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:self];
  OrgGeogebraCommonKernelMatrixCoords *a0 = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk((IOSObjectArray_Get(nil_chk(ancestors_), 0)))) getVertexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:self];
  OrgGeogebraCommonKernelMatrixCoords *a1 = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk((IOSObjectArray_Get(ancestors_, 1)))) getVertexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:self];
  OrgGeogebraCommonKernelMatrixCoords *v0 = [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(a0)) subWithOrgGeogebraCommonKernelMatrixCoords:vertex_];
  OrgGeogebraCommonKernelMatrixCoords *v1 = [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(a1)) subWithOrgGeogebraCommonKernelMatrixCoords:vertex_];
  OrgGeogebraCommonKernelMatrixCoords *v2 = [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(p0)) subWithOrgGeogebraCommonKernelMatrixCoords:vertex_];
  OrgGeogebraCommonKernelMatrixCoords *v3 = [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(p1)) subWithOrgGeogebraCommonKernelMatrixCoords:vertex_];
  jdouble vol0 = JavaLangMath_absWithDouble_([((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(v0)) dotproductWithOrgGeogebraCommonKernelMatrixCoords:[((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(v3)) crossProductWithOrgGeogebraCommonKernelMatrixCoords:v1]]);
  jdouble vol1 = JavaLangMath_absWithDouble_([v0 dotproductWithOrgGeogebraCommonKernelMatrixCoords:[((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(v2)) crossProductWithOrgGeogebraCommonKernelMatrixCoords:v1]]);
  if (vol0 == 0.0 && vol1 == 0.0) {
    vol0 = JavaLangMath_absWithDouble_([v2 dotproductWithOrgGeogebraCommonKernelMatrixCoords:[v3 crossProductWithOrgGeogebraCommonKernelMatrixCoords:v1]]);
    vol1 = JavaLangMath_absWithDouble_([v2 dotproductWithOrgGeogebraCommonKernelMatrixCoords:[v0 crossProductWithOrgGeogebraCommonKernelMatrixCoords:v3]]);
  }
  if (JavaLangDouble_isNaNWithDouble_(vol0) || JavaLangDouble_isInfiniteWithDouble_(vol0)) *IOSDoubleArray_GetRef(nil_chk(errors_), 0) = area_ * area_ * OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_undefErrorConst;
  else *IOSDoubleArray_GetRef(nil_chk(errors_), 0) = vol0;
  if (JavaLangDouble_isNaNWithDouble_(vol1) || JavaLangDouble_isInfiniteWithDouble_(vol1)) *IOSDoubleArray_GetRef(nil_chk(errors_), 1) = area_ * area_ * OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_undefErrorConst;
  else *IOSDoubleArray_GetRef(nil_chk(errors_), 1) = vol1;
  if (IOSDoubleArray_Get(nil_chk(errors_), 0) == 0.0 || IOSDoubleArray_Get(errors_, 1) == 0.0) {
    jdouble alpha = 0.123456;
    jdouble nu = alpha * IOSDoubleArray_Get(nil_chk(params_), 0) + (1 - alpha) * IOSDoubleArray_Get(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(IOSObjectArray_Get(ancestors_, 0)))->params_, 0);
    jdouble nv = alpha * IOSDoubleArray_Get(params_, 1) + (1 - alpha) * IOSDoubleArray_Get(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(IOSObjectArray_Get(ancestors_, 0)))->params_, 1);
    nu = alpha * nu + (1 - alpha) * IOSDoubleArray_Get(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(IOSObjectArray_Get(parents_, 0), [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]))))->params_, 0);
    nv = alpha * nv + (1 - alpha) * IOSDoubleArray_Get(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(IOSObjectArray_Get(parents_, 1), [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]))))->params_, 1);
    OrgGeogebraCommonKernelMatrixCoords *pt = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_calcVertexWithDouble_withDouble_(self, nu, nv);
    if ([((OrgGeogebraCommonKernelMatrixCoords *) nil_chk([((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(pt)) subWithOrgGeogebraCommonKernelMatrixCoords:vertex_])) dotproductWithOrgGeogebraCommonKernelMatrixCoords:[a0 subWithOrgGeogebraCommonKernelMatrixCoords:pt]] < 0.99) *IOSDoubleArray_GetRef(errors_, 0) = *IOSDoubleArray_GetRef(errors_, 1) = area_ * 0.1;
  }
  jint fac = 0;
  if (![p0 isDefined]) fac++;
  if (![p1 isDefined]) fac++;
  if (![a0 isDefined]) fac++;
  if (![a1 isDefined]) fac++;
  if (fac == 4) *IOSDoubleArray_GetRef(errors_, 0) = *IOSDoubleArray_GetRef(errors_, 1) = 0;
  else if (fac > 2) {
    *IOSDoubleArray_GetRef(errors_, 0) *= 2.0;
    *IOSDoubleArray_GetRef(errors_, 1) *= 2.0;
  }
}

- (jdouble)getArea {
  return area_;
}

- (jdouble)getError {
  return JavaLangMath_maxWithDouble_withDouble_(IOSDoubleArray_Get(nil_chk(errors_), 0), IOSDoubleArray_Get(errors_, 1));
}

- (OrgGeogebraCommonKernelMatrixCoords *)getNormal {
  return normal_;
}

- (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)getOtherParentWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)p {
  return OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_getOtherParentWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_(self, p);
}

- (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem *)getTriangleWithInt:(jint)j {
  return IOSObjectArray_Get(nil_chk(triangles_), j);
}

- (OrgGeogebraCommonKernelMatrixCoords *)getVertexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *)o {
  if (alt_ == nil) return vertex_;
  if (((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(o))->vertex_ == nil) {
    jdouble c = (IOSDoubleArray_Get(nil_chk(o->params_), 0) - IOSDoubleArray_Get(params_, 0)) * IOSDoubleArray_Get(nil_chk(ancestorDiff_), 0) + (IOSDoubleArray_Get(o->params_, 1) - IOSDoubleArray_Get(params_, 1)) * IOSDoubleArray_Get(ancestorDiff_, 1);
    return c < 0 ? vertex_ : alt_;
  }
  if (o->alt_ != nil || [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(o->vertex_)) isDefined]) return [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(alt_)) isDefined] ? alt_ : vertex_;
  return [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(alt_)) isDefined] ? vertex_ : alt_;
}

- (jboolean)readyForMergeWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)activeParent {
  return ![((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_getOtherParentWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_(self, activeParent))) isSplit];
}

- (jboolean)recalculateWithInt:(jint)currentVersion
                   withBoolean:(jboolean)recurse {
  if (lastVersion_ == currentVersion) return NO;
  lastVersion_ = currentVersion;
  updateInDrawList_ = YES;
  [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk(IOSObjectArray_Get(nil_chk(parents_), 0))) recalculateWithInt:currentVersion withBoolean:NO];
  [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk(IOSObjectArray_Get(parents_, 1))) recalculateWithInt:currentVersion withBoolean:NO];
  [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(IOSObjectArray_Get(nil_chk(ancestors_), 0))) recalculateWithInt:currentVersion withBoolean:NO];
  [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(IOSObjectArray_Get(ancestors_, 1))) recalculateWithInt:currentVersion withBoolean:NO];
  [self calcMainVertexWithDouble:IOSDoubleArray_Get(nil_chk(params_), 0) withDouble:IOSDoubleArray_Get(params_, 1)];
  normal_ = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_approxNormalWithDouble_withDouble_(self, IOSDoubleArray_Get(params_, 0), IOSDoubleArray_Get(params_, 1));
  [self setBoundingBox];
  [self setArea];
  [self generateError];
  return YES;
}

- (void)reinsertInQueue {
  if (bucket_owner_ != nil) {
    OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ *list = bucket_owner_;
    [list removeWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:self];
    [list addWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:self];
  }
}

- (void)setArea {
  if (IOSDoubleArray_Get(nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(IOSObjectArray_Get(nil_chk(ancestors_), 0)))->params_), 0) - IOSDoubleArray_Get(params_, 0) != 0) area_ = JavaLangMath_absWithDouble_((IOSDoubleArray_Get(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(IOSObjectArray_Get(ancestors_, 0)))->params_, 0) - IOSDoubleArray_Get(params_, 0)) * (IOSDoubleArray_Get(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(IOSObjectArray_Get(nil_chk(parents_), 0), [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]))))->params_, 1) - IOSDoubleArray_Get(params_, 1)));
  else area_ = JavaLangMath_absWithDouble_((IOSDoubleArray_Get(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(IOSObjectArray_Get(nil_chk(parents_), 1), [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]))))->params_, 0) - IOSDoubleArray_Get(params_, 0)) * (IOSDoubleArray_Get(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(IOSObjectArray_Get(ancestors_, 0)))->params_, 1) - IOSDoubleArray_Get(params_, 1)));
}

- (void)setBoundingBox {
  OrgGeogebraCommonKernelMatrixCoords *v1 = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(IOSObjectArray_Get(nil_chk(ancestors_), 0))) getVertexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:self];
  OrgGeogebraCommonKernelMatrixCoords *v2 = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(IOSObjectArray_Get(ancestors_, 1))) getVertexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:self];
  OrgGeogebraCommonKernelMatrixCoords *v3 = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(IOSObjectArray_Get(nil_chk(parents_), 0), [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class])))) getVertexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:self];
  OrgGeogebraCommonKernelMatrixCoords *v4 = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(IOSObjectArray_Get(parents_, 1), [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class])))) getVertexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:self];
  OrgGeogebraCommonKernelMatrixCoords *v5 = vertex_;
  jdouble x0, x1, y0, y1, z0, z1, x, y, z;
  IOSDoubleArray *xs = [IOSDoubleArray newArrayWithDoubles:(jdouble[]){ [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(v2)) getX], [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(v3)) getX], [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(v4)) getX], [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(v5)) getX] } count:4];
  IOSDoubleArray *ys = [IOSDoubleArray newArrayWithDoubles:(jdouble[]){ [v2 getY], [v3 getY], [v4 getY], [v5 getY] } count:4];
  IOSDoubleArray *zs = [IOSDoubleArray newArrayWithDoubles:(jdouble[]){ [v2 getZ], [v3 getZ], [v4 getZ], [v5 getZ] } count:4];
  x0 = x1 = [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(v1)) getX];
  y0 = y1 = [v1 getY];
  z0 = z1 = [v1 getZ];
  for (jint i = 0; i < 4; i++) {
    x = IOSDoubleArray_Get(xs, i);
    y = IOSDoubleArray_Get(ys, i);
    z = IOSDoubleArray_Get(zs, i);
    if (JavaLangDouble_isNaNWithDouble_(x) || JavaLangDouble_isInfiniteWithDouble_(x)) {
      x0 = JavaLangDouble_NEGATIVE_INFINITY;
      x1 = JavaLangDouble_POSITIVE_INFINITY;
    }
    else {
      if (x0 > x) x0 = x;
      if (x1 < x) x1 = x;
    }
    if (JavaLangDouble_isNaNWithDouble_(y) || JavaLangDouble_isInfiniteWithDouble_(y)) {
      y0 = JavaLangDouble_NEGATIVE_INFINITY;
      y1 = JavaLangDouble_POSITIVE_INFINITY;
    }
    else {
      if (y0 > y) y0 = y;
      if (y1 < y) y1 = y;
    }
    if (JavaLangDouble_isNaNWithDouble_(z) || JavaLangDouble_isInfiniteWithDouble_(z)) {
      z0 = JavaLangDouble_NEGATIVE_INFINITY;
      z1 = JavaLangDouble_POSITIVE_INFINITY;
    }
    else {
      if (z0 > z) z0 = z;
      if (z1 < z) z1 = z;
    }
  }
  boundingBox_ = [IOSDoubleArray newArrayWithDoubles:(jdouble[]){ x0, x1, y0, y1, z0, z1 } count:6];
}

- (void)setChildWithInt:(jint)i
withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)e {
  (void) IOSObjectArray_Set(nil_chk(children_), i, e);
}

- (void)setHiddenWithBoolean:(jboolean)hide {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2 *t = (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2 *) check_class_cast(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMesh2 *) nil_chk(mesh_))->drawList_, [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2 class]);
  if (hide) {
    [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2 *) nil_chk(t)) hideWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:self withInt:0];
    [t hideWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:self withInt:1];
  }
  else {
    [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2 *) nil_chk(t)) showWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:self withInt:0];
    [t showWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:self withInt:1];
  }
}

- (void)setTriangleWithInt:(jint)j
withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem *)e {
  (void) IOSObjectArray_Set(nil_chk(triangles_), j, e);
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2:withInt:withDouble:withDouble:withBoolean:withInt:", "SurfaceDiamond2", NULL, 0x1, NULL, NULL },
    { "initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2:withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:withInt:withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:withInt:withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:withInt:withInt:", "SurfaceDiamond2", NULL, 0x0, NULL, NULL },
    { "init__", "init", "V", 0x2, NULL, NULL },
    { "approxNormalWithDouble:withDouble:", "approxNormal", "Lorg.geogebra.common.kernel.Matrix.Coords;", 0x2, NULL, NULL },
    { "calcMainVertexWithDouble:withDouble:", "calcMainVertex", "V", 0x0, NULL, NULL },
    { "calcVertexWithDouble:withDouble:", "calcVertex", "Lorg.geogebra.common.kernel.Matrix.Coords;", 0x2, NULL, NULL },
    { "childCreatedWithInt:", "childCreated", "Z", 0x1, NULL, NULL },
    { "createChildWithInt:", "createChild", "V", 0x4, NULL, NULL },
    { "cullChildren", NULL, "V", 0x4, NULL, NULL },
    { "freeTriangleWithInt:", "freeTriangle", "V", 0x1, NULL, NULL },
    { "generateError", NULL, "V", 0x0, NULL, NULL },
    { "getArea", NULL, "D", 0x1, NULL, NULL },
    { "getError", NULL, "D", 0x4, NULL, NULL },
    { "getNormal", NULL, "Lorg.geogebra.common.kernel.Matrix.Coords;", 0x1, NULL, NULL },
    { "getOtherParentWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:", "getOtherParent", "Lorg.geogebra.common.geogebra3D.euclidian3D.plots.DynamicMeshElement2;", 0x2, NULL, NULL },
    { "getTriangleWithInt:", "getTriangle", "Lorg.geogebra.common.geogebra3D.euclidian3D.plots.TriListElem;", 0x1, NULL, NULL },
    { "getVertexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:", "getVertex", "Lorg.geogebra.common.kernel.Matrix.Coords;", 0x1, NULL, NULL },
    { "readyForMergeWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:", "readyForMerge", "Z", 0x1, NULL, NULL },
    { "recalculateWithInt:withBoolean:", "recalculate", "Z", 0x1, NULL, NULL },
    { "reinsertInQueue", NULL, "V", 0x4, NULL, NULL },
    { "setArea", NULL, "V", 0x1, NULL, NULL },
    { "setBoundingBox", NULL, "V", 0x0, NULL, NULL },
    { "setChildWithInt:withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:", "setChild", "V", 0x0, NULL, NULL },
    { "setHiddenWithBoolean:", "setHidden", "V", 0x4, NULL, NULL },
    { "setTriangleWithInt:withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem:", "setTriangle", "V", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "errors_", NULL, 0x0, "[D", NULL, NULL,  },
    { "area_", NULL, 0x2, "D", NULL, NULL,  },
    { "triangles_", NULL, 0x2, "[Lorg.geogebra.common.geogebra3D.euclidian3D.plots.TriListElem;", NULL, NULL,  },
    { "params_", NULL, 0x0, "[D", NULL, NULL,  },
    { "vertex_", NULL, 0x0, "Lorg.geogebra.common.kernel.Matrix.Coords;", NULL, NULL,  },
    { "normal_", NULL, 0x2, "Lorg.geogebra.common.kernel.Matrix.Coords;", NULL, NULL,  },
    { "alt_", NULL, 0x0, "Lorg.geogebra.common.kernel.Matrix.Coords;", NULL, NULL,  },
    { "ancestorDiff_", NULL, 0x0, "[D", NULL, NULL,  },
    { "originalParams_", NULL, 0x0, "[D", NULL, NULL,  },
    { "ancestors_", NULL, 0x0, "[Lorg.geogebra.common.geogebra3D.euclidian3D.plots.SurfaceDiamond2;", NULL, NULL,  },
    { "indices_", NULL, 0x0, "[I", NULL, NULL,  },
  };
  static const J2ObjcClassInfo _OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 = { 2, "SurfaceDiamond2", "org.geogebra.common.geogebra3D.euclidian3D.plots", NULL, 0x0, 25, methods, 11, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2;
}

@end

void OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_withInt_withDouble_withDouble_withBoolean_withInt_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *self, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 *mesh, jint level, jdouble pa1, jdouble pa2, jboolean isClipped, jint version_) {
  (void) OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMesh2_withInt_withBoolean_withInt_(self, mesh, level, isClipped, version_);
  self->errors_ = [IOSDoubleArray newArrayWithLength:2];
  self->triangles_ = [IOSObjectArray newArrayWithLength:2 type:OrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem_class_()];
  self->params_ = [IOSDoubleArray newArrayWithLength:2];
  self->alt_ = nil;
  self->ancestors_ = [IOSObjectArray newArrayWithLength:2 type:OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_class_()];
  self->indices_ = [IOSIntArray newArrayWithLength:2];
  *IOSDoubleArray_GetRef(self->params_, 0) = pa1;
  *IOSDoubleArray_GetRef(self->params_, 1) = pa2;
  self->vertex_ = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_calcVertexWithDouble_withDouble_(self, pa1, pa2);
  self->normal_ = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_approxNormalWithDouble_withDouble_(self, pa1, pa2);
}

OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_withInt_withDouble_withDouble_withBoolean_withInt_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 *mesh, jint level, jdouble pa1, jdouble pa2, jboolean isClipped, jint version_) {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *self = [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 alloc];
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_withInt_withDouble_withDouble_withBoolean_withInt_(self, mesh, level, pa1, pa2, isClipped, version_);
  return self;
}

void OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withInt_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *self, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 *mesh, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *parent0, jint index0, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *parent1, jint index1, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *ancestor0, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *ancestor1, jint level, jint version_) {
  (void) OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMesh2_withInt_withBoolean_withInt_(self, mesh, level, ((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(ancestor0))->ignoreFlag_ || (((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(parent0))->ignoreFlag_ && ((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(parent1))->ignoreFlag_), version_);
  self->errors_ = [IOSDoubleArray newArrayWithLength:2];
  self->triangles_ = [IOSObjectArray newArrayWithLength:2 type:OrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem_class_()];
  self->params_ = [IOSDoubleArray newArrayWithLength:2];
  self->alt_ = nil;
  self->ancestors_ = [IOSObjectArray newArrayWithLength:2 type:OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_class_()];
  self->indices_ = [IOSIntArray newArrayWithLength:2];
  (void) IOSObjectArray_Set(nil_chk(self->parents_), 0, parent0);
  (void) IOSObjectArray_Set(self->parents_, 1, parent1);
  *IOSIntArray_GetRef(self->indices_, 0) = index0;
  *IOSIntArray_GetRef(self->indices_, 1) = index1;
  (void) IOSObjectArray_Set(self->ancestors_, 0, ancestor0);
  (void) IOSObjectArray_Set(self->ancestors_, 1, ancestor1);
  *IOSDoubleArray_GetRef(self->params_, 0) = (IOSDoubleArray_Get(ancestor0->params_, 0) + IOSDoubleArray_Get(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(ancestor1))->params_, 0)) * 0.5;
  *IOSDoubleArray_GetRef(self->params_, 1) = (IOSDoubleArray_Get(ancestor0->params_, 1) + IOSDoubleArray_Get(ancestor1->params_, 1)) * 0.5;
  [self calcMainVertexWithDouble:IOSDoubleArray_Get(self->params_, 0) withDouble:IOSDoubleArray_Get(self->params_, 1)];
  self->normal_ = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_approxNormalWithDouble_withDouble_(self, IOSDoubleArray_Get(self->params_, 0), IOSDoubleArray_Get(self->params_, 1));
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_init__(self);
}

OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withInt_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 *mesh, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *parent0, jint index0, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *parent1, jint index1, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *ancestor0, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *ancestor1, jint level, jint version_) {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *self = [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 alloc];
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withInt_(self, mesh, parent0, index0, parent1, index1, ancestor0, ancestor1, level, version_);
  return self;
}

void OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_init__(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *self) {
  [self setBoundingBox];
  [self setArea];
  [self generateError];
}

OrgGeogebraCommonKernelMatrixCoords *OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_approxNormalWithDouble_withDouble_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *self, jdouble u, jdouble v) {
  OrgGeogebraCommonKernelMatrixCoords *dx = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_calcVertexWithDouble_withDouble_(self, u + OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_normalDelta, v);
  OrgGeogebraCommonKernelMatrixCoords *dy = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_calcVertexWithDouble_withDouble_(self, u, v + OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_normalDelta);
  return [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk([((OrgGeogebraCommonKernelMatrixCoords *) nil_chk([((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(dx)) subWithOrgGeogebraCommonKernelMatrixCoords:self->vertex_])) crossProductWithOrgGeogebraCommonKernelMatrixCoords:[((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(dy)) subWithOrgGeogebraCommonKernelMatrixCoords:self->vertex_]])) normalized];
}

OrgGeogebraCommonKernelMatrixCoords *OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_calcVertexWithDouble_withDouble_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *self, jdouble u, jdouble v) {
  id<OrgGeogebraCommonKernelKernelNDSurfaceEvaluable> function = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 *) nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 *) check_class_cast(self->mesh_, [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 class])))) getFunction];
  OrgGeogebraCommonKernelMatrixCoords *f = [((id<OrgGeogebraCommonKernelKernelNDSurfaceEvaluable>) nil_chk(function)) evaluatePointWithDouble:u withDouble:v];
  jfloat d = 1e-6f;
  if (![((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(f)) isFinite] || ![f isDefined]) {
    f = [function evaluatePointWithDouble:u + d withDouble:v];
    if (![((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(f)) isFinite] || ![f isDefined]) {
      f = [function evaluatePointWithDouble:u withDouble:v + d];
      if (![((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(f)) isFinite] || ![f isDefined]) {
        f = [function evaluatePointWithDouble:u - d withDouble:v];
        if (![((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(f)) isFinite] || ![f isDefined]) f = [function evaluatePointWithDouble:u withDouble:v - d];
      }
    }
  }
  return f;
}

OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_getOtherParentWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *self, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *p) {
  if (p == IOSObjectArray_Get(nil_chk(self->parents_), 0)) return IOSObjectArray_Get(self->parents_, 1);
  return IOSObjectArray_Get(self->parents_, 0);
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2)

@implementation OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMergeBucketAssigner2

- (jint)getBucketIndexWithId:(id)o
                     withInt:(jint)bucketAmt {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *d = (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(o, [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]);
  jdouble e = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(d)) getError];
  jint f = J2ObjCFpToInt((JavaLangMath_expWithDouble_(1 - e) * 200));
  jint ret = f > bucketAmt - 1 ? bucketAmt - 1 : f;
  if (ret < 0) ret = 0;
  return ret;
}

- (instancetype)init {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMergeBucketAssigner2_init(self);
  return self;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "getBucketIndexWithId:withInt:", "getBucketIndex", "I", 0x1, NULL, NULL },
    { "init", NULL, NULL, 0x0, NULL, NULL },
  };
  static const J2ObjcClassInfo _OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMergeBucketAssigner2 = { 2, "SurfaceMergeBucketAssigner2", "org.geogebra.common.geogebra3D.euclidian3D.plots", NULL, 0x0, 2, methods, 0, NULL, 0, NULL, 0, NULL, NULL, "Ljava/lang/Object;Lorg/geogebra/common/geogebra3D/euclidian3D/plots/BucketAssigner<Lorg/geogebra/common/geogebra3D/euclidian3D/plots/DynamicMeshElement2;>;" };
  return &_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMergeBucketAssigner2;
}

@end

void OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMergeBucketAssigner2_init(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMergeBucketAssigner2 *self) {
  (void) NSObject_init(self);
}

OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMergeBucketAssigner2 *new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMergeBucketAssigner2_init() {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMergeBucketAssigner2 *self = [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMergeBucketAssigner2 alloc];
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMergeBucketAssigner2_init(self);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMergeBucketAssigner2)

@implementation OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2

- (instancetype)initWithOrgGeogebraCommonKernelKernelNDSurfaceEvaluable:(id<OrgGeogebraCommonKernelKernelNDSurfaceEvaluable>)function
                                                        withDoubleArray:(IOSDoubleArray *)cullingBox
                                                        withDoubleArray:(IOSDoubleArray *)domain {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_initWithOrgGeogebraCommonKernelKernelNDSurfaceEvaluable_withDoubleArray_withDoubleArray_(self, function, cullingBox, domain);
  return self;
}

- (NSString *)getDebugInfoWithLong:(jlong)time {
  return JreStrcat("@$J$I$F$F", function_, @":\tupdate time: ", time, @"ms\t triangles: ", [((id<OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshTriList2>) nil_chk(drawList_)) getTriAmt], @"\t max error: ", (jfloat) [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk([((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ *) nil_chk(splitQueue_)) peek])) getError], @"\t error threshold: ", (jfloat) desiredMaxError_);
}

- (jint)getVisibleChunks {
  return [((id<OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshTriList2>) nil_chk(drawList_)) getChunkAmt];
}

- (id<OrgGeogebraCommonKernelKernelNDSurfaceEvaluable>)getFunction {
  return function_;
}

- (void)initMeshWithDouble:(jdouble)xMin
                withDouble:(jdouble)xMax
                withDouble:(jdouble)yMin
                withDouble:(jdouble)yMax {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_initMeshWithDouble_withDouble_withDouble_withDouble_(self, xMin, xMax, yMin, yMax);
}

- (void)setCullingBoxWithDoubleArray:(IOSDoubleArray *)bb {
  self->cullingBox_ = bb;
  jdouble maxWidth, wx, wy, wz;
  wx = IOSDoubleArray_Get(nil_chk(bb), 1) - IOSDoubleArray_Get(bb, 0);
  wy = IOSDoubleArray_Get(bb, 5) - IOSDoubleArray_Get(bb, 4);
  wz = IOSDoubleArray_Get(bb, 3) - IOSDoubleArray_Get(bb, 2);
  maxWidth = wx > wy ? (wx > wz ? wx : wz) : (wy > wz ? wy : wz);
  if ([((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(((OrgGeogebraCommonKernelGeosGeoElement *) check_class_cast(function_, [OrgGeogebraCommonKernelGeosGeoElement class])))) hasLevelOfDetail]) [self setLevelOfDetailWithDouble:[((id<OrgGeogebraCommonKernelKernelNDSurfaceEvaluable>) nil_chk(function_)) getLevelOfDetail] == OrgGeogebraCommonKernelKernelNDSurfaceEvaluable_LevelOfDetailEnum_get_SPEED() ? 5 : 8];
  desiredMaxError_ = maxErrorCoeff_ * maxWidth;
  noUpdate_ = NO;
}

- (void)setLevelOfDetailWithDouble:(jdouble)l {
  if (l < 0) @throw new_JavaLangRuntimeException_init();
  levelOfDetail_ = l;
  maxErrorCoeff_ = 1 / (JavaLangMath_powWithDouble_withDouble_(10, 1.7 + l * 0.4));
}

- (jdouble)getLevelOfDetail {
  return levelOfDetail_;
}

- (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMesh2_SideEnum *)tooCoarse {
  if ([((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ *) nil_chk(splitQueue_)) peek] != nil && [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk([splitQueue_ peek])) getError] > desiredMaxError_) return OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMesh2_SideEnum_get_SPLIT();
  else if ([((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ *) nil_chk(mergeQueue_)) peek] != nil && [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk([mergeQueue_ peek])) getError] < desiredMaxError_) return OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMesh2_SideEnum_get_MERGE();
  return OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMesh2_SideEnum_get_NONE();
}

- (void)updateCullingInfo {
  [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(root_)) updateCullInfo];
  if ([root_ childCreatedWithInt:0]) [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk([root_ getChildWithInt:0])) updateCullInfo];
  if ([root_ childCreatedWithInt:1]) [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk([root_ getChildWithInt:1])) updateCullInfo];
  if ([root_ childCreatedWithInt:2]) [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk([root_ getChildWithInt:2])) updateCullInfo];
  if ([root_ childCreatedWithInt:3]) [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk([root_ getChildWithInt:3])) updateCullInfo];
}

- (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsOctree *)getObjectOctree {
  if (octree_ == nil) {
    octree_ = new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriangleOctree_init();
    jint n = [((id<OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshTriList2>) nil_chk(drawList_)) getTriAmt];
    OrgGeogebraCommonGeogebra3DEuclidian3DPlotsJavaNioFloatBuffer *buf = [drawList_ getTriangleBuffer];
    IOSFloatArray *temp = [IOSFloatArray newArrayWithLength:9];
    for (jint i = 0; i < n; i++) {
      (void) [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsJavaNioFloatBuffer *) nil_chk(buf)) getWithFloatArray:temp];
      @try {
        [octree_ insertTriangleWithFloatArray:temp];
      }
      @catch (JavaLangException *e) {
        [((JavaIoPrintStream *) nil_chk(JavaLangSystem_get_err_())) printlnWithId:e];
        return nil;
      }
    }
  }
  return octree_;
}

- (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsOctree *)getVisibleTriangleOctree {
  return [self getObjectOctree];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgGeogebraCommonKernelKernelNDSurfaceEvaluable:withDoubleArray:withDoubleArray:", "SurfaceMesh2", NULL, 0x1, NULL, NULL },
    { "getDebugInfoWithLong:", "getDebugInfo", "Ljava.lang.String;", 0x4, NULL, NULL },
    { "getVisibleChunks", NULL, "I", 0x1, NULL, NULL },
    { "getFunction", NULL, "Lorg.geogebra.common.kernel.kernelND.SurfaceEvaluable;", 0x1, NULL, NULL },
    { "initMeshWithDouble:withDouble:withDouble:withDouble:", "initMesh", "V", 0x2, NULL, NULL },
    { "setCullingBoxWithDoubleArray:", "setCullingBox", "V", 0x1, NULL, NULL },
    { "setLevelOfDetailWithDouble:", "setLevelOfDetail", "V", 0x1, NULL, NULL },
    { "getLevelOfDetail", NULL, "D", 0x1, NULL, NULL },
    { "tooCoarse", NULL, "Lorg.geogebra.common.geogebra3D.euclidian3D.plots.DynamicMesh2$Side;", 0x4, NULL, NULL },
    { "updateCullingInfo", NULL, "V", 0x4, NULL, NULL },
    { "getObjectOctree", NULL, "Lorg.geogebra.common.geogebra3D.euclidian3D.plots.Octree;", 0x1, NULL, NULL },
    { "getVisibleTriangleOctree", NULL, "Lorg.geogebra.common.geogebra3D.euclidian3D.plots.Octree;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "octree_", NULL, 0x2, "Lorg.geogebra.common.geogebra3D.euclidian3D.plots.Octree;", NULL, NULL,  },
    { "maxErrorCoeff_", NULL, 0x2, "D", NULL, NULL,  },
    { "normalDelta_", NULL, 0x19, "D", NULL, NULL, .constantValue.asDouble = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_normalDelta },
    { "undefErrorConst_", NULL, 0x19, "D", NULL, NULL, .constantValue.asDouble = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_undefErrorConst },
    { "levelOfDetail_", NULL, 0x1, "D", NULL, NULL,  },
    { "maxLevel_", NULL, 0x1a, "I", NULL, NULL, .constantValue.asInt = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_maxLevel },
    { "function_", NULL, 0x2, "Lorg.geogebra.common.kernel.kernelND.SurfaceEvaluable;", NULL, NULL,  },
    { "root_", NULL, 0x2, "Lorg.geogebra.common.geogebra3D.euclidian3D.plots.SurfaceDiamond2;", NULL, NULL,  },
    { "desiredMaxError_", NULL, 0x2, "D", NULL, NULL,  },
  };
  static const J2ObjcClassInfo _OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 = { 2, "SurfaceMesh2", "org.geogebra.common.geogebra3D.euclidian3D.plots", NULL, 0x1, 12, methods, 9, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2;
}

@end

void OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_initWithOrgGeogebraCommonKernelKernelNDSurfaceEvaluable_withDoubleArray_withDoubleArray_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 *self, id<OrgGeogebraCommonKernelKernelNDSurfaceEvaluable> function, IOSDoubleArray *cullingBox, IOSDoubleArray *domain) {
  (void) OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMesh2_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshTriList2_withInt_withInt_withInt_(self, new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner_withBoolean_(new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceSplitBucketAssigner2_init(), YES), new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsBucketAssigner_withBoolean_(new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceSplitBucketAssigner2_init(), NO), new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_initWithInt_withInt_(100, 0), 2, 4, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_maxLevel);
  self->maxErrorCoeff_ = 1e-2;
  self->levelOfDetail_ = 0.1;
  self->function_ = function;
  [self setLevelOfDetailWithDouble:5];
  [self setCullingBoxWithDoubleArray:cullingBox];
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_initMeshWithDouble_withDouble_withDouble_withDouble_(self, IOSDoubleArray_Get(nil_chk(domain), 0), IOSDoubleArray_Get(domain, 1), IOSDoubleArray_Get(domain, 2), IOSDoubleArray_Get(domain, 3));
  [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsFastBucketPQ *) nil_chk(self->splitQueue_)) addWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:self->root_];
  [((id<OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshTriList2>) nil_chk(self->drawList_)) addWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:self->root_];
  for (jint i = 0; i < 100; i++) [self splitWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:[self->splitQueue_ forcePoll]];
}

OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 *new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_initWithOrgGeogebraCommonKernelKernelNDSurfaceEvaluable_withDoubleArray_withDoubleArray_(id<OrgGeogebraCommonKernelKernelNDSurfaceEvaluable> function, IOSDoubleArray *cullingBox, IOSDoubleArray *domain) {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 *self = [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 alloc];
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_initWithOrgGeogebraCommonKernelKernelNDSurfaceEvaluable_withDoubleArray_withDoubleArray_(self, function, cullingBox, domain);
  return self;
}

void OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_initMeshWithDouble_withDouble_withDouble_withDouble_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2 *self, jdouble xMin, jdouble xMax, jdouble yMin, jdouble yMax) {
  jint di, ix, jx;
  jdouble x, y;
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *t;
  IOSObjectArray *base0 = [IOSObjectArray newArrayWithDimensions:2 lengths:(jint[]){ 4, 4 } type:OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_class_()];
  IOSObjectArray *base1 = [IOSObjectArray newArrayWithDimensions:2 lengths:(jint[]){ 4, 4 } type:OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_class_()];
  jdouble dx = (xMax - xMin);
  jdouble dy = (yMax - yMin);
  for (jint i = 0; i < 4; i++) for (jint j = 0; j < 4; j++) {
    x = xMin + (i - 0.5) * dx;
    y = yMin + (j - 0.5) * dy;
    (void) IOSObjectArray_Set(nil_chk(IOSObjectArray_Get(base0, j)), i, new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_withInt_withDouble_withDouble_withBoolean_withInt_(self, 0, x, y, !(i == 1 && j == 1), self->currentVersion_));
    x = xMin + (i - 1) * dx;
    y = yMin + (j - 1) * dy;
    (void) IOSObjectArray_Set(nil_chk(IOSObjectArray_Get(base1, j)), i, t = new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_initWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2_withInt_withDouble_withDouble_withBoolean_withInt_(self, ((i ^ j) & 1) != 0 ? -1 : -2, x, y, NO, self->currentVersion_));
    [t setSplitWithBoolean:YES];
  }
  for (jint i = 0; i < 4; i++) for (jint j = 0; j < 4; j++) {
    t = IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(base0, j)), i);
    di = ((i ^ j) & 1) != 0 ? 1 : -1;
    ix = (RShift32((2 * i + 1 - di), 1)) % 4;
    jx = (RShift32(2 * j, 1)) % 4;
    (void) IOSObjectArray_Set(nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(t))->parents_), 0, IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(base1, jx)), ix));
    ix = (RShift32((2 * i + 1 + di), 1)) % 4;
    jx = (RShift32(2 * (j + 1), 1)) % 4;
    (void) IOSObjectArray_Set(t->parents_, 1, IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(base1, jx)), ix));
    ix = (RShift32(2 * i, 1)) % 4;
    jx = (RShift32((2 * j + 1 + di), 1)) % 4;
    (void) IOSObjectArray_Set(nil_chk(t->ancestors_), 0, IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(base1, jx)), ix));
    ix = (RShift32((2 * (i + 1)), 1)) % 4;
    jx = (RShift32((2 * j + 1 - di), 1)) % 4;
    (void) IOSObjectArray_Set(t->ancestors_, 1, IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(base1, jx)), ix));
    ix = (di < 0 ? 0 : 3);
    [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(IOSObjectArray_Get(t->parents_, 0), [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class])))) setChildWithInt:ix withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:t];
    *IOSIntArray_GetRef(nil_chk(t->indices_), 0) = ix;
    ix = (di < 0 ? 2 : 1);
    [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(IOSObjectArray_Get(t->parents_, 1), [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class])))) setChildWithInt:ix withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:t];
    *IOSIntArray_GetRef(t->indices_, 1) = ix;
  }
  for (jint i = 0; i < 4; i++) for (jint j = 0; j < 4; j++) {
    t = IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(base1, j)), i);
    (void) IOSObjectArray_Set(nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(t))->ancestors_), 1, IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(base1, (j + 3) % 4)), i));
    (void) IOSObjectArray_Set(t->ancestors_, 0, IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(base1, (j + 1) % 4)), i));
    (void) IOSObjectArray_Set(nil_chk(t->parents_), 0, IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(base1, j)), (i + 3) % 4));
    (void) IOSObjectArray_Set(t->parents_, 1, IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(base1, j)), (i + 1) % 4));
  }
  self->root_ = IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(base0, 1)), 1);
  [self->root_ calcMainVertexWithDouble:IOSDoubleArray_Get(nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(self->root_))->params_), 0) withDouble:IOSDoubleArray_Get(self->root_->params_, 1)];
  [self->root_ setBoundingBox];
  [self->root_ setArea];
  [self->root_ generateError];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceMesh2)

@implementation OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceSplitBucketAssigner2

- (jint)getBucketIndexWithId:(id)o
                     withInt:(jint)bucketAmt {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *d = (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(o, [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]);
  jint bucket;
  jdouble e = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(d)) getError];
  jint f = J2ObjCFpToInt((JavaLangMath_expWithDouble_(e + 1) * 200)) + 3;
  jint alt = J2ObjCFpToInt((JavaLangMath_logWithDouble_(1 + JavaLangMath_logWithDouble_(1 + JavaLangMath_logWithDouble_(1 + 10000 * e))) * 1000));
  f = alt;
  if (e == 0.0) bucket = 1;
  bucket = f > bucketAmt - 1 || f < 0 ? bucketAmt - 1 : f;
  return bucket;
}

- (instancetype)init {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceSplitBucketAssigner2_init(self);
  return self;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "getBucketIndexWithId:withInt:", "getBucketIndex", "I", 0x1, NULL, NULL },
    { "init", NULL, NULL, 0x0, NULL, NULL },
  };
  static const J2ObjcClassInfo _OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceSplitBucketAssigner2 = { 2, "SurfaceSplitBucketAssigner2", "org.geogebra.common.geogebra3D.euclidian3D.plots", NULL, 0x0, 2, methods, 0, NULL, 0, NULL, 0, NULL, NULL, "Ljava/lang/Object;Lorg/geogebra/common/geogebra3D/euclidian3D/plots/BucketAssigner<Lorg/geogebra/common/geogebra3D/euclidian3D/plots/DynamicMeshElement2;>;" };
  return &_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceSplitBucketAssigner2;
}

@end

void OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceSplitBucketAssigner2_init(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceSplitBucketAssigner2 *self) {
  (void) NSObject_init(self);
}

OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceSplitBucketAssigner2 *new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceSplitBucketAssigner2_init() {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceSplitBucketAssigner2 *self = [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceSplitBucketAssigner2 alloc];
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceSplitBucketAssigner2_init(self);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceSplitBucketAssigner2)

@implementation OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2

- (instancetype)initWithInt:(jint)capacity
                    withInt:(jint)marigin {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_initWithInt_withInt_(self, capacity, marigin);
  return self;
}

- (void)addWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)e {
  [self addWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:e withInt:0];
  [self addWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:e withInt:1];
}

- (void)addWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)e
                                                                      withInt:(jint)j {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *s = (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(e, [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]);
  if (((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(s))->ignoreFlag_ || ((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(IOSObjectArray_Get(nil_chk(s->parents_), j), [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]))))->ignoreFlag_) return;
  IOSFloatArray *v = [IOSFloatArray newArrayWithLength:9];
  IOSFloatArray *n = [IOSFloatArray newArrayWithLength:9];
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_calcFloatsWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withFloatArray_withFloatArray_(self, s, j, v, n);
  jchar flags = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_getFlagsWithFloatArray_withFloatArray_(self, v, n);
  jboolean ignore = (flags & OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_MASK_IGNORE) != 0;
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem *lm = ignore ? new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem_initWithChar_(flags) : [self addWithFloatArray:v withFloatArray:n];
  [lm setOwnerWithId:s];
  [s setTriangleWithInt:j withOrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem:lm];
  if (!ignore && ((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk(e))->cullInfo_ == OrgGeogebraCommonGeogebra3DEuclidian3DPlotsCullInfo2Enum_get_OUT()) {
    [self hideWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:s withInt:j];
  }
}

- (jchar)getFlagsWithFloatArray:(IOSFloatArray *)v
                 withFloatArray:(IOSFloatArray *)n {
  return OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_getFlagsWithFloatArray_withFloatArray_(self, v, n);
}

- (void)calcFloatsWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *)d
                                                                         withInt:(jint)j
                                                                  withFloatArray:(IOSFloatArray *)v
                                                                  withFloatArray:(IOSFloatArray *)n {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_calcFloatsWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withFloatArray_withFloatArray_(self, d, j, v, n);
}

- (jboolean)hideWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)t {
  @throw new_JavaLangUnsupportedOperationException_init();
}

- (jboolean)hideWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *)d
                                                                       withInt:(jint)j {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem *t = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(d)) getTriangleWithInt:j];
  return (t != nil && (t->flags_ & OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_MASK_IGNORE) != 0) || [self hideWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem:t];
}

- (jboolean)showWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)t {
  @throw new_JavaLangUnsupportedOperationException_init();
}

- (jboolean)showWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)e
                                                                           withInt:(jint)j {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *d = (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(e, [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]);
  [self reinsertWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:d withInt:currentVersion_];
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem *t = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(d)) getTriangleWithInt:j];
  return (t != nil && (t->flags_ & OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_MASK_IGNORE) != 0) || [self showWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem:t];
}

- (void)reinsertWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)a
                                                                           withInt:(jint)version_ {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *s = (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(a, [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]);
  [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(s)) recalculateWithInt:version_ withBoolean:YES];
  if (s->updateInDrawList_) {
    s->updateInDrawList_ = NO;
    OrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem *e0 = [s getTriangleWithInt:0];
    OrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem *e1 = [s getTriangleWithInt:1];
    if (e0 != nil) {
      IOSFloatArray *v0 = [IOSFloatArray newArrayWithLength:9];
      IOSFloatArray *n0 = [IOSFloatArray newArrayWithLength:9];
      OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_calcFloatsWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withFloatArray_withFloatArray_(self, s, 0, v0, n0);
      jchar flags = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_getFlagsWithFloatArray_withFloatArray_(self, v0, n0);
      if ([e0 getIndex] != -1) {
        [self setVerticesWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem:e0 withFloatArray:v0];
        [self setNormalsWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem:e0 withFloatArray:n0];
      }
      else {
        [e0 pushVerticesWithFloatArray:v0];
        [e0 pushNormalsWithFloatArray:n0];
      }
    }
    if (e1 != nil) {
      IOSFloatArray *v1 = [IOSFloatArray newArrayWithLength:9];
      IOSFloatArray *n1 = [IOSFloatArray newArrayWithLength:9];
      OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_calcFloatsWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withFloatArray_withFloatArray_(self, s, 1, v1, n1);
      jchar flags = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_getFlagsWithFloatArray_withFloatArray_(self, v1, n1);
      if ([e1 getIndex] != -1) {
        [self setVerticesWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem:e1 withFloatArray:v1];
        [self setNormalsWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem:e1 withFloatArray:n1];
      }
      else {
        [e1 pushVerticesWithFloatArray:v1];
        [e1 pushNormalsWithFloatArray:n1];
      }
    }
    [s reinsertInQueue];
  }
}

- (jboolean)removeWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)e {
  jboolean b = NO;
  b |= [self removeWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:e withInt:0];
  b |= [self removeWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:e withInt:1];
  return b;
}

- (jboolean)removeWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *)e
                                                                             withInt:(jint)j {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *d = (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(e, [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]);
  if (((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(d))->ignoreFlag_ || ((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast(IOSObjectArray_Get(nil_chk(d->parents_), j), [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]))))->ignoreFlag_) return NO;
  jboolean ret = [self hideWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:d withInt:j];
  [d freeTriangleWithInt:j];
  return ret;
}

- (void)recalculateWithInt:(jint)version_ {
  self->currentVersion_ = version_;
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem *e = front_;
  JavaUtilLinkedList *list = new_JavaUtilLinkedList_init();
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *el;
  while (e != nil) {
    el = (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) check_class_cast([((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriListElem *) nil_chk(e)) getOwner], [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 class]);
    if (((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *) nil_chk(el))->lastVersion_ != currentVersion_) [list addWithId:el];
    e = [e getNext];
  }
  id<JavaUtilIterator> it = [list iterator];
  while ([((id<JavaUtilIterator>) nil_chk(it)) hasNext]) {
    OrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2 *elem = [it next];
    [self reinsertWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:elem withInt:currentVersion_];
  }
}

- (NSUInteger)countByEnumeratingWithState:(NSFastEnumerationState *)state objects:(__unsafe_unretained id *)stackbuf count:(NSUInteger)len {
  return JreDefaultFastEnumeration(self, state, stackbuf, len);
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithInt:withInt:", "SurfaceTriList2", NULL, 0x0, NULL, NULL },
    { "addWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:", "add", "V", 0x1, NULL, NULL },
    { "addWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:withInt:", "add", "V", 0x1, NULL, NULL },
    { "getFlagsWithFloatArray:withFloatArray:", "getFlags", "C", 0x2, NULL, NULL },
    { "calcFloatsWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:withInt:withFloatArray:withFloatArray:", "calcFloats", "V", 0x2, NULL, NULL },
    { "hideWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:", "hide", "Z", 0x1, NULL, NULL },
    { "hideWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:withInt:", "hide", "Z", 0x1, NULL, NULL },
    { "showWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:", "show", "Z", 0x1, NULL, NULL },
    { "showWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:withInt:", "show", "Z", 0x1, NULL, NULL },
    { "reinsertWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:withInt:", "reinsert", "V", 0x1, NULL, NULL },
    { "removeWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:", "remove", "Z", 0x1, NULL, NULL },
    { "removeWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsDynamicMeshElement2:withInt:", "remove", "Z", 0x1, NULL, NULL },
    { "recalculateWithInt:", "recalculate", "V", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "currentVersion_", NULL, 0x2, "I", NULL, NULL,  },
    { "asymptoteThreshold_", NULL, 0x1a, "D", NULL, NULL, .constantValue.asDouble = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_asymptoteThreshold },
    { "FLAGS_SINGULAR_", NULL, 0x18, "C", NULL, NULL, .constantValue.asUnichar = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_FLAGS_SINGULAR },
    { "FLAGS_ASYMPTOTE_", NULL, 0x18, "C", NULL, NULL, .constantValue.asUnichar = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_FLAGS_ASYMPTOTE },
    { "MASK_IGNORE_", NULL, 0x18, "C", NULL, NULL, .constantValue.asUnichar = OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_MASK_IGNORE },
  };
  static const J2ObjcClassInfo _OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2 = { 2, "SurfaceTriList2", "org.geogebra.common.geogebra3D.euclidian3D.plots", NULL, 0x0, 13, methods, 5, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2;
}

@end

void OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_initWithInt_withInt_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2 *self, jint capacity, jint marigin) {
  (void) OrgGeogebraCommonGeogebra3DEuclidian3DPlotsTriList_initWithInt_withInt_withInt_withBoolean_(self, capacity, marigin, 9, YES);
}

OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2 *new_OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_initWithInt_withInt_(jint capacity, jint marigin) {
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2 *self = [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2 alloc];
  OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_initWithInt_withInt_(self, capacity, marigin);
  return self;
}

jchar OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_getFlagsWithFloatArray_withFloatArray_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2 *self, IOSFloatArray *v, IOSFloatArray *n) {
  jchar ret = 0;
  if (JavaLangDouble_isNaNWithDouble_(IOSFloatArray_Get(nil_chk(v), 0)) || JavaLangDouble_isInfiniteWithDouble_(IOSFloatArray_Get(v, 0)) || JavaLangDouble_isNaNWithDouble_(IOSFloatArray_Get(v, 1)) || JavaLangDouble_isInfiniteWithDouble_(IOSFloatArray_Get(v, 1)) || JavaLangDouble_isNaNWithDouble_(IOSFloatArray_Get(v, 2)) || JavaLangDouble_isInfiniteWithDouble_(IOSFloatArray_Get(v, 2)) || JavaLangDouble_isNaNWithDouble_(IOSFloatArray_Get(v, 3)) || JavaLangDouble_isInfiniteWithDouble_(IOSFloatArray_Get(v, 3)) || JavaLangDouble_isNaNWithDouble_(IOSFloatArray_Get(v, 4)) || JavaLangDouble_isInfiniteWithDouble_(IOSFloatArray_Get(v, 4)) || JavaLangDouble_isNaNWithDouble_(IOSFloatArray_Get(v, 5)) || JavaLangDouble_isInfiniteWithDouble_(IOSFloatArray_Get(v, 5)) || JavaLangDouble_isNaNWithDouble_(IOSFloatArray_Get(v, 6)) || JavaLangDouble_isInfiniteWithDouble_(IOSFloatArray_Get(v, 6)) || JavaLangDouble_isNaNWithDouble_(IOSFloatArray_Get(v, 7)) || JavaLangDouble_isInfiniteWithDouble_(IOSFloatArray_Get(v, 7)) || JavaLangDouble_isNaNWithDouble_(IOSFloatArray_Get(v, 8)) || JavaLangDouble_isInfiniteWithDouble_(IOSFloatArray_Get(v, 8))) {
    ret |= OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_FLAGS_SINGULAR;
  }
  jdouble x1 = IOSFloatArray_Get(v, 3) - IOSFloatArray_Get(v, 0);
  jdouble y1 = IOSFloatArray_Get(v, 4) - IOSFloatArray_Get(v, 1);
  jdouble z1 = IOSFloatArray_Get(v, 5) - IOSFloatArray_Get(v, 2);
  jdouble x2 = IOSFloatArray_Get(v, 6) - IOSFloatArray_Get(v, 0);
  jdouble y2 = IOSFloatArray_Get(v, 7) - IOSFloatArray_Get(v, 1);
  jdouble z2 = IOSFloatArray_Get(v, 8) - IOSFloatArray_Get(v, 2);
  jdouble nx = y1 * z2 - y2 * z1;
  jdouble ny = x2 * z1 - x1 * z2;
  jdouble nz = x1 * y2 - x2 * y1;
  if (nx * IOSFloatArray_Get(nil_chk(n), 0) + ny * IOSFloatArray_Get(n, 1) + nz * IOSFloatArray_Get(n, 2) < OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_asymptoteThreshold) {
    ret |= OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_FLAGS_ASYMPTOTE;
  }
  return ret;
}

void OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2_calcFloatsWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_withInt_withFloatArray_withFloatArray_(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2 *self, OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *d, jint j, IOSFloatArray *v, IOSFloatArray *n) {
  IOSObjectArray *t = [IOSObjectArray newArrayWithLength:3 type:OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2_class_()];
  (void) IOSObjectArray_Set(t, 1, (OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) check_class_cast([((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(d)) getParentWithInt:j], [OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 class]));
  if (j == 0) {
    (void) IOSObjectArray_Set(t, 0, IOSObjectArray_Get(nil_chk(d->ancestors_), 0));
    (void) IOSObjectArray_Set(t, 2, IOSObjectArray_Get(d->ancestors_, 1));
  }
  else {
    (void) IOSObjectArray_Set(t, 0, IOSObjectArray_Get(nil_chk(d->ancestors_), 1));
    (void) IOSObjectArray_Set(t, 2, IOSObjectArray_Get(d->ancestors_, 0));
  }
  for (jint i = 0, c = 0; i < 3; i++, c += 3) {
    OrgGeogebraCommonKernelMatrixCoords *vertex = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(IOSObjectArray_Get(t, i))) getVertexWithOrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2:d];
    OrgGeogebraCommonKernelMatrixCoords *normal = [((OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceDiamond2 *) nil_chk(IOSObjectArray_Get(t, i))) getNormal];
    *IOSFloatArray_GetRef(nil_chk(v), c) = (jfloat) [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(vertex)) getX];
    *IOSFloatArray_GetRef(v, c + 1) = (jfloat) [vertex getY];
    *IOSFloatArray_GetRef(v, c + 2) = (jfloat) [vertex getZ];
    *IOSFloatArray_GetRef(nil_chk(n), c) = (jfloat) [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(normal)) getX];
    *IOSFloatArray_GetRef(n, c + 1) = (jfloat) [normal getY];
    *IOSFloatArray_GetRef(n, c + 2) = (jfloat) [normal getZ];
    if (JavaLangDouble_isNaNWithDouble_(IOSFloatArray_Get(n, c)) || JavaLangDouble_isNaNWithDouble_(IOSFloatArray_Get(n, c + 1)) || JavaLangDouble_isNaNWithDouble_(IOSFloatArray_Get(n, c + 2))) {
      *IOSFloatArray_GetRef(n, c) = *IOSFloatArray_GetRef(n, c + 1) = 0;
      *IOSFloatArray_GetRef(n, c + 2) = 1;
    }
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgGeogebraCommonGeogebra3DEuclidian3DPlotsSurfaceTriList2)
