//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/GeoGebraiOSARC/GeoGebraiOSARC/javasources/org/geogebra/common/gui/view/spreadsheet/RelativeCopy.java
//


#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "com/google/gwt/regexp/shared/MatchResult.h"
#include "com/google/gwt/regexp/shared/RegExp.h"
#include "java/lang/Character.h"
#include "java/lang/Exception.h"
#include "java/lang/RuntimeException.h"
#include "java/lang/StringBuilder.h"
#include "java/lang/Throwable.h"
#include "java/util/ArrayList.h"
#include "java/util/Iterator.h"
#include "java/util/TreeSet.h"
#include "org/geogebra/common/awt/GPoint.h"
#include "org/geogebra/common/gui/view/spreadsheet/CellRange.h"
#include "org/geogebra/common/gui/view/spreadsheet/RelativeCopy.h"
#include "org/geogebra/common/kernel/CircularDefinitionException.h"
#include "org/geogebra/common/kernel/Construction.h"
#include "org/geogebra/common/kernel/Kernel.h"
#include "org/geogebra/common/kernel/Locateable.h"
#include "org/geogebra/common/kernel/StringTemplate.h"
#include "org/geogebra/common/kernel/algos/AlgoElement.h"
#include "org/geogebra/common/kernel/arithmetic/ExpressionValue.h"
#include "org/geogebra/common/kernel/arithmetic/Traversing.h"
#include "org/geogebra/common/kernel/arithmetic/ValidExpression.h"
#include "org/geogebra/common/kernel/commands/AlgebraProcessor.h"
#include "org/geogebra/common/kernel/geos/GeoBoolean.h"
#include "org/geogebra/common/kernel/geos/GeoElement.h"
#include "org/geogebra/common/kernel/geos/GeoElementSpreadsheet.h"
#include "org/geogebra/common/kernel/geos/GeoFunction.h"
#include "org/geogebra/common/kernel/geos/GeoImage.h"
#include "org/geogebra/common/kernel/geos/GeoList.h"
#include "org/geogebra/common/kernel/geos/GeoText.h"
#include "org/geogebra/common/kernel/kernelND/GeoPointND.h"
#include "org/geogebra/common/kernel/parser/Parser.h"
#include "org/geogebra/common/main/App.h"
#include "org/geogebra/common/main/SpreadsheetTableModel.h"
#include "org/geogebra/common/main/settings/Settings.h"
#include "org/geogebra/common/main/settings/SpreadsheetSettings.h"
#include "org/geogebra/common/plugin/GeoClass.h"
#include "org/geogebra/common/util/StringUtil.h"
#include "org/geogebra/common/util/Unicode.h"

@interface OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy ()

+ (jboolean)isPatternSourceWithOrgGeogebraCommonGuiViewSpreadsheetCellRange:(OrgGeogebraCommonGuiViewSpreadsheetCellRange *)cellRange;

+ (void)updateCellReferencesWithOrgGeogebraCommonKernelArithmeticValidExpression:(OrgGeogebraCommonKernelArithmeticValidExpression *)exp
                                                                         withInt:(jint)dx
                                                                         withInt:(jint)dy;

+ (OrgGeogebraCommonKernelGeosGeoElement *)prepareNewValueWithOrgGeogebraCommonKernelKernel:(OrgGeogebraCommonKernelKernel *)kernel
                                                                               withNSString:(NSString *)name
                                                                               withNSString:(NSString *)inputText;

+ (OrgGeogebraCommonKernelGeosGeoElement *)updateOldValueWithOrgGeogebraCommonKernelKernel:(OrgGeogebraCommonKernelKernel *)kernel
                                                 withOrgGeogebraCommonKernelGeosGeoElement:(OrgGeogebraCommonKernelGeosGeoElement *)oldValue
                                                                              withNSString:(NSString *)name
                                                                              withNSString:(NSString *)text;

+ (jboolean)isStandardNumberWithNSString:(NSString *)s;

@end

__attribute__((unused)) static jboolean OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_isPatternSourceWithOrgGeogebraCommonGuiViewSpreadsheetCellRange_(OrgGeogebraCommonGuiViewSpreadsheetCellRange *cellRange);

__attribute__((unused)) static void OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_updateCellReferencesWithOrgGeogebraCommonKernelArithmeticValidExpression_withInt_withInt_(OrgGeogebraCommonKernelArithmeticValidExpression *exp, jint dx, jint dy);

__attribute__((unused)) static OrgGeogebraCommonKernelGeosGeoElement *OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_prepareNewValueWithOrgGeogebraCommonKernelKernel_withNSString_withNSString_(OrgGeogebraCommonKernelKernel *kernel, NSString *name, NSString *inputText);

__attribute__((unused)) static OrgGeogebraCommonKernelGeosGeoElement *OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_updateOldValueWithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonKernelGeosGeoElement_withNSString_withNSString_(OrgGeogebraCommonKernelKernel *kernel, OrgGeogebraCommonKernelGeosGeoElement *oldValue, NSString *name, NSString *text);

__attribute__((unused)) static jboolean OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_isStandardNumberWithNSString_(NSString *s);

J2OBJC_INITIALIZED_DEFN(OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy)

ComGoogleGwtRegexpSharedRegExp *OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_pattern2_;

@implementation OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy

- (instancetype)initWithOrgGeogebraCommonKernelKernel:(OrgGeogebraCommonKernelKernel *)kernel0 {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initWithOrgGeogebraCommonKernelKernel_(self, kernel0);
  return self;
}

- (jboolean)doDragCopyWithInt:(jint)sx1
                      withInt:(jint)sy1
                      withInt:(jint)sx2
                      withInt:(jint)sy2
                      withInt:(jint)dx1
                      withInt:(jint)dy1
                      withInt:(jint)dx2
                      withInt:(jint)dy2 {
  [((OrgGeogebraCommonMainApp *) nil_chk(app_)) setWaitCursor];
  OrgGeogebraCommonKernelConstruction *cons = [((OrgGeogebraCommonKernelKernel *) nil_chk(kernel_)) getConstruction];
  @try {
    jboolean success = NO;
    [((OrgGeogebraCommonKernelConstruction *) nil_chk(cons)) startCollectingRedefineCalls];
    jboolean patternOK = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_isPatternSourceWithOrgGeogebraCommonGuiViewSpreadsheetCellRange_(new_OrgGeogebraCommonGuiViewSpreadsheetCellRange_initWithOrgGeogebraCommonMainApp_withInt_withInt_withInt_withInt_(app_, sx1, sy1, sx2, sy2));
    if ((sx1 == dx1) && (sx2 == dx2)) {
      if (dy2 < sy1) {
        if (((sy1 + 1) == sy2) && patternOK) {
          for (jint x = sx1; x <= sx2; ++x) {
            OrgGeogebraCommonKernelGeosGeoElement *v1 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, x, sy1);
            OrgGeogebraCommonKernelGeosGeoElement *v2 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, x, sy2);
            if ((v1 == nil) || (v2 == nil)) {
              continue;
            }
            for (jint y = dy2; y >= dy1; --y) {
              OrgGeogebraCommonKernelGeosGeoElement *vOld = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, x, y);
              if (vOld != nil && [vOld isFixed]) {
                break;
              }
              OrgGeogebraCommonKernelGeosGeoElement *v3 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, x, y + 2);
              OrgGeogebraCommonKernelGeosGeoElement *v4 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, x, y + 1);
              NSString *vs1 = [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(v3)) isGeoFunction] ? @"(x)" : @"";
              NSString *vs2 = [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(v4)) isGeoFunction] ? @"(x)" : @"";
              NSString *d0 = JreStrcat("$$", OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_getSpreadsheetCellNameWithInt_withInt_(x, y + 2), vs1);
              NSString *d1 = JreStrcat("$$", OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_getSpreadsheetCellNameWithInt_withInt_(x, y + 1), vs2);
              NSString *text = JreStrcat("$$C$", @"=2*", d1, '-', d0);
              OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_doCopyNoStoringUndoInfo1WithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonMainApp_withNSString_withOrgGeogebraCommonKernelGeosGeoElement_withInt_withInt_(kernel_, app_, text, v4, x, y);
            }
          }
        }
        else {
          [self doCopyVerticalNoStoringUndoInfo1WithInt:sx1 withInt:sx2 withInt:sy1 withInt:dy1 withInt:dy2];
        }
        success = YES;
      }
      else if (dy1 > sy2) {
        if (((sy1 + 1) == sy2) && patternOK) {
          for (jint x = sx1; x <= sx2; ++x) {
            OrgGeogebraCommonKernelGeosGeoElement *v1 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, x, sy1);
            OrgGeogebraCommonKernelGeosGeoElement *v2 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, x, sy2);
            if ((v1 == nil) || (v2 == nil)) {
              continue;
            }
            for (jint y = dy1; y <= dy2; ++y) {
              OrgGeogebraCommonKernelGeosGeoElement *vOld = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, x, y);
              if (vOld != nil && [vOld isFixed]) {
                break;
              }
              OrgGeogebraCommonKernelGeosGeoElement *v3 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, x, y - 2);
              OrgGeogebraCommonKernelGeosGeoElement *v4 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, x, y - 1);
              NSString *vs1 = [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(v3)) isGeoFunction] ? @"(x)" : @"";
              NSString *vs2 = [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(v4)) isGeoFunction] ? @"(x)" : @"";
              NSString *d0 = JreStrcat("$$", OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_getSpreadsheetCellNameWithInt_withInt_(x, y - 2), vs1);
              NSString *d1 = JreStrcat("$$", OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_getSpreadsheetCellNameWithInt_withInt_(x, y - 1), vs2);
              NSString *text = JreStrcat("$$C$", @"=2*", d1, '-', d0);
              OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_doCopyNoStoringUndoInfo1WithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonMainApp_withNSString_withOrgGeogebraCommonKernelGeosGeoElement_withInt_withInt_(kernel_, app_, text, v4, x, y);
            }
          }
        }
        else {
          [self doCopyVerticalNoStoringUndoInfo1WithInt:sx1 withInt:sx2 withInt:sy2 withInt:dy1 withInt:dy2];
        }
        success = YES;
      }
    }
    else if ((sy1 == dy1) && (sy2 == dy2)) {
      if (dx2 < sx1) {
        if (((sx1 + 1) == sx2) && patternOK) {
          for (jint y = sy1; y <= sy2; ++y) {
            OrgGeogebraCommonKernelGeosGeoElement *v1 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, sx1, y);
            OrgGeogebraCommonKernelGeosGeoElement *v2 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, sx2, y);
            if ((v1 == nil) || (v2 == nil)) {
              continue;
            }
            for (jint x = dx2; x >= dx1; --x) {
              OrgGeogebraCommonKernelGeosGeoElement *vOld = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, x, y);
              if (vOld != nil && [vOld isFixed]) {
                break;
              }
              OrgGeogebraCommonKernelGeosGeoElement *v3 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, x + 2, y);
              OrgGeogebraCommonKernelGeosGeoElement *v4 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, x + 1, y);
              NSString *vs1 = [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(v3)) isGeoFunction] ? @"(x)" : @"";
              NSString *vs2 = [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(v4)) isGeoFunction] ? @"(x)" : @"";
              NSString *d0 = JreStrcat("$$", OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_getSpreadsheetCellNameWithInt_withInt_(x + 2, y), vs1);
              NSString *d1 = JreStrcat("$$", OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_getSpreadsheetCellNameWithInt_withInt_(x + 1, y), vs2);
              NSString *text = JreStrcat("$$C$", @"=2*", d1, '-', d0);
              OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_doCopyNoStoringUndoInfo1WithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonMainApp_withNSString_withOrgGeogebraCommonKernelGeosGeoElement_withInt_withInt_(kernel_, app_, text, v4, x, y);
            }
          }
        }
        else {
          [self doCopyHorizontalNoStoringUndoInfo1WithInt:sy1 withInt:sy2 withInt:sx1 withInt:dx1 withInt:dx2];
        }
        success = YES;
      }
      else if (dx1 > sx2) {
        if (((sx1 + 1) == sx2) && patternOK) {
          for (jint y = sy1; y <= sy2; ++y) {
            OrgGeogebraCommonKernelGeosGeoElement *v1 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, sx1, y);
            OrgGeogebraCommonKernelGeosGeoElement *v2 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, sx2, y);
            if ((v1 == nil) || (v2 == nil)) {
              continue;
            }
            for (jint x = dx1; x <= dx2; ++x) {
              OrgGeogebraCommonKernelGeosGeoElement *vOld = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, x, y);
              if (vOld != nil && [vOld isFixed]) {
                break;
              }
              OrgGeogebraCommonKernelGeosGeoElement *v3 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, x - 2, y);
              OrgGeogebraCommonKernelGeosGeoElement *v4 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, x - 1, y);
              NSString *vs1 = [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(v3)) isGeoFunction] ? @"(x)" : @"";
              NSString *vs2 = [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(v4)) isGeoFunction] ? @"(x)" : @"";
              NSString *d0 = JreStrcat("$$", OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_getSpreadsheetCellNameWithInt_withInt_(x - 2, y), vs1);
              NSString *d1 = JreStrcat("$$", OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_getSpreadsheetCellNameWithInt_withInt_(x - 1, y), vs2);
              NSString *text = JreStrcat("$$C$", @"=2*", d1, '-', d0);
              OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_doCopyNoStoringUndoInfo1WithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonMainApp_withNSString_withOrgGeogebraCommonKernelGeosGeoElement_withInt_withInt_(kernel_, app_, text, v4, x, y);
            }
          }
        }
        else {
          [self doCopyHorizontalNoStoringUndoInfo1WithInt:sy1 withInt:sy2 withInt:sx2 withInt:dx1 withInt:dx2];
        }
        success = YES;
      }
    }
    [cons processCollectedRedefineCalls];
    if (success) {
      return YES;
    }
    NSString *msg = JreStrcat("$I$I$I$I$I$I$I$I$", @"sx1 = ", sx1, @"\x0d\nsy1 = ", sy1, @"\x0d\nsx2 = ", sx2, @"\x0d\nsy2 = ", sy2, @"\x0d\ndx1 = ", dx1, @"\x0d\ndy1 = ", dy1, @"\x0d\ndx2 = ", dx2, @"\x0d\ndy2 = ", dy2, @"\x0d\n");
    @throw new_JavaLangRuntimeException_initWithNSString_(JreStrcat("$$", @"Error from RelativeCopy.doCopy:\x0d\n", msg));
  }
  @catch (JavaLangException *ex) {
    [((JavaLangException *) nil_chk(ex)) printStackTrace];
    return NO;
  }
  @finally {
    [((OrgGeogebraCommonKernelConstruction *) nil_chk(cons)) stopCollectingRedefineCalls];
    [app_ setDefaultCursor];
  }
}

+ (jboolean)isPatternSourceWithOrgGeogebraCommonGuiViewSpreadsheetCellRange:(OrgGeogebraCommonGuiViewSpreadsheetCellRange *)cellRange {
  return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_isPatternSourceWithOrgGeogebraCommonGuiViewSpreadsheetCellRange_(cellRange);
}

- (void)doCopyVerticalNoStoringUndoInfo1WithInt:(jint)x1
                                        withInt:(jint)x2
                                        withInt:(jint)sy
                                        withInt:(jint)dy1
                                        withInt:(jint)dy2 {
  JavaUtilTreeSet *tree = new_JavaUtilTreeSet_init();
  for (jint x = x1; x <= x2; ++x) {
    jint ix = x - x1;
    OrgGeogebraCommonKernelGeosGeoElement *cell = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, x1 + ix, sy);
    if (cell != nil) {
      [tree addWithId:cell];
    }
  }
  for (jint y = dy1; y <= dy2; ++y) {
    jint iy = y - dy1;
    id<JavaUtilIterator> iterator = [tree iterator];
    while ([((id<JavaUtilIterator>) nil_chk(iterator)) hasNext]) {
      OrgGeogebraCommonKernelGeosGeoElement *geo = ([iterator next]);
      if (geo != nil) {
        OrgGeogebraCommonAwtGPoint *p = [geo getSpreadsheetCoords];
        OrgGeogebraCommonKernelGeosGeoElement *vOld = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, ((OrgGeogebraCommonAwtGPoint *) nil_chk(p))->x_, dy1 + iy);
        if (vOld != nil && [vOld isFixed]) {
          continue;
        }
        (void) OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_doCopyNoStoringUndoInfo0WithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonMainApp_withOrgGeogebraCommonKernelGeosGeoElement_withOrgGeogebraCommonKernelGeosGeoElement_withInt_withInt_(kernel_, app_, geo, OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, p->x_, dy1 + iy), 0, y - sy);
      }
    }
  }
}

- (void)doCopyHorizontalNoStoringUndoInfo1WithInt:(jint)y1
                                          withInt:(jint)y2
                                          withInt:(jint)sx
                                          withInt:(jint)dx1
                                          withInt:(jint)dx2 {
  JavaUtilTreeSet *tree = new_JavaUtilTreeSet_init();
  for (jint y = y1; y <= y2; ++y) {
    jint iy = y - y1;
    OrgGeogebraCommonKernelGeosGeoElement *cell = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, sx, y1 + iy);
    if (cell != nil) {
      [tree addWithId:cell];
    }
  }
  for (jint x = dx1; x <= dx2; ++x) {
    jint ix = x - dx1;
    id<JavaUtilIterator> iterator = [tree iterator];
    while ([((id<JavaUtilIterator>) nil_chk(iterator)) hasNext]) {
      OrgGeogebraCommonKernelGeosGeoElement *geo = ([iterator next]);
      if (geo != nil) {
        OrgGeogebraCommonAwtGPoint *p = [geo getSpreadsheetCoords];
        OrgGeogebraCommonKernelGeosGeoElement *vOld = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, dx1 + ix, ((OrgGeogebraCommonAwtGPoint *) nil_chk(p))->y_);
        if (vOld != nil && [vOld isFixed]) {
          continue;
        }
        (void) OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_doCopyNoStoringUndoInfo0WithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonMainApp_withOrgGeogebraCommonKernelGeosGeoElement_withOrgGeogebraCommonKernelGeosGeoElement_withInt_withInt_(kernel_, app_, geo, OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app_, dx1 + ix, p->y_), x - sx, 0);
      }
    }
  }
}

+ (OrgGeogebraCommonKernelGeosGeoElement *)doCopyNoStoringUndoInfo0WithOrgGeogebraCommonKernelKernel:(OrgGeogebraCommonKernelKernel *)kernel
                                                                        withOrgGeogebraCommonMainApp:(OrgGeogebraCommonMainApp *)app
                                                           withOrgGeogebraCommonKernelGeosGeoElement:(OrgGeogebraCommonKernelGeosGeoElement *)value
                                                           withOrgGeogebraCommonKernelGeosGeoElement:(OrgGeogebraCommonKernelGeosGeoElement *)oldValue
                                                                                             withInt:(jint)dx
                                                                                             withInt:(jint)dy {
  return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_doCopyNoStoringUndoInfo0WithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonMainApp_withOrgGeogebraCommonKernelGeosGeoElement_withOrgGeogebraCommonKernelGeosGeoElement_withInt_withInt_(kernel, app, value, oldValue, dx, dy);
}

+ (void)updateCellReferencesWithOrgGeogebraCommonKernelArithmeticValidExpression:(OrgGeogebraCommonKernelArithmeticValidExpression *)exp
                                                                         withInt:(jint)dx
                                                                         withInt:(jint)dy {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_updateCellReferencesWithOrgGeogebraCommonKernelArithmeticValidExpression_withInt_withInt_(exp, dx, dy);
}

+ (NSString *)updateCellNameWithOffsetWithNSString:(NSString *)name
                                           withInt:(jint)dx
                                           withInt:(jint)dy {
  return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_updateCellNameWithOffsetWithNSString_withInt_withInt_(name, dx, dy);
}

+ (void)doCopyNoStoringUndoInfo1WithOrgGeogebraCommonKernelKernel:(OrgGeogebraCommonKernelKernel *)kernel
                                     withOrgGeogebraCommonMainApp:(OrgGeogebraCommonMainApp *)app
                                                     withNSString:(NSString *)text
                        withOrgGeogebraCommonKernelGeosGeoElement:(OrgGeogebraCommonKernelGeosGeoElement *)geoForStyle
                                                          withInt:(jint)column
                                                          withInt:(jint)row {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_doCopyNoStoringUndoInfo1WithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonMainApp_withNSString_withOrgGeogebraCommonKernelGeosGeoElement_withInt_withInt_(kernel, app, text, geoForStyle, column, row);
}

+ (NSString *)replaceAllWithComGoogleGwtRegexpSharedRegExp:(ComGoogleGwtRegexpSharedRegExp *)spreadsheetpattern
                                              withNSString:(NSString *)text
                                              withNSString:(NSString *)before
                                              withNSString:(NSString *)after {
  return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_replaceAllWithComGoogleGwtRegexpSharedRegExp_withNSString_withNSString_withNSString_(spreadsheetpattern, text, before, after);
}

+ (IOSObjectArray *)getDependentObjectsWithOrgGeogebraCommonKernelGeosGeoElement:(OrgGeogebraCommonKernelGeosGeoElement *)geo {
  return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getDependentObjectsWithOrgGeogebraCommonKernelGeosGeoElement_(geo);
}

+ (IOSObjectArray *)getValuesWithOrgGeogebraCommonMainApp:(OrgGeogebraCommonMainApp *)app
                                                  withInt:(jint)column1
                                                  withInt:(jint)row1
                                                  withInt:(jint)column2
                                                  withInt:(jint)row2 {
  return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValuesWithOrgGeogebraCommonMainApp_withInt_withInt_withInt_withInt_(app, column1, row1, column2, row2);
}

+ (OrgGeogebraCommonKernelGeosGeoElement *)getValueWithOrgGeogebraCommonMainApp:(OrgGeogebraCommonMainApp *)app
                                                 withOrgGeogebraCommonAwtGPoint:(OrgGeogebraCommonAwtGPoint *)point {
  return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withOrgGeogebraCommonAwtGPoint_(app, point);
}

+ (OrgGeogebraCommonKernelGeosGeoElement *)getValueWithOrgGeogebraCommonMainApp:(OrgGeogebraCommonMainApp *)app
                                                                        withInt:(jint)column
                                                                        withInt:(jint)row {
  return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app, column, row);
}

+ (OrgGeogebraCommonKernelGeosGeoElement *)prepareNewValueWithOrgGeogebraCommonKernelKernel:(OrgGeogebraCommonKernelKernel *)kernel
                                                                               withNSString:(NSString *)name
                                                                               withNSString:(NSString *)inputText {
  return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_prepareNewValueWithOrgGeogebraCommonKernelKernel_withNSString_withNSString_(kernel, name, inputText);
}

+ (OrgGeogebraCommonKernelGeosGeoElement *)updateOldValueWithOrgGeogebraCommonKernelKernel:(OrgGeogebraCommonKernelKernel *)kernel
                                                 withOrgGeogebraCommonKernelGeosGeoElement:(OrgGeogebraCommonKernelGeosGeoElement *)oldValue
                                                                              withNSString:(NSString *)name
                                                                              withNSString:(NSString *)text {
  return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_updateOldValueWithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonKernelGeosGeoElement_withNSString_withNSString_(kernel, oldValue, name, text);
}

+ (OrgGeogebraCommonKernelGeosGeoElement *)prepareAddingValueToTableNoStoringUndoInfoWithOrgGeogebraCommonKernelKernel:(OrgGeogebraCommonKernelKernel *)kernel
                                                                                          withOrgGeogebraCommonMainApp:(OrgGeogebraCommonMainApp *)app
                                                                                                          withNSString:(NSString *)inputText
                                                                             withOrgGeogebraCommonKernelGeosGeoElement:(OrgGeogebraCommonKernelGeosGeoElement *)oldValue
                                                                                                               withInt:(jint)column
                                                                                                               withInt:(jint)row {
  return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_prepareAddingValueToTableNoStoringUndoInfoWithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonMainApp_withNSString_withOrgGeogebraCommonKernelGeosGeoElement_withInt_withInt_(kernel, app, inputText, oldValue, column, row);
}

+ (jboolean)isNumberWithNSString:(NSString *)str {
  return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_isNumberWithNSString_(str);
}

+ (jboolean)isStandardNumberWithNSString:(NSString *)s {
  return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_isStandardNumberWithNSString_(s);
}

+ (void)initialize {
  if (self == [OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy class]) {
    OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_pattern2_ = ComGoogleGwtRegexpSharedRegExp_compileWithNSString_(@"(::|\\$)([A-Z]+)(::|\\$)([0-9]+)");
    J2OBJC_SET_INITIALIZED(OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy)
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgGeogebraCommonKernelKernel:", "RelativeCopy", NULL, 0x1, NULL, NULL },
    { "doDragCopyWithInt:withInt:withInt:withInt:withInt:withInt:withInt:withInt:", "doDragCopy", "Z", 0x1, NULL, NULL },
    { "isPatternSourceWithOrgGeogebraCommonGuiViewSpreadsheetCellRange:", "isPatternSource", "Z", 0xa, NULL, NULL },
    { "doCopyVerticalNoStoringUndoInfo1WithInt:withInt:withInt:withInt:withInt:", "doCopyVerticalNoStoringUndoInfo1", "V", 0x1, "Ljava.lang.Exception;", NULL },
    { "doCopyHorizontalNoStoringUndoInfo1WithInt:withInt:withInt:withInt:withInt:", "doCopyHorizontalNoStoringUndoInfo1", "V", 0x1, "Ljava.lang.Exception;", NULL },
    { "doCopyNoStoringUndoInfo0WithOrgGeogebraCommonKernelKernel:withOrgGeogebraCommonMainApp:withOrgGeogebraCommonKernelGeosGeoElement:withOrgGeogebraCommonKernelGeosGeoElement:withInt:withInt:", "doCopyNoStoringUndoInfo0", "Lorg.geogebra.common.kernel.geos.GeoElement;", 0x9, "Ljava.lang.Exception;", NULL },
    { "updateCellReferencesWithOrgGeogebraCommonKernelArithmeticValidExpression:withInt:withInt:", "updateCellReferences", "V", 0xa, NULL, NULL },
    { "updateCellNameWithOffsetWithNSString:withInt:withInt:", "updateCellNameWithOffset", "Ljava.lang.String;", 0x9, NULL, NULL },
    { "doCopyNoStoringUndoInfo1WithOrgGeogebraCommonKernelKernel:withOrgGeogebraCommonMainApp:withNSString:withOrgGeogebraCommonKernelGeosGeoElement:withInt:withInt:", "doCopyNoStoringUndoInfo1", "V", 0x9, "Ljava.lang.Exception;", NULL },
    { "replaceAllWithComGoogleGwtRegexpSharedRegExp:withNSString:withNSString:withNSString:", "replaceAll", "Ljava.lang.String;", 0x9, NULL, NULL },
    { "getDependentObjectsWithOrgGeogebraCommonKernelGeosGeoElement:", "getDependentObjects", "[Lorg.geogebra.common.kernel.geos.GeoElement;", 0x9, NULL, NULL },
    { "getValuesWithOrgGeogebraCommonMainApp:withInt:withInt:withInt:withInt:", "getValues", "[[Lorg.geogebra.common.kernel.geos.GeoElement;", 0x9, NULL, NULL },
    { "getValueWithOrgGeogebraCommonMainApp:withOrgGeogebraCommonAwtGPoint:", "getValue", "Lorg.geogebra.common.kernel.geos.GeoElement;", 0x9, NULL, NULL },
    { "getValueWithOrgGeogebraCommonMainApp:withInt:withInt:", "getValue", "Lorg.geogebra.common.kernel.geos.GeoElement;", 0x9, NULL, NULL },
    { "prepareNewValueWithOrgGeogebraCommonKernelKernel:withNSString:withNSString:", "prepareNewValue", "Lorg.geogebra.common.kernel.geos.GeoElement;", 0xa, "Ljava.lang.Exception;", NULL },
    { "updateOldValueWithOrgGeogebraCommonKernelKernel:withOrgGeogebraCommonKernelGeosGeoElement:withNSString:withNSString:", "updateOldValue", "Lorg.geogebra.common.kernel.geos.GeoElement;", 0xa, "Ljava.lang.Exception;", NULL },
    { "prepareAddingValueToTableNoStoringUndoInfoWithOrgGeogebraCommonKernelKernel:withOrgGeogebraCommonMainApp:withNSString:withOrgGeogebraCommonKernelGeosGeoElement:withInt:withInt:", "prepareAddingValueToTableNoStoringUndoInfo", "Lorg.geogebra.common.kernel.geos.GeoElement;", 0x9, "Ljava.lang.Exception;", NULL },
    { "isNumberWithNSString:", "isNumber", "Z", 0x9, NULL, NULL },
    { "isStandardNumberWithNSString:", "isStandardNumber", "Z", 0xa, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "kernel_", NULL, 0x4, "Lorg.geogebra.common.kernel.Kernel;", NULL, NULL,  },
    { "app_", NULL, 0x0, "Lorg.geogebra.common.main.App;", NULL, NULL,  },
    { "pattern2_", NULL, 0x1c, "Lcom.google.gwt.regexp.shared.RegExp;", &OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_pattern2_, NULL,  },
  };
  static const J2ObjcClassInfo _OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy = { 2, "RelativeCopy", "org.geogebra.common.gui.view.spreadsheet", NULL, 0x1, 19, methods, 3, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy;
}

@end

void OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initWithOrgGeogebraCommonKernelKernel_(OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy *self, OrgGeogebraCommonKernelKernel *kernel0) {
  (void) NSObject_init(self);
  self->kernel_ = kernel0;
  self->app_ = [((OrgGeogebraCommonKernelKernel *) nil_chk(self->kernel_)) getApplication];
}

OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy *new_OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initWithOrgGeogebraCommonKernelKernel_(OrgGeogebraCommonKernelKernel *kernel0) {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy *self = [OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy alloc];
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initWithOrgGeogebraCommonKernelKernel_(self, kernel0);
  return self;
}

jboolean OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_isPatternSourceWithOrgGeogebraCommonGuiViewSpreadsheetCellRange_(OrgGeogebraCommonGuiViewSpreadsheetCellRange *cellRange) {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initialize();
  if ([((OrgGeogebraCommonGuiViewSpreadsheetCellRange *) nil_chk(cellRange)) hasEmptyCells]) {
    return NO;
  }
  JavaUtilArrayList *list = [cellRange toGeoList];
  for (OrgGeogebraCommonKernelGeosGeoElement * __strong geo in nil_chk(list)) {
    if (!([((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(geo)) isGeoNumeric] || [geo isGeoFunction] || [geo isGeoPoint])) {
      return NO;
    }
  }
  return YES;
}

OrgGeogebraCommonKernelGeosGeoElement *OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_doCopyNoStoringUndoInfo0WithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonMainApp_withOrgGeogebraCommonKernelGeosGeoElement_withOrgGeogebraCommonKernelGeosGeoElement_withInt_withInt_(OrgGeogebraCommonKernelKernel *kernel, OrgGeogebraCommonMainApp *app, OrgGeogebraCommonKernelGeosGeoElement *value, OrgGeogebraCommonKernelGeosGeoElement *oldValue, jint dx, jint dy) {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initialize();
  if (value == nil) {
    if (oldValue != nil) {
      ComGoogleGwtRegexpSharedMatchResult *matcher = [((ComGoogleGwtRegexpSharedRegExp *) nil_chk(OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_get_spreadsheetPattern_())) execWithNSString:[oldValue getLabelWithOrgGeogebraCommonKernelStringTemplate:OrgGeogebraCommonKernelStringTemplate_get_defaultTemplate_()]];
      jint column = OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_getSpreadsheetColumnWithComGoogleGwtRegexpSharedMatchResult_(matcher);
      jint row = OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_getSpreadsheetRowWithComGoogleGwtRegexpSharedMatchResult_(matcher);
      (void) OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_prepareAddingValueToTableNoStoringUndoInfoWithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonMainApp_withNSString_withOrgGeogebraCommonKernelGeosGeoElement_withInt_withInt_(kernel, app, nil, oldValue, column, row);
    }
    return nil;
  }
  NSString *text = nil;
  OrgGeogebraCommonKernelStringTemplate *highPrecision = OrgGeogebraCommonKernelStringTemplate_get_maxPrecision_();
  if ([((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(value)) isPointOnPath] || [value isPointInRegion]) {
    text = [value getCommandDescriptionWithOrgGeogebraCommonKernelStringTemplate:highPrecision];
  }
  else if ([value isChangeable]) {
    text = [value toValueStringWithOrgGeogebraCommonKernelStringTemplate:highPrecision];
  }
  else {
    text = [value getCommandDescriptionWithOrgGeogebraCommonKernelStringTemplate:highPrecision];
  }
  if ([value isGeoText] && ![((OrgGeogebraCommonKernelGeosGeoText *) check_class_cast(value, [OrgGeogebraCommonKernelGeosGeoText class])) isTextCommand]) {
    if ([value isIndependent]) {
      text = JreStrcat("C$C", '"', text, '"');
    }
    else {
      OrgGeogebraCommonKernelGeosGeoText *testGeoText = [((OrgGeogebraCommonKernelCommandsAlgebraProcessor *) nil_chk([((OrgGeogebraCommonKernelKernel *) nil_chk(kernel)) getAlgebraProcessor])) evaluateToTextWithNSString:text withBoolean:NO withBoolean:NO];
      if (testGeoText == nil) {
        text = JreStrcat("$$", text, @"+\"\"");
      }
    }
  }
  if ([value isGeoFunction] && [((NSString *) nil_chk(text)) isEqual:@""]) {
    text = [((OrgGeogebraCommonKernelGeosGeoFunction *) check_class_cast(value, [OrgGeogebraCommonKernelGeosGeoFunction class])) toSymbolicStringWithOrgGeogebraCommonKernelStringTemplate:highPrecision];
  }
  jboolean freeImage = NO;
  if ([value isGeoImage]) {
    OrgGeogebraCommonKernelGeosGeoImage *image = (OrgGeogebraCommonKernelGeosGeoImage *) check_class_cast(value, [OrgGeogebraCommonKernelGeosGeoImage class]);
    if ([image getParentAlgorithm] == nil) {
      freeImage = YES;
    }
  }
  jboolean oldFlag = [((OrgGeogebraCommonKernelKernel *) nil_chk(kernel)) isUsingInternalCommandNames];
  [kernel setUseInternalCommandNamesWithBoolean:YES];
  OrgGeogebraCommonKernelArithmeticValidExpression *exp = [((OrgGeogebraCommonKernelParserParser *) nil_chk([kernel getParser])) parseGeoGebraExpressionWithNSString:text];
  [kernel setUseInternalCommandNamesWithBoolean:oldFlag];
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_updateCellReferencesWithOrgGeogebraCommonKernelArithmeticValidExpression_withInt_withInt_(exp, dx, dy);
  text = [((OrgGeogebraCommonKernelArithmeticValidExpression *) nil_chk(exp)) toStringWithOrgGeogebraCommonKernelStringTemplate:highPrecision];
  OrgGeogebraCommonKernelGeosGeoBoolean *bool_ = [value getShowObjectCondition];
  NSString *boolText = nil, *oldBoolText = nil;
  if (bool_ != nil) {
    if ([bool_ isChangeable]) {
      oldBoolText = [bool_ toValueStringWithOrgGeogebraCommonKernelStringTemplate:highPrecision];
    }
    else {
      oldBoolText = [bool_ getCommandDescriptionWithOrgGeogebraCommonKernelStringTemplate:highPrecision];
    }
  }
  OrgGeogebraCommonKernelGeosGeoList *dynamicColorList = [value getColorFunction];
  NSString *colorText = nil, *oldColorText = nil;
  if (dynamicColorList != nil) {
    if ([dynamicColorList isChangeable]) {
      oldColorText = [dynamicColorList toValueStringWithOrgGeogebraCommonKernelStringTemplate:highPrecision];
    }
    else {
      oldColorText = [dynamicColorList getCommandDescriptionWithOrgGeogebraCommonKernelStringTemplate:highPrecision];
    }
  }
  if ([((NSString *) nil_chk(text)) isEqual:@""]) {
    text = @"\"\"";
  }
  if (![value isGeoText] && [((OrgGeogebraCommonMainSettingsSpreadsheetSettings *) nil_chk([((OrgGeogebraCommonMainSettingsSettings *) nil_chk([((OrgGeogebraCommonMainApp *) nil_chk(app)) getSettings])) getSpreadsheet])) equalsRequired]) {
    text = JreStrcat("C$", '=', text);
  }
  jint column0 = -1, row0 = -1;
  if (value->labelSet_) {
    ComGoogleGwtRegexpSharedMatchResult *matcher = [((ComGoogleGwtRegexpSharedRegExp *) nil_chk(OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_get_spreadsheetPattern_())) execWithNSString:[value getLabelWithOrgGeogebraCommonKernelStringTemplate:OrgGeogebraCommonKernelStringTemplate_get_defaultTemplate_()]];
    column0 = OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_getSpreadsheetColumnWithComGoogleGwtRegexpSharedMatchResult_(matcher);
    row0 = OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_getSpreadsheetRowWithComGoogleGwtRegexpSharedMatchResult_(matcher);
  }
  else if ([value getSpreadsheetCoords] != nil) {
    column0 = ((OrgGeogebraCommonAwtGPoint *) nil_chk([value getSpreadsheetCoords]))->x_;
    row0 = ((OrgGeogebraCommonAwtGPoint *) nil_chk([value getSpreadsheetCoords]))->y_;
  }
  OrgGeogebraCommonKernelGeosGeoElement *value2;
  if (freeImage || [value isGeoButton]) {
    value2 = [value copy__];
    if (oldValue != nil) {
      [oldValue remove];
    }
    [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(value2)) setLabelWithNSString:OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_getSpreadsheetCellNameWithInt_withInt_(column0 + dx, row0 + dy)];
    [value2 updateRepaint];
  }
  else {
    value2 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_prepareAddingValueToTableNoStoringUndoInfoWithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonMainApp_withNSString_withOrgGeogebraCommonKernelGeosGeoElement_withInt_withInt_(kernel, app, text, oldValue, column0 + dx, row0 + dy);
  }
  [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(value2)) setAllVisualPropertiesWithOrgGeogebraCommonKernelGeosGeoElement:value withBoolean:NO];
  [value2 setAuxiliaryObjectWithBoolean:YES];
  IOSObjectArray *startPoints = nil;
  if ([OrgGeogebraCommonKernelLocateable_class_() isInstance:value]) {
    id<OrgGeogebraCommonKernelLocateable> loc = (id<OrgGeogebraCommonKernelLocateable>) check_protocol_cast(value, @protocol(OrgGeogebraCommonKernelLocateable));
    IOSObjectArray *pts = [loc getStartPoints];
    if (pts != nil) {
      startPoints = [IOSObjectArray newArrayWithLength:pts->size_ type:NSString_class_()];
      for (jint i = 0; i < pts->size_; i++) {
        (void) IOSObjectArray_Set(startPoints, i, [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(((OrgGeogebraCommonKernelGeosGeoElement *) check_class_cast(IOSObjectArray_Get(pts, i), [OrgGeogebraCommonKernelGeosGeoElement class])))) getLabelWithOrgGeogebraCommonKernelStringTemplate:highPrecision]);
        if ([((ComGoogleGwtRegexpSharedRegExp *) nil_chk(OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_get_spreadsheetPattern_())) testWithNSString:IOSObjectArray_Get(startPoints, i)]) {
          (void) IOSObjectArray_Set(startPoints, i, OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_updateCellNameWithOffsetWithNSString_withInt_withInt_(IOSObjectArray_Get(startPoints, i), dx, dy));
        }
      }
    }
  }
  if (oldBoolText != nil) {
    exp = [((OrgGeogebraCommonKernelParserParser *) nil_chk([kernel getParser])) parseGeoGebraExpressionWithNSString:oldBoolText];
    OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_updateCellReferencesWithOrgGeogebraCommonKernelArithmeticValidExpression_withInt_withInt_(exp, dx, dy);
    boolText = [((OrgGeogebraCommonKernelArithmeticValidExpression *) nil_chk(exp)) toStringWithOrgGeogebraCommonKernelStringTemplate:OrgGeogebraCommonKernelStringTemplate_get_maxPrecision_()];
  }
  if ((boolText != nil)) {
    @try {
      OrgGeogebraCommonKernelGeosGeoBoolean *newConditionToShowObject = [((OrgGeogebraCommonKernelCommandsAlgebraProcessor *) nil_chk([kernel getAlgebraProcessor])) evaluateToBooleanWithNSString:boolText withBoolean:NO];
      [value2 setShowObjectConditionWithOrgGeogebraCommonKernelGeosGeoBoolean:newConditionToShowObject];
      [value2 update];
    }
    @catch (JavaLangException *e) {
      [((JavaLangException *) nil_chk(e)) printStackTrace];
      return nil;
    }
  }
  if (oldColorText != nil) {
    exp = [((OrgGeogebraCommonKernelParserParser *) nil_chk([kernel getParser])) parseGeoGebraExpressionWithNSString:oldColorText];
    OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_updateCellReferencesWithOrgGeogebraCommonKernelArithmeticValidExpression_withInt_withInt_(exp, dx, dy);
    colorText = [((OrgGeogebraCommonKernelArithmeticValidExpression *) nil_chk(exp)) toStringWithOrgGeogebraCommonKernelStringTemplate:OrgGeogebraCommonKernelStringTemplate_get_maxPrecision_()];
  }
  if ((colorText != nil)) {
    @try {
      OrgGeogebraCommonKernelGeosGeoList *newColorFunction = [((OrgGeogebraCommonKernelCommandsAlgebraProcessor *) nil_chk([kernel getAlgebraProcessor])) evaluateToListWithNSString:colorText];
      [value2 setColorFunctionWithOrgGeogebraCommonKernelGeosGeoList:newColorFunction];
    }
    @catch (JavaLangException *e) {
      [((JavaLangException *) nil_chk(e)) printStackTrace];
      return nil;
    }
  }
  if (startPoints != nil) {
    for (jint i = 0; i < startPoints->size_; i++) {
      [((id<OrgGeogebraCommonKernelLocateable>) check_protocol_cast(value2, @protocol(OrgGeogebraCommonKernelLocateable))) setStartPointWithOrgGeogebraCommonKernelKernelNDGeoPointND:[((OrgGeogebraCommonKernelCommandsAlgebraProcessor *) nil_chk([kernel getAlgebraProcessor])) evaluateToPointWithNSString:IOSObjectArray_Get(startPoints, i) withBoolean:NO withBoolean:YES] withInt:i];
    }
    [value2 update];
  }
  return value2;
}

void OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_updateCellReferencesWithOrgGeogebraCommonKernelArithmeticValidExpression_withInt_withInt_(OrgGeogebraCommonKernelArithmeticValidExpression *exp, jint dx, jint dy) {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initialize();
  OrgGeogebraCommonKernelArithmeticTraversing_SpreadsheetVariableRenamer *replacer = new_OrgGeogebraCommonKernelArithmeticTraversing_SpreadsheetVariableRenamer_initWithInt_withInt_(dx, dy);
  (void) [((OrgGeogebraCommonKernelArithmeticValidExpression *) nil_chk(exp)) traverseWithOrgGeogebraCommonKernelArithmeticTraversing:replacer];
}

NSString *OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_updateCellNameWithOffsetWithNSString_withInt_withInt_(NSString *name, jint dx, jint dy) {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initialize();
  ComGoogleGwtRegexpSharedMatchResult *m = [((ComGoogleGwtRegexpSharedRegExp *) nil_chk(OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_get_spreadsheetPattern_())) execWithNSString:name];
  NSString *m1 = [((ComGoogleGwtRegexpSharedMatchResult *) nil_chk(m)) getGroupWithInt:OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_MATCH_COLUMN_$];
  NSString *m2 = [m getGroupWithInt:OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_MATCH_COLUMN];
  NSString *m3 = [m getGroupWithInt:OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_MATCH_ROW_$];
  NSString *m4 = [m getGroupWithInt:OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_MATCH_ROW];
  if ([@"" isEqual:m1]) {
    jint column = OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_getSpreadsheetColumnWithComGoogleGwtRegexpSharedMatchResult_(m);
    if (column > -1 && dx + column > 0) {
      m2 = OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_getSpreadsheetColumnNameWithInt_(dx + column);
    }
  }
  if ([@"" isEqual:m3]) {
    jint row = OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_getSpreadsheetRowWithComGoogleGwtRegexpSharedMatchResult_(m);
    if (row > -1 && dy + row + 1 >= 1) {
      m4 = JreStrcat("I", (dy + row + 1));
    }
  }
  JavaLangStringBuilder *newName = new_JavaLangStringBuilder_init();
  (void) [newName appendWithNSString:m1];
  (void) [newName appendWithNSString:m2];
  (void) [newName appendWithNSString:m3];
  (void) [newName appendWithNSString:m4];
  return [newName description];
}

void OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_doCopyNoStoringUndoInfo1WithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonMainApp_withNSString_withOrgGeogebraCommonKernelGeosGeoElement_withInt_withInt_(OrgGeogebraCommonKernelKernel *kernel, OrgGeogebraCommonMainApp *app, NSString *text, OrgGeogebraCommonKernelGeosGeoElement *geoForStyle, jint column, jint row) {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initialize();
  OrgGeogebraCommonKernelGeosGeoElement *oldValue = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app, column, row);
  if (text == nil) {
    if (oldValue != nil) {
      (void) OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_prepareAddingValueToTableNoStoringUndoInfoWithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonMainApp_withNSString_withOrgGeogebraCommonKernelGeosGeoElement_withInt_withInt_(kernel, app, nil, oldValue, column, row);
    }
    return;
  }
  OrgGeogebraCommonKernelGeosGeoElement *value2 = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_prepareAddingValueToTableNoStoringUndoInfoWithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonMainApp_withNSString_withOrgGeogebraCommonKernelGeosGeoElement_withInt_withInt_(kernel, app, text, oldValue, column, row);
  if (geoForStyle != nil) {
    [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(value2)) setVisualStyleWithOrgGeogebraCommonKernelGeosGeoElement:geoForStyle];
  }
}

NSString *OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_replaceAllWithComGoogleGwtRegexpSharedRegExp_withNSString_withNSString_withNSString_(ComGoogleGwtRegexpSharedRegExp *spreadsheetpattern, NSString *text, NSString *before, NSString *after) {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initialize();
  JavaLangStringBuilder *pre = new_JavaLangStringBuilder_init();
  NSString *post = text;
  jint end = 0;
  ComGoogleGwtRegexpSharedMatchResult *matcher;
  do {
    matcher = [((ComGoogleGwtRegexpSharedRegExp *) nil_chk(spreadsheetpattern)) execWithNSString:post];
    if (matcher != nil) {
      NSString *s = [matcher getGroupWithInt:0];
      if ([((NSString *) nil_chk(s)) isEqual:before]) {
        jint start = [((NSString *) nil_chk(post)) indexOfString:s];
        (void) [pre appendWithNSString:[post substring:0 endIndex:start]];
        (void) [pre appendWithNSString:after];
        end = start + ((jint) [s length]);
        post = [post substring:end];
      }
      else {
        jint start = [((NSString *) nil_chk(post)) indexOfString:s];
        (void) [pre appendWithNSString:[post substring:0 endIndex:start]];
        (void) [pre appendWithNSString:s];
        end = start + ((jint) [s length]);
        post = [post substring:end];
      }
    }
  }
  while (matcher != nil);
  (void) [pre appendWithNSString:post];
  return [pre description];
}

IOSObjectArray *OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getDependentObjectsWithOrgGeogebraCommonKernelGeosGeoElement_(OrgGeogebraCommonKernelGeosGeoElement *geo) {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initialize();
  if ([((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(geo)) isIndependent]) {
    return [IOSObjectArray newArrayWithLength:0 type:OrgGeogebraCommonKernelGeosGeoElement_class_()];
  }
  JavaUtilTreeSet *geoTree = [geo getAllPredecessors];
  return [((JavaUtilTreeSet *) nil_chk(geoTree)) toArrayWithNSObjectArray:[IOSObjectArray newArrayWithLength:0 type:OrgGeogebraCommonKernelGeosGeoElement_class_()]];
}

IOSObjectArray *OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValuesWithOrgGeogebraCommonMainApp_withInt_withInt_withInt_withInt_(OrgGeogebraCommonMainApp *app, jint column1, jint row1, jint column2, jint row2) {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initialize();
  IOSObjectArray *values = [IOSObjectArray newArrayWithDimensions:2 lengths:(jint[]){ (column2 - column1) + 1, (row2 - row1) + 1 } type:OrgGeogebraCommonKernelGeosGeoElement_class_()];
  for (jint r = row1; r <= row2; ++r) {
    for (jint c = column1; c <= column2; ++c) {
      (void) IOSObjectArray_Set(nil_chk(IOSObjectArray_Get(values, c - column1)), r - row1, OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app, c, r));
    }
  }
  return values;
}

OrgGeogebraCommonKernelGeosGeoElement *OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withOrgGeogebraCommonAwtGPoint_(OrgGeogebraCommonMainApp *app, OrgGeogebraCommonAwtGPoint *point) {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initialize();
  return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(app, [((OrgGeogebraCommonAwtGPoint *) nil_chk(point)) getX], [point getY]);
}

OrgGeogebraCommonKernelGeosGeoElement *OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_getValueWithOrgGeogebraCommonMainApp_withInt_withInt_(OrgGeogebraCommonMainApp *app, jint column, jint row) {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initialize();
  OrgGeogebraCommonMainSpreadsheetTableModel *tableModel = [((OrgGeogebraCommonMainApp *) nil_chk(app)) getSpreadsheetTableModel];
  if ((row < 0) || (row >= [((OrgGeogebraCommonMainSpreadsheetTableModel *) nil_chk(tableModel)) getRowCount])) {
    return nil;
  }
  if ((column < 0) || (column >= [((OrgGeogebraCommonMainSpreadsheetTableModel *) nil_chk(tableModel)) getColumnCount])) {
    return nil;
  }
  return (OrgGeogebraCommonKernelGeosGeoElement *) check_class_cast([((OrgGeogebraCommonMainSpreadsheetTableModel *) nil_chk(tableModel)) getValueAtWithInt:row withInt:column], [OrgGeogebraCommonKernelGeosGeoElement class]);
}

OrgGeogebraCommonKernelGeosGeoElement *OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_prepareNewValueWithOrgGeogebraCommonKernelKernel_withNSString_withNSString_(OrgGeogebraCommonKernelKernel *kernel, NSString *name, NSString *inputText) {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initialize();
  NSString *text = inputText;
  if (text == nil) {
    return nil;
  }
  if (((jint) [((NSString *) nil_chk(text)) length]) > 0 && [text charAtWithInt:0] == '=') {
    text = [text substring:1];
  }
  text = [((NSString *) nil_chk(text)) trim];
  IOSObjectArray *newValues = nil;
  @try {
    if ([((NSString *) nil_chk(text)) isEqual:name]) {
      @throw new_OrgGeogebraCommonKernelCircularDefinitionException_init();
    }
    newValues = [((OrgGeogebraCommonKernelCommandsAlgebraProcessor *) nil_chk([((OrgGeogebraCommonKernelKernel *) nil_chk(kernel)) getAlgebraProcessor])) processAlgebraCommandNoExceptionHandlingWithNSString:text withBoolean:NO withBoolean:NO withBoolean:NO withBoolean:NO];
    if ([((NSString *) nil_chk(OrgGeogebraCommonUtilStringUtil_toLowerCaseWithNSString_(text))) isEqual:[((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(IOSObjectArray_Get(nil_chk(newValues), 0))) getLabelWithOrgGeogebraCommonKernelStringTemplate:OrgGeogebraCommonKernelStringTemplate_get_defaultTemplate_()]] || [text isEqual:[((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(IOSObjectArray_Get(newValues, 0))) getLabelWithOrgGeogebraCommonKernelStringTemplate:OrgGeogebraCommonKernelStringTemplate_get_defaultTemplate_()]]) {
      text = JreStrcat("$$$", name, @" = ", text);
      newValues = [((OrgGeogebraCommonKernelCommandsAlgebraProcessor *) nil_chk([kernel getAlgebraProcessor])) processAlgebraCommandNoExceptionsWithNSString:text withBoolean:NO];
    }
    OrgGeogebraCommonKernelGeosGeoElement *autoCreateGeo = [kernel lookupLabelWithNSString:name];
    if (autoCreateGeo != nil) {
      jboolean circularDefinition = NO;
      for (jint i = 0; i < ((IOSObjectArray *) nil_chk(newValues))->size_; i++) {
        if ([((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(IOSObjectArray_Get(newValues, i))) isChildOfWithOrgGeogebraCommonKernelGeosGeoElement:autoCreateGeo]) {
          circularDefinition = YES;
          break;
        }
      }
      if (circularDefinition) {
        [autoCreateGeo remove];
        [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(IOSObjectArray_Get(newValues, 0))) remove];
        @throw new_OrgGeogebraCommonKernelCircularDefinitionException_init();
      }
    }
    for (jint i = 0; i < ((IOSObjectArray *) nil_chk(newValues))->size_; i++) {
      [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(IOSObjectArray_Get(newValues, i))) setAuxiliaryObjectWithBoolean:YES];
      if ([((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(IOSObjectArray_Get(newValues, i))) isGeoText]) {
        [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(IOSObjectArray_Get(newValues, i))) setEuclidianVisibleWithBoolean:NO];
      }
    }
    OrgGeogebraCommonKernelGeosGeoElement_setLabelsWithNSString_withOrgGeogebraCommonKernelGeosGeoElementArray_(name, newValues);
  }
  @catch (OrgGeogebraCommonKernelCircularDefinitionException *ce) {
    [((OrgGeogebraCommonMainApp *) nil_chk([((OrgGeogebraCommonKernelKernel *) nil_chk(kernel)) getApplication])) showErrorWithNSString:@"CircularDefinition"];
    return nil;
  }
  @catch (JavaLangException *e) {
    if ([((NSString *) nil_chk(text)) hasPrefix:@"\""]) text = [text substring:1 endIndex:((jint) [text length]) - 2];
    text = JreStrcat("C$C", '"', ([((NSString *) nil_chk(text)) replace:@"\"" withSequence:@"\"+UnicodeToLetter[34]+\""]), '"');
    newValues = [((OrgGeogebraCommonKernelCommandsAlgebraProcessor *) nil_chk([((OrgGeogebraCommonKernelKernel *) nil_chk(kernel)) getAlgebraProcessor])) processAlgebraCommandNoExceptionsWithNSString:text withBoolean:NO];
    [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(IOSObjectArray_Get(nil_chk(newValues), 0))) setLabelWithNSString:name];
    [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(IOSObjectArray_Get(newValues, 0))) setEuclidianVisibleWithBoolean:NO];
    [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(IOSObjectArray_Get(newValues, 0))) update];
  }
  return IOSObjectArray_Get(nil_chk(newValues), 0);
}

OrgGeogebraCommonKernelGeosGeoElement *OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_updateOldValueWithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonKernelGeosGeoElement_withNSString_withNSString_(OrgGeogebraCommonKernelKernel *kernel, OrgGeogebraCommonKernelGeosGeoElement *oldValue, NSString *name, NSString *text) {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initialize();
  NSString *text0 = text;
  if ([((NSString *) nil_chk(text)) charAtWithInt:0] == '=') {
    text = [text substring:1];
  }
  OrgGeogebraCommonKernelGeosGeoElement *newValue = nil;
  @try {
    newValue = [((OrgGeogebraCommonKernelCommandsAlgebraProcessor *) nil_chk([((OrgGeogebraCommonKernelKernel *) nil_chk(kernel)) getAlgebraProcessor])) changeGeoElementNoExceptionHandlingWithOrgGeogebraCommonKernelGeosGeoElement:oldValue withNSString:text withBoolean:YES withBoolean:NO];
    [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(newValue)) setAllVisualPropertiesWithOrgGeogebraCommonKernelGeosGeoElement:oldValue withBoolean:YES];
    if ([((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(oldValue)) isAuxiliaryObject]) {
      [newValue setAuxiliaryObjectWithBoolean:YES];
    }
    if ([newValue getGeoClassType] == [oldValue getGeoClassType]) {
    }
    else {
      [((OrgGeogebraCommonMainApp *) nil_chk([kernel getApplication])) refreshViews];
    }
  }
  @catch (OrgGeogebraCommonKernelCircularDefinitionException *cde) {
    [((OrgGeogebraCommonMainApp *) nil_chk([((OrgGeogebraCommonKernelKernel *) nil_chk(kernel)) getApplication])) showErrorWithNSString:@"CircularDefinition"];
    return nil;
  }
  @catch (JavaLangThrowable *e) {
    {
      if ([((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(oldValue)) isGeoText]) {
        [((OrgGeogebraCommonKernelGeosGeoText *) check_class_cast(oldValue, [OrgGeogebraCommonKernelGeosGeoText class])) setTextStringWithNSString:text0];
        [oldValue updateCascade];
      }
      else if (![oldValue hasChildren]) {
        [oldValue remove];
        @try {
          newValue = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_prepareNewValueWithOrgGeogebraCommonKernelKernel_withNSString_withNSString_(kernel, name, JreStrcat("C$C", '"', text0, '"'));
        }
        @catch (JavaLangThrowable *t) {
          newValue = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_prepareNewValueWithOrgGeogebraCommonKernelKernel_withNSString_withNSString_(kernel, name, @"");
        }
        [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(newValue)) setEuclidianVisibleWithBoolean:NO];
        [newValue update];
      }
      else {
        @throw new_JavaLangException_initWithJavaLangThrowable_(e);
      }
    }
  }
  return newValue;
}

OrgGeogebraCommonKernelGeosGeoElement *OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_prepareAddingValueToTableNoStoringUndoInfoWithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonMainApp_withNSString_withOrgGeogebraCommonKernelGeosGeoElement_withInt_withInt_(OrgGeogebraCommonKernelKernel *kernel, OrgGeogebraCommonMainApp *app, NSString *inputText, OrgGeogebraCommonKernelGeosGeoElement *oldValue, jint column, jint row) {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initialize();
  NSString *text = inputText;
  NSString *name = OrgGeogebraCommonKernelGeosGeoElementSpreadsheet_getSpreadsheetCellNameWithInt_withInt_(column, row);
  if (text != nil) {
    text = [text trim];
    if (((jint) [((NSString *) nil_chk(text)) length]) == 0) {
      text = nil;
    }
  }
  if ([((OrgGeogebraCommonMainSettingsSpreadsheetSettings *) nil_chk([((OrgGeogebraCommonMainSettingsSettings *) nil_chk([((OrgGeogebraCommonMainApp *) nil_chk(app)) getSettings])) getSpreadsheet])) equalsRequired] && text != nil) {
    if (!(([text charAtWithInt:0] == '=') || OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_isNumberWithNSString_(text))) {
      text = JreStrcat("C$C", '"', text, '"');
    }
  }
  if (text == nil) {
    if (oldValue != nil) {
      [oldValue remove];
    }
    return nil;
  }
  else if (oldValue == nil) {
    jboolean oldFlag = [((OrgGeogebraCommonKernelKernel *) nil_chk(kernel)) isUsingInternalCommandNames];
    @try {
      [kernel setUseInternalCommandNamesWithBoolean:YES];
      OrgGeogebraCommonKernelGeosGeoElement *ret = OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_prepareNewValueWithOrgGeogebraCommonKernelKernel_withNSString_withNSString_(kernel, name, text);
      [kernel setUseInternalCommandNamesWithBoolean:oldFlag];
      return ret;
    }
    @catch (JavaLangThrowable *t) {
      [kernel setUseInternalCommandNamesWithBoolean:oldFlag];
      return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_prepareNewValueWithOrgGeogebraCommonKernelKernel_withNSString_withNSString_(kernel, name, @"");
    }
  }
  else {
    return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_updateOldValueWithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonKernelGeosGeoElement_withNSString_withNSString_(kernel, oldValue, name, text);
  }
}

jboolean OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_isNumberWithNSString_(NSString *str) {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initialize();
  NSString *s = str;
  s = [((NSString *) nil_chk(s)) trim];
  if (s == nil || ((jint) [s length]) == 0) return NO;
  if ([s charAtWithInt:((jint) [((NSString *) nil_chk(s)) length]) - 1] == OrgGeogebraCommonUtilUnicode_DEGREE_CHAR || [s charAtWithInt:((jint) [s length]) - 1] == '%') {
    s = [s substring:0 endIndex:((jint) [s length]) - 1];
  }
  IOSObjectArray *s2 = [((NSString *) nil_chk(s)) split:@"E"];
  if (((IOSObjectArray *) nil_chk(s2))->size_ == 1) {
    return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_isStandardNumberWithNSString_(IOSObjectArray_Get(s2, 0));
  }
  else if (s2->size_ == 2) {
    return OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_isStandardNumberWithNSString_(IOSObjectArray_Get(s2, 0)) && OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_isStandardNumberWithNSString_(IOSObjectArray_Get(s2, 1));
  }
  else return NO;
}

jboolean OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_isStandardNumberWithNSString_(NSString *s) {
  OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy_initialize();
  if (s == nil || ((jint) [s length]) == 0) return NO;
  JavaLangCharacter *c = JavaLangCharacter_valueOfWithChar_([((NSString *) nil_chk(s)) charAtWithInt:0]);
  if (!(OrgGeogebraCommonUtilStringUtil_isDigitWithChar_([c charValue]) || [c charValue] == '.' || [c charValue] == '-' || [c charValue] == '+' || [c charValue] == 0x2212)) {
    return NO;
  }
  jint decimalCount = 0;
  for (jint i = 1; i < ((jint) [s length]); i++) {
    c = JavaLangCharacter_valueOfWithChar_([s charAtWithInt:i]);
    if (OrgGeogebraCommonUtilStringUtil_isDigitWithChar_([c charValue])) {
      continue;
    }
    if ([c charValue] == '.' && decimalCount == 0) {
      decimalCount++;
      continue;
    }
    return NO;
  }
  return YES;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgGeogebraCommonGuiViewSpreadsheetRelativeCopy)
