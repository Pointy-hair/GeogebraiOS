//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/GeogebraiOS/GeogebraiOS/sources/org/geogebra/common/kernel/optimization/FitRealFunction.java
//


#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/util/HashSet.h"
#include "org/geogebra/common/kernel/Kernel.h"
#include "org/geogebra/common/kernel/StringTemplate.h"
#include "org/geogebra/common/kernel/arithmetic/ExpressionNode.h"
#include "org/geogebra/common/kernel/arithmetic/ExpressionValue.h"
#include "org/geogebra/common/kernel/arithmetic/Function.h"
#include "org/geogebra/common/kernel/arithmetic/FunctionVariable.h"
#include "org/geogebra/common/kernel/arithmetic/MyDouble.h"
#include "org/geogebra/common/kernel/arithmetic/NumberValue.h"
#include "org/geogebra/common/kernel/optimization/FitRealFunction.h"

@interface OrgGeogebraCommonKernelOptimizationFitRealFunction () {
 @public
  OrgGeogebraCommonKernelKernel *kernel_;
  jint numberOfParameters_;
  IOSObjectArray *gliders_;
  OrgGeogebraCommonKernelArithmeticFunction *newf_;
  jdouble lastvalue_;
  IOSObjectArray *mydoubles_;
}

@end

J2OBJC_FIELD_SETTER(OrgGeogebraCommonKernelOptimizationFitRealFunction, kernel_, OrgGeogebraCommonKernelKernel *)
J2OBJC_FIELD_SETTER(OrgGeogebraCommonKernelOptimizationFitRealFunction, gliders_, IOSObjectArray *)
J2OBJC_FIELD_SETTER(OrgGeogebraCommonKernelOptimizationFitRealFunction, newf_, OrgGeogebraCommonKernelArithmeticFunction *)
J2OBJC_FIELD_SETTER(OrgGeogebraCommonKernelOptimizationFitRealFunction, mydoubles_, IOSObjectArray *)

__attribute__((unused)) static jdouble OrgGeogebraCommonKernelOptimizationFitRealFunction_valueWithDouble_withDoubleArray_(OrgGeogebraCommonKernelOptimizationFitRealFunction *self, jdouble x, IOSDoubleArray *pars);

@implementation OrgGeogebraCommonKernelOptimizationFitRealFunction

- (instancetype)init {
  OrgGeogebraCommonKernelOptimizationFitRealFunction_init(self);
  return self;
}

- (instancetype)initWithOrgGeogebraCommonKernelArithmeticFunction:(OrgGeogebraCommonKernelArithmeticFunction *)f {
  OrgGeogebraCommonKernelOptimizationFitRealFunction_initWithOrgGeogebraCommonKernelArithmeticFunction_(self, f);
  return self;
}

- (jdouble)valueWithDouble:(jdouble)x
           withDoubleArray:(IOSDoubleArray *)pars {
  return OrgGeogebraCommonKernelOptimizationFitRealFunction_valueWithDouble_withDoubleArray_(self, x, pars);
}

- (IOSDoubleArray *)gradientWithDouble:(jdouble)x
                       withDoubleArray:(IOSDoubleArray *)pars {
  jdouble oldf, newf;
  jdouble deltap = 1.0E-5;
  IOSDoubleArray *gradient = [IOSDoubleArray arrayWithLength:numberOfParameters_];
  for (jint i = 0; i < numberOfParameters_; i++) {
    oldf = OrgGeogebraCommonKernelOptimizationFitRealFunction_valueWithDouble_withDoubleArray_(self, x, pars);
    *IOSDoubleArray_GetRef(nil_chk(pars), i) += deltap;
    newf = OrgGeogebraCommonKernelOptimizationFitRealFunction_valueWithDouble_withDoubleArray_(self, x, pars);
    *IOSDoubleArray_GetRef(gradient, i) = (newf - oldf) / deltap;
    *IOSDoubleArray_GetRef(pars, i) -= deltap;
  }
  return gradient;
}

- (void)setFunctionWithOrgGeogebraCommonKernelArithmeticFunction:(OrgGeogebraCommonKernelArithmeticFunction *)f {
  OrgGeogebraCommonKernelOptimizationFitRealFunction_set_kernel_(self, [((OrgGeogebraCommonKernelArithmeticFunction *) nil_chk(f)) getKernel]);
  OrgGeogebraCommonKernelArithmeticFunctionVariable *fvar = [f getFunctionVariable];
  JavaUtilHashSet *hash_ = [f getVariables];
  if (hash_ == nil) {
    self->parametersOK_ = NO;
  }
  else {
    OrgGeogebraCommonKernelOptimizationFitRealFunction_set_gliders_(self, [hash_ toArray]);
  }
  numberOfParameters_ = ((IOSObjectArray *) nil_chk(gliders_))->size_;
  OrgGeogebraCommonKernelOptimizationFitRealFunction_setAndConsume_mydoubles_(self, [IOSObjectArray newArrayWithLength:numberOfParameters_ type:OrgGeogebraCommonKernelArithmeticMyDouble_class_()]);
  jdouble temp;
  for (jint i = 0; i < numberOfParameters_; i++) {
    temp = [((id<OrgGeogebraCommonKernelArithmeticNumberValue>) nil_chk(((id<OrgGeogebraCommonKernelArithmeticNumberValue>) check_protocol_cast(IOSObjectArray_Get(gliders_, i), @protocol(OrgGeogebraCommonKernelArithmeticNumberValue))))) getDouble];
    IOSObjectArray_SetAndConsume(mydoubles_, i, new_OrgGeogebraCommonKernelArithmeticMyDouble_initWithOrgGeogebraCommonKernelKernel_(kernel_));
    [((OrgGeogebraCommonKernelArithmeticMyDouble *) nil_chk(IOSObjectArray_Get(mydoubles_, i))) setWithDouble:temp];
  }
  OrgGeogebraCommonKernelArithmeticExpressionNode *node = [f getExpression];
  OrgGeogebraCommonKernelArithmeticExpressionNode *enf = (OrgGeogebraCommonKernelArithmeticExpressionNode *) check_class_cast([((OrgGeogebraCommonKernelArithmeticExpressionNode *) nil_chk(node)) deepCopyWithOrgGeogebraCommonKernelKernel:kernel_], [OrgGeogebraCommonKernelArithmeticExpressionNode class]);
  for (jint i = 0; i < numberOfParameters_; i++) {
    enf = [((id<OrgGeogebraCommonKernelArithmeticExpressionValue>) nil_chk([((OrgGeogebraCommonKernelArithmeticExpressionNode *) nil_chk(enf)) replaceWithOrgGeogebraCommonKernelArithmeticExpressionValue:(id<OrgGeogebraCommonKernelArithmeticExpressionValue>) check_protocol_cast(IOSObjectArray_Get(gliders_, i), @protocol(OrgGeogebraCommonKernelArithmeticExpressionValue)) withOrgGeogebraCommonKernelArithmeticExpressionValue:[((OrgGeogebraCommonKernelArithmeticMyDouble *) nil_chk(IOSObjectArray_Get(mydoubles_, i))) evaluateWithOrgGeogebraCommonKernelStringTemplate:OrgGeogebraCommonKernelStringTemplate_get_defaultTemplate_()]])) wrap];
  }
  [((OrgGeogebraCommonKernelArithmeticExpressionNode *) nil_chk(enf)) resolveVariables];
  OrgGeogebraCommonKernelOptimizationFitRealFunction_setAndConsume_newf_(self, new_OrgGeogebraCommonKernelArithmeticFunction_initWithOrgGeogebraCommonKernelArithmeticExpressionNode_withOrgGeogebraCommonKernelArithmeticFunctionVariable_(enf, fvar));
}

- (jint)getNumberOfParameters {
  return numberOfParameters_;
}

- (IOSDoubleArray *)getStartValues {
  IOSDoubleArray *startvalues = [IOSDoubleArray arrayWithLength:numberOfParameters_];
  for (jint i = 0; i < numberOfParameters_; i++) {
    *IOSDoubleArray_GetRef(startvalues, i) = [((id<OrgGeogebraCommonKernelArithmeticNumberValue>) nil_chk(((id<OrgGeogebraCommonKernelArithmeticNumberValue>) check_protocol_cast(IOSObjectArray_Get(nil_chk(gliders_), i), @protocol(OrgGeogebraCommonKernelArithmeticNumberValue))))) getDouble];
  }
  return startvalues;
}

- (jdouble)evaluateWithDouble:(jdouble)x
              withDoubleArray:(IOSDoubleArray *)pars {
  return OrgGeogebraCommonKernelOptimizationFitRealFunction_valueWithDouble_withDoubleArray_(self, x, pars);
}

- (jdouble)evaluate {
  return lastvalue_;
}

- (jdouble)evaluateWithDouble:(jdouble)x {
  return [((OrgGeogebraCommonKernelArithmeticFunction *) nil_chk(newf_)) evaluateWithDouble:x];
}

- (OrgGeogebraCommonKernelArithmeticFunction *)getFunction {
  return newf_;
}

- (IOSObjectArray *)getCoeffs {
  return mydoubles_;
}

- (void)dealloc {
  RELEASE_(kernel_);
  RELEASE_(gliders_);
  RELEASE_(newf_);
  RELEASE_(mydoubles_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "init", "FitRealFunction", NULL, 0x1, NULL, NULL },
    { "initWithOrgGeogebraCommonKernelArithmeticFunction:", "FitRealFunction", NULL, 0x1, NULL, NULL },
    { "valueWithDouble:withDoubleArray:", "value", "D", 0x11, NULL, NULL },
    { "gradientWithDouble:withDoubleArray:", "gradient", "[D", 0x11, NULL, NULL },
    { "setFunctionWithOrgGeogebraCommonKernelArithmeticFunction:", "setFunction", "V", 0x1, NULL, NULL },
    { "getNumberOfParameters", NULL, "I", 0x11, NULL, NULL },
    { "getStartValues", NULL, "[D", 0x11, NULL, NULL },
    { "evaluateWithDouble:withDoubleArray:", "evaluate", "D", 0x11, NULL, NULL },
    { "evaluate", NULL, "D", 0x11, NULL, NULL },
    { "evaluateWithDouble:", "evaluate", "D", 0x11, NULL, NULL },
    { "getFunction", NULL, "Lorg.geogebra.common.kernel.arithmetic.Function;", 0x11, NULL, NULL },
    { "getCoeffs", NULL, "[Lorg.geogebra.common.kernel.arithmetic.MyDouble;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "kernel_", NULL, 0x2, "Lorg.geogebra.common.kernel.Kernel;", NULL, NULL,  },
    { "numberOfParameters_", NULL, 0x2, "I", NULL, NULL,  },
    { "gliders_", NULL, 0x2, "[Ljava.lang.Object;", NULL, NULL,  },
    { "newf_", NULL, 0x2, "Lorg.geogebra.common.kernel.arithmetic.Function;", NULL, NULL,  },
    { "lastvalue_", NULL, 0x2, "D", NULL, NULL,  },
    { "mydoubles_", NULL, 0x2, "[Lorg.geogebra.common.kernel.arithmetic.MyDouble;", NULL, NULL,  },
    { "parametersOK_", NULL, 0x1, "Z", NULL, NULL,  },
  };
  static const J2ObjcClassInfo _OrgGeogebraCommonKernelOptimizationFitRealFunction = { 2, "FitRealFunction", "org.geogebra.common.kernel.optimization", NULL, 0x1, 12, methods, 7, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgGeogebraCommonKernelOptimizationFitRealFunction;
}

@end

void OrgGeogebraCommonKernelOptimizationFitRealFunction_init(OrgGeogebraCommonKernelOptimizationFitRealFunction *self) {
  NSObject_init(self);
  OrgGeogebraCommonKernelOptimizationFitRealFunction_set_kernel_(self, nil);
  self->numberOfParameters_ = 0;
  OrgGeogebraCommonKernelOptimizationFitRealFunction_set_gliders_(self, nil);
  OrgGeogebraCommonKernelOptimizationFitRealFunction_set_newf_(self, nil);
  self->lastvalue_ = 0.0;
  OrgGeogebraCommonKernelOptimizationFitRealFunction_set_mydoubles_(self, nil);
  self->parametersOK_ = YES;
}

OrgGeogebraCommonKernelOptimizationFitRealFunction *new_OrgGeogebraCommonKernelOptimizationFitRealFunction_init() {
  OrgGeogebraCommonKernelOptimizationFitRealFunction *self = [OrgGeogebraCommonKernelOptimizationFitRealFunction alloc];
  OrgGeogebraCommonKernelOptimizationFitRealFunction_init(self);
  return self;
}

void OrgGeogebraCommonKernelOptimizationFitRealFunction_initWithOrgGeogebraCommonKernelArithmeticFunction_(OrgGeogebraCommonKernelOptimizationFitRealFunction *self, OrgGeogebraCommonKernelArithmeticFunction *f) {
  NSObject_init(self);
  OrgGeogebraCommonKernelOptimizationFitRealFunction_set_kernel_(self, nil);
  self->numberOfParameters_ = 0;
  OrgGeogebraCommonKernelOptimizationFitRealFunction_set_gliders_(self, nil);
  OrgGeogebraCommonKernelOptimizationFitRealFunction_set_newf_(self, nil);
  self->lastvalue_ = 0.0;
  OrgGeogebraCommonKernelOptimizationFitRealFunction_set_mydoubles_(self, nil);
  self->parametersOK_ = YES;
  [self setFunctionWithOrgGeogebraCommonKernelArithmeticFunction:f];
}

OrgGeogebraCommonKernelOptimizationFitRealFunction *new_OrgGeogebraCommonKernelOptimizationFitRealFunction_initWithOrgGeogebraCommonKernelArithmeticFunction_(OrgGeogebraCommonKernelArithmeticFunction *f) {
  OrgGeogebraCommonKernelOptimizationFitRealFunction *self = [OrgGeogebraCommonKernelOptimizationFitRealFunction alloc];
  OrgGeogebraCommonKernelOptimizationFitRealFunction_initWithOrgGeogebraCommonKernelArithmeticFunction_(self, f);
  return self;
}

jdouble OrgGeogebraCommonKernelOptimizationFitRealFunction_valueWithDouble_withDoubleArray_(OrgGeogebraCommonKernelOptimizationFitRealFunction *self, jdouble x, IOSDoubleArray *pars) {
  for (jint i = 0; i < self->numberOfParameters_; i++) {
    [((OrgGeogebraCommonKernelArithmeticMyDouble *) nil_chk(IOSObjectArray_Get(nil_chk(self->mydoubles_), i))) setWithDouble:IOSDoubleArray_Get(nil_chk(pars), i)];
  }
  self->lastvalue_ = [((OrgGeogebraCommonKernelArithmeticFunction *) nil_chk(self->newf_)) evaluateWithDouble:x];
  return self->lastvalue_;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgGeogebraCommonKernelOptimizationFitRealFunction)
