//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/GeogebraiOS/GeogebraiOS/sources/org/geogebra/common/kernel/locusequ/AlgoEnvelope.java
//


#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/lang/Exception.h"
#include "java/lang/StringBuilder.h"
#include "java/lang/Throwable.h"
#include "java/util/ArrayList.h"
#include "java/util/Arrays.h"
#include "java/util/Collection.h"
#include "java/util/HashSet.h"
#include "java/util/Iterator.h"
#include "java/util/Set.h"
#include "java/util/TreeSet.h"
#include "org/geogebra/common/cas/GeoGebraCAS.h"
#include "org/geogebra/common/cas/giac/CASgiac.h"
#include "org/geogebra/common/cas/singularws/SingularWebService.h"
#include "org/geogebra/common/kernel/CASGenericInterface.h"
#include "org/geogebra/common/kernel/Construction.h"
#include "org/geogebra/common/kernel/GeoGebraCasInterface.h"
#include "org/geogebra/common/kernel/Kernel.h"
#include "org/geogebra/common/kernel/Path.h"
#include "org/geogebra/common/kernel/StringTemplate.h"
#include "org/geogebra/common/kernel/algos/AlgoElement.h"
#include "org/geogebra/common/kernel/algos/AlgoPointOnPath.h"
#include "org/geogebra/common/kernel/commands/Commands.h"
#include "org/geogebra/common/kernel/geos/GeoElement.h"
#include "org/geogebra/common/kernel/geos/GeoPoint.h"
#include "org/geogebra/common/kernel/implicit/GeoImplicitPoly.h"
#include "org/geogebra/common/kernel/locusequ/AlgoEnvelope.h"
#include "org/geogebra/common/kernel/locusequ/CASTranslator.h"
#include "org/geogebra/common/kernel/locusequ/EquationAuxiliarSymbolicPoint.h"
#include "org/geogebra/common/kernel/locusequ/EquationHelpers.h"
#include "org/geogebra/common/kernel/locusequ/EquationList.h"
#include "org/geogebra/common/kernel/locusequ/EquationPoint.h"
#include "org/geogebra/common/kernel/locusequ/EquationScope.h"
#include "org/geogebra/common/kernel/locusequ/EquationSystem.h"
#include "org/geogebra/common/kernel/locusequ/arith/Equation.h"
#include "org/geogebra/common/kernel/locusequ/arith/EquationSymbolicValue.h"
#include "org/geogebra/common/main/App.h"
#include "org/geogebra/common/util/debug/Log.h"

@interface OrgGeogebraCommonKernelLocusequAlgoEnvelope () {
 @public
  OrgGeogebraCommonKernelGeosGeoPoint *movingPoint_;
  OrgGeogebraCommonKernelGeosGeoElement *path_;
  OrgGeogebraCommonKernelImplicitGeoImplicitPoly *geoPoly_;
  IOSObjectArray *efficientInput_AlgoEnvelope_, *standardInput_;
}

- (NSString *)getImplicitPoly;

+ (void)addAlgoIfNotVisitedWithOrgGeogebraCommonKernelLocusequEquationList:(OrgGeogebraCommonKernelLocusequEquationList *)restrictions
                               withOrgGeogebraCommonKernelAlgosAlgoElement:(OrgGeogebraCommonKernelAlgosAlgoElement *)algo
                          withOrgGeogebraCommonKernelLocusequEquationScope:(OrgGeogebraCommonKernelLocusequEquationScope *)scope
                                                           withJavaUtilSet:(id<JavaUtilSet>)visitedAlgos;

@end

J2OBJC_FIELD_SETTER(OrgGeogebraCommonKernelLocusequAlgoEnvelope, movingPoint_, OrgGeogebraCommonKernelGeosGeoPoint *)
J2OBJC_FIELD_SETTER(OrgGeogebraCommonKernelLocusequAlgoEnvelope, path_, OrgGeogebraCommonKernelGeosGeoElement *)
J2OBJC_FIELD_SETTER(OrgGeogebraCommonKernelLocusequAlgoEnvelope, geoPoly_, OrgGeogebraCommonKernelImplicitGeoImplicitPoly *)
J2OBJC_FIELD_SETTER(OrgGeogebraCommonKernelLocusequAlgoEnvelope, efficientInput_AlgoEnvelope_, IOSObjectArray *)
J2OBJC_FIELD_SETTER(OrgGeogebraCommonKernelLocusequAlgoEnvelope, standardInput_, IOSObjectArray *)

__attribute__((unused)) static NSString *OrgGeogebraCommonKernelLocusequAlgoEnvelope_getImplicitPoly(OrgGeogebraCommonKernelLocusequAlgoEnvelope *self);

__attribute__((unused)) static void OrgGeogebraCommonKernelLocusequAlgoEnvelope_addAlgoIfNotVisitedWithOrgGeogebraCommonKernelLocusequEquationList_withOrgGeogebraCommonKernelAlgosAlgoElement_withOrgGeogebraCommonKernelLocusequEquationScope_withJavaUtilSet_(OrgGeogebraCommonKernelLocusequEquationList *restrictions, OrgGeogebraCommonKernelAlgosAlgoElement *algo, OrgGeogebraCommonKernelLocusequEquationScope *scope, id<JavaUtilSet> visitedAlgos);

NSString *OrgGeogebraCommonKernelLocusequAlgoEnvelope_CLASS_NAME_ = @"AlgoEnvelope";

@implementation OrgGeogebraCommonKernelLocusequAlgoEnvelope

- (instancetype)initWithOrgGeogebraCommonKernelConstruction:(OrgGeogebraCommonKernelConstruction *)cons
                                               withNSString:(NSString *)label
                  withOrgGeogebraCommonKernelGeosGeoElement:(OrgGeogebraCommonKernelGeosGeoElement *)path
                    withOrgGeogebraCommonKernelGeosGeoPoint:(OrgGeogebraCommonKernelGeosGeoPoint *)movingPoint {
  OrgGeogebraCommonKernelLocusequAlgoEnvelope_initWithOrgGeogebraCommonKernelConstruction_withNSString_withOrgGeogebraCommonKernelGeosGeoElement_withOrgGeogebraCommonKernelGeosGeoPoint_(self, cons, label, path, movingPoint);
  return self;
}

- (instancetype)initWithOrgGeogebraCommonKernelConstruction:(OrgGeogebraCommonKernelConstruction *)cons
                  withOrgGeogebraCommonKernelGeosGeoElement:(OrgGeogebraCommonKernelGeosGeoElement *)path
                    withOrgGeogebraCommonKernelGeosGeoPoint:(OrgGeogebraCommonKernelGeosGeoPoint *)movingPoint {
  OrgGeogebraCommonKernelLocusequAlgoEnvelope_initWithOrgGeogebraCommonKernelConstruction_withOrgGeogebraCommonKernelGeosGeoElement_withOrgGeogebraCommonKernelGeosGeoPoint_(self, cons, path, movingPoint);
  return self;
}

- (void)setInputOutput {
  JavaUtilTreeSet *inSet = [new_JavaUtilTreeSet_init() autorelease];
  [inSet addWithId:[((id<OrgGeogebraCommonKernelPath>) nil_chk([((OrgGeogebraCommonKernelGeosGeoPoint *) nil_chk(self->movingPoint_)) getPath])) toGeoElement]];
  id<JavaUtilIterator> it = [((JavaUtilTreeSet *) nil_chk([((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(self->path_)) getAllPredecessors])) iterator];
  while ([((id<JavaUtilIterator>) nil_chk(it)) hasNext]) {
    OrgGeogebraCommonKernelGeosGeoElement *geo = [it next];
    if ([((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(geo)) isIndependent] || [geo isPointOnPath]) {
      [inSet addWithId:geo];
    }
  }
  [inSet removeWithId:movingPoint_];
  OrgGeogebraCommonKernelLocusequAlgoEnvelope_setAndConsume_efficientInput_AlgoEnvelope_(self, [IOSObjectArray newArrayWithLength:[inSet size] type:OrgGeogebraCommonKernelGeosGeoElement_class_()]);
  OrgGeogebraCommonKernelLocusequAlgoEnvelope_set_efficientInput_AlgoEnvelope_(self, [inSet toArrayWithNSObjectArray:efficientInput_AlgoEnvelope_]);
  OrgGeogebraCommonKernelLocusequAlgoEnvelope_setAndConsume_standardInput_(self, [IOSObjectArray newArrayWithLength:2 type:OrgGeogebraCommonKernelGeosGeoElement_class_()]);
  IOSObjectArray_Set(standardInput_, 0, self->path_);
  IOSObjectArray_Set(standardInput_, 1, self->movingPoint_);
  [self setOutputLengthWithInt:1];
  [self setOutputWithInt:0 withOrgGeogebraCommonKernelGeosGeoElement:self->geoPoly_];
  [self setEfficientDependenciesWithOrgGeogebraCommonKernelGeosGeoElementArray:standardInput_ withOrgGeogebraCommonKernelGeosGeoElementArray:efficientInput_AlgoEnvelope_];
}

- (OrgGeogebraCommonKernelImplicitGeoImplicitPoly *)getPoly {
  return self->geoPoly_;
}

- (void)compute {
  NSString *result = nil;
  @try {
    result = OrgGeogebraCommonKernelLocusequAlgoEnvelope_getImplicitPoly(self);
  }
  @catch (JavaLangThrowable *ex) {
    OrgGeogebraCommonUtilDebugLog_warnWithNSString_(@"Error computing implicit curve");
  }
  if (result != nil) {
    @try {
      [((OrgGeogebraCommonKernelImplicitGeoImplicitPoly *) nil_chk(self->geoPoly_)) setCoeffWithDoubleArray2:OrgGeogebraCommonKernelLocusequCASTranslator_getBivarPolyCoefficientsSingularWithNSString_(result)];
      [self->geoPoly_ setDefined];
    }
    @catch (JavaLangException *e) {
      [((OrgGeogebraCommonKernelImplicitGeoImplicitPoly *) nil_chk(self->geoPoly_)) setUndefined];
    }
  }
  else {
    [((OrgGeogebraCommonKernelImplicitGeoImplicitPoly *) nil_chk(self->geoPoly_)) setUndefined];
  }
}

- (NSString *)getImplicitPoly {
  return OrgGeogebraCommonKernelLocusequAlgoEnvelope_getImplicitPoly(self);
}

+ (void)addAlgoIfNotVisitedWithOrgGeogebraCommonKernelLocusequEquationList:(OrgGeogebraCommonKernelLocusequEquationList *)restrictions
                               withOrgGeogebraCommonKernelAlgosAlgoElement:(OrgGeogebraCommonKernelAlgosAlgoElement *)algo
                          withOrgGeogebraCommonKernelLocusequEquationScope:(OrgGeogebraCommonKernelLocusequEquationScope *)scope
                                                           withJavaUtilSet:(id<JavaUtilSet>)visitedAlgos {
  OrgGeogebraCommonKernelLocusequAlgoEnvelope_addAlgoIfNotVisitedWithOrgGeogebraCommonKernelLocusequEquationList_withOrgGeogebraCommonKernelAlgosAlgoElement_withOrgGeogebraCommonKernelLocusequEquationScope_withJavaUtilSet_(restrictions, algo, scope, visitedAlgos);
}

- (OrgGeogebraCommonKernelCommandsCommandsEnum *)getClassName {
  return OrgGeogebraCommonKernelCommandsCommandsEnum_get_Envelope();
}

- (void)dealloc {
  RELEASE_(movingPoint_);
  RELEASE_(path_);
  RELEASE_(geoPoly_);
  RELEASE_(efficientInput_AlgoEnvelope_);
  RELEASE_(standardInput_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgGeogebraCommonKernelConstruction:withNSString:withOrgGeogebraCommonKernelGeosGeoElement:withOrgGeogebraCommonKernelGeosGeoPoint:", "AlgoEnvelope", NULL, 0x1, NULL, NULL },
    { "initWithOrgGeogebraCommonKernelConstruction:withOrgGeogebraCommonKernelGeosGeoElement:withOrgGeogebraCommonKernelGeosGeoPoint:", "AlgoEnvelope", NULL, 0x1, NULL, NULL },
    { "setInputOutput", NULL, "V", 0x4, NULL, NULL },
    { "getPoly", NULL, "Lorg.geogebra.common.kernel.implicit.GeoImplicitPoly;", 0x1, NULL, NULL },
    { "compute", NULL, "V", 0x1, NULL, NULL },
    { "getImplicitPoly", NULL, "Ljava.lang.String;", 0x2, "Ljava.lang.Throwable;", NULL },
    { "addAlgoIfNotVisitedWithOrgGeogebraCommonKernelLocusequEquationList:withOrgGeogebraCommonKernelAlgosAlgoElement:withOrgGeogebraCommonKernelLocusequEquationScope:withJavaUtilSet:", "addAlgoIfNotVisited", "V", 0xa, NULL, NULL },
    { "getClassName", NULL, "Lorg.geogebra.common.kernel.commands.Commands;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "movingPoint_", NULL, 0x2, "Lorg.geogebra.common.kernel.geos.GeoPoint;", NULL, NULL,  },
    { "path_", NULL, 0x2, "Lorg.geogebra.common.kernel.geos.GeoElement;", NULL, NULL,  },
    { "CLASS_NAME_", NULL, 0x19, "Ljava.lang.String;", &OrgGeogebraCommonKernelLocusequAlgoEnvelope_CLASS_NAME_, NULL,  },
    { "geoPoly_", NULL, 0x2, "Lorg.geogebra.common.kernel.implicit.GeoImplicitPoly;", NULL, NULL,  },
    { "efficientInput_AlgoEnvelope_", "efficientInput", 0x2, "[Lorg.geogebra.common.kernel.geos.GeoElement;", NULL, NULL,  },
    { "standardInput_", NULL, 0x2, "[Lorg.geogebra.common.kernel.geos.GeoElement;", NULL, NULL,  },
  };
  static const J2ObjcClassInfo _OrgGeogebraCommonKernelLocusequAlgoEnvelope = { 2, "AlgoEnvelope", "org.geogebra.common.kernel.locusequ", NULL, 0x1, 8, methods, 6, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgGeogebraCommonKernelLocusequAlgoEnvelope;
}

@end

void OrgGeogebraCommonKernelLocusequAlgoEnvelope_initWithOrgGeogebraCommonKernelConstruction_withNSString_withOrgGeogebraCommonKernelGeosGeoElement_withOrgGeogebraCommonKernelGeosGeoPoint_(OrgGeogebraCommonKernelLocusequAlgoEnvelope *self, OrgGeogebraCommonKernelConstruction *cons, NSString *label, OrgGeogebraCommonKernelGeosGeoElement *path, OrgGeogebraCommonKernelGeosGeoPoint *movingPoint) {
  OrgGeogebraCommonKernelLocusequAlgoEnvelope_initWithOrgGeogebraCommonKernelConstruction_withOrgGeogebraCommonKernelGeosGeoElement_withOrgGeogebraCommonKernelGeosGeoPoint_(self, cons, path, movingPoint);
  [((OrgGeogebraCommonKernelImplicitGeoImplicitPoly *) nil_chk(self->geoPoly_)) setLabelWithNSString:label];
}

OrgGeogebraCommonKernelLocusequAlgoEnvelope *new_OrgGeogebraCommonKernelLocusequAlgoEnvelope_initWithOrgGeogebraCommonKernelConstruction_withNSString_withOrgGeogebraCommonKernelGeosGeoElement_withOrgGeogebraCommonKernelGeosGeoPoint_(OrgGeogebraCommonKernelConstruction *cons, NSString *label, OrgGeogebraCommonKernelGeosGeoElement *path, OrgGeogebraCommonKernelGeosGeoPoint *movingPoint) {
  OrgGeogebraCommonKernelLocusequAlgoEnvelope *self = [OrgGeogebraCommonKernelLocusequAlgoEnvelope alloc];
  OrgGeogebraCommonKernelLocusequAlgoEnvelope_initWithOrgGeogebraCommonKernelConstruction_withNSString_withOrgGeogebraCommonKernelGeosGeoElement_withOrgGeogebraCommonKernelGeosGeoPoint_(self, cons, label, path, movingPoint);
  return self;
}

void OrgGeogebraCommonKernelLocusequAlgoEnvelope_initWithOrgGeogebraCommonKernelConstruction_withOrgGeogebraCommonKernelGeosGeoElement_withOrgGeogebraCommonKernelGeosGeoPoint_(OrgGeogebraCommonKernelLocusequAlgoEnvelope *self, OrgGeogebraCommonKernelConstruction *cons, OrgGeogebraCommonKernelGeosGeoElement *path, OrgGeogebraCommonKernelGeosGeoPoint *movingPoint) {
  OrgGeogebraCommonKernelAlgosAlgoElement_initWithOrgGeogebraCommonKernelConstruction_(self, cons);
  OrgGeogebraCommonKernelLocusequAlgoEnvelope_set_movingPoint_(self, movingPoint);
  OrgGeogebraCommonKernelLocusequAlgoEnvelope_set_path_(self, path);
  OrgGeogebraCommonKernelLocusequAlgoEnvelope_setAndConsume_geoPoly_(self, new_OrgGeogebraCommonKernelImplicitGeoImplicitPoly_initWithOrgGeogebraCommonKernelConstruction_(cons));
  [self setInputOutput];
  [self compute];
}

OrgGeogebraCommonKernelLocusequAlgoEnvelope *new_OrgGeogebraCommonKernelLocusequAlgoEnvelope_initWithOrgGeogebraCommonKernelConstruction_withOrgGeogebraCommonKernelGeosGeoElement_withOrgGeogebraCommonKernelGeosGeoPoint_(OrgGeogebraCommonKernelConstruction *cons, OrgGeogebraCommonKernelGeosGeoElement *path, OrgGeogebraCommonKernelGeosGeoPoint *movingPoint) {
  OrgGeogebraCommonKernelLocusequAlgoEnvelope *self = [OrgGeogebraCommonKernelLocusequAlgoEnvelope alloc];
  OrgGeogebraCommonKernelLocusequAlgoEnvelope_initWithOrgGeogebraCommonKernelConstruction_withOrgGeogebraCommonKernelGeosGeoElement_withOrgGeogebraCommonKernelGeosGeoPoint_(self, cons, path, movingPoint);
  return self;
}

NSString *OrgGeogebraCommonKernelLocusequAlgoEnvelope_getImplicitPoly(OrgGeogebraCommonKernelLocusequAlgoEnvelope *self) {
  NSString *locusLib = OrgGeogebraCommonCasSingularwsSingularWebService_getLocusLib();
  OrgGeogebraCommonKernelLocusequEquationScope *scope = [new_OrgGeogebraCommonKernelLocusequEquationScope_initWithOrgGeogebraCommonKernelGeosGeoElement_withOrgGeogebraCommonKernelGeosGeoPoint_(self->path_, self->movingPoint_) autorelease];
  IOSObjectArray *points = OrgGeogebraCommonKernelLocusequEquationHelpers_getDependentPredecessorPointsForElementWithOrgGeogebraCommonKernelGeosGeoElement_(self->path_);
  OrgGeogebraCommonKernelLocusequEquationPoint *pequ;
  OrgGeogebraCommonKernelLocusequEquationList *restrictions = [new_OrgGeogebraCommonKernelLocusequEquationList_init() autorelease];
  OrgGeogebraCommonKernelAlgosAlgoElement *algo;
  id<JavaUtilSet> visitedAlgos = [new_JavaUtilHashSet_init() autorelease];
  jboolean constructionIsFeasible = YES;
  {
    IOSObjectArray *a__ = points;
    OrgGeogebraCommonKernelGeosGeoPoint * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    OrgGeogebraCommonKernelGeosGeoPoint * const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      OrgGeogebraCommonKernelGeosGeoPoint *p = *b__++;
      pequ = [scope getPointWithOrgGeogebraCommonKernelGeosGeoPoint:p];
      if (![((OrgGeogebraCommonKernelLocusequEquationPoint *) nil_chk(pequ)) isIndependent]) {
        OrgGeogebraCommonKernelLocusequAlgoEnvelope_addAlgoIfNotVisitedWithOrgGeogebraCommonKernelLocusequEquationList_withOrgGeogebraCommonKernelAlgosAlgoElement_withOrgGeogebraCommonKernelLocusequEquationScope_withJavaUtilSet_(restrictions, [((OrgGeogebraCommonKernelGeosGeoPoint *) nil_chk(p)) getParentAlgorithm], scope, visitedAlgos);
        if ([p getParentAlgorithm] != nil && ![((OrgGeogebraCommonKernelAlgosAlgoElement *) nil_chk([p getParentAlgorithm])) isLocusEquable]) {
          constructionIsFeasible = NO;
          break;
        }
        for (id __strong algoObj in nil_chk([p getAlgorithmList])) {
          algo = (OrgGeogebraCommonKernelAlgosAlgoElement *) check_class_cast(algoObj, [OrgGeogebraCommonKernelAlgosAlgoElement class]);
          OrgGeogebraCommonKernelLocusequAlgoEnvelope_addAlgoIfNotVisitedWithOrgGeogebraCommonKernelLocusequEquationList_withOrgGeogebraCommonKernelAlgosAlgoElement_withOrgGeogebraCommonKernelLocusequEquationScope_withJavaUtilSet_(restrictions, algo, scope, visitedAlgos);
        }
      }
    }
  }
  for (OrgGeogebraCommonKernelLocusequEquationAuxiliarSymbolicPoint * __strong p in nil_chk([scope getAuxiliarSymbolicPoints])) {
    [restrictions addAllWithJavaUtilCollection:[((OrgGeogebraCommonKernelLocusequEquationAuxiliarSymbolicPoint *) nil_chk(p)) getRestrictions]];
  }
  OrgGeogebraCommonKernelGeosGeoPoint *locusPoint = [new_OrgGeogebraCommonKernelGeosGeoPoint_initWithOrgGeogebraCommonKernelConstruction_(self->cons_) autorelease];
  OrgGeogebraCommonKernelAlgosAlgoPointOnPath *apop = [new_OrgGeogebraCommonKernelAlgosAlgoPointOnPath_initWithOrgGeogebraCommonKernelConstruction_withOrgGeogebraCommonKernelPath_withDouble_withDouble_(self->cons_, (id<OrgGeogebraCommonKernelPath>) check_protocol_cast(self->path_, @protocol(OrgGeogebraCommonKernelPath)), 1, 1) autorelease];
  [locusPoint setParentAlgorithmWithOrgGeogebraCommonKernelAlgosAlgoElement:apop];
  OrgGeogebraCommonKernelLocusequEquationList *last = [new_OrgGeogebraCommonKernelLocusequEquationList_init() autorelease];
  OrgGeogebraCommonKernelLocusequAlgoEnvelope_addAlgoIfNotVisitedWithOrgGeogebraCommonKernelLocusequEquationList_withOrgGeogebraCommonKernelAlgosAlgoElement_withOrgGeogebraCommonKernelLocusequEquationScope_withJavaUtilSet_(last, apop, scope, visitedAlgos);
  [locusPoint remove];
  if (!constructionIsFeasible) {
    return nil;
  }
  OrgGeogebraCommonKernelLocusequCASTranslator *ct = [new_OrgGeogebraCommonKernelLocusequCASTranslator_initWithOrgGeogebraCommonKernelKernel_(self->kernel_) autorelease];
  OrgGeogebraCommonKernelLocusequEquationSystem *es = [new_OrgGeogebraCommonKernelLocusequEquationSystem_initWithOrgGeogebraCommonKernelLocusequEquationList_withOrgGeogebraCommonKernelLocusequEquationScope_(restrictions, scope) autorelease];
  id<JavaUtilCollection> restrictionsT = [ct translateWithOrgGeogebraCommonKernelLocusequEquationSystem:es];
  es = [new_OrgGeogebraCommonKernelLocusequEquationSystem_initWithOrgGeogebraCommonKernelLocusequEquationList_withOrgGeogebraCommonKernelLocusequEquationScope_(last, scope) autorelease];
  id<JavaUtilCollection> lastT = [ct translateWithOrgGeogebraCommonKernelLocusequEquationSystem:es];
  id<JavaUtilCollection> scopeVars = [scope getAllVariables];
  jint varsN = [((id<JavaUtilCollection>) nil_chk(scopeVars)) size];
  IOSIntArray *scopeVarsI = [IOSIntArray arrayWithLength:varsN];
  id<JavaUtilIterator> it = [scopeVars iterator];
  jint i = 0;
  while ([((id<JavaUtilIterator>) nil_chk(it)) hasNext]) {
    *IOSIntArray_GetRef(scopeVarsI, i++) = [((OrgGeogebraCommonKernelLocusequArithEquationSymbolicValue *) nil_chk(((OrgGeogebraCommonKernelLocusequArithEquationSymbolicValue *) check_class_cast([it next], [OrgGeogebraCommonKernelLocusequArithEquationSymbolicValue class])))) getId];
  }
  JavaUtilArrays_sortWithIntArray_(scopeVarsI);
  NSString *varx = JreStrcat("CI", 'x', IOSIntArray_Get(scopeVarsI, varsN - 2));
  NSString *vary = JreStrcat("CI", 'x', IOSIntArray_Get(scopeVarsI, varsN - 1));
  IOSObjectArray *lastS = [IOSObjectArray arrayWithLength:[((id<JavaUtilCollection>) nil_chk(lastT)) size] type:NSString_class_()];
  it = [lastT iterator];
  i = 0;
  while ([((id<JavaUtilIterator>) nil_chk(it)) hasNext]) {
    NSString *eq = [nil_chk([it next]) description];
    eq = [((NSString *) nil_chk(eq)) replaceAll:varx withReplacement:@"x"];
    eq = [((NSString *) nil_chk(eq)) replaceAll:vary withReplacement:@"y"];
    eq = OrgGeogebraCommonKernelLocusequCASTranslator_convertFloatsToRationalsWithNSString_(eq);
    IOSObjectArray_Set(lastS, i++, eq);
  }
  NSString *vars = @"";
  for (i = 0; i < varsN - 2; ++i) {
    vars = JreStrcat("$$", vars, JreStrcat("CI", 'x', IOSIntArray_Get(scopeVarsI, i)));
    if (i < varsN - 3) {
      vars = JreStrcat("$C", vars, ',');
    }
  }
  NSString *polys = @"";
  it = [((id<JavaUtilCollection>) nil_chk(restrictionsT)) iterator];
  while ([((id<JavaUtilIterator>) nil_chk(it)) hasNext]) {
    polys = JreStrcat("$$", polys, JreStrcat("$C", OrgGeogebraCommonKernelLocusequCASTranslator_convertFloatsToRationalsWithNSString_([nil_chk([it next]) description]), ','));
  }
  it = [lastT iterator];
  for (i = 0; i < lastS->size_; ++i) {
    polys = JreStrcat("$$", polys, OrgGeogebraCommonKernelLocusequCASTranslator_convertFloatsToRationalsWithNSString_(IOSObjectArray_Get(lastS, i)));
    if (i < lastS->size_ - 1) {
      polys = JreStrcat("$C", polys, ',');
    }
  }
  JavaLangStringBuilder *script = [new_JavaLangStringBuilder_init() autorelease];
  if (((jint) [((NSString *) nil_chk(locusLib)) length]) == 0) {
    [script appendWithNSString:@"[["];
    [((JavaLangStringBuilder *) nil_chk([((JavaLangStringBuilder *) nil_chk([script appendWithNSString:@"m:=["])) appendWithNSString:polys])) appendWithNSString:@"]],[J:=det("];
    for (i = 0; i < varsN - 2; ++i) {
      [script appendWithNSString:@"["];
      for (jint j = 0; j < varsN - 2; ++j) {
        [script appendWithNSString:JreStrcat("$I$IC", @"diff(m[", i, @"],x", IOSIntArray_Get(scopeVarsI, j), ')')];
        if (j != varsN - 3) {
          [script appendWithNSString:@","];
        }
      }
      [script appendWithNSString:@"]"];
      if (i != varsN - 3) {
        [script appendWithNSString:@","];
      }
    }
    [script appendWithNSString:@")]][1][0]"];
    OrgGeogebraCommonUtilDebugLog_infoWithNSString_(JreStrcat("$@", @"[Envelope] input to giac (compute det of Jacobi matrix): ", script));
    OrgGeogebraCommonCasGeoGebraCAS *cas = (OrgGeogebraCommonCasGeoGebraCAS *) check_class_cast([((OrgGeogebraCommonKernelKernel *) nil_chk([locusPoint getKernel])) getGeoGebraCAS], [OrgGeogebraCommonCasGeoGebraCAS class]);
    @try {
      NSString *det = [((id<OrgGeogebraCommonKernelCASGenericInterface>) nil_chk([((OrgGeogebraCommonCasGeoGebraCAS *) nil_chk(cas)) getCurrentCAS])) evaluateRawWithNSString:[script description]];
      OrgGeogebraCommonUtilDebugLog_infoWithNSString_(JreStrcat("$$", @"[Envelope] output from giac (compute det of Jacobi matrix): ", det));
      NSString *script2 = [((id<OrgGeogebraCommonKernelCASGenericInterface>) nil_chk([cas getCurrentCAS])) createLocusEquationScriptWithNSString:JreStrcat("$C$", polys, ',', det) withNSString:JreStrcat("$$", vars, @",x,y") withNSString:vars];
      OrgGeogebraCommonUtilDebugLog_infoWithNSString_(JreStrcat("$$", @"[Envelope] input to giac: ", script2));
      @try {
        [cas evaluateRawWithNSString:OrgGeogebraCommonCasGiacCASgiac_get_closeString_()];
      }
      @catch (JavaLangThrowable *e) {
        [((JavaLangThrowable *) nil_chk(e)) printStackTrace];
      }
      NSString *result = [((id<OrgGeogebraCommonKernelCASGenericInterface>) nil_chk([cas getCurrentCAS])) evaluateRawWithNSString:script2];
      @try {
        [cas evaluateRawWithNSString:OrgGeogebraCommonCasGiacCASgiac_get_initString_()];
      }
      @catch (JavaLangThrowable *e) {
        [((JavaLangThrowable *) nil_chk(e)) printStackTrace];
      }
      result = [result substring:1 endIndex:((jint) [((NSString *) nil_chk(result)) length]) - 1];
      return result;
    }
    @catch (JavaLangException *ex) {
      OrgGeogebraCommonUtilDebugLog_warnWithNSString_(@"Error computing envelope");
      return nil;
    }
  }
  [script appendWithNSString:@"proc mylocusdgto(list L) {poly p=1;int i; int j; int k;for(i=1;i<=size(L);i++) { if(L[i][3]<>\"Degenerate\") { if(size(L[i][1])>1) {p=p*((L[i][1][1])^2+(L[i][1][2])^2);}else {p=p*L[i][1][1];}} } return(p); }"];
  [script appendWithNSString:@"proc myenvelopeto (list GG) {list GGG;if (GG[1][2][1]<>1) { GGG=delete(GG,1); }else { GGG=GG; };string SLo=locusto(locus(GGG));if (find(SLo,\"Normal\") == 0 and find(SLo,\"Accumulation\") == 0 and find(SLo,\"Special\") == 0){ return(1); }else { return(mylocusdgto(locus(GGG))); } }"];
  [((JavaLangStringBuilder *) nil_chk([script appendWithNSString:JreStrcat("$$$$", @"LIB \"", locusLib, @".lib\";ring r=(0,x,y),(", vars)])) appendWithNSString:@"),dp;short=0;ideal m="];
  [script appendWithNSString:polys];
  [script appendWithNSString:JreStrcat("$$$", @";poly D=det(jacob(m));ideal S=", polys, @",D;list e=myenvelopeto(grobcov(S));")];
  [script appendWithNSString:@"string ex=\"poly p=\" + string(e[1]);"];
  [script appendWithNSString:@"ring rr=0,(x,y),dp;"];
  [script appendWithNSString:@"execute(ex);"];
  [((JavaLangStringBuilder *) nil_chk([script appendWithNSString:@"printf(\"%s,%s,%s\",size(coeffs(p,x)),size(coeffs(p,y)),"])) appendWithNSString:@"coeffs(coeffs(p,x),y));"];
  OrgGeogebraCommonUtilDebugLog_infoWithNSString_(JreStrcat("$@", @"[Envelope] input to singular: ", script));
  NSString *result = [((OrgGeogebraCommonCasSingularwsSingularWebService *) nil_chk(OrgGeogebraCommonMainApp_get_singularWS_())) directCommandWithNSString:[script description]];
  OrgGeogebraCommonUtilDebugLog_infoWithNSString_(JreStrcat("$$", @"[Envelope] output from singular: ", result));
  return result;
}

void OrgGeogebraCommonKernelLocusequAlgoEnvelope_addAlgoIfNotVisitedWithOrgGeogebraCommonKernelLocusequEquationList_withOrgGeogebraCommonKernelAlgosAlgoElement_withOrgGeogebraCommonKernelLocusequEquationScope_withJavaUtilSet_(OrgGeogebraCommonKernelLocusequEquationList *restrictions, OrgGeogebraCommonKernelAlgosAlgoElement *algo, OrgGeogebraCommonKernelLocusequEquationScope *scope, id<JavaUtilSet> visitedAlgos) {
  OrgGeogebraCommonKernelLocusequAlgoEnvelope_initialize();
  if (![((id<JavaUtilSet>) nil_chk(visitedAlgos)) containsWithId:algo]) {
    [visitedAlgos addWithId:algo];
    OrgGeogebraCommonKernelLocusequEquationList *eqs = [((OrgGeogebraCommonKernelLocusequEquationScope *) nil_chk(scope)) getRestrictionsFromAlgoWithOrgGeogebraCommonKernelAlgosAlgoElement:algo];
    OrgGeogebraCommonMainApp_debugWithNSString_(@"[Envelope] Restrictions init");
    OrgGeogebraCommonMainApp_debugWithNSString_(JreStrcat("$$", @"[Envelope] Construction ", [((OrgGeogebraCommonKernelGeosGeoElement *) nil_chk(IOSObjectArray_Get(nil_chk([((OrgGeogebraCommonKernelAlgosAlgoElement *) nil_chk(algo)) getOutput]), 0))) toStringWithOrgGeogebraCommonKernelStringTemplate:OrgGeogebraCommonKernelStringTemplate_get_defaultTemplate_()]));
    for (OrgGeogebraCommonKernelLocusequArithEquation * __strong eq in nil_chk(eqs)) {
      OrgGeogebraCommonMainApp_debugWithNSString_([((OrgGeogebraCommonKernelLocusequArithEquation *) nil_chk(eq)) description]);
    }
    OrgGeogebraCommonMainApp_debugWithNSString_(@"[Envelope] Restrictions end");
    [((OrgGeogebraCommonKernelLocusequEquationList *) nil_chk(restrictions)) addAllWithJavaUtilCollection:eqs];
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgGeogebraCommonKernelLocusequAlgoEnvelope)
