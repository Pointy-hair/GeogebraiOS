//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/GeoGebraiOSARC/GeoGebraiOSARC/javasources/org/geogebra/common/kernel/kernelND/GeoConicPartParameters.java
//


#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/lang/Double.h"
#include "java/lang/Math.h"
#include "java/lang/StringBuilder.h"
#include "org/geogebra/common/kernel/Kernel.h"
#include "org/geogebra/common/kernel/Matrix/Coords.h"
#include "org/geogebra/common/kernel/PathParameter.h"
#include "org/geogebra/common/kernel/geos/GeoLine.h"
#include "org/geogebra/common/kernel/geos/GeoPoint.h"
#include "org/geogebra/common/kernel/integration/EllipticArcLength.h"
#include "org/geogebra/common/kernel/kernelND/GeoConicND.h"
#include "org/geogebra/common/kernel/kernelND/GeoConicNDConstants.h"
#include "org/geogebra/common/kernel/kernelND/GeoConicPartND.h"
#include "org/geogebra/common/kernel/kernelND/GeoConicPartParameters.h"

@interface OrgGeogebraCommonKernelKernelNDGeoConicPartParameters () {
 @public
  OrgGeogebraCommonKernelKernelNDGeoConicND *conic_;
}

- (jdouble)computeArgWithDouble:(jdouble)x0
                     withDouble:(jdouble)y0;

@end

J2OBJC_FIELD_SETTER(OrgGeogebraCommonKernelKernelNDGeoConicPartParameters, conic_, OrgGeogebraCommonKernelKernelNDGeoConicND *)

__attribute__((unused)) static jdouble OrgGeogebraCommonKernelKernelNDGeoConicPartParameters_computeArgWithDouble_withDouble_(OrgGeogebraCommonKernelKernelNDGeoConicPartParameters *self, jdouble x0, jdouble y0);

@implementation OrgGeogebraCommonKernelKernelNDGeoConicPartParameters

- (instancetype)initWithOrgGeogebraCommonKernelKernelNDGeoConicND:(OrgGeogebraCommonKernelKernelNDGeoConicND *)conic
                                                          withInt:(jint)type {
  OrgGeogebraCommonKernelKernelNDGeoConicPartParameters_initWithOrgGeogebraCommonKernelKernelNDGeoConicND_withInt_(self, conic, type);
  return self;
}

- (void)setWithOrgGeogebraCommonKernelKernelNDGeoConicPartParameters:(OrgGeogebraCommonKernelKernelNDGeoConicPartParameters *)cp {
  paramStart_ = ((OrgGeogebraCommonKernelKernelNDGeoConicPartParameters *) nil_chk(cp))->paramStart_;
  paramEnd_ = cp->paramEnd_;
  paramExtent_ = cp->paramExtent_;
  posOrientation_ = cp->posOrientation_;
  conic_part_type_ = cp->conic_part_type_;
  value_ = cp->value_;
  area_ = cp->area_;
  value_defined_ = cp->value_defined_;
  keepTypeOnGeometricTransform_ = cp->keepTypeOnGeometricTransform_;
}

- (jboolean)isEqualWithOrgGeogebraCommonKernelKernelNDGeoConicPartParameters:(OrgGeogebraCommonKernelKernelNDGeoConicPartParameters *)other {
  return posOrientation_ == ((OrgGeogebraCommonKernelKernelNDGeoConicPartParameters *) nil_chk(other))->posOrientation_ && conic_part_type_ == other->conic_part_type_ && OrgGeogebraCommonKernelKernel_isEqualWithDouble_withDouble_(paramStart_, other->paramStart_) && OrgGeogebraCommonKernelKernel_isEqualWithDouble_withDouble_(paramEnd_, other->paramEnd_);
}

- (void)setParametersWithBoolean:(jboolean)isDefined
                      withDouble:(jdouble)start
                      withDouble:(jdouble)end
                     withBoolean:(jboolean)positiveOrientation {
  jdouble startParam = start;
  jdouble endParam = end;
  value_defined_ = isDefined;
  if (!value_defined_) {
    value_ = JavaLangDouble_NaN;
    return;
  }
  posOrientation_ = positiveOrientation;
  if (!posOrientation_) {
    jdouble tmp = startParam;
    startParam = endParam;
    endParam = tmp;
  }
  {
    jdouble r;
    switch ([((OrgGeogebraCommonKernelKernelNDGeoConicND *) nil_chk(conic_)) getType]) {
      case OrgGeogebraCommonKernelKernelNDGeoConicNDConstants_CONIC_CIRCLE:
      paramStart_ = OrgGeogebraCommonKernelKernel_convertToAngleValueWithDouble_(startParam);
      paramEnd_ = OrgGeogebraCommonKernelKernel_convertToAngleValueWithDouble_(endParam);
      paramExtent_ = paramEnd_ - paramStart_;
      if (paramExtent_ < 0) paramExtent_ += OrgGeogebraCommonKernelKernel_PI_2;
      r = [conic_ getHalfAxisWithInt:0];
      arcLength_ = r * paramExtent_;
      if (conic_part_type_ == OrgGeogebraCommonKernelKernelNDGeoConicNDConstants_CONIC_PART_ARC) {
        value_ = arcLength_;
        area_ = r * r * (paramExtent_ - JavaLangMath_sinWithDouble_(paramExtent_)) / 2.0;
      }
      else {
        value_ = r * r * paramExtent_ / 2.0;
        area_ = value_;
      }
      value_defined_ = (!JavaLangDouble_isNaNWithDouble_(value_) && !JavaLangDouble_isInfiniteWithDouble_(value_));
      break;
      case OrgGeogebraCommonKernelKernelNDGeoConicNDConstants_CONIC_ELLIPSE:
      paramStart_ = OrgGeogebraCommonKernelKernel_convertToAngleValueWithDouble_(startParam);
      paramEnd_ = OrgGeogebraCommonKernelKernel_convertToAngleValueWithDouble_(endParam);
      paramExtent_ = paramEnd_ - paramStart_;
      if (paramExtent_ < 0) paramExtent_ += OrgGeogebraCommonKernelKernel_PI_2;
      if (ellipticArcLength_ == nil) ellipticArcLength_ = new_OrgGeogebraCommonKernelIntegrationEllipticArcLength_initWithOrgGeogebraCommonKernelKernelNDGeoConicND_(conic_);
      if (conic_part_type_ == OrgGeogebraCommonKernelKernelNDGeoConicNDConstants_CONIC_PART_ARC) {
        value_ = [((OrgGeogebraCommonKernelIntegrationEllipticArcLength *) nil_chk(ellipticArcLength_)) computeWithDouble:paramStart_ withDouble:paramEnd_];
      }
      else {
        value_ = [conic_ getHalfAxisWithInt:0] * [conic_ getHalfAxisWithInt:1] * paramExtent_ / 2.0;
      }
      value_defined_ = (!JavaLangDouble_isNaNWithDouble_(value_) && !JavaLangDouble_isInfiniteWithDouble_(value_));
      break;
      case OrgGeogebraCommonKernelKernelNDGeoConicNDConstants_CONIC_PARALLEL_LINES:
      if (conic_part_type_ == OrgGeogebraCommonKernelKernelNDGeoConicNDConstants_CONIC_PART_ARC && posOrientation_) {
        OrgGeogebraCommonKernelGeosGeoPoint *startPoint = [((OrgGeogebraCommonKernelGeosGeoLine *) nil_chk(IOSObjectArray_Get(nil_chk(conic_->lines_), 0))) getStartPoint];
        OrgGeogebraCommonKernelGeosGeoPoint *endPoint = [((OrgGeogebraCommonKernelGeosGeoLine *) nil_chk(IOSObjectArray_Get(conic_->lines_, 0))) getEndPoint];
        if (startPoint != nil && endPoint != nil) {
          value_ = [startPoint distanceWithOrgGeogebraCommonKernelGeosGeoPoint:endPoint];
        }
        else {
          value_ = JavaLangDouble_POSITIVE_INFINITY;
          value_defined_ = NO;
          break;
        }
      }
      else {
        value_ = JavaLangDouble_POSITIVE_INFINITY;
      }
      value_defined_ = YES;
      break;
      default:
      value_defined_ = NO;
    }
  }
}

- (jdouble)getValue {
  if (!value_defined_) return JavaLangDouble_NaN;
  return value_;
}

- (jdouble)getArcLength {
  if (!value_defined_) return JavaLangDouble_NaN;
  return arcLength_;
}

- (jdouble)getArea {
  if (!value_defined_) return JavaLangDouble_NaN;
  return area_;
}

- (void)setEllipseParameterWithOrgGeogebraCommonKernelMatrixCoords:(OrgGeogebraCommonKernelMatrixCoords *)P
                          withOrgGeogebraCommonKernelPathParameter:(OrgGeogebraCommonKernelPathParameter *)pp {
  [((id<OrgGeogebraCommonKernelKernelNDGeoConicPartND>) nil_chk(((id<OrgGeogebraCommonKernelKernelNDGeoConicPartND>) check_protocol_cast(conic_, @protocol(OrgGeogebraCommonKernelKernelNDGeoConicPartND))))) superPointChangedWithOrgGeogebraCommonKernelMatrixCoords:P withOrgGeogebraCommonKernelPathParameter:pp];
  if (((OrgGeogebraCommonKernelPathParameter *) nil_chk(pp))->t_ < 0) pp->t_ += OrgGeogebraCommonKernelKernel_PI_2;
  jdouble t = pp->t_ - paramStart_;
  if (t < 0) t += OrgGeogebraCommonKernelKernel_PI_2;
  pp->t_ = t / paramExtent_;
}

- (void)clipEllipseParameterWithOrgGeogebraCommonKernelMatrixCoords:(OrgGeogebraCommonKernelMatrixCoords *)P
                           withOrgGeogebraCommonKernelPathParameter:(OrgGeogebraCommonKernelPathParameter *)pp {
  if (((OrgGeogebraCommonKernelPathParameter *) nil_chk(pp))->t_ > 0.5 + JavaLangMath_PI / paramExtent_) {
    if (posOrientation_) pp->t_ = 0;
    else pp->t_ = 1;
    [((OrgGeogebraCommonKernelKernelNDGeoConicND *) nil_chk(conic_)) pathChangedWithOrgGeogebraCommonKernelMatrixCoords:P withOrgGeogebraCommonKernelPathParameter:pp];
  }
  else if (pp->t_ > 1) {
    if (posOrientation_) pp->t_ = 1;
    else pp->t_ = 0;
    [((OrgGeogebraCommonKernelKernelNDGeoConicND *) nil_chk(conic_)) pathChangedWithOrgGeogebraCommonKernelMatrixCoords:P withOrgGeogebraCommonKernelPathParameter:pp];
  }
  else if (!posOrientation_) {
    pp->t_ = 1.0 - pp->t_;
  }
}

- (void)getXMLtagsWithJavaLangStringBuilder:(JavaLangStringBuilder *)sb {
  (void) [((JavaLangStringBuilder *) nil_chk(sb)) appendWithNSString:@"\t<outlyingIntersections val=\""];
  (void) [sb appendWithBoolean:allowOutlyingIntersections_];
  (void) [sb appendWithNSString:@"\"/>\n"];
  (void) [sb appendWithNSString:@"\t<keepTypeOnTransform val=\""];
  (void) [sb appendWithBoolean:keepTypeOnGeometricTransform_];
  (void) [sb appendWithNSString:@"\"/>\n"];
}

- (jboolean)isInRegionWithDouble:(jdouble)x0
                      withDouble:(jdouble)y0 {
  if (conic_part_type_ == OrgGeogebraCommonKernelKernelNDGeoConicNDConstants_CONIC_PART_SECTOR) {
    jdouble arg = OrgGeogebraCommonKernelKernelNDGeoConicPartParameters_computeArgWithDouble_withDouble_(self, x0, y0);
    if (arg < 0) arg += OrgGeogebraCommonKernelKernel_PI_2;
    return ((arg >= -OrgGeogebraCommonKernelKernel_STANDARD_PRECISION) && (arg <= paramExtent_ + OrgGeogebraCommonKernelKernel_STANDARD_PRECISION));
  }
  OrgGeogebraCommonKernelMatrixCoords *midPoint = [((OrgGeogebraCommonKernelKernelNDGeoConicND *) nil_chk(conic_)) getMidpoint2D];
  OrgGeogebraCommonKernelMatrixCoords *firstVec = [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk([((OrgGeogebraCommonKernelMatrixCoords *) nil_chk([conic_ getEigenvecWithInt:0])) mulWithDouble:[conic_ getHalfAxisWithInt:0] * JavaLangMath_cosWithDouble_(paramStart_)])) addWithOrgGeogebraCommonKernelMatrixCoords:[((OrgGeogebraCommonKernelMatrixCoords *) nil_chk([conic_ getEigenvecWithInt:1])) mulWithDouble:[conic_ getHalfAxisWithInt:1] * JavaLangMath_sinWithDouble_(paramStart_)]];
  OrgGeogebraCommonKernelMatrixCoords *secondVec = [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk([((OrgGeogebraCommonKernelMatrixCoords *) nil_chk([conic_ getEigenvecWithInt:0])) mulWithDouble:[conic_ getHalfAxisWithInt:0] * JavaLangMath_cosWithDouble_(paramEnd_)])) addWithOrgGeogebraCommonKernelMatrixCoords:[((OrgGeogebraCommonKernelMatrixCoords *) nil_chk([conic_ getEigenvecWithInt:1])) mulWithDouble:[conic_ getHalfAxisWithInt:1] * JavaLangMath_sinWithDouble_(paramEnd_)]];
  jdouble vx = (x0 - [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(midPoint)) getX]) - [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(firstVec)) getX], vy = (y0 - [midPoint getY]) - [firstVec getY];
  jdouble lx = [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(secondVec)) getX] - [firstVec getX], ly = [secondVec getY] - [firstVec getY];
  return (vx * ly - vy * lx > 0);
}

- (jdouble)computeArgWithDouble:(jdouble)x0
                     withDouble:(jdouble)y0 {
  return OrgGeogebraCommonKernelKernelNDGeoConicPartParameters_computeArgWithDouble_withDouble_(self, x0, y0);
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgGeogebraCommonKernelKernelNDGeoConicND:withInt:", "GeoConicPartParameters", NULL, 0x1, NULL, NULL },
    { "setWithOrgGeogebraCommonKernelKernelNDGeoConicPartParameters:", "set", "V", 0x1, NULL, NULL },
    { "isEqualWithOrgGeogebraCommonKernelKernelNDGeoConicPartParameters:", "isEqual", "Z", 0x11, NULL, NULL },
    { "setParametersWithBoolean:withDouble:withDouble:withBoolean:", "setParameters", "V", 0x11, NULL, NULL },
    { "getValue", NULL, "D", 0x11, NULL, NULL },
    { "getArcLength", NULL, "D", 0x11, NULL, NULL },
    { "getArea", NULL, "D", 0x11, NULL, NULL },
    { "setEllipseParameterWithOrgGeogebraCommonKernelMatrixCoords:withOrgGeogebraCommonKernelPathParameter:", "setEllipseParameter", "V", 0x1, NULL, NULL },
    { "clipEllipseParameterWithOrgGeogebraCommonKernelMatrixCoords:withOrgGeogebraCommonKernelPathParameter:", "clipEllipseParameter", "V", 0x1, NULL, NULL },
    { "getXMLtagsWithJavaLangStringBuilder:", "getXMLtags", "V", 0x1, NULL, NULL },
    { "isInRegionWithDouble:withDouble:", "isInRegion", "Z", 0x1, NULL, NULL },
    { "computeArgWithDouble:withDouble:", "computeArg", "D", 0x2, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "conic_", NULL, 0x2, "Lorg.geogebra.common.kernel.kernelND.GeoConicND;", NULL, NULL,  },
    { "paramStart_", NULL, 0x1, "D", NULL, NULL,  },
    { "paramEnd_", NULL, 0x1, "D", NULL, NULL,  },
    { "paramExtent_", NULL, 0x1, "D", NULL, NULL,  },
    { "posOrientation_", NULL, 0x1, "Z", NULL, NULL,  },
    { "conic_part_type_", NULL, 0x1, "I", NULL, NULL,  },
    { "value_", NULL, 0x1, "D", NULL, NULL,  },
    { "area_", NULL, 0x1, "D", NULL, NULL,  },
    { "arcLength_", NULL, 0x1, "D", NULL, NULL,  },
    { "value_defined_", NULL, 0x1, "Z", NULL, NULL,  },
    { "ellipticArcLength_", NULL, 0x1, "Lorg.geogebra.common.kernel.integration.EllipticArcLength;", NULL, NULL,  },
    { "allowOutlyingIntersections_", NULL, 0x1, "Z", NULL, NULL,  },
    { "keepTypeOnGeometricTransform_", NULL, 0x1, "Z", NULL, NULL,  },
  };
  static const J2ObjcClassInfo _OrgGeogebraCommonKernelKernelNDGeoConicPartParameters = { 2, "GeoConicPartParameters", "org.geogebra.common.kernel.kernelND", NULL, 0x1, 12, methods, 13, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgGeogebraCommonKernelKernelNDGeoConicPartParameters;
}

@end

void OrgGeogebraCommonKernelKernelNDGeoConicPartParameters_initWithOrgGeogebraCommonKernelKernelNDGeoConicND_withInt_(OrgGeogebraCommonKernelKernelNDGeoConicPartParameters *self, OrgGeogebraCommonKernelKernelNDGeoConicND *conic, jint type) {
  (void) NSObject_init(self);
  self->posOrientation_ = YES;
  self->allowOutlyingIntersections_ = NO;
  self->keepTypeOnGeometricTransform_ = YES;
  self->conic_ = conic;
  self->conic_part_type_ = type;
}

OrgGeogebraCommonKernelKernelNDGeoConicPartParameters *new_OrgGeogebraCommonKernelKernelNDGeoConicPartParameters_initWithOrgGeogebraCommonKernelKernelNDGeoConicND_withInt_(OrgGeogebraCommonKernelKernelNDGeoConicND *conic, jint type) {
  OrgGeogebraCommonKernelKernelNDGeoConicPartParameters *self = [OrgGeogebraCommonKernelKernelNDGeoConicPartParameters alloc];
  OrgGeogebraCommonKernelKernelNDGeoConicPartParameters_initWithOrgGeogebraCommonKernelKernelNDGeoConicND_withInt_(self, conic, type);
  return self;
}

jdouble OrgGeogebraCommonKernelKernelNDGeoConicPartParameters_computeArgWithDouble_withDouble_(OrgGeogebraCommonKernelKernelNDGeoConicPartParameters *self, jdouble x0, jdouble y0) {
  OrgGeogebraCommonKernelMatrixCoords *b = [((OrgGeogebraCommonKernelKernelNDGeoConicND *) nil_chk(self->conic_)) getMidpoint2D];
  jdouble px = x0 - [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk(b)) getX];
  jdouble py = y0 - [b getY];
  jdouble px2 = px * [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk([self->conic_ getEigenvecWithInt:0])) getX] + py * [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk([self->conic_ getEigenvecWithInt:0])) getY];
  py = px * [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk([self->conic_ getEigenvecWithInt:1])) getX] + py * [((OrgGeogebraCommonKernelMatrixCoords *) nil_chk([self->conic_ getEigenvecWithInt:1])) getY];
  jdouble arg = JavaLangMath_atan2WithDouble_withDouble_([self->conic_ getHalfAxisWithInt:0] * py, [self->conic_ getHalfAxisWithInt:1] * px2);
  if (arg < 0) arg += OrgGeogebraCommonKernelKernel_PI_2;
  return arg - self->paramStart_;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgGeogebraCommonKernelKernelNDGeoConicPartParameters)
