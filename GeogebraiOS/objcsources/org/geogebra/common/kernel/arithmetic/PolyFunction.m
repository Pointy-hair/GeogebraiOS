//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/GeoGebraiOSARC/GeoGebraiOSARC/javasources/org/geogebra/common/kernel/arithmetic/PolyFunction.java
//


#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "org/geogebra/common/kernel/Kernel.h"
#include "org/geogebra/common/kernel/arithmetic/ExpressionNode.h"
#include "org/geogebra/common/kernel/arithmetic/Function.h"
#include "org/geogebra/common/kernel/arithmetic/FunctionVariable.h"
#include "org/geogebra/common/kernel/arithmetic/MyDouble.h"
#include "org/geogebra/common/kernel/arithmetic/PolyFunction.h"
#include "org/geogebra/common/plugin/Operation.h"

@interface OrgGeogebraCommonKernelArithmeticPolyFunction () {
 @public
  jint degree_;
  OrgGeogebraCommonKernelArithmeticPolyFunction *derivative_, *integral_;
}

- (OrgGeogebraCommonKernelArithmeticPolyFunction *)buildDerivative;

- (OrgGeogebraCommonKernelArithmeticPolyFunction *)buildIntegral;

@end

J2OBJC_FIELD_SETTER(OrgGeogebraCommonKernelArithmeticPolyFunction, derivative_, OrgGeogebraCommonKernelArithmeticPolyFunction *)
J2OBJC_FIELD_SETTER(OrgGeogebraCommonKernelArithmeticPolyFunction, integral_, OrgGeogebraCommonKernelArithmeticPolyFunction *)

__attribute__((unused)) static OrgGeogebraCommonKernelArithmeticPolyFunction *OrgGeogebraCommonKernelArithmeticPolyFunction_buildDerivative(OrgGeogebraCommonKernelArithmeticPolyFunction *self);

__attribute__((unused)) static OrgGeogebraCommonKernelArithmeticPolyFunction *OrgGeogebraCommonKernelArithmeticPolyFunction_buildIntegral(OrgGeogebraCommonKernelArithmeticPolyFunction *self);

__attribute__((unused)) static IOSDoubleArray *OrgGeogebraCommonKernelArithmeticPolyFunction_evaluateDerivFuncWithDouble_(OrgGeogebraCommonKernelArithmeticPolyFunction *self, jdouble x);

@implementation OrgGeogebraCommonKernelArithmeticPolyFunction

- (instancetype)initWithInt:(jint)degree {
  OrgGeogebraCommonKernelArithmeticPolyFunction_initWithInt_(self, degree);
  return self;
}

- (instancetype)initWithDoubleArray:(IOSDoubleArray *)c {
  OrgGeogebraCommonKernelArithmeticPolyFunction_initWithDoubleArray_(self, c);
  return self;
}

- (instancetype)initWithOrgGeogebraCommonKernelArithmeticPolyFunction:(OrgGeogebraCommonKernelArithmeticPolyFunction *)pf {
  OrgGeogebraCommonKernelArithmeticPolyFunction_initWithOrgGeogebraCommonKernelArithmeticPolyFunction_(self, pf);
  return self;
}

- (IOSDoubleArray *)getCoeffs {
  return coeffs_;
}

- (IOSDoubleArray *)getCoeffsCopy {
  IOSDoubleArray *ret = [IOSDoubleArray newArrayWithLength:((IOSDoubleArray *) nil_chk(coeffs_))->size_];
  for (jint i = 0; i < coeffs_->size_; i++) {
    *IOSDoubleArray_GetRef(ret, i) = IOSDoubleArray_Get(coeffs_, i);
  }
  return ret;
}

- (jboolean)updateCoeffValues {
  return YES;
}

- (jint)getDegree {
  return degree_;
}

- (OrgGeogebraCommonKernelArithmeticPolyFunction *)getDerivative {
  if (derivative_ == nil) {
    derivative_ = OrgGeogebraCommonKernelArithmeticPolyFunction_buildDerivative(self);
  }
  return derivative_;
}

- (OrgGeogebraCommonKernelArithmeticPolyFunction *)getIntegral {
  if (integral_ == nil) {
    integral_ = OrgGeogebraCommonKernelArithmeticPolyFunction_buildIntegral(self);
  }
  return integral_;
}

- (OrgGeogebraCommonKernelArithmeticPolyFunction *)buildDerivative {
  return OrgGeogebraCommonKernelArithmeticPolyFunction_buildDerivative(self);
}

- (OrgGeogebraCommonKernelArithmeticPolyFunction *)buildIntegral {
  return OrgGeogebraCommonKernelArithmeticPolyFunction_buildIntegral(self);
}

- (IOSDoubleArray *)evaluateDerivFuncWithDouble:(jdouble)x {
  return OrgGeogebraCommonKernelArithmeticPolyFunction_evaluateDerivFuncWithDouble_(self, x);
}

- (jdouble)evaluateDerivativeWithDouble:(jdouble)x {
  return IOSDoubleArray_Get(nil_chk(OrgGeogebraCommonKernelArithmeticPolyFunction_evaluateDerivFuncWithDouble_(self, x)), 1);
}

- (jdouble)evaluateWithDouble:(jdouble)x {
  jdouble p = IOSDoubleArray_Get(nil_chk(coeffs_), degree_);
  for (jint i = degree_ - 1; i >= 0; i--) {
    p = p * x + IOSDoubleArray_Get(coeffs_, i);
  }
  return p;
}

- (IOSDoubleArray *)evaluateDerivativesWithDouble:(jdouble)x
                                          withInt:(jint)order {
  IOSDoubleArray *pd = [IOSDoubleArray newArrayWithLength:order + 1];
  jint nnd, j, i;
  jdouble cnst = 1.0;
  *IOSDoubleArray_GetRef(pd, 0) = IOSDoubleArray_Get(nil_chk(coeffs_), degree_);
  for (j = 1; j <= order; j++) *IOSDoubleArray_GetRef(pd, j) = 0.0;
  for (i = degree_ - 1; i >= 0; i--) {
    nnd = (order < (degree_ - i) ? order : degree_ - i);
    for (j = nnd; j >= 1; j--) *IOSDoubleArray_GetRef(pd, j) = IOSDoubleArray_Get(pd, j) * x + IOSDoubleArray_Get(pd, j - 1);
    *IOSDoubleArray_GetRef(pd, 0) = IOSDoubleArray_Get(pd, 0) * x + IOSDoubleArray_Get(coeffs_, i);
  }
  for (i = 2; i <= order; i++) {
    cnst *= i;
    *IOSDoubleArray_GetRef(pd, i) *= cnst;
  }
  return pd;
}

- (OrgGeogebraCommonKernelArithmeticFunction *)getFunctionWithOrgGeogebraCommonKernelKernel:(OrgGeogebraCommonKernelKernel *)kernel
                                      withOrgGeogebraCommonKernelArithmeticFunctionVariable:(OrgGeogebraCommonKernelArithmeticFunctionVariable *)fv {
  OrgGeogebraCommonKernelArithmeticExpressionNode *fvEn = new_OrgGeogebraCommonKernelArithmeticExpressionNode_initWithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonKernelArithmeticExpressionValue_(kernel, fv);
  if (degree_ == 0) {
    OrgGeogebraCommonKernelArithmeticExpressionNode *en = new_OrgGeogebraCommonKernelArithmeticExpressionNode_initWithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonKernelArithmeticExpressionValue_(kernel, new_OrgGeogebraCommonKernelArithmeticMyDouble_initWithOrgGeogebraCommonKernelKernel_withDouble_(kernel, IOSDoubleArray_Get(nil_chk(coeffs_), 0)));
    return new_OrgGeogebraCommonKernelArithmeticFunction_initWithOrgGeogebraCommonKernelArithmeticExpressionNode_withOrgGeogebraCommonKernelArithmeticFunctionVariable_(en, fv);
  }
  else if (degree_ == 1) {
    OrgGeogebraCommonKernelArithmeticExpressionNode *en = [((OrgGeogebraCommonKernelArithmeticExpressionNode *) nil_chk([fvEn multiplyRWithDouble:IOSDoubleArray_Get(nil_chk(coeffs_), 1)])) plusWithDouble:IOSDoubleArray_Get(coeffs_, 0)];
    return new_OrgGeogebraCommonKernelArithmeticFunction_initWithOrgGeogebraCommonKernelArithmeticExpressionNode_withOrgGeogebraCommonKernelArithmeticFunctionVariable_(en, fv);
  }
  OrgGeogebraCommonKernelArithmeticExpressionNode *en = [((OrgGeogebraCommonKernelArithmeticExpressionNode *) nil_chk([fvEn powerWithDouble:(degree_)])) multiplyRWithDouble:IOSDoubleArray_Get(nil_chk(coeffs_), degree_)];
  if (degree_ > 2) {
    for (jint i = degree_ - 1; i > 1; i--) {
      if (IOSDoubleArray_Get(coeffs_, i) != 0) {
        OrgGeogebraCommonKernelArithmeticExpressionNode *term = [new_OrgGeogebraCommonKernelArithmeticExpressionNode_initWithOrgGeogebraCommonKernelKernel_withOrgGeogebraCommonKernelArithmeticExpressionValue_withOrgGeogebraCommonPluginOperationEnum_withOrgGeogebraCommonKernelArithmeticExpressionValue_(kernel, fv, OrgGeogebraCommonPluginOperationEnum_get_POWER(), new_OrgGeogebraCommonKernelArithmeticMyDouble_initWithOrgGeogebraCommonKernelKernel_withDouble_(kernel, i)) multiplyRWithDouble:IOSDoubleArray_Get(coeffs_, i)];
        en = [((OrgGeogebraCommonKernelArithmeticExpressionNode *) nil_chk(en)) plusWithOrgGeogebraCommonKernelArithmeticExpressionValue:term];
      }
    }
  }
  if (!OrgGeogebraCommonKernelKernel_isZeroWithDouble_(IOSDoubleArray_Get(coeffs_, 1))) {
    en = [((OrgGeogebraCommonKernelArithmeticExpressionNode *) nil_chk(en)) plusWithOrgGeogebraCommonKernelArithmeticExpressionValue:[fvEn multiplyRWithDouble:IOSDoubleArray_Get(coeffs_, 1)]];
  }
  if (!OrgGeogebraCommonKernelKernel_isZeroWithDouble_(IOSDoubleArray_Get(coeffs_, 0))) {
    en = [((OrgGeogebraCommonKernelArithmeticExpressionNode *) nil_chk(en)) plusWithDouble:IOSDoubleArray_Get(coeffs_, 0)];
  }
  return new_OrgGeogebraCommonKernelArithmeticFunction_initWithOrgGeogebraCommonKernelArithmeticExpressionNode_withOrgGeogebraCommonKernelArithmeticFunctionVariable_(en, fv);
}

- (jboolean)isEqualWithOrgGeogebraCommonKernelArithmeticPolyFunction:(OrgGeogebraCommonKernelArithmeticPolyFunction *)poly {
  if ([((OrgGeogebraCommonKernelArithmeticPolyFunction *) nil_chk(poly)) getDegree] != degree_) {
    return NO;
  }
  IOSDoubleArray *polyCoeffs = [poly getCoeffs];
  for (jint i = 0; i <= degree_; i++) {
    if (!OrgGeogebraCommonKernelKernel_isEqualWithDouble_withDouble_(IOSDoubleArray_Get(nil_chk(polyCoeffs), i), IOSDoubleArray_Get(nil_chk(coeffs_), i))) {
      return NO;
    }
  }
  return YES;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithInt:", "PolyFunction", NULL, 0x1, NULL, NULL },
    { "initWithDoubleArray:", "PolyFunction", NULL, 0x1, NULL, NULL },
    { "initWithOrgGeogebraCommonKernelArithmeticPolyFunction:", "PolyFunction", NULL, 0x1, NULL, NULL },
    { "getCoeffs", NULL, "[D", 0x1, NULL, NULL },
    { "getCoeffsCopy", NULL, "[D", 0x1, NULL, NULL },
    { "updateCoeffValues", NULL, "Z", 0x1, NULL, NULL },
    { "getDegree", NULL, "I", 0x1, NULL, NULL },
    { "getDerivative", NULL, "Lorg.geogebra.common.kernel.arithmetic.PolyFunction;", 0x11, NULL, NULL },
    { "getIntegral", NULL, "Lorg.geogebra.common.kernel.arithmetic.PolyFunction;", 0x11, NULL, NULL },
    { "buildDerivative", NULL, "Lorg.geogebra.common.kernel.arithmetic.PolyFunction;", 0x2, NULL, NULL },
    { "buildIntegral", NULL, "Lorg.geogebra.common.kernel.arithmetic.PolyFunction;", 0x2, NULL, NULL },
    { "evaluateDerivFuncWithDouble:", "evaluateDerivFunc", "[D", 0x11, NULL, NULL },
    { "evaluateDerivativeWithDouble:", "evaluateDerivative", "D", 0x11, NULL, NULL },
    { "evaluateWithDouble:", "evaluate", "D", 0x11, NULL, NULL },
    { "evaluateDerivativesWithDouble:withInt:", "evaluateDerivatives", "[D", 0x11, NULL, NULL },
    { "getFunctionWithOrgGeogebraCommonKernelKernel:withOrgGeogebraCommonKernelArithmeticFunctionVariable:", "getFunction", "Lorg.geogebra.common.kernel.arithmetic.Function;", 0x1, NULL, NULL },
    { "isEqualWithOrgGeogebraCommonKernelArithmeticPolyFunction:", "isEqual", "Z", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "coeffs_", NULL, 0x4, "[D", NULL, NULL,  },
    { "degree_", NULL, 0x2, "I", NULL, NULL,  },
    { "derivative_", NULL, 0x2, "Lorg.geogebra.common.kernel.arithmetic.PolyFunction;", NULL, NULL,  },
    { "integral_", NULL, 0x2, "Lorg.geogebra.common.kernel.arithmetic.PolyFunction;", NULL, NULL,  },
  };
  static const J2ObjcClassInfo _OrgGeogebraCommonKernelArithmeticPolyFunction = { 2, "PolyFunction", "org.geogebra.common.kernel.arithmetic", NULL, 0x1, 17, methods, 4, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgGeogebraCommonKernelArithmeticPolyFunction;
}

@end

void OrgGeogebraCommonKernelArithmeticPolyFunction_initWithInt_(OrgGeogebraCommonKernelArithmeticPolyFunction *self, jint degree) {
  (void) NSObject_init(self);
  self->degree_ = degree;
  self->coeffs_ = [IOSDoubleArray newArrayWithLength:degree + 1];
}

OrgGeogebraCommonKernelArithmeticPolyFunction *new_OrgGeogebraCommonKernelArithmeticPolyFunction_initWithInt_(jint degree) {
  OrgGeogebraCommonKernelArithmeticPolyFunction *self = [OrgGeogebraCommonKernelArithmeticPolyFunction alloc];
  OrgGeogebraCommonKernelArithmeticPolyFunction_initWithInt_(self, degree);
  return self;
}

void OrgGeogebraCommonKernelArithmeticPolyFunction_initWithDoubleArray_(OrgGeogebraCommonKernelArithmeticPolyFunction *self, IOSDoubleArray *c) {
  (void) NSObject_init(self);
  self->coeffs_ = [IOSDoubleArray newArrayWithLength:((IOSDoubleArray *) nil_chk(c))->size_];
  for (jint i = 0; i < c->size_; i++) {
    *IOSDoubleArray_GetRef(self->coeffs_, i) = IOSDoubleArray_Get(c, i);
  }
  self->degree_ = self->coeffs_->size_ - 1;
}

OrgGeogebraCommonKernelArithmeticPolyFunction *new_OrgGeogebraCommonKernelArithmeticPolyFunction_initWithDoubleArray_(IOSDoubleArray *c) {
  OrgGeogebraCommonKernelArithmeticPolyFunction *self = [OrgGeogebraCommonKernelArithmeticPolyFunction alloc];
  OrgGeogebraCommonKernelArithmeticPolyFunction_initWithDoubleArray_(self, c);
  return self;
}

void OrgGeogebraCommonKernelArithmeticPolyFunction_initWithOrgGeogebraCommonKernelArithmeticPolyFunction_(OrgGeogebraCommonKernelArithmeticPolyFunction *self, OrgGeogebraCommonKernelArithmeticPolyFunction *pf) {
  (void) NSObject_init(self);
  self->degree_ = ((OrgGeogebraCommonKernelArithmeticPolyFunction *) nil_chk(pf))->degree_;
  self->coeffs_ = [pf getCoeffsCopy];
}

OrgGeogebraCommonKernelArithmeticPolyFunction *new_OrgGeogebraCommonKernelArithmeticPolyFunction_initWithOrgGeogebraCommonKernelArithmeticPolyFunction_(OrgGeogebraCommonKernelArithmeticPolyFunction *pf) {
  OrgGeogebraCommonKernelArithmeticPolyFunction *self = [OrgGeogebraCommonKernelArithmeticPolyFunction alloc];
  OrgGeogebraCommonKernelArithmeticPolyFunction_initWithOrgGeogebraCommonKernelArithmeticPolyFunction_(self, pf);
  return self;
}

OrgGeogebraCommonKernelArithmeticPolyFunction *OrgGeogebraCommonKernelArithmeticPolyFunction_buildDerivative(OrgGeogebraCommonKernelArithmeticPolyFunction *self) {
  if (self->degree_ < 1) return new_OrgGeogebraCommonKernelArithmeticPolyFunction_initWithInt_(0);
  OrgGeogebraCommonKernelArithmeticPolyFunction *deriv = new_OrgGeogebraCommonKernelArithmeticPolyFunction_initWithInt_(self->degree_ - 1);
  for (jint i = 1; i <= self->degree_; i++) {
    *IOSDoubleArray_GetRef(nil_chk(deriv->coeffs_), i - 1) = i * IOSDoubleArray_Get(self->coeffs_, i);
  }
  return deriv;
}

OrgGeogebraCommonKernelArithmeticPolyFunction *OrgGeogebraCommonKernelArithmeticPolyFunction_buildIntegral(OrgGeogebraCommonKernelArithmeticPolyFunction *self) {
  OrgGeogebraCommonKernelArithmeticPolyFunction *integ = new_OrgGeogebraCommonKernelArithmeticPolyFunction_initWithInt_(self->degree_ + 1);
  for (jint i = 0; i <= self->degree_; i++) {
    *IOSDoubleArray_GetRef(nil_chk(integ->coeffs_), i + 1) = IOSDoubleArray_Get(self->coeffs_, i) / (i + 1);
  }
  return integ;
}

IOSDoubleArray *OrgGeogebraCommonKernelArithmeticPolyFunction_evaluateDerivFuncWithDouble_(OrgGeogebraCommonKernelArithmeticPolyFunction *self, jdouble x) {
  IOSDoubleArray *ret = [IOSDoubleArray newArrayWithLength:2];
  *IOSDoubleArray_GetRef(ret, 0) = IOSDoubleArray_Get(nil_chk(self->coeffs_), self->degree_);
  *IOSDoubleArray_GetRef(ret, 1) = 0;
  for (jint i = self->degree_ - 1; i >= 0; i--) {
    *IOSDoubleArray_GetRef(ret, 1) = IOSDoubleArray_Get(ret, 1) * x + IOSDoubleArray_Get(ret, 0);
    *IOSDoubleArray_GetRef(ret, 0) = IOSDoubleArray_Get(ret, 0) * x + IOSDoubleArray_Get(self->coeffs_, i);
  }
  return ret;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgGeogebraCommonKernelArithmeticPolyFunction)
