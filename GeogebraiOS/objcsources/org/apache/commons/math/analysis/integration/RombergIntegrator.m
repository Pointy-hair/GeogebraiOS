//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/GeogebraiOS/GeogebraiOS/sources/org/apache/commons/math/analysis/integration/RombergIntegrator.java
//


#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/lang/Deprecated.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/Integer.h"
#include "org/apache/commons/math/FunctionEvaluationException.h"
#include "org/apache/commons/math/MathRuntimeException.h"
#include "org/apache/commons/math/MaxIterationsExceededException.h"
#include "org/apache/commons/math/analysis/UnivariateRealFunction.h"
#include "org/apache/commons/math/analysis/integration/RombergIntegrator.h"
#include "org/apache/commons/math/analysis/integration/TrapezoidIntegrator.h"
#include "org/apache/commons/math/analysis/integration/UnivariateRealIntegratorImpl.h"
#include "org/apache/commons/math/exception/util/LocalizedFormats.h"
#include "org/apache/commons/math/util/FastMath.h"

@implementation OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator

- (instancetype)initWithOrgApacheCommonsMathAnalysisUnivariateRealFunction:(id<OrgApacheCommonsMathAnalysisUnivariateRealFunction>)f {
  OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator_initWithOrgApacheCommonsMathAnalysisUnivariateRealFunction_(self, f);
  return self;
}

- (instancetype)init {
  OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator_init(self);
  return self;
}

- (jdouble)integrateWithDouble:(jdouble)min
                    withDouble:(jdouble)max {
  return [self integrateWithOrgApacheCommonsMathAnalysisUnivariateRealFunction:f_ withDouble:min withDouble:max];
}

- (jdouble)integrateWithOrgApacheCommonsMathAnalysisUnivariateRealFunction:(id<OrgApacheCommonsMathAnalysisUnivariateRealFunction>)f
                                                                withDouble:(jdouble)min
                                                                withDouble:(jdouble)max {
  jint m = maximalIterationCount_ + 1;
  IOSDoubleArray *previousRow = [IOSDoubleArray arrayWithLength:m];
  IOSDoubleArray *currentRow = [IOSDoubleArray arrayWithLength:m];
  [self clearResult];
  [self verifyIntervalWithDouble:min withDouble:max];
  [self verifyIterationCount];
  OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator *qtrap = [new_OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator_init() autorelease];
  *IOSDoubleArray_GetRef(currentRow, 0) = [qtrap stageWithOrgApacheCommonsMathAnalysisUnivariateRealFunction:f withDouble:min withDouble:max withInt:0];
  jdouble olds = IOSDoubleArray_Get(currentRow, 0);
  for (jint i = 1; i <= maximalIterationCount_; ++i) {
    IOSDoubleArray *tmpRow = previousRow;
    previousRow = currentRow;
    currentRow = tmpRow;
    *IOSDoubleArray_GetRef(currentRow, 0) = [qtrap stageWithOrgApacheCommonsMathAnalysisUnivariateRealFunction:f withDouble:min withDouble:max withInt:i];
    for (jint j = 1; j <= i; j++) {
      jdouble r = (LShift64(1LL, (2 * j))) - 1;
      jdouble tIJm1 = IOSDoubleArray_Get(currentRow, j - 1);
      *IOSDoubleArray_GetRef(currentRow, j) = tIJm1 + (tIJm1 - IOSDoubleArray_Get(previousRow, j - 1)) / r;
    }
    jdouble s = IOSDoubleArray_Get(currentRow, i);
    if (i >= minimalIterationCount_) {
      jdouble delta = OrgApacheCommonsMathUtilFastMath_absWithDouble_(s - olds);
      jdouble rLimit = relativeAccuracy_ * (OrgApacheCommonsMathUtilFastMath_absWithDouble_(olds) + OrgApacheCommonsMathUtilFastMath_absWithDouble_(s)) * 0.5;
      if ((delta <= rLimit) || (delta <= absoluteAccuracy_)) {
        [self setResultWithDouble:s withInt:i];
        return result_;
      }
    }
    olds = s;
  }
  @throw [new_OrgApacheCommonsMathMaxIterationsExceededException_initWithInt_(maximalIterationCount_) autorelease];
}

- (void)verifyIterationCount {
  [super verifyIterationCount];
  if (maximalIterationCount_ > 32) {
    @throw OrgApacheCommonsMathMathRuntimeException_createIllegalArgumentExceptionWithOrgApacheCommonsMathExceptionUtilLocalizable_withNSObjectArray_(OrgApacheCommonsMathExceptionUtilLocalizedFormatsEnum_get_INVALID_ITERATIONS_LIMITS(), [IOSObjectArray arrayWithObjects:(id[]){ JavaLangInteger_valueOfWithInt_(0), JavaLangInteger_valueOfWithInt_(32) } count:2 type:NSObject_class_()]);
  }
}

+ (IOSObjectArray *)__annotations_initWithOrgApacheCommonsMathAnalysisUnivariateRealFunction_ {
  return [IOSObjectArray arrayWithObjects:(id[]) { [[[JavaLangDeprecated alloc] init] autorelease] } count:1 type:JavaLangAnnotationAnnotation_class_()];
}

+ (IOSObjectArray *)__annotations_integrateWithDouble_withDouble_ {
  return [IOSObjectArray arrayWithObjects:(id[]) { [[[JavaLangDeprecated alloc] init] autorelease] } count:1 type:JavaLangAnnotationAnnotation_class_()];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheCommonsMathAnalysisUnivariateRealFunction:", "RombergIntegrator", NULL, 0x1, NULL, NULL },
    { "init", "RombergIntegrator", NULL, 0x1, NULL, NULL },
    { "integrateWithDouble:withDouble:", "integrate", "D", 0x1, "Lorg.apache.commons.math.MaxIterationsExceededException;Lorg.apache.commons.math.FunctionEvaluationException;Ljava.lang.IllegalArgumentException;", NULL },
    { "integrateWithOrgApacheCommonsMathAnalysisUnivariateRealFunction:withDouble:withDouble:", "integrate", "D", 0x1, "Lorg.apache.commons.math.MaxIterationsExceededException;Lorg.apache.commons.math.FunctionEvaluationException;Ljava.lang.IllegalArgumentException;", NULL },
    { "verifyIterationCount", NULL, "V", 0x4, "Ljava.lang.IllegalArgumentException;", NULL },
  };
  static const J2ObjcClassInfo _OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator = { 2, "RombergIntegrator", "org.apache.commons.math.analysis.integration", NULL, 0x1, 5, methods, 0, NULL, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator;
}

@end

void OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator_initWithOrgApacheCommonsMathAnalysisUnivariateRealFunction_(OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator *self, id<OrgApacheCommonsMathAnalysisUnivariateRealFunction> f) {
  OrgApacheCommonsMathAnalysisIntegrationUnivariateRealIntegratorImpl_initWithOrgApacheCommonsMathAnalysisUnivariateRealFunction_withInt_(self, f, 32);
}

OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator *new_OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator_initWithOrgApacheCommonsMathAnalysisUnivariateRealFunction_(id<OrgApacheCommonsMathAnalysisUnivariateRealFunction> f) {
  OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator *self = [OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator alloc];
  OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator_initWithOrgApacheCommonsMathAnalysisUnivariateRealFunction_(self, f);
  return self;
}

void OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator_init(OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator *self) {
  OrgApacheCommonsMathAnalysisIntegrationUnivariateRealIntegratorImpl_initWithInt_(self, 32);
}

OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator *new_OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator_init() {
  OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator *self = [OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator alloc];
  OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator_init(self);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheCommonsMathAnalysisIntegrationRombergIntegrator)
