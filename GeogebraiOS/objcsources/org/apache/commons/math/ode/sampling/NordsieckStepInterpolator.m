//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/GeoGebraiOSARC/GeoGebraiOSARC/javasources/org/apache/commons/math/ode/sampling/NordsieckStepInterpolator.java
//


#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/io/ObjectInput.h"
#include "java/io/ObjectOutput.h"
#include "java/lang/ClassNotFoundException.h"
#include "java/util/Arrays.h"
#include "org/apache/commons/math/linear/Array2DRowRealMatrix.h"
#include "org/apache/commons/math/ode/DerivativeException.h"
#include "org/apache/commons/math/ode/sampling/AbstractStepInterpolator.h"
#include "org/apache/commons/math/ode/sampling/NordsieckStepInterpolator.h"
#include "org/apache/commons/math/ode/sampling/StepInterpolator.h"
#include "org/apache/commons/math/util/FastMath.h"

#define OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator_serialVersionUID -7179861704951334960LL

@interface OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator () {
 @public
  jdouble scalingH_;
  jdouble referenceTime_;
  IOSDoubleArray *scaled_;
  OrgApacheCommonsMathLinearArray2DRowRealMatrix *nordsieck_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator, scaled_, IOSDoubleArray *)
J2OBJC_FIELD_SETTER(OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator, nordsieck_, OrgApacheCommonsMathLinearArray2DRowRealMatrix *)

J2OBJC_STATIC_FIELD_GETTER(OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator, serialVersionUID, jlong)

@implementation OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator

- (instancetype)init {
  OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator_init(self);
  return self;
}

- (instancetype)initWithOrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator:(OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator *)interpolator {
  OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator_initWithOrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator_(self, interpolator);
  return self;
}

- (id<OrgApacheCommonsMathOdeSamplingStepInterpolator>)doCopy {
  return new_OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator_initWithOrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator_(self);
}

- (void)reinitializeWithDoubleArray:(IOSDoubleArray *)y
                        withBoolean:(jboolean)forward {
  [super reinitializeWithDoubleArray:y withBoolean:forward];
  stateVariation_ = [IOSDoubleArray newArrayWithLength:((IOSDoubleArray *) nil_chk(y))->size_];
}

- (void)reinitializeWithDouble:(jdouble)time
                    withDouble:(jdouble)stepSize
               withDoubleArray:(IOSDoubleArray *)scaledDerivative
withOrgApacheCommonsMathLinearArray2DRowRealMatrix:(OrgApacheCommonsMathLinearArray2DRowRealMatrix *)nordsieckVector {
  self->referenceTime_ = time;
  self->scalingH_ = stepSize;
  self->scaled_ = scaledDerivative;
  self->nordsieck_ = nordsieckVector;
  [self setInterpolatedTimeWithDouble:[self getInterpolatedTime]];
}

- (void)rescaleWithDouble:(jdouble)stepSize {
  jdouble ratio = stepSize / scalingH_;
  for (jint i = 0; i < ((IOSDoubleArray *) nil_chk(scaled_))->size_; ++i) {
    *IOSDoubleArray_GetRef(scaled_, i) *= ratio;
  }
  IOSObjectArray *nData = [((OrgApacheCommonsMathLinearArray2DRowRealMatrix *) nil_chk(nordsieck_)) getDataRef];
  jdouble power = ratio;
  for (jint i = 0; i < ((IOSObjectArray *) nil_chk(nData))->size_; ++i) {
    power *= ratio;
    IOSDoubleArray *nDataI = IOSObjectArray_Get(nData, i);
    for (jint j = 0; j < ((IOSDoubleArray *) nil_chk(nDataI))->size_; ++j) {
      *IOSDoubleArray_GetRef(nDataI, j) *= power;
    }
  }
  scalingH_ = stepSize;
}

- (IOSDoubleArray *)getInterpolatedStateVariation {
  (void) [self getInterpolatedState];
  return stateVariation_;
}

- (void)computeInterpolatedStateAndDerivativesWithDouble:(jdouble)theta
                                              withDouble:(jdouble)oneMinusThetaH {
  jdouble x = interpolatedTime_ - referenceTime_;
  jdouble normalizedAbscissa = x / scalingH_;
  JavaUtilArrays_fillWithDoubleArray_withDouble_(stateVariation_, 0.0);
  JavaUtilArrays_fillWithDoubleArray_withDouble_(interpolatedDerivatives_, 0.0);
  IOSObjectArray *nData = [((OrgApacheCommonsMathLinearArray2DRowRealMatrix *) nil_chk(nordsieck_)) getDataRef];
  for (jint i = ((IOSObjectArray *) nil_chk(nData))->size_ - 1; i >= 0; --i) {
    jint order = i + 2;
    IOSDoubleArray *nDataI = IOSObjectArray_Get(nData, i);
    jdouble power = OrgApacheCommonsMathUtilFastMath_powWithDouble_withDouble_(normalizedAbscissa, order);
    for (jint j = 0; j < ((IOSDoubleArray *) nil_chk(nDataI))->size_; ++j) {
      jdouble d = IOSDoubleArray_Get(nDataI, j) * power;
      *IOSDoubleArray_GetRef(nil_chk(stateVariation_), j) += d;
      *IOSDoubleArray_GetRef(nil_chk(interpolatedDerivatives_), j) += order * d;
    }
  }
  for (jint j = 0; j < ((IOSDoubleArray *) nil_chk(currentState_))->size_; ++j) {
    *IOSDoubleArray_GetRef(nil_chk(stateVariation_), j) += IOSDoubleArray_Get(nil_chk(scaled_), j) * normalizedAbscissa;
    *IOSDoubleArray_GetRef(nil_chk(interpolatedState_), j) = IOSDoubleArray_Get(currentState_, j) + IOSDoubleArray_Get(stateVariation_, j);
    *IOSDoubleArray_GetRef(nil_chk(interpolatedDerivatives_), j) = (IOSDoubleArray_Get(interpolatedDerivatives_, j) + IOSDoubleArray_Get(scaled_, j) * normalizedAbscissa) / x;
  }
}

- (void)writeExternalWithJavaIoObjectOutput:(id<JavaIoObjectOutput>)outArg {
  [self writeBaseExternalWithJavaIoObjectOutput:outArg];
  [((id<JavaIoObjectOutput>) nil_chk(outArg)) writeDoubleWithDouble:scalingH_];
  [outArg writeDoubleWithDouble:referenceTime_];
  jint n = (currentState_ == nil) ? -1 : currentState_->size_;
  if (scaled_ == nil) {
    [outArg writeBooleanWithBoolean:NO];
  }
  else {
    [outArg writeBooleanWithBoolean:YES];
    for (jint j = 0; j < n; ++j) {
      [outArg writeDoubleWithDouble:IOSDoubleArray_Get(scaled_, j)];
    }
  }
  if (nordsieck_ == nil) {
    [outArg writeBooleanWithBoolean:NO];
  }
  else {
    [outArg writeBooleanWithBoolean:YES];
    [outArg writeObjectWithId:nordsieck_];
  }
}

- (void)readExternalWithJavaIoObjectInput:(id<JavaIoObjectInput>)inArg {
  jdouble t = [self readBaseExternalWithJavaIoObjectInput:inArg];
  scalingH_ = [((id<JavaIoObjectInput>) nil_chk(inArg)) readDouble];
  referenceTime_ = [inArg readDouble];
  jint n = (currentState_ == nil) ? -1 : currentState_->size_;
  jboolean hasScaled = [inArg readBoolean];
  if (hasScaled) {
    scaled_ = [IOSDoubleArray newArrayWithLength:n];
    for (jint j = 0; j < n; ++j) {
      *IOSDoubleArray_GetRef(scaled_, j) = [inArg readDouble];
    }
  }
  else {
    scaled_ = nil;
  }
  jboolean hasNordsieck = [inArg readBoolean];
  if (hasNordsieck) {
    nordsieck_ = (OrgApacheCommonsMathLinearArray2DRowRealMatrix *) check_class_cast([inArg readObject], [OrgApacheCommonsMathLinearArray2DRowRealMatrix class]);
  }
  else {
    nordsieck_ = nil;
  }
  if (hasScaled && hasNordsieck) {
    stateVariation_ = [IOSDoubleArray newArrayWithLength:n];
    [self setInterpolatedTimeWithDouble:t];
  }
  else {
    stateVariation_ = nil;
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "init", "NordsieckStepInterpolator", NULL, 0x1, NULL, NULL },
    { "initWithOrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator:", "NordsieckStepInterpolator", NULL, 0x1, NULL, NULL },
    { "doCopy", NULL, "Lorg.apache.commons.math.ode.sampling.StepInterpolator;", 0x4, NULL, NULL },
    { "reinitializeWithDoubleArray:withBoolean:", "reinitialize", "V", 0x1, NULL, NULL },
    { "reinitializeWithDouble:withDouble:withDoubleArray:withOrgApacheCommonsMathLinearArray2DRowRealMatrix:", "reinitialize", "V", 0x1, NULL, NULL },
    { "rescaleWithDouble:", "rescale", "V", 0x1, NULL, NULL },
    { "getInterpolatedStateVariation", NULL, "[D", 0x1, "Lorg.apache.commons.math.ode.DerivativeException;", NULL },
    { "computeInterpolatedStateAndDerivativesWithDouble:withDouble:", "computeInterpolatedStateAndDerivatives", "V", 0x4, NULL, NULL },
    { "writeExternalWithJavaIoObjectOutput:", "writeExternal", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "readExternalWithJavaIoObjectInput:", "readExternal", "V", 0x1, "Ljava.io.IOException;Ljava.lang.ClassNotFoundException;", NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "serialVersionUID_", NULL, 0x1a, "J", NULL, NULL, .constantValue.asLong = OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator_serialVersionUID },
    { "stateVariation_", NULL, 0x4, "[D", NULL, NULL,  },
    { "scalingH_", NULL, 0x2, "D", NULL, NULL,  },
    { "referenceTime_", NULL, 0x2, "D", NULL, NULL,  },
    { "scaled_", NULL, 0x2, "[D", NULL, NULL,  },
    { "nordsieck_", NULL, 0x2, "Lorg.apache.commons.math.linear.Array2DRowRealMatrix;", NULL, NULL,  },
  };
  static const J2ObjcClassInfo _OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator = { 2, "NordsieckStepInterpolator", "org.apache.commons.math.ode.sampling", NULL, 0x1, 10, methods, 6, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator;
}

@end

void OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator_init(OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator *self) {
  (void) OrgApacheCommonsMathOdeSamplingAbstractStepInterpolator_init(self);
}

OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator *new_OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator_init() {
  OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator *self = [OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator alloc];
  OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator_init(self);
  return self;
}

void OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator_initWithOrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator_(OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator *self, OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator *interpolator) {
  (void) OrgApacheCommonsMathOdeSamplingAbstractStepInterpolator_initWithOrgApacheCommonsMathOdeSamplingAbstractStepInterpolator_(self, interpolator);
  self->scalingH_ = ((OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator *) nil_chk(interpolator))->scalingH_;
  self->referenceTime_ = interpolator->referenceTime_;
  if (interpolator->scaled_ != nil) {
    self->scaled_ = [interpolator->scaled_ clone];
  }
  if (interpolator->nordsieck_ != nil) {
    self->nordsieck_ = new_OrgApacheCommonsMathLinearArray2DRowRealMatrix_initWithDoubleArray2_withBoolean_([interpolator->nordsieck_ getDataRef], YES);
  }
  if (interpolator->stateVariation_ != nil) {
    self->stateVariation_ = [interpolator->stateVariation_ clone];
  }
}

OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator *new_OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator_initWithOrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator_(OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator *interpolator) {
  OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator *self = [OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator alloc];
  OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator_initWithOrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator_(self, interpolator);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheCommonsMathOdeSamplingNordsieckStepInterpolator)
