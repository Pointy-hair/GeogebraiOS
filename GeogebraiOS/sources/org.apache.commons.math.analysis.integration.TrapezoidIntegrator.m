//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/geogebra_iOS/geogebra/geogebra/common/src/org/apache/commons/math/analysis/integration/TrapezoidIntegrator.java
//


#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/lang/Deprecated.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/Integer.h"
#include "org/apache/commons/math/FunctionEvaluationException.h"
#include "org/apache/commons/math/MathRuntimeException.h"
#include "org/apache/commons/math/MaxIterationsExceededException.h"
#include "org/apache/commons/math/analysis/UnivariateRealFunction.h"
#include "org/apache/commons/math/analysis/integration/TrapezoidIntegrator.h"
#include "org/apache/commons/math/analysis/integration/UnivariateRealIntegratorImpl.h"
#include "org/apache/commons/math/exception/util/LocalizedFormats.h"
#include "org/apache/commons/math/util/FastMath.h"

@interface OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator () {
 @public
  jdouble s_;
}

@end

@implementation OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator

- (instancetype)initWithOrgApacheCommonsMathAnalysisUnivariateRealFunction:(id<OrgApacheCommonsMathAnalysisUnivariateRealFunction>)f {
  OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator_initWithOrgApacheCommonsMathAnalysisUnivariateRealFunction_(self, f);
  return self;
}

- (instancetype)init {
  OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator_init(self);
  return self;
}

- (jdouble)stageWithOrgApacheCommonsMathAnalysisUnivariateRealFunction:(id<OrgApacheCommonsMathAnalysisUnivariateRealFunction>)f
                                                            withDouble:(jdouble)min
                                                            withDouble:(jdouble)max
                                                               withInt:(jint)n {
  if (n == 0) {
    s_ = 0.5 * (max - min) * ([((id<OrgApacheCommonsMathAnalysisUnivariateRealFunction>) nil_chk(f)) valueWithDouble:min] + [f valueWithDouble:max]);
    return s_;
  }
  else {
    jlong np = LShift64(1LL, (n - 1));
    jdouble sum = 0;
    jdouble spacing = (max - min) / np;
    jdouble x = min + 0.5 * spacing;
    for (jlong i = 0; i < np; i++) {
      sum += [((id<OrgApacheCommonsMathAnalysisUnivariateRealFunction>) nil_chk(f)) valueWithDouble:x];
      x += spacing;
    }
    s_ = 0.5 * (s_ + sum * spacing);
    return s_;
  }
}

- (jdouble)integrateWithDouble:(jdouble)min
                    withDouble:(jdouble)max {
  return [self integrateWithOrgApacheCommonsMathAnalysisUnivariateRealFunction:f_ withDouble:min withDouble:max];
}

- (jdouble)integrateWithOrgApacheCommonsMathAnalysisUnivariateRealFunction:(id<OrgApacheCommonsMathAnalysisUnivariateRealFunction>)f
                                                                withDouble:(jdouble)min
                                                                withDouble:(jdouble)max {
  [self clearResult];
  [self verifyIntervalWithDouble:min withDouble:max];
  [self verifyIterationCount];
  jdouble oldt = [self stageWithOrgApacheCommonsMathAnalysisUnivariateRealFunction:f withDouble:min withDouble:max withInt:0];
  for (jint i = 1; i <= maximalIterationCount_; ++i) {
    jdouble t = [self stageWithOrgApacheCommonsMathAnalysisUnivariateRealFunction:f withDouble:min withDouble:max withInt:i];
    if (i >= minimalIterationCount_) {
      jdouble delta = OrgApacheCommonsMathUtilFastMath_absWithDouble_(t - oldt);
      jdouble rLimit = relativeAccuracy_ * (OrgApacheCommonsMathUtilFastMath_absWithDouble_(oldt) + OrgApacheCommonsMathUtilFastMath_absWithDouble_(t)) * 0.5;
      if ((delta <= rLimit) || (delta <= absoluteAccuracy_)) {
        [self setResultWithDouble:t withInt:i];
        return result_;
      }
    }
    oldt = t;
  }
  @throw [new_OrgApacheCommonsMathMaxIterationsExceededException_initWithInt_(maximalIterationCount_) autorelease];
}

- (void)verifyIterationCount {
  [super verifyIterationCount];
  if (maximalIterationCount_ > 64) {
    @throw OrgApacheCommonsMathMathRuntimeException_createIllegalArgumentExceptionWithOrgApacheCommonsMathExceptionUtilLocalizable_withNSObjectArray_(OrgApacheCommonsMathExceptionUtilLocalizedFormatsEnum_get_INVALID_ITERATIONS_LIMITS(), [IOSObjectArray arrayWithObjects:(id[]){ JavaLangInteger_valueOfWithInt_(0), JavaLangInteger_valueOfWithInt_(64) } count:2 type:NSObject_class_()]);
  }
}

+ (IOSObjectArray *)__annotations_initWithOrgApacheCommonsMathAnalysisUnivariateRealFunction_ {
  return [IOSObjectArray arrayWithObjects:(id[]) { [[[JavaLangDeprecated alloc] init] autorelease] } count:1 type:JavaLangAnnotationAnnotation_class_()];
}

+ (IOSObjectArray *)__annotations_integrateWithDouble_withDouble_ {
  return [IOSObjectArray arrayWithObjects:(id[]) { [[[JavaLangDeprecated alloc] init] autorelease] } count:1 type:JavaLangAnnotationAnnotation_class_()];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheCommonsMathAnalysisUnivariateRealFunction:", "TrapezoidIntegrator", NULL, 0x1, NULL, NULL },
    { "init", "TrapezoidIntegrator", NULL, 0x1, NULL, NULL },
    { "stageWithOrgApacheCommonsMathAnalysisUnivariateRealFunction:withDouble:withDouble:withInt:", "stage", "D", 0x0, "Lorg.apache.commons.math.FunctionEvaluationException;", NULL },
    { "integrateWithDouble:withDouble:", "integrate", "D", 0x1, "Lorg.apache.commons.math.MaxIterationsExceededException;Lorg.apache.commons.math.FunctionEvaluationException;Ljava.lang.IllegalArgumentException;", NULL },
    { "integrateWithOrgApacheCommonsMathAnalysisUnivariateRealFunction:withDouble:withDouble:", "integrate", "D", 0x1, "Lorg.apache.commons.math.MaxIterationsExceededException;Lorg.apache.commons.math.FunctionEvaluationException;Ljava.lang.IllegalArgumentException;", NULL },
    { "verifyIterationCount", NULL, "V", 0x4, "Ljava.lang.IllegalArgumentException;", NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "s_", NULL, 0x2, "D", NULL, NULL,  },
  };
  static const J2ObjcClassInfo _OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator = { 2, "TrapezoidIntegrator", "org.apache.commons.math.analysis.integration", NULL, 0x1, 6, methods, 1, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator;
}

@end

void OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator_initWithOrgApacheCommonsMathAnalysisUnivariateRealFunction_(OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator *self, id<OrgApacheCommonsMathAnalysisUnivariateRealFunction> f) {
  OrgApacheCommonsMathAnalysisIntegrationUnivariateRealIntegratorImpl_initWithOrgApacheCommonsMathAnalysisUnivariateRealFunction_withInt_(self, f, 64);
}

OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator *new_OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator_initWithOrgApacheCommonsMathAnalysisUnivariateRealFunction_(id<OrgApacheCommonsMathAnalysisUnivariateRealFunction> f) {
  OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator *self = [OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator alloc];
  OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator_initWithOrgApacheCommonsMathAnalysisUnivariateRealFunction_(self, f);
  return self;
}

void OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator_init(OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator *self) {
  OrgApacheCommonsMathAnalysisIntegrationUnivariateRealIntegratorImpl_initWithInt_(self, 64);
}

OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator *new_OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator_init() {
  OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator *self = [OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator alloc];
  OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator_init(self);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheCommonsMathAnalysisIntegrationTrapezoidIntegrator)
