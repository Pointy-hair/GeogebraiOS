//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/geogebra_iOS/geogebra/geogebra/common/src/geogebra/common/move/ggtapi/operations/LogInOperation.java
//


#include "IOSClass.h"
#include "J2ObjC_source.h"
#include "geogebra/common/main/App.h"
#include "geogebra/common/move/events/StayLoggedOutEvent.h"
#include "geogebra/common/move/ggtapi/events/LogOutEvent.h"
#include "geogebra/common/move/ggtapi/events/LoginAttemptEvent.h"
#include "geogebra/common/move/ggtapi/models/AuthenticationModel.h"
#include "geogebra/common/move/ggtapi/models/GeoGebraTubeAPI.h"
#include "geogebra/common/move/ggtapi/models/GeoGebraTubeUser.h"
#include "geogebra/common/move/ggtapi/models/Material.h"
#include "geogebra/common/move/ggtapi/operations/LogInOperation.h"
#include "geogebra/common/move/models/BaseModel.h"
#include "geogebra/common/move/operations/BaseOperation.h"

@implementation GeogebraCommonMoveGgtapiOperationsLogInOperation

- (GeogebraCommonMoveGgtapiModelsAuthenticationModel *)getModel {
  return (GeogebraCommonMoveGgtapiModelsAuthenticationModel *) check_class_cast([super getModel], [GeogebraCommonMoveGgtapiModelsAuthenticationModel class]);
}

- (NSString *)getUserName {
  return [((GeogebraCommonMoveGgtapiModelsAuthenticationModel *) nil_chk([self getModel])) getUserName];
}

- (jboolean)isLoggedIn {
  return [((GeogebraCommonMoveGgtapiModelsAuthenticationModel *) nil_chk([self getModel])) isLoggedIn];
}

- (void)performTokenLogin {
  NSString *token = [((GeogebraCommonMoveGgtapiModelsAuthenticationModel *) nil_chk([self getModel])) getLoginToken];
  if (token != nil) {
    [self performTokenLoginWithNSString:token withBoolean:YES];
  }
  else {
    [((GeogebraCommonMoveGgtapiModelsGeoGebraTubeAPI *) nil_chk([self getGeoGebraTubeAPI])) checkAvailableWithGeogebraCommonMoveGgtapiOperationsLogInOperation:self];
  }
}

- (void)performTokenLoginWithNSString:(NSString *)token
                          withBoolean:(jboolean)automatic {
  if ([@"" isEqual:token]) {
    [self stayLoggedOut];
  }
  [self doPerformTokenLoginWithGeogebraCommonMoveGgtapiModelsGeoGebraTubeUser:[new_GeogebraCommonMoveGgtapiModelsGeoGebraTubeUser_initWithNSString_(token) autorelease] withBoolean:automatic];
}

- (void)stayLoggedOut {
  [((GeogebraCommonMoveGgtapiModelsAuthenticationModel *) nil_chk([self getModel])) stayLoggedOut];
  [self onEventWithGeogebraCommonMoveEventsBaseEvent:[new_GeogebraCommonMoveEventsStayLoggedOutEvent_initWithNSString_(nil) autorelease]];
}

- (void)performCookieLoginWithNSString:(NSString *)cookie {
  [self doPerformTokenLoginWithGeogebraCommonMoveGgtapiModelsGeoGebraTubeUser:[new_GeogebraCommonMoveGgtapiModelsGeoGebraTubeUser_initWithNSString_withNSString_(nil, cookie) autorelease] withBoolean:YES];
}

- (void)doPerformTokenLoginWithGeogebraCommonMoveGgtapiModelsGeoGebraTubeUser:(GeogebraCommonMoveGgtapiModelsGeoGebraTubeUser *)user
                                                                  withBoolean:(jboolean)automatic {
  GeogebraCommonMoveGgtapiModelsGeoGebraTubeAPI *api = [self getGeoGebraTubeAPI];
  GeogebraCommonMainApp_debugWithNSString_(@"Sending call to GeoGebraTube API to authorize the login token...");
  [self onEventWithGeogebraCommonMoveEventsBaseEvent:[new_GeogebraCommonMoveGgtapiEventsLoginAttemptEvent_initWithGeogebraCommonMoveGgtapiModelsGeoGebraTubeUser_(user) autorelease]];
  [((GeogebraCommonMoveGgtapiModelsGeoGebraTubeAPI *) nil_chk(api)) authorizeUserWithGeogebraCommonMoveGgtapiModelsGeoGebraTubeUser:user withGeogebraCommonMoveGgtapiOperationsLogInOperation:self withBoolean:automatic];
}

- (void)performLogOut {
  [self onEventWithGeogebraCommonMoveEventsBaseEvent:[new_GeogebraCommonMoveGgtapiEventsLogOutEvent_init() autorelease]];
}

- (GeogebraCommonMoveGgtapiModelsGeoGebraTubeAPI *)getGeoGebraTubeAPI {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (NSString *)getLoginURLWithNSString:(NSString *)languageCode {
  return JreStrcat("$$$$$$$$", @"https://accounts.geogebra.org/user/signin/caller/", [self getURLLoginCaller], @"/expiration/", [self getURLTokenExpirationMinutes], @"/clientinfo/", [self getURLClientInfo], @"/?lang=", languageCode);
}

- (NSString *)getURLLoginCaller {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (NSString *)getURLTokenExpirationMinutes {
  return @"129600";
}

- (NSString *)getURLClientInfo {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (void)startOffline {
  [((GeogebraCommonMoveGgtapiModelsAuthenticationModel *) nil_chk([self getModel])) startOfflineWithGeogebraCommonMoveGgtapiModelsGeoGebraTubeAPI:[self getGeoGebraTubeAPI]];
}

- (jboolean)mayLogIn {
  return [((GeogebraCommonMoveGgtapiModelsAuthenticationModel *) nil_chk([self getModel])) mayLogIn];
}

- (jboolean)ownsWithGeogebraCommonMoveGgtapiModelsMaterial:(GeogebraCommonMoveGgtapiModelsMaterial *)mat {
  return [((GeogebraCommonMoveGgtapiModelsMaterial *) nil_chk(mat)) getAuthorID] <= 0 || [mat getAuthorID] == [((GeogebraCommonMoveGgtapiModelsAuthenticationModel *) nil_chk([self getModel])) getUserId];
}

- (instancetype)init {
  GeogebraCommonMoveGgtapiOperationsLogInOperation_init(self);
  return self;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "getModel", NULL, "Lgeogebra.common.move.ggtapi.models.AuthenticationModel;", 0x1, NULL, NULL },
    { "getUserName", NULL, "Ljava.lang.String;", 0x1, NULL, NULL },
    { "isLoggedIn", NULL, "Z", 0x11, NULL, NULL },
    { "performTokenLogin", NULL, "V", 0x11, NULL, NULL },
    { "performTokenLoginWithNSString:withBoolean:", "performTokenLogin", "V", 0x1, NULL, NULL },
    { "stayLoggedOut", NULL, "V", 0x1, NULL, NULL },
    { "performCookieLoginWithNSString:", "performCookieLogin", "V", 0x1, NULL, NULL },
    { "doPerformTokenLoginWithGeogebraCommonMoveGgtapiModelsGeoGebraTubeUser:withBoolean:", "doPerformTokenLogin", "V", 0x4, NULL, NULL },
    { "performLogOut", NULL, "V", 0x1, NULL, NULL },
    { "getGeoGebraTubeAPI", NULL, "Lgeogebra.common.move.ggtapi.models.GeoGebraTubeAPI;", 0x401, NULL, NULL },
    { "getLoginURLWithNSString:", "getLoginURL", "Ljava.lang.String;", 0x1, NULL, NULL },
    { "getURLLoginCaller", NULL, "Ljava.lang.String;", 0x404, NULL, NULL },
    { "getURLTokenExpirationMinutes", NULL, "Ljava.lang.String;", 0x4, NULL, NULL },
    { "getURLClientInfo", NULL, "Ljava.lang.String;", 0x404, NULL, NULL },
    { "startOffline", NULL, "V", 0x1, NULL, NULL },
    { "mayLogIn", NULL, "Z", 0x1, NULL, NULL },
    { "ownsWithGeogebraCommonMoveGgtapiModelsMaterial:", "owns", "Z", 0x1, NULL, NULL },
    { "init", NULL, NULL, 0x1, NULL, NULL },
  };
  static const char *superclass_type_args[] = {"Lgeogebra.common.move.views.EventRenderable;"};
  static const J2ObjcClassInfo _GeogebraCommonMoveGgtapiOperationsLogInOperation = { 2, "LogInOperation", "geogebra.common.move.ggtapi.operations", NULL, 0x401, 18, methods, 0, NULL, 1, superclass_type_args, 0, NULL, NULL, "Lgeogebra/common/move/operations/BaseOperation<Lgeogebra/common/move/views/EventRenderable;>;" };
  return &_GeogebraCommonMoveGgtapiOperationsLogInOperation;
}

@end

void GeogebraCommonMoveGgtapiOperationsLogInOperation_init(GeogebraCommonMoveGgtapiOperationsLogInOperation *self) {
  GeogebraCommonMoveOperationsBaseOperation_init(self);
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(GeogebraCommonMoveGgtapiOperationsLogInOperation)
