//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/geogebra_iOS/geogebra/geogebra/common/src/geogebra/common/util/GgbMat.java
//


#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "geogebra/common/kernel/Construction.h"
#include "geogebra/common/kernel/Kernel.h"
#include "geogebra/common/kernel/arithmetic/ExpressionValue.h"
#include "geogebra/common/kernel/arithmetic/MyList.h"
#include "geogebra/common/kernel/arithmetic/NumberValue.h"
#include "geogebra/common/kernel/geos/GeoElement.h"
#include "geogebra/common/kernel/geos/GeoList.h"
#include "geogebra/common/kernel/geos/GeoNumeric.h"
#include "geogebra/common/util/GgbMat.h"
#include "java/lang/Exception.h"
#include "org/apache/commons/math/linear/Array2DRowRealMatrix.h"
#include "org/apache/commons/math/linear/DecompositionSolver.h"
#include "org/apache/commons/math/linear/LUDecompositionImpl.h"
#include "org/apache/commons/math/linear/RealMatrix.h"

#define GeogebraCommonUtilGgbMat_serialVersionUID 1LL

@interface GeogebraCommonUtilGgbMat () {
 @public
  jboolean isUndefined__;
}

@end

J2OBJC_STATIC_FIELD_GETTER(GeogebraCommonUtilGgbMat, serialVersionUID, jlong)

@implementation GeogebraCommonUtilGgbMat

- (instancetype)initWithGeogebraCommonKernelGeosGeoList:(GeogebraCommonKernelGeosGeoList *)inputList {
  GeogebraCommonUtilGgbMat_initWithGeogebraCommonKernelGeosGeoList_(self, inputList);
  return self;
}

- (instancetype)initWithGeogebraCommonKernelArithmeticMyList:(GeogebraCommonKernelArithmeticMyList *)inputList {
  GeogebraCommonUtilGgbMat_initWithGeogebraCommonKernelArithmeticMyList_(self, inputList);
  return self;
}

- (instancetype)initWithInt:(jint)rows
                    withInt:(jint)cols {
  GeogebraCommonUtilGgbMat_initWithInt_withInt_(self, rows, cols);
  return self;
}

- (void)inverseImmediate {
  @try {
    id<OrgApacheCommonsMathLinearDecompositionSolver> d = [((OrgApacheCommonsMathLinearLUDecompositionImpl *) [new_OrgApacheCommonsMathLinearLUDecompositionImpl_initWithOrgApacheCommonsMathLinearRealMatrix_withDouble_(self, GeogebraCommonKernelKernel_STANDARD_PRECISION) autorelease]) getSolver];
    id<OrgApacheCommonsMathLinearRealMatrix> ret = [((id<OrgApacheCommonsMathLinearDecompositionSolver>) nil_chk(d)) getInverse];
    OrgApacheCommonsMathLinearArray2DRowRealMatrix_set_data_(self, [((id<OrgApacheCommonsMathLinearRealMatrix>) nil_chk(ret)) getData]);
  }
  @catch (JavaLangException *e) {
    [self setIsUndefinedWithBoolean:YES];
  }
}

- (jdouble)determinant {
  return [((OrgApacheCommonsMathLinearLUDecompositionImpl *) [new_OrgApacheCommonsMathLinearLUDecompositionImpl_initWithOrgApacheCommonsMathLinearRealMatrix_withDouble_(self, GeogebraCommonKernelKernel_STANDARD_PRECISION) autorelease]) getDeterminant];
}

- (void)reducedRowEchelonFormImmediate {
  jint rowCount = ((IOSObjectArray *) nil_chk(data_))->size_;
  if (rowCount == 0) return;
  jint columnCount = ((IOSDoubleArray *) nil_chk(IOSObjectArray_Get(data_, 0)))->size_;
  jint lead = 0;
  for (jint r = 0; r < rowCount; r++) {
    if (lead >= columnCount) break;
    {
      jint i = r;
      while (GeogebraCommonKernelKernel_isZeroWithDouble_(IOSDoubleArray_Get(nil_chk(IOSObjectArray_Get(data_, i)), lead))) {
        *IOSDoubleArray_GetRef(nil_chk(IOSObjectArray_Get(data_, i)), lead) = 0;
        i++;
        if (i == rowCount) {
          i = r;
          lead++;
          if (lead == columnCount) return;
        }
      }
      IOSDoubleArray *temp = IOSObjectArray_Get(data_, r);
      IOSObjectArray_Set(data_, r, IOSObjectArray_Get(data_, i));
      IOSObjectArray_Set(data_, i, temp);
    }
    {
      jdouble lv = IOSDoubleArray_Get(nil_chk(IOSObjectArray_Get(data_, r)), lead);
      for (jint j = 0; j < columnCount; j++) *IOSDoubleArray_GetRef(nil_chk(IOSObjectArray_Get(data_, r)), j) /= lv;
    }
    for (jint i = 0; i < rowCount; i++) {
      if (i != r) {
        jdouble lv = IOSDoubleArray_Get(nil_chk(IOSObjectArray_Get(data_, i)), lead);
        for (jint j = 0; j < columnCount; j++) *IOSDoubleArray_GetRef(nil_chk(IOSObjectArray_Get(data_, i)), j) -= lv * IOSDoubleArray_Get(nil_chk(IOSObjectArray_Get(data_, r)), j);
      }
    }
    lead++;
  }
}

- (void)transposeImmediate {
  jint m = [self getRowDimension];
  jint n = [self getColumnDimension];
  IOSObjectArray *C = [IOSDoubleArray arrayWithDimensions:2 lengths:(jint[]){ n, m }];
  for (jint i = 0; i < m; i++) {
    for (jint j = 0; j < n; j++) {
      *IOSDoubleArray_GetRef(nil_chk(IOSObjectArray_Get(C, j)), i) = IOSDoubleArray_Get(nil_chk(IOSObjectArray_Get(nil_chk(data_), i)), j);
    }
  }
  OrgApacheCommonsMathLinearArray2DRowRealMatrix_set_data_(self, C);
}

- (void)getGeoListWithGeogebraCommonKernelGeosGeoList:(GeogebraCommonKernelGeosGeoList *)outputList
                 withGeogebraCommonKernelConstruction:(GeogebraCommonKernelConstruction *)cons {
  if (isUndefined__) {
    [((GeogebraCommonKernelGeosGeoList *) nil_chk(outputList)) setDefinedWithBoolean:NO];
    return;
  }
  [((GeogebraCommonKernelGeosGeoList *) nil_chk(outputList)) clear];
  [outputList setDefinedWithBoolean:YES];
  for (jint r = 0; r < [self getRowDimension]; r++) {
    GeogebraCommonKernelGeosGeoList *columnList = [new_GeogebraCommonKernelGeosGeoList_initWithGeogebraCommonKernelConstruction_(cons) autorelease];
    for (jint c = 0; c < [self getColumnDimension]; c++) {
      [columnList addWithGeogebraCommonKernelGeosGeoElement:[new_GeogebraCommonKernelGeosGeoNumeric_initWithGeogebraCommonKernelConstruction_withDouble_(cons, [self getEntryWithInt:r withInt:c]) autorelease]];
    }
    [outputList addWithGeogebraCommonKernelGeosGeoElement:columnList];
  }
}

- (void)getMyListWithGeogebraCommonKernelArithmeticMyList:(GeogebraCommonKernelArithmeticMyList *)outputList
                           withGeogebraCommonKernelKernel:(GeogebraCommonKernelKernel *)kernel {
  if (isUndefined__) {
    return;
  }
  [((GeogebraCommonKernelArithmeticMyList *) nil_chk(outputList)) clear];
  for (jint r = 0; r < [self getRowDimension]; r++) {
    GeogebraCommonKernelArithmeticMyList *columnList = [new_GeogebraCommonKernelArithmeticMyList_initWithGeogebraCommonKernelKernel_(kernel) autorelease];
    for (jint c = 0; c < [self getColumnDimension]; c++) {
      [columnList addListElementWithGeogebraCommonKernelArithmeticExpressionValue:[new_GeogebraCommonKernelGeosGeoNumeric_initWithGeogebraCommonKernelConstruction_withDouble_([((GeogebraCommonKernelKernel *) nil_chk(kernel)) getConstruction], [self getEntryWithInt:r withInt:c]) autorelease]];
    }
    [outputList addListElementWithGeogebraCommonKernelArithmeticExpressionValue:columnList];
  }
}

- (jboolean)isUndefined {
  return isUndefined__;
}

- (void)setIsUndefinedWithBoolean:(jboolean)undefined {
  isUndefined__ = undefined;
}

- (jboolean)hasOnlyIntegers {
  for (jint i = 0; i < ((IOSObjectArray *) nil_chk(data_))->size_; i++) for (jint j = 0; j < ((IOSDoubleArray *) nil_chk(IOSObjectArray_Get(data_, i)))->size_; j++) if (!GeogebraCommonKernelKernel_isIntegerWithDouble_(IOSDoubleArray_Get(nil_chk(IOSObjectArray_Get(data_, i)), j))) return NO;
  return YES;
}

- (void)set3x3fromConicWithDoubleArray:(IOSDoubleArray *)matrix {
  [self setEntryWithInt:0 withInt:0 withDouble:IOSDoubleArray_Get(nil_chk(matrix), 0)];
  [self setEntryWithInt:0 withInt:1 withDouble:IOSDoubleArray_Get(matrix, 3)];
  [self setEntryWithInt:1 withInt:0 withDouble:IOSDoubleArray_Get(matrix, 3)];
  [self setEntryWithInt:1 withInt:1 withDouble:IOSDoubleArray_Get(matrix, 1)];
  [self setEntryWithInt:2 withInt:0 withDouble:IOSDoubleArray_Get(matrix, 4)];
  [self setEntryWithInt:0 withInt:2 withDouble:IOSDoubleArray_Get(matrix, 4)];
  [self setEntryWithInt:2 withInt:1 withDouble:IOSDoubleArray_Get(matrix, 5)];
  [self setEntryWithInt:1 withInt:2 withDouble:IOSDoubleArray_Get(matrix, 5)];
  [self setEntryWithInt:2 withInt:2 withDouble:IOSDoubleArray_Get(matrix, 2)];
  [self setIsUndefinedWithBoolean:NO];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithGeogebraCommonKernelGeosGeoList:", "GgbMat", NULL, 0x1, NULL, NULL },
    { "initWithGeogebraCommonKernelArithmeticMyList:", "GgbMat", NULL, 0x1, NULL, NULL },
    { "initWithInt:withInt:", "GgbMat", NULL, 0x1, NULL, NULL },
    { "inverseImmediate", NULL, "V", 0x1, NULL, NULL },
    { "determinant", NULL, "D", 0x1, NULL, NULL },
    { "reducedRowEchelonFormImmediate", NULL, "V", 0x1, NULL, NULL },
    { "transposeImmediate", NULL, "V", 0x1, NULL, NULL },
    { "getGeoListWithGeogebraCommonKernelGeosGeoList:withGeogebraCommonKernelConstruction:", "getGeoList", "V", 0x1, NULL, NULL },
    { "getMyListWithGeogebraCommonKernelArithmeticMyList:withGeogebraCommonKernelKernel:", "getMyList", "V", 0x1, NULL, NULL },
    { "isUndefined", NULL, "Z", 0x1, NULL, NULL },
    { "setIsUndefinedWithBoolean:", "setIsUndefined", "V", 0x1, NULL, NULL },
    { "hasOnlyIntegers", NULL, "Z", 0x1, NULL, NULL },
    { "set3x3fromConicWithDoubleArray:", "set3x3fromConic", "V", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "serialVersionUID_", NULL, 0x1a, "J", NULL, NULL, .constantValue.asLong = GeogebraCommonUtilGgbMat_serialVersionUID },
    { "isUndefined__", "isUndefined", 0x2, "Z", NULL, NULL,  },
  };
  static const J2ObjcClassInfo _GeogebraCommonUtilGgbMat = { 2, "GgbMat", "geogebra.common.util", NULL, 0x1, 13, methods, 2, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_GeogebraCommonUtilGgbMat;
}

@end

void GeogebraCommonUtilGgbMat_initWithGeogebraCommonKernelGeosGeoList_(GeogebraCommonUtilGgbMat *self, GeogebraCommonKernelGeosGeoList *inputList) {
  OrgApacheCommonsMathLinearArray2DRowRealMatrix_init(self);
  self->isUndefined__ = NO;
  jint rows = [((GeogebraCommonKernelGeosGeoList *) nil_chk(inputList)) size];
  if (![inputList isDefined] || rows == 0) {
    [self setIsUndefinedWithBoolean:YES];
    return;
  }
  GeogebraCommonKernelGeosGeoElement *geo = [inputList getWithInt:0];
  if (![((GeogebraCommonKernelGeosGeoElement *) nil_chk(geo)) isGeoList]) {
    [self setIsUndefinedWithBoolean:YES];
    return;
  }
  jint cols = [((GeogebraCommonKernelGeosGeoList *) check_class_cast(geo, [GeogebraCommonKernelGeosGeoList class])) size];
  if (cols == 0) {
    [self setIsUndefinedWithBoolean:YES];
    return;
  }
  OrgApacheCommonsMathLinearArray2DRowRealMatrix_setAndConsume_data_(self, [IOSDoubleArray newArrayWithDimensions:2 lengths:(jint[]){ rows, cols }]);
  GeogebraCommonKernelGeosGeoList *rowList;
  for (jint r = 0; r < rows; r++) {
    geo = [inputList getWithInt:r];
    if (![((GeogebraCommonKernelGeosGeoElement *) nil_chk(geo)) isGeoList]) {
      [self setIsUndefinedWithBoolean:YES];
      return;
    }
    rowList = (GeogebraCommonKernelGeosGeoList *) check_class_cast(geo, [GeogebraCommonKernelGeosGeoList class]);
    if ([rowList size] != cols) {
      [self setIsUndefinedWithBoolean:YES];
      return;
    }
    for (jint c = 0; c < cols; c++) {
      geo = [rowList getWithInt:c];
      if (![((GeogebraCommonKernelGeosGeoElement *) nil_chk(geo)) isGeoNumeric]) {
        [self setIsUndefinedWithBoolean:YES];
        return;
      }
      [self setEntryWithInt:r withInt:c withDouble:[((GeogebraCommonKernelGeosGeoNumeric *) check_class_cast(geo, [GeogebraCommonKernelGeosGeoNumeric class])) getValue]];
    }
  }
}

GeogebraCommonUtilGgbMat *new_GeogebraCommonUtilGgbMat_initWithGeogebraCommonKernelGeosGeoList_(GeogebraCommonKernelGeosGeoList *inputList) {
  GeogebraCommonUtilGgbMat *self = [GeogebraCommonUtilGgbMat alloc];
  GeogebraCommonUtilGgbMat_initWithGeogebraCommonKernelGeosGeoList_(self, inputList);
  return self;
}

void GeogebraCommonUtilGgbMat_initWithGeogebraCommonKernelArithmeticMyList_(GeogebraCommonUtilGgbMat *self, GeogebraCommonKernelArithmeticMyList *inputList) {
  OrgApacheCommonsMathLinearArray2DRowRealMatrix_init(self);
  self->isUndefined__ = NO;
  if (![((GeogebraCommonKernelArithmeticMyList *) nil_chk(inputList)) isMatrix]) {
    [self setIsUndefinedWithBoolean:YES];
    return;
  }
  jint rows = [inputList getMatrixRows];
  jint cols = [inputList getMatrixCols];
  if (rows < 1 || cols < 1) {
    [self setIsUndefinedWithBoolean:YES];
    return;
  }
  OrgApacheCommonsMathLinearArray2DRowRealMatrix_setAndConsume_data_(self, [IOSDoubleArray newArrayWithDimensions:2 lengths:(jint[]){ rows, cols }]);
  for (jint r = 0; r < rows; r++) {
    for (jint c = 0; c < cols; c++) {
      id<GeogebraCommonKernelArithmeticExpressionValue> geo = GeogebraCommonKernelArithmeticMyList_getCellWithGeogebraCommonKernelArithmeticMyList_withInt_withInt_(inputList, c, r);
      if (!([GeogebraCommonKernelArithmeticNumberValue_class_() isInstance:geo])) {
        [self setIsUndefinedWithBoolean:YES];
        return;
      }
      [self setEntryWithInt:r withInt:c withDouble:[((id<GeogebraCommonKernelArithmeticNumberValue>) nil_chk(((id<GeogebraCommonKernelArithmeticNumberValue>) check_protocol_cast(geo, @protocol(GeogebraCommonKernelArithmeticNumberValue))))) getDouble]];
    }
  }
}

GeogebraCommonUtilGgbMat *new_GeogebraCommonUtilGgbMat_initWithGeogebraCommonKernelArithmeticMyList_(GeogebraCommonKernelArithmeticMyList *inputList) {
  GeogebraCommonUtilGgbMat *self = [GeogebraCommonUtilGgbMat alloc];
  GeogebraCommonUtilGgbMat_initWithGeogebraCommonKernelArithmeticMyList_(self, inputList);
  return self;
}

void GeogebraCommonUtilGgbMat_initWithInt_withInt_(GeogebraCommonUtilGgbMat *self, jint rows, jint cols) {
  OrgApacheCommonsMathLinearArray2DRowRealMatrix_init(self);
  self->isUndefined__ = NO;
  OrgApacheCommonsMathLinearArray2DRowRealMatrix_setAndConsume_data_(self, [IOSDoubleArray newArrayWithDimensions:2 lengths:(jint[]){ rows, cols }]);
  [self setIsUndefinedWithBoolean:NO];
}

GeogebraCommonUtilGgbMat *new_GeogebraCommonUtilGgbMat_initWithInt_withInt_(jint rows, jint cols) {
  GeogebraCommonUtilGgbMat *self = [GeogebraCommonUtilGgbMat alloc];
  GeogebraCommonUtilGgbMat_initWithInt_withInt_(self, rows, cols);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(GeogebraCommonUtilGgbMat)
