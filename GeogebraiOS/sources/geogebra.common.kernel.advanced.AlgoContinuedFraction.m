//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/geogebra_iOS/geogebra/geogebra/common/src/geogebra/common/kernel/advanced/AlgoContinuedFraction.java
//


#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "geogebra/common/kernel/Construction.h"
#include "geogebra/common/kernel/Kernel.h"
#include "geogebra/common/kernel/StringTemplate.h"
#include "geogebra/common/kernel/advanced/AlgoContinuedFraction.h"
#include "geogebra/common/kernel/algos/AlgoElement.h"
#include "geogebra/common/kernel/algos/ConstructionElement.h"
#include "geogebra/common/kernel/arithmetic/ExpressionNodeConstants.h"
#include "geogebra/common/kernel/commands/Commands.h"
#include "geogebra/common/kernel/geos/GeoBoolean.h"
#include "geogebra/common/kernel/geos/GeoElement.h"
#include "geogebra/common/kernel/geos/GeoNumberValue.h"
#include "geogebra/common/kernel/geos/GeoText.h"
#include "geogebra/common/main/App.h"
#include "geogebra/common/main/Localization.h"
#include "geogebra/common/util/Unicode.h"
#include "java/lang/Double.h"
#include "java/lang/Math.h"
#include "java/lang/StringBuilder.h"

#define GeogebraCommonKernelAdvancedAlgoContinuedFraction_MAX_QUOTIENTS 15

@interface GeogebraCommonKernelAdvancedAlgoContinuedFraction () {
 @public
  id<GeogebraCommonKernelGeosGeoNumberValue> num_;
  id<GeogebraCommonKernelGeosGeoNumberValue> level_;
  GeogebraCommonKernelGeosGeoText *text_;
  GeogebraCommonKernelGeosGeoBoolean *shorthand_;
  IOSLongArray *denominators_;
  JavaLangStringBuilder *sb_;
  jboolean dotsNeeded_;
}

- (void)appendLongLatexWithInt:(jint)steps
withGeogebraCommonKernelStringTemplate:(GeogebraCommonKernelStringTemplate *)tpl;

- (jint)DecimalToFractionWithDouble:(jdouble)dec
                         withDouble:(jdouble)AccuracyFactor
                      withLongArray:(IOSLongArray *)denominators
                            withInt:(jint)maxSteps;

@end

J2OBJC_FIELD_SETTER(GeogebraCommonKernelAdvancedAlgoContinuedFraction, num_, id<GeogebraCommonKernelGeosGeoNumberValue>)
J2OBJC_FIELD_SETTER(GeogebraCommonKernelAdvancedAlgoContinuedFraction, level_, id<GeogebraCommonKernelGeosGeoNumberValue>)
J2OBJC_FIELD_SETTER(GeogebraCommonKernelAdvancedAlgoContinuedFraction, text_, GeogebraCommonKernelGeosGeoText *)
J2OBJC_FIELD_SETTER(GeogebraCommonKernelAdvancedAlgoContinuedFraction, shorthand_, GeogebraCommonKernelGeosGeoBoolean *)
J2OBJC_FIELD_SETTER(GeogebraCommonKernelAdvancedAlgoContinuedFraction, denominators_, IOSLongArray *)
J2OBJC_FIELD_SETTER(GeogebraCommonKernelAdvancedAlgoContinuedFraction, sb_, JavaLangStringBuilder *)

J2OBJC_STATIC_FIELD_GETTER(GeogebraCommonKernelAdvancedAlgoContinuedFraction, MAX_QUOTIENTS, jint)

__attribute__((unused)) static void GeogebraCommonKernelAdvancedAlgoContinuedFraction_compute(GeogebraCommonKernelAdvancedAlgoContinuedFraction *self);

__attribute__((unused)) static void GeogebraCommonKernelAdvancedAlgoContinuedFraction_appendLongLatexWithInt_withGeogebraCommonKernelStringTemplate_(GeogebraCommonKernelAdvancedAlgoContinuedFraction *self, jint steps, GeogebraCommonKernelStringTemplate *tpl);

__attribute__((unused)) static jint GeogebraCommonKernelAdvancedAlgoContinuedFraction_DecimalToFractionWithDouble_withDouble_withLongArray_withInt_(GeogebraCommonKernelAdvancedAlgoContinuedFraction *self, jdouble dec, jdouble AccuracyFactor, IOSLongArray *denominators, jint maxSteps);

@implementation GeogebraCommonKernelAdvancedAlgoContinuedFraction

- (instancetype)initWithGeogebraCommonKernelConstruction:(GeogebraCommonKernelConstruction *)cons
                                            withNSString:(NSString *)label
              withGeogebraCommonKernelGeosGeoNumberValue:(id<GeogebraCommonKernelGeosGeoNumberValue>)num
              withGeogebraCommonKernelGeosGeoNumberValue:(id<GeogebraCommonKernelGeosGeoNumberValue>)level
                  withGeogebraCommonKernelGeosGeoBoolean:(GeogebraCommonKernelGeosGeoBoolean *)shorthand {
  GeogebraCommonKernelAdvancedAlgoContinuedFraction_initWithGeogebraCommonKernelConstruction_withNSString_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoBoolean_(self, cons, label, num, level, shorthand);
  return self;
}

- (instancetype)initWithGeogebraCommonKernelConstruction:(GeogebraCommonKernelConstruction *)cons
              withGeogebraCommonKernelGeosGeoNumberValue:(id<GeogebraCommonKernelGeosGeoNumberValue>)num
              withGeogebraCommonKernelGeosGeoNumberValue:(id<GeogebraCommonKernelGeosGeoNumberValue>)level
                  withGeogebraCommonKernelGeosGeoBoolean:(GeogebraCommonKernelGeosGeoBoolean *)shorthand {
  GeogebraCommonKernelAdvancedAlgoContinuedFraction_initWithGeogebraCommonKernelConstruction_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoBoolean_(self, cons, num, level, shorthand);
  return self;
}

- (GeogebraCommonKernelCommandsCommandsEnum *)getClassName {
  return GeogebraCommonKernelCommandsCommandsEnum_get_ContinuedFraction();
}

- (void)setInputOutput {
  jint inputLength = 1 + (level_ == nil ? 0 : 1) + (shorthand_ == nil ? 0 : 1);
  GeogebraCommonKernelAlgosAlgoElement_setAndConsume_input_(self, [IOSObjectArray newArrayWithLength:inputLength type:GeogebraCommonKernelGeosGeoElement_class_()]);
  IOSObjectArray_Set(input_, 0, [((id<GeogebraCommonKernelGeosGeoNumberValue>) nil_chk(num_)) toGeoElement]);
  jint shorthandPos = 1;
  if (level_ != nil) {
    shorthandPos = 2;
    IOSObjectArray_Set(input_, 1, [level_ toGeoElement]);
  }
  if (shorthand_ != nil) {
    IOSObjectArray_Set(input_, shorthandPos, shorthand_);
  }
  [self setOutputLengthWithInt:1];
  [self setOutputWithInt:0 withGeogebraCommonKernelGeosGeoElement:text_];
  [self setDependencies];
}

- (GeogebraCommonKernelGeosGeoText *)getResult {
  return text_;
}

- (void)compute {
  GeogebraCommonKernelAdvancedAlgoContinuedFraction_compute(self);
}

- (void)appendLongLatexWithInt:(jint)steps
withGeogebraCommonKernelStringTemplate:(GeogebraCommonKernelStringTemplate *)tpl {
  GeogebraCommonKernelAdvancedAlgoContinuedFraction_appendLongLatexWithInt_withGeogebraCommonKernelStringTemplate_(self, steps, tpl);
}

- (jint)DecimalToFractionWithDouble:(jdouble)dec
                         withDouble:(jdouble)AccuracyFactor
                      withLongArray:(IOSLongArray *)denominators
                            withInt:(jint)maxSteps {
  return GeogebraCommonKernelAdvancedAlgoContinuedFraction_DecimalToFractionWithDouble_withDouble_withLongArray_withInt_(self, dec, AccuracyFactor, denominators, maxSteps);
}

- (jboolean)isLaTeXTextCommand {
  return YES;
}

- (void)dealloc {
  RELEASE_(num_);
  RELEASE_(level_);
  RELEASE_(text_);
  RELEASE_(shorthand_);
  RELEASE_(denominators_);
  RELEASE_(sb_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithGeogebraCommonKernelConstruction:withNSString:withGeogebraCommonKernelGeosGeoNumberValue:withGeogebraCommonKernelGeosGeoNumberValue:withGeogebraCommonKernelGeosGeoBoolean:", "AlgoContinuedFraction", NULL, 0x1, NULL, NULL },
    { "initWithGeogebraCommonKernelConstruction:withGeogebraCommonKernelGeosGeoNumberValue:withGeogebraCommonKernelGeosGeoNumberValue:withGeogebraCommonKernelGeosGeoBoolean:", "AlgoContinuedFraction", NULL, 0x0, NULL, NULL },
    { "getClassName", NULL, "Lgeogebra.common.kernel.commands.Commands;", 0x1, NULL, NULL },
    { "setInputOutput", NULL, "V", 0x4, NULL, NULL },
    { "getResult", NULL, "Lgeogebra.common.kernel.geos.GeoText;", 0x1, NULL, NULL },
    { "compute", NULL, "V", 0x11, NULL, NULL },
    { "appendLongLatexWithInt:withGeogebraCommonKernelStringTemplate:", "appendLongLatex", "V", 0x2, NULL, NULL },
    { "DecimalToFractionWithDouble:withDouble:withLongArray:withInt:", "DecimalToFraction", "I", 0x2, NULL, NULL },
    { "isLaTeXTextCommand", NULL, "Z", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "num_", NULL, 0x2, "Lgeogebra.common.kernel.geos.GeoNumberValue;", NULL, NULL,  },
    { "level_", NULL, 0x2, "Lgeogebra.common.kernel.geos.GeoNumberValue;", NULL, NULL,  },
    { "text_", NULL, 0x2, "Lgeogebra.common.kernel.geos.GeoText;", NULL, NULL,  },
    { "shorthand_", NULL, 0x2, "Lgeogebra.common.kernel.geos.GeoBoolean;", NULL, NULL,  },
    { "MAX_QUOTIENTS_", NULL, 0x1a, "I", NULL, NULL, .constantValue.asInt = GeogebraCommonKernelAdvancedAlgoContinuedFraction_MAX_QUOTIENTS },
    { "denominators_", NULL, 0x2, "[J", NULL, NULL,  },
    { "sb_", NULL, 0x2, "Ljava.lang.StringBuilder;", NULL, NULL,  },
    { "dotsNeeded_", NULL, 0x2, "Z", NULL, NULL,  },
  };
  static const J2ObjcClassInfo _GeogebraCommonKernelAdvancedAlgoContinuedFraction = { 2, "AlgoContinuedFraction", "geogebra.common.kernel.advanced", NULL, 0x1, 9, methods, 8, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_GeogebraCommonKernelAdvancedAlgoContinuedFraction;
}

@end

void GeogebraCommonKernelAdvancedAlgoContinuedFraction_initWithGeogebraCommonKernelConstruction_withNSString_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoBoolean_(GeogebraCommonKernelAdvancedAlgoContinuedFraction *self, GeogebraCommonKernelConstruction *cons, NSString *label, id<GeogebraCommonKernelGeosGeoNumberValue> num, id<GeogebraCommonKernelGeosGeoNumberValue> level, GeogebraCommonKernelGeosGeoBoolean *shorthand) {
  GeogebraCommonKernelAdvancedAlgoContinuedFraction_initWithGeogebraCommonKernelConstruction_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoBoolean_(self, cons, num, level, shorthand);
  [((GeogebraCommonKernelGeosGeoText *) nil_chk(self->text_)) setLabelWithNSString:label];
}

GeogebraCommonKernelAdvancedAlgoContinuedFraction *new_GeogebraCommonKernelAdvancedAlgoContinuedFraction_initWithGeogebraCommonKernelConstruction_withNSString_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoBoolean_(GeogebraCommonKernelConstruction *cons, NSString *label, id<GeogebraCommonKernelGeosGeoNumberValue> num, id<GeogebraCommonKernelGeosGeoNumberValue> level, GeogebraCommonKernelGeosGeoBoolean *shorthand) {
  GeogebraCommonKernelAdvancedAlgoContinuedFraction *self = [GeogebraCommonKernelAdvancedAlgoContinuedFraction alloc];
  GeogebraCommonKernelAdvancedAlgoContinuedFraction_initWithGeogebraCommonKernelConstruction_withNSString_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoBoolean_(self, cons, label, num, level, shorthand);
  return self;
}

void GeogebraCommonKernelAdvancedAlgoContinuedFraction_initWithGeogebraCommonKernelConstruction_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoBoolean_(GeogebraCommonKernelAdvancedAlgoContinuedFraction *self, GeogebraCommonKernelConstruction *cons, id<GeogebraCommonKernelGeosGeoNumberValue> num, id<GeogebraCommonKernelGeosGeoNumberValue> level, GeogebraCommonKernelGeosGeoBoolean *shorthand) {
  GeogebraCommonKernelAlgosAlgoElement_initWithGeogebraCommonKernelConstruction_(self, cons);
  GeogebraCommonKernelAdvancedAlgoContinuedFraction_setAndConsume_denominators_(self, [IOSLongArray newArrayWithLength:GeogebraCommonKernelAdvancedAlgoContinuedFraction_MAX_QUOTIENTS]);
  GeogebraCommonKernelAdvancedAlgoContinuedFraction_setAndConsume_sb_(self, new_JavaLangStringBuilder_init());
  GeogebraCommonKernelAdvancedAlgoContinuedFraction_set_num_(self, num);
  GeogebraCommonKernelAdvancedAlgoContinuedFraction_set_level_(self, level);
  GeogebraCommonKernelAdvancedAlgoContinuedFraction_set_shorthand_(self, shorthand);
  GeogebraCommonKernelAdvancedAlgoContinuedFraction_setAndConsume_text_(self, new_GeogebraCommonKernelGeosGeoText_initWithGeogebraCommonKernelConstruction_(cons));
  [self->text_ setFormulaTypeWithGeogebraCommonKernelArithmeticExpressionNodeConstants_StringTypeEnum:[((GeogebraCommonMainApp *) nil_chk([((GeogebraCommonKernelKernel *) nil_chk(self->kernel_)) getApplication])) getPreferredFormulaRenderingType]];
  [self->text_ setLaTeXWithBoolean:YES withBoolean:NO];
  [self->text_ setIsTextCommandWithBoolean:YES];
  [self setInputOutput];
  GeogebraCommonKernelAdvancedAlgoContinuedFraction_compute(self);
}

GeogebraCommonKernelAdvancedAlgoContinuedFraction *new_GeogebraCommonKernelAdvancedAlgoContinuedFraction_initWithGeogebraCommonKernelConstruction_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoBoolean_(GeogebraCommonKernelConstruction *cons, id<GeogebraCommonKernelGeosGeoNumberValue> num, id<GeogebraCommonKernelGeosGeoNumberValue> level, GeogebraCommonKernelGeosGeoBoolean *shorthand) {
  GeogebraCommonKernelAdvancedAlgoContinuedFraction *self = [GeogebraCommonKernelAdvancedAlgoContinuedFraction alloc];
  GeogebraCommonKernelAdvancedAlgoContinuedFraction_initWithGeogebraCommonKernelConstruction_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoNumberValue_withGeogebraCommonKernelGeosGeoBoolean_(self, cons, num, level, shorthand);
  return self;
}

void GeogebraCommonKernelAdvancedAlgoContinuedFraction_compute(GeogebraCommonKernelAdvancedAlgoContinuedFraction *self) {
  GeogebraCommonKernelStringTemplate *tpl = [((GeogebraCommonKernelGeosGeoText *) nil_chk(self->text_)) getStringTemplate];
  if ([((id<GeogebraCommonKernelGeosGeoNumberValue>) nil_chk(self->num_)) isDefined] && (self->level_ == nil || [self->level_ isDefined])) {
    jint maxSteps = self->level_ == nil ? 0 : J2ObjCFpToInt([self->level_ getDouble]);
    jint steps = GeogebraCommonKernelAdvancedAlgoContinuedFraction_DecimalToFractionWithDouble_withDouble_withLongArray_withInt_(self, [self->num_ getDouble], GeogebraCommonKernelKernel_STANDARD_PRECISION, self->denominators_, maxSteps);
    if (steps < 1) {
      [self->text_ setUndefined];
      return;
    }
    switch ([[((GeogebraCommonKernelStringTemplate *) nil_chk(tpl)) getStringType] ordinal]) {
      case GeogebraCommonKernelArithmeticExpressionNodeConstants_StringType_MATHML:
      if (steps == 1) {
        [((JavaLangStringBuilder *) nil_chk(self->sb_)) setLengthWithInt:0];
        [self->sb_ appendWithNSString:@"<cn>"];
        [self->sb_ appendWithNSString:[((GeogebraCommonKernelKernel *) nil_chk(self->kernel_)) formatWithDouble:IOSLongArray_Get(nil_chk(self->denominators_), 0) withGeogebraCommonKernelStringTemplate:tpl]];
        [self->sb_ appendWithNSString:@"</cn>"];
        [self->text_ setTextStringWithNSString:[self->sb_ description]];
      }
      else {
        [((JavaLangStringBuilder *) nil_chk(self->sb_)) setLengthWithInt:0];
        [self->sb_ appendWithNSString:@"<apply><plus/>"];
        for (jint i = 0; i < steps - 1; i++) {
          [self->sb_ appendWithNSString:@"<cn>"];
          [self->sb_ appendWithLong:IOSLongArray_Get(nil_chk(self->denominators_), i)];
          [self->sb_ appendWithNSString:@"</cn><apply><divide/><cn>1</cn><apply><plus/>"];
        }
        [self->sb_ appendWithNSString:@"<cn>"];
        [self->sb_ appendWithNSString:[((GeogebraCommonKernelKernel *) nil_chk(self->kernel_)) formatWithDouble:GeogebraCommonKernelKernel_checkDecimalFractionWithDouble_(IOSLongArray_Get(nil_chk(self->denominators_), steps - 1)) withGeogebraCommonKernelStringTemplate:tpl]];
        [self->sb_ appendWithNSString:@"</cn><ci>"];
        [self->sb_ appendWithChar:GeogebraCommonUtilUnicode_ellipsis];
        [self->sb_ appendWithNSString:@"</ci>"];
        for (jint i = 0; i < steps - 1; i++) {
          [self->sb_ appendWithNSString:@"</apply></apply>"];
        }
        [self->sb_ appendWithNSString:@"</apply>"];
        GeogebraCommonMainApp_debugWithNSString_([self->sb_ description]);
        [self->text_ setTextStringWithNSString:[self->sb_ description]];
      }
      break;
      case GeogebraCommonKernelArithmeticExpressionNodeConstants_StringType_LATEX:
      if (steps == 1) {
        [self->text_ setTextStringWithNSString:[((GeogebraCommonKernelKernel *) nil_chk(self->kernel_)) formatWithDouble:JavaLangMath_roundWithDouble_([self->num_ getDouble]) withGeogebraCommonKernelStringTemplate:tpl]];
      }
      else {
        if (self->shorthand_ == nil || ![self->shorthand_ getBoolean]) {
          GeogebraCommonKernelAdvancedAlgoContinuedFraction_appendLongLatexWithInt_withGeogebraCommonKernelStringTemplate_(self, steps, tpl);
        }
        else {
          [((JavaLangStringBuilder *) nil_chk(self->sb_)) setLengthWithInt:0];
          if ([self->num_ getDouble] < 0) {
            [self->sb_ appendWithChar:'-'];
          }
          [self->sb_ appendWithChar:'['];
          [self->sb_ appendWithNSString:[((GeogebraCommonKernelKernel *) nil_chk(self->kernel_)) formatWithDouble:IOSLongArray_Get(nil_chk(self->denominators_), 0) withGeogebraCommonKernelStringTemplate:tpl]];
          [self->sb_ appendWithChar:';'];
          for (jint i = 1; i < steps - 1; i++) {
            [self->sb_ appendWithNSString:[self->kernel_ formatWithDouble:IOSLongArray_Get(self->denominators_, i) withGeogebraCommonKernelStringTemplate:tpl]];
            [self->sb_ appendWithNSString:@","];
          }
          [self->sb_ appendWithNSString:[self->kernel_ formatWithDouble:IOSLongArray_Get(self->denominators_, steps - 1) withGeogebraCommonKernelStringTemplate:tpl]];
          if (self->dotsNeeded_) {
            [self->sb_ appendWithNSString:@",\\ldots"];
          }
          [self->sb_ appendWithChar:']'];
          [self->text_ setTextStringWithNSString:[self->sb_ description]];
        }
      }
      break;
    }
    [self->text_ setLaTeXWithBoolean:YES withBoolean:NO];
  }
  else {
    [self->text_ setLaTeXWithBoolean:NO withBoolean:NO];
    [self->text_ setTextStringWithNSString:[((GeogebraCommonMainLocalization *) nil_chk([self getLoc])) getPlainWithNSString:@"Undefined"]];
  }
}

void GeogebraCommonKernelAdvancedAlgoContinuedFraction_appendLongLatexWithInt_withGeogebraCommonKernelStringTemplate_(GeogebraCommonKernelAdvancedAlgoContinuedFraction *self, jint steps, GeogebraCommonKernelStringTemplate *tpl) {
  [((JavaLangStringBuilder *) nil_chk(self->sb_)) setLengthWithInt:0];
  jint start = 0;
  if ([((id<GeogebraCommonKernelGeosGeoNumberValue>) nil_chk(self->num_)) getDouble] < 0) {
    [self->sb_ appendWithChar:'-'];
    [self->sb_ appendWithNSString:[((GeogebraCommonKernelKernel *) nil_chk(self->kernel_)) formatWithDouble:IOSLongArray_Get(nil_chk(self->denominators_), 0) withGeogebraCommonKernelStringTemplate:tpl]];
    [self->sb_ appendWithNSString:@"-\\frac{1}{"];
    start = 1;
  }
  for (jint i = start; i < steps - 1; i++) {
    [self->sb_ appendWithNSString:[((GeogebraCommonKernelKernel *) nil_chk(self->kernel_)) formatWithDouble:IOSLongArray_Get(nil_chk(self->denominators_), i) withGeogebraCommonKernelStringTemplate:tpl]];
    [self->sb_ appendWithNSString:@"+\\frac{1}{"];
  }
  [self->sb_ appendWithNSString:[((GeogebraCommonKernelKernel *) nil_chk(self->kernel_)) formatWithDouble:IOSLongArray_Get(nil_chk(self->denominators_), steps - 1) withGeogebraCommonKernelStringTemplate:tpl]];
  if (self->dotsNeeded_) {
    [self->sb_ appendWithNSString:@"+\\cdots"];
  }
  for (jint i = 0; i < steps - 1; i++) {
    [self->sb_ appendWithNSString:@"}"];
  }
  [((GeogebraCommonKernelGeosGeoText *) nil_chk(self->text_)) setTextStringWithNSString:[self->sb_ description]];
}

jint GeogebraCommonKernelAdvancedAlgoContinuedFraction_DecimalToFractionWithDouble_withDouble_withLongArray_withInt_(GeogebraCommonKernelAdvancedAlgoContinuedFraction *self, jdouble dec, jdouble AccuracyFactor, IOSLongArray *denominators, jint maxSteps) {
  jdouble FractionNumerator, FractionDenominator;
  jdouble DecimalSign;
  jdouble Z;
  jdouble PreviousDenominator;
  jdouble ScratchValue;
  if (JavaLangDouble_isNaNWithDouble_(dec)) return -1;
  if (dec == JavaLangDouble_POSITIVE_INFINITY || dec == JavaLangDouble_NEGATIVE_INFINITY) {
    return -1;
  }
  if (dec < 0.0) DecimalSign = -1.0;
  else DecimalSign = 1.0;
  jdouble decimal = JavaLangMath_absWithDouble_(dec);
  if (JavaLangMath_absWithDouble_(decimal - JavaLangMath_floorWithDouble_(decimal)) < AccuracyFactor) {
    FractionNumerator = decimal * DecimalSign;
    FractionDenominator = 1.0;
    *IOSLongArray_GetRef(nil_chk(denominators), 0) = J2ObjCFpToInt(JavaLangMath_floorWithDouble_(decimal));
    return 1;
  }
  if (decimal < 1.0E-19) {
    *IOSLongArray_GetRef(nil_chk(denominators), 0) = 0;
    return 2;
  }
  if (decimal > 1.0E19) {
    *IOSLongArray_GetRef(nil_chk(denominators), 0) = 999999999;
    return 1;
  }
  Z = decimal;
  PreviousDenominator = 0.0;
  FractionDenominator = 1.0;
  jint steps = 0;
  self->dotsNeeded_ = YES;
  do {
    *IOSLongArray_GetRef(nil_chk(denominators), steps) = J2ObjCFpToLong(JavaLangMath_floorWithDouble_(Z));
    Z = 1.0 / (Z - JavaLangMath_floorWithDouble_(Z));
    ScratchValue = FractionDenominator;
    FractionDenominator = FractionDenominator * JavaLangMath_floorWithDouble_(Z) + PreviousDenominator;
    PreviousDenominator = ScratchValue;
    FractionNumerator = JavaLangMath_floorWithDouble_(decimal * FractionDenominator + 0.5);
    steps++;
    if (GeogebraCommonKernelKernel_isEqualWithDouble_withDouble_(Z, JavaLangMath_floorWithDouble_(Z))) {
      *IOSLongArray_GetRef(denominators, steps) = J2ObjCFpToLong(JavaLangMath_floorWithDouble_(Z));
      self->dotsNeeded_ = NO;
      steps++;
      break;
    }
    if (JavaLangMath_absWithDouble_((decimal - (FractionNumerator / FractionDenominator))) <= AccuracyFactor) {
      *IOSLongArray_GetRef(denominators, steps) = J2ObjCFpToLong(JavaLangMath_floorWithDouble_(Z));
      steps++;
      break;
    }
  }
  while ((maxSteps == 0 || steps < maxSteps) && Z != JavaLangMath_floorWithDouble_(Z) && steps < denominators->size_);
  return steps;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(GeogebraCommonKernelAdvancedAlgoContinuedFraction)
