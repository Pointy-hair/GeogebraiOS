//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/geogebra_iOS/geogebra/geogebra/common/src/org/apache/commons/math/optimization/fitting/HarmonicFitter.java
//


#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/lang/Integer.h"
#include "java/lang/RuntimeException.h"
#include "org/apache/commons/math/FunctionEvaluationException.h"
#include "org/apache/commons/math/exception/util/LocalizedFormats.h"
#include "org/apache/commons/math/optimization/DifferentiableMultivariateVectorialOptimizer.h"
#include "org/apache/commons/math/optimization/OptimizationException.h"
#include "org/apache/commons/math/optimization/fitting/CurveFitter.h"
#include "org/apache/commons/math/optimization/fitting/HarmonicCoefficientsGuesser.h"
#include "org/apache/commons/math/optimization/fitting/HarmonicFitter.h"
#include "org/apache/commons/math/optimization/fitting/HarmonicFunction.h"
#include "org/apache/commons/math/optimization/fitting/ParametricRealFunction.h"
#include "org/apache/commons/math/util/FastMath.h"

@interface OrgApacheCommonsMathOptimizationFittingHarmonicFitter () {
 @public
  OrgApacheCommonsMathOptimizationFittingCurveFitter *fitter_;
  IOSDoubleArray *parameters_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheCommonsMathOptimizationFittingHarmonicFitter, fitter_, OrgApacheCommonsMathOptimizationFittingCurveFitter *)
J2OBJC_FIELD_SETTER(OrgApacheCommonsMathOptimizationFittingHarmonicFitter, parameters_, IOSDoubleArray *)

@interface OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction : NSObject < OrgApacheCommonsMathOptimizationFittingParametricRealFunction >

- (jdouble)valueWithDouble:(jdouble)x
           withDoubleArray:(IOSDoubleArray *)parameters;

- (IOSDoubleArray *)gradientWithDouble:(jdouble)x
                       withDoubleArray:(IOSDoubleArray *)parameters;

- (instancetype)init;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction)

__attribute__((unused)) static void OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction_init(OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction *self);

__attribute__((unused)) static OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction *new_OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction_init() NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction)

@implementation OrgApacheCommonsMathOptimizationFittingHarmonicFitter

- (instancetype)initWithOrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer:(id<OrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer>)optimizer {
  OrgApacheCommonsMathOptimizationFittingHarmonicFitter_initWithOrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer_(self, optimizer);
  return self;
}

- (instancetype)initWithOrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer:(id<OrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer>)optimizer
                                                                                     withDoubleArray:(IOSDoubleArray *)initialGuess {
  OrgApacheCommonsMathOptimizationFittingHarmonicFitter_initWithOrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer_withDoubleArray_(self, optimizer, initialGuess);
  return self;
}

- (void)addObservedPointWithDouble:(jdouble)weight
                        withDouble:(jdouble)x
                        withDouble:(jdouble)y {
  [((OrgApacheCommonsMathOptimizationFittingCurveFitter *) nil_chk(fitter_)) addObservedPointWithDouble:weight withDouble:x withDouble:y];
}

- (OrgApacheCommonsMathOptimizationFittingHarmonicFunction *)fit {
  if (parameters_ == nil) {
    IOSObjectArray *observations = [((OrgApacheCommonsMathOptimizationFittingCurveFitter *) nil_chk(fitter_)) getObservations];
    if (((IOSObjectArray *) nil_chk(observations))->size_ < 4) {
      @throw [new_OrgApacheCommonsMathOptimizationOptimizationException_initWithOrgApacheCommonsMathExceptionUtilLocalizable_withNSObjectArray_(OrgApacheCommonsMathExceptionUtilLocalizedFormatsEnum_get_INSUFFICIENT_OBSERVED_POINTS_IN_SAMPLE(), [IOSObjectArray arrayWithObjects:(id[]){ JavaLangInteger_valueOfWithInt_(observations->size_), JavaLangInteger_valueOfWithInt_(4) } count:2 type:NSObject_class_()]) autorelease];
    }
    OrgApacheCommonsMathOptimizationFittingHarmonicCoefficientsGuesser *guesser = [new_OrgApacheCommonsMathOptimizationFittingHarmonicCoefficientsGuesser_initWithOrgApacheCommonsMathOptimizationFittingWeightedObservedPointArray_(observations) autorelease];
    [guesser guess];
    OrgApacheCommonsMathOptimizationFittingHarmonicFitter_setAndConsume_parameters_(self, [IOSDoubleArray newArrayWithDoubles:(jdouble[]){ [guesser getGuessedAmplitude], [guesser getGuessedPulsation], [guesser getGuessedPhase] } count:3]);
  }
  @try {
    IOSDoubleArray *fitted = [((OrgApacheCommonsMathOptimizationFittingCurveFitter *) nil_chk(fitter_)) fitWithOrgApacheCommonsMathOptimizationFittingParametricRealFunction:[new_OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction_init() autorelease] withDoubleArray:parameters_];
    return [new_OrgApacheCommonsMathOptimizationFittingHarmonicFunction_initWithDouble_withDouble_withDouble_(IOSDoubleArray_Get(nil_chk(fitted), 0), IOSDoubleArray_Get(fitted, 1), IOSDoubleArray_Get(fitted, 2)) autorelease];
  }
  @catch (OrgApacheCommonsMathFunctionEvaluationException *fee) {
    @throw [new_JavaLangRuntimeException_initWithJavaLangThrowable_(fee) autorelease];
  }
}

- (void)dealloc {
  RELEASE_(fitter_);
  RELEASE_(parameters_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer:", "HarmonicFitter", NULL, 0x1, NULL, NULL },
    { "initWithOrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer:withDoubleArray:", "HarmonicFitter", NULL, 0x1, NULL, NULL },
    { "addObservedPointWithDouble:withDouble:withDouble:", "addObservedPoint", "V", 0x1, NULL, NULL },
    { "fit", NULL, "Lorg.apache.commons.math.optimization.fitting.HarmonicFunction;", 0x1, "Lorg.apache.commons.math.optimization.OptimizationException;", NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "fitter_", NULL, 0x12, "Lorg.apache.commons.math.optimization.fitting.CurveFitter;", NULL, NULL,  },
    { "parameters_", NULL, 0x2, "[D", NULL, NULL,  },
  };
  static const char *inner_classes[] = {"Lorg.apache.commons.math.optimization.fitting.HarmonicFitter$ParametricHarmonicFunction;"};
  static const J2ObjcClassInfo _OrgApacheCommonsMathOptimizationFittingHarmonicFitter = { 2, "HarmonicFitter", "org.apache.commons.math.optimization.fitting", NULL, 0x1, 4, methods, 2, fields, 0, NULL, 1, inner_classes, NULL, NULL };
  return &_OrgApacheCommonsMathOptimizationFittingHarmonicFitter;
}

@end

void OrgApacheCommonsMathOptimizationFittingHarmonicFitter_initWithOrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer_(OrgApacheCommonsMathOptimizationFittingHarmonicFitter *self, id<OrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer> optimizer) {
  NSObject_init(self);
  OrgApacheCommonsMathOptimizationFittingHarmonicFitter_setAndConsume_fitter_(self, new_OrgApacheCommonsMathOptimizationFittingCurveFitter_initWithOrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer_(optimizer));
  OrgApacheCommonsMathOptimizationFittingHarmonicFitter_set_parameters_(self, nil);
}

OrgApacheCommonsMathOptimizationFittingHarmonicFitter *new_OrgApacheCommonsMathOptimizationFittingHarmonicFitter_initWithOrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer_(id<OrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer> optimizer) {
  OrgApacheCommonsMathOptimizationFittingHarmonicFitter *self = [OrgApacheCommonsMathOptimizationFittingHarmonicFitter alloc];
  OrgApacheCommonsMathOptimizationFittingHarmonicFitter_initWithOrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer_(self, optimizer);
  return self;
}

void OrgApacheCommonsMathOptimizationFittingHarmonicFitter_initWithOrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer_withDoubleArray_(OrgApacheCommonsMathOptimizationFittingHarmonicFitter *self, id<OrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer> optimizer, IOSDoubleArray *initialGuess) {
  NSObject_init(self);
  OrgApacheCommonsMathOptimizationFittingHarmonicFitter_setAndConsume_fitter_(self, new_OrgApacheCommonsMathOptimizationFittingCurveFitter_initWithOrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer_(optimizer));
  OrgApacheCommonsMathOptimizationFittingHarmonicFitter_set_parameters_(self, [((IOSDoubleArray *) nil_chk(initialGuess)) clone]);
}

OrgApacheCommonsMathOptimizationFittingHarmonicFitter *new_OrgApacheCommonsMathOptimizationFittingHarmonicFitter_initWithOrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer_withDoubleArray_(id<OrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer> optimizer, IOSDoubleArray *initialGuess) {
  OrgApacheCommonsMathOptimizationFittingHarmonicFitter *self = [OrgApacheCommonsMathOptimizationFittingHarmonicFitter alloc];
  OrgApacheCommonsMathOptimizationFittingHarmonicFitter_initWithOrgApacheCommonsMathOptimizationDifferentiableMultivariateVectorialOptimizer_withDoubleArray_(self, optimizer, initialGuess);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheCommonsMathOptimizationFittingHarmonicFitter)

@implementation OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction

- (jdouble)valueWithDouble:(jdouble)x
           withDoubleArray:(IOSDoubleArray *)parameters {
  jdouble a = IOSDoubleArray_Get(nil_chk(parameters), 0);
  jdouble omega = IOSDoubleArray_Get(parameters, 1);
  jdouble phi = IOSDoubleArray_Get(parameters, 2);
  return a * OrgApacheCommonsMathUtilFastMath_cosWithDouble_(omega * x + phi);
}

- (IOSDoubleArray *)gradientWithDouble:(jdouble)x
                       withDoubleArray:(IOSDoubleArray *)parameters {
  jdouble a = IOSDoubleArray_Get(nil_chk(parameters), 0);
  jdouble omega = IOSDoubleArray_Get(parameters, 1);
  jdouble phi = IOSDoubleArray_Get(parameters, 2);
  jdouble alpha = omega * x + phi;
  jdouble cosAlpha = OrgApacheCommonsMathUtilFastMath_cosWithDouble_(alpha);
  jdouble sinAlpha = OrgApacheCommonsMathUtilFastMath_sinWithDouble_(alpha);
  return [IOSDoubleArray arrayWithDoubles:(jdouble[]){ cosAlpha, -a * x * sinAlpha, -a * sinAlpha } count:3];
}

- (instancetype)init {
  OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction_init(self);
  return self;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "valueWithDouble:withDoubleArray:", "value", "D", 0x1, NULL, NULL },
    { "gradientWithDouble:withDoubleArray:", "gradient", "[D", 0x1, NULL, NULL },
    { "init", NULL, NULL, 0x2, NULL, NULL },
  };
  static const J2ObjcClassInfo _OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction = { 2, "ParametricHarmonicFunction", "org.apache.commons.math.optimization.fitting", "HarmonicFitter", 0xa, 3, methods, 0, NULL, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction;
}

@end

void OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction_init(OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction *self) {
  NSObject_init(self);
}

OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction *new_OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction_init() {
  OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction *self = [OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction alloc];
  OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction_init(self);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheCommonsMathOptimizationFittingHarmonicFitter_ParametricHarmonicFunction)
