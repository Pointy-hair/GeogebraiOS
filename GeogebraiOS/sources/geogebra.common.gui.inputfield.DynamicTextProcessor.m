//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/geogebra_iOS/geogebra/geogebra/common/src/geogebra/common/gui/inputfield/DynamicTextProcessor.java
//


#include "J2ObjC_source.h"
#include "geogebra/common/gui/inputfield/DynamicTextElement.h"
#include "geogebra/common/gui/inputfield/DynamicTextProcessor.h"
#include "geogebra/common/kernel/StringTemplate.h"
#include "geogebra/common/kernel/algos/AlgoDependentText.h"
#include "geogebra/common/kernel/algos/AlgoElement.h"
#include "geogebra/common/kernel/arithmetic/ExpressionNode.h"
#include "geogebra/common/kernel/arithmetic/ExpressionValue.h"
#include "geogebra/common/kernel/arithmetic/MyStringBuffer.h"
#include "geogebra/common/kernel/geos/GeoElement.h"
#include "geogebra/common/kernel/geos/GeoText.h"
#include "geogebra/common/main/App.h"
#include "geogebra/common/main/Localization.h"
#include "geogebra/common/util/StringUtil.h"
#include "geogebra/common/util/Unicode.h"
#include "java/lang/StringBuilder.h"
#include "java/util/ArrayList.h"

@interface GeogebraCommonGuiInputfieldDynamicTextProcessor () {
 @public
  GeogebraCommonMainApp *app_;
  JavaUtilArrayList *dList_;
}

- (void)splitStringWithGeogebraCommonKernelArithmeticExpressionNode:(GeogebraCommonKernelArithmeticExpressionNode *)en
                                              withJavaUtilArrayList:(JavaUtilArrayList *)dList;

- (GeogebraCommonGuiInputfieldDynamicTextElement *)createDynamicTextElementWithNSString:(NSString *)text;

@end

J2OBJC_FIELD_SETTER(GeogebraCommonGuiInputfieldDynamicTextProcessor, app_, GeogebraCommonMainApp *)
J2OBJC_FIELD_SETTER(GeogebraCommonGuiInputfieldDynamicTextProcessor, dList_, JavaUtilArrayList *)

__attribute__((unused)) static void GeogebraCommonGuiInputfieldDynamicTextProcessor_splitStringWithGeogebraCommonKernelArithmeticExpressionNode_withJavaUtilArrayList_(GeogebraCommonGuiInputfieldDynamicTextProcessor *self, GeogebraCommonKernelArithmeticExpressionNode *en, JavaUtilArrayList *dList);

__attribute__((unused)) static GeogebraCommonGuiInputfieldDynamicTextElement *GeogebraCommonGuiInputfieldDynamicTextProcessor_createDynamicTextElementWithNSString_(GeogebraCommonGuiInputfieldDynamicTextProcessor *self, NSString *text);

@implementation GeogebraCommonGuiInputfieldDynamicTextProcessor

- (instancetype)initWithGeogebraCommonMainApp:(GeogebraCommonMainApp *)app {
  GeogebraCommonGuiInputfieldDynamicTextProcessor_initWithGeogebraCommonMainApp_(self, app);
  return self;
}

- (JavaUtilArrayList *)buildDynamicTextListWithGeogebraCommonKernelGeosGeoText:(GeogebraCommonKernelGeosGeoText *)geo {
  [((JavaUtilArrayList *) nil_chk(dList_)) clear];
  if (geo == nil) return dList_;
  if ([((GeogebraCommonKernelGeosGeoText *) nil_chk(geo)) isIndependent]) {
    [dList_ addWithId:[new_GeogebraCommonGuiInputfieldDynamicTextElement_initWithNSString_withGeogebraCommonGuiInputfieldDynamicTextElement_DynamicTextTypeEnum_([geo getTextString], GeogebraCommonGuiInputfieldDynamicTextElement_DynamicTextTypeEnum_get_STATIC()) autorelease]];
    return dList_;
  }
  GeogebraCommonKernelArithmeticExpressionNode *root = [((GeogebraCommonKernelAlgosAlgoDependentText *) nil_chk(((GeogebraCommonKernelAlgosAlgoDependentText *) check_class_cast([geo getParentAlgorithm], [GeogebraCommonKernelAlgosAlgoDependentText class])))) getRoot];
  GeogebraCommonGuiInputfieldDynamicTextProcessor_splitStringWithGeogebraCommonKernelArithmeticExpressionNode_withJavaUtilArrayList_(self, root, dList_);
  return dList_;
}

- (void)splitStringWithGeogebraCommonKernelArithmeticExpressionNode:(GeogebraCommonKernelArithmeticExpressionNode *)en
                                              withJavaUtilArrayList:(JavaUtilArrayList *)dList {
  GeogebraCommonGuiInputfieldDynamicTextProcessor_splitStringWithGeogebraCommonKernelArithmeticExpressionNode_withJavaUtilArrayList_(self, en, dList);
}

- (GeogebraCommonGuiInputfieldDynamicTextElement *)createDynamicTextElementWithNSString:(NSString *)text {
  return GeogebraCommonGuiInputfieldDynamicTextProcessor_createDynamicTextElementWithNSString_(self, text);
}

- (NSString *)buildGeoGebraStringWithJavaUtilArrayList:(JavaUtilArrayList *)list
                                           withBoolean:(jboolean)latex {
  if (list == nil || [list size] == 0) {
    return @"";
  }
  jchar currentQuote = GeogebraCommonUtilUnicode_OPEN_DOUBLE_QUOTE;
  JavaLangStringBuilder *sb = [new_JavaLangStringBuilder_init() autorelease];
  NSString *text;
  GeogebraCommonGuiInputfieldDynamicTextElement_DynamicTextTypeEnum *mode;
  for (jint i = 0; i < [((JavaUtilArrayList *) nil_chk(list)) size]; i++) {
    text = ((GeogebraCommonGuiInputfieldDynamicTextElement *) nil_chk([list getWithInt:i]))->text_;
    mode = ((GeogebraCommonGuiInputfieldDynamicTextElement *) nil_chk([list getWithInt:i]))->type_;
    if (mode == GeogebraCommonGuiInputfieldDynamicTextElement_DynamicTextTypeEnum_get_STATIC()) {
      for (jint k = 0; k < ((jint) [((NSString *) nil_chk(text)) length]); k++) {
        currentQuote = GeogebraCommonUtilStringUtil_processQuotesWithJavaLangStringBuilder_withNSString_withChar_(sb, [text substring:k endIndex:k + 1], currentQuote);
      }
    }
    else {
      if (mode == GeogebraCommonGuiInputfieldDynamicTextElement_DynamicTextTypeEnum_get_DEFINITION()) {
        [sb appendWithNSString:@"\"+"];
        [sb appendWithNSString:@"Name["];
        [sb appendWithNSString:text];
        [sb appendWithChar:']'];
        [sb appendWithNSString:@"+\""];
      }
      else if (latex || mode == GeogebraCommonGuiInputfieldDynamicTextElement_DynamicTextTypeEnum_get_FORMULA_TEXT()) {
        [sb appendWithNSString:@"\"+"];
        [sb appendWithNSString:@"LaTeX["];
        [sb appendWithNSString:text];
        [sb appendWithChar:']'];
        [sb appendWithNSString:@"+\""];
      }
      else if (mode == GeogebraCommonGuiInputfieldDynamicTextElement_DynamicTextTypeEnum_get_VALUE()) {
        [sb appendWithNSString:@"\"+("];
        [sb appendWithNSString:text];
        [sb appendWithNSString:@")+\""];
      }
    }
  }
  [sb insertWithInt:0 withChar:'"'];
  [sb appendWithChar:'"'];
  return [sb description];
}

- (void)dealloc {
  RELEASE_(app_);
  RELEASE_(dList_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithGeogebraCommonMainApp:", "DynamicTextProcessor", NULL, 0x1, NULL, NULL },
    { "buildDynamicTextListWithGeogebraCommonKernelGeosGeoText:", "buildDynamicTextList", "Ljava.util.ArrayList;", 0x1, NULL, NULL },
    { "splitStringWithGeogebraCommonKernelArithmeticExpressionNode:withJavaUtilArrayList:", "splitString", "V", 0x2, NULL, NULL },
    { "createDynamicTextElementWithNSString:", "createDynamicTextElement", "Lgeogebra.common.gui.inputfield.DynamicTextElement;", 0x2, NULL, NULL },
    { "buildGeoGebraStringWithJavaUtilArrayList:withBoolean:", "buildGeoGebraString", "Ljava.lang.String;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "app_", NULL, 0x2, "Lgeogebra.common.main.App;", NULL, NULL,  },
    { "dList_", NULL, 0x2, "Ljava.util.ArrayList;", NULL, "Ljava/util/ArrayList<Lgeogebra/common/gui/inputfield/DynamicTextElement;>;",  },
  };
  static const J2ObjcClassInfo _GeogebraCommonGuiInputfieldDynamicTextProcessor = { 2, "DynamicTextProcessor", "geogebra.common.gui.inputfield", NULL, 0x1, 5, methods, 2, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_GeogebraCommonGuiInputfieldDynamicTextProcessor;
}

@end

void GeogebraCommonGuiInputfieldDynamicTextProcessor_initWithGeogebraCommonMainApp_(GeogebraCommonGuiInputfieldDynamicTextProcessor *self, GeogebraCommonMainApp *app) {
  NSObject_init(self);
  GeogebraCommonGuiInputfieldDynamicTextProcessor_set_app_(self, app);
  GeogebraCommonGuiInputfieldDynamicTextProcessor_setAndConsume_dList_(self, new_JavaUtilArrayList_init());
}

GeogebraCommonGuiInputfieldDynamicTextProcessor *new_GeogebraCommonGuiInputfieldDynamicTextProcessor_initWithGeogebraCommonMainApp_(GeogebraCommonMainApp *app) {
  GeogebraCommonGuiInputfieldDynamicTextProcessor *self = [GeogebraCommonGuiInputfieldDynamicTextProcessor alloc];
  GeogebraCommonGuiInputfieldDynamicTextProcessor_initWithGeogebraCommonMainApp_(self, app);
  return self;
}

void GeogebraCommonGuiInputfieldDynamicTextProcessor_splitStringWithGeogebraCommonKernelArithmeticExpressionNode_withJavaUtilArrayList_(GeogebraCommonGuiInputfieldDynamicTextProcessor *self, GeogebraCommonKernelArithmeticExpressionNode *en, JavaUtilArrayList *dList) {
  id<GeogebraCommonKernelArithmeticExpressionValue> left = [((GeogebraCommonKernelArithmeticExpressionNode *) nil_chk(en)) getLeft];
  id<GeogebraCommonKernelArithmeticExpressionValue> right = [en getRight];
  GeogebraCommonKernelStringTemplate *tpl = GeogebraCommonKernelStringTemplate_get_defaultTemplate_();
  if ([en isLeaf]) {
    if ([((id<GeogebraCommonKernelArithmeticExpressionValue>) nil_chk(left)) isGeoElement]) {
      GeogebraCommonGuiInputfieldDynamicTextElement *d = GeogebraCommonGuiInputfieldDynamicTextProcessor_createDynamicTextElementWithNSString_(self, [((GeogebraCommonKernelGeosGeoElement *) check_class_cast(left, [GeogebraCommonKernelGeosGeoElement class])) getLabelWithGeogebraCommonKernelStringTemplate:tpl]);
      [((JavaUtilArrayList *) nil_chk(dList)) addWithId:d];
    }
    else if ([left isExpressionNode]) GeogebraCommonGuiInputfieldDynamicTextProcessor_splitStringWithGeogebraCommonKernelArithmeticExpressionNode_withJavaUtilArrayList_(self, (GeogebraCommonKernelArithmeticExpressionNode *) check_class_cast(left, [GeogebraCommonKernelArithmeticExpressionNode class]), dList);
    else if ([left isKindOfClass:[GeogebraCommonKernelArithmeticMyStringBuffer class]]) {
      GeogebraCommonGuiInputfieldDynamicTextElement *d = GeogebraCommonGuiInputfieldDynamicTextProcessor_createDynamicTextElementWithNSString_(self, [((NSString *) nil_chk([left toStringWithGeogebraCommonKernelStringTemplate:tpl])) replaceAll:@"\"" withReplacement:@""]);
      [((JavaUtilArrayList *) nil_chk(dList)) addWithId:d];
    }
    else {
      GeogebraCommonGuiInputfieldDynamicTextElement *d = GeogebraCommonGuiInputfieldDynamicTextProcessor_createDynamicTextElementWithNSString_(self, [left toStringWithGeogebraCommonKernelStringTemplate:tpl]);
      [((JavaUtilArrayList *) nil_chk(dList)) addWithId:d];
    }
  }
  else {
    if (right != nil && ![en containsMyStringBuffer]) {
      [((JavaUtilArrayList *) nil_chk(dList)) addWithId:GeogebraCommonGuiInputfieldDynamicTextProcessor_createDynamicTextElementWithNSString_(self, [en toStringWithGeogebraCommonKernelStringTemplate:tpl])];
      return;
    }
    if ([((id<GeogebraCommonKernelArithmeticExpressionValue>) nil_chk(left)) isGeoElement]) {
      [((JavaUtilArrayList *) nil_chk(dList)) addWithId:GeogebraCommonGuiInputfieldDynamicTextProcessor_createDynamicTextElementWithNSString_(self, [((GeogebraCommonKernelGeosGeoElement *) check_class_cast(left, [GeogebraCommonKernelGeosGeoElement class])) getLabelWithGeogebraCommonKernelStringTemplate:tpl])];
    }
    else if ([left isExpressionNode]) GeogebraCommonGuiInputfieldDynamicTextProcessor_splitStringWithGeogebraCommonKernelArithmeticExpressionNode_withJavaUtilArrayList_(self, (GeogebraCommonKernelArithmeticExpressionNode *) check_class_cast(left, [GeogebraCommonKernelArithmeticExpressionNode class]), dList);
    else if ([left isKindOfClass:[GeogebraCommonKernelArithmeticMyStringBuffer class]]) {
      [((JavaUtilArrayList *) nil_chk(dList)) addWithId:[new_GeogebraCommonGuiInputfieldDynamicTextElement_initWithNSString_withGeogebraCommonGuiInputfieldDynamicTextElement_DynamicTextTypeEnum_([((NSString *) nil_chk([left toStringWithGeogebraCommonKernelStringTemplate:tpl])) replaceAll:@"\"" withReplacement:@""], GeogebraCommonGuiInputfieldDynamicTextElement_DynamicTextTypeEnum_get_STATIC()) autorelease]];
    }
    else {
      [((JavaUtilArrayList *) nil_chk(dList)) addWithId:GeogebraCommonGuiInputfieldDynamicTextProcessor_createDynamicTextElementWithNSString_(self, [left toStringWithGeogebraCommonKernelStringTemplate:tpl])];
    }
    if (right != nil) {
      if ([right isGeoElement]) {
        [((JavaUtilArrayList *) nil_chk(dList)) addWithId:GeogebraCommonGuiInputfieldDynamicTextProcessor_createDynamicTextElementWithNSString_(self, [((GeogebraCommonKernelGeosGeoElement *) check_class_cast(right, [GeogebraCommonKernelGeosGeoElement class])) getLabelWithGeogebraCommonKernelStringTemplate:tpl])];
      }
      else if ([right isExpressionNode]) GeogebraCommonGuiInputfieldDynamicTextProcessor_splitStringWithGeogebraCommonKernelArithmeticExpressionNode_withJavaUtilArrayList_(self, (GeogebraCommonKernelArithmeticExpressionNode *) check_class_cast(right, [GeogebraCommonKernelArithmeticExpressionNode class]), dList);
      else if ([right isKindOfClass:[GeogebraCommonKernelArithmeticMyStringBuffer class]]) {
        [((JavaUtilArrayList *) nil_chk(dList)) addWithId:[new_GeogebraCommonGuiInputfieldDynamicTextElement_initWithNSString_withGeogebraCommonGuiInputfieldDynamicTextElement_DynamicTextTypeEnum_([((NSString *) nil_chk([right toStringWithGeogebraCommonKernelStringTemplate:tpl])) replaceAll:@"\"" withReplacement:@""], GeogebraCommonGuiInputfieldDynamicTextElement_DynamicTextTypeEnum_get_STATIC()) autorelease]];
      }
      else {
        [((JavaUtilArrayList *) nil_chk(dList)) addWithId:GeogebraCommonGuiInputfieldDynamicTextProcessor_createDynamicTextElementWithNSString_(self, [right toStringWithGeogebraCommonKernelStringTemplate:tpl])];
      }
    }
  }
}

GeogebraCommonGuiInputfieldDynamicTextElement *GeogebraCommonGuiInputfieldDynamicTextProcessor_createDynamicTextElementWithNSString_(GeogebraCommonGuiInputfieldDynamicTextProcessor *self, NSString *text) {
  NSString *contentString = text;
  GeogebraCommonGuiInputfieldDynamicTextElement_DynamicTextTypeEnum *type = GeogebraCommonGuiInputfieldDynamicTextElement_DynamicTextTypeEnum_get_VALUE();
  NSString *prefix;
  if ([((NSString *) nil_chk(contentString)) hasSuffix:@"]"]) {
    if ([contentString hasPrefix:prefix = JreStrcat("$C", [((GeogebraCommonMainLocalization *) nil_chk([((GeogebraCommonMainApp *) nil_chk(self->app_)) getLocalization])) getCommandWithNSString:@"LaTeX"], '[')]) {
      contentString = [contentString substring:((jint) [prefix length]) endIndex:((jint) [contentString length]) - 1];
      jint commaIndex = [((NSString *) nil_chk(contentString)) lastIndexOf:','];
      jint bracketCount = 0;
      for (jint i = commaIndex + 1; i < ((jint) [contentString length]); i++) {
        if ([contentString charAtWithInt:i] == '[') bracketCount++;
        else if ([contentString charAtWithInt:i] == ']') bracketCount--;
      }
      if (bracketCount != 0 || commaIndex == -1) {
        type = GeogebraCommonGuiInputfieldDynamicTextElement_DynamicTextTypeEnum_get_FORMULA_TEXT();
      }
    }
    else if ([contentString hasPrefix:prefix = JreStrcat("$C", [((GeogebraCommonMainLocalization *) nil_chk([self->app_ getLocalization])) getCommandWithNSString:@"Name"], '[')]) {
      contentString = [contentString substring:((jint) [prefix length]) endIndex:((jint) [contentString length]) - 1];
      type = GeogebraCommonGuiInputfieldDynamicTextElement_DynamicTextTypeEnum_get_DEFINITION();
    }
  }
  return [new_GeogebraCommonGuiInputfieldDynamicTextElement_initWithNSString_withGeogebraCommonGuiInputfieldDynamicTextElement_DynamicTextTypeEnum_(contentString, type) autorelease];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(GeogebraCommonGuiInputfieldDynamicTextProcessor)
