//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/geogebra_iOS/geogebra/geogebra/common/src/geogebra/common/kernel/implicit/AlgoIntersectImplicitpolys.java
//


#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "geogebra/common/euclidian/EuclidianConstants.h"
#include "geogebra/common/kernel/Construction.h"
#include "geogebra/common/kernel/EquationSolverInterface.h"
#include "geogebra/common/kernel/Kernel.h"
#include "geogebra/common/kernel/algos/AlgoElement.h"
#include "geogebra/common/kernel/algos/AlgoSimpleRootsPolynomial.h"
#include "geogebra/common/kernel/commands/Commands.h"
#include "geogebra/common/kernel/geos/GeoConic.h"
#include "geogebra/common/kernel/geos/GeoElement.h"
#include "geogebra/common/kernel/geos/GeoPoint.h"
#include "geogebra/common/kernel/implicit/AlgoIntersectImplicitpolys.h"
#include "geogebra/common/kernel/implicit/GeoImplicitPoly.h"
#include "geogebra/common/kernel/implicit/PolynomialUtils.h"
#include "geogebra/common/kernel/polynomial/BigPolynomial.h"
#include "geogebra/common/util/debug/Log.h"
#include "java/lang/Math.h"
#include "java/util/ArrayList.h"
#include "java/util/Arrays.h"
#include "java/util/LinkedList.h"
#include "java/util/List.h"
#include "java/util/ListIterator.h"
#include "org/apache/commons/math/analysis/polynomials/PolynomialFunction.h"

#define GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_PolyX 0
#define GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_PolyY 1

@interface GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys () {
 @public
  GeogebraCommonKernelImplicitGeoImplicitPoly *p1_;
  GeogebraCommonKernelImplicitGeoImplicitPoly *p2_;
  GeogebraCommonKernelGeosGeoConic *c1_;
  id<JavaUtilList> valPairs_;
  jint univarType_;
  id<JavaUtilList> hints_;
}

+ (jint)getNearRootsWithDoubleArray:(IOSDoubleArray *)roots
withGeogebraCommonKernelEquationSolverInterface:(id<GeogebraCommonKernelEquationSolverInterface>)solver
                         withDouble:(jdouble)epsilon;

- (void)insertWithDoubleArray:(IOSDoubleArray *)pair;

@end

J2OBJC_FIELD_SETTER(GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys, p1_, GeogebraCommonKernelImplicitGeoImplicitPoly *)
J2OBJC_FIELD_SETTER(GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys, p2_, GeogebraCommonKernelImplicitGeoImplicitPoly *)
J2OBJC_FIELD_SETTER(GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys, c1_, GeogebraCommonKernelGeosGeoConic *)
J2OBJC_FIELD_SETTER(GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys, valPairs_, id<JavaUtilList>)
J2OBJC_FIELD_SETTER(GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys, hints_, id<JavaUtilList>)

J2OBJC_STATIC_FIELD_GETTER(GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys, PolyX, jint)

J2OBJC_STATIC_FIELD_GETTER(GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys, PolyY, jint)

__attribute__((unused)) static jint GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_getNearRootsWithDoubleArray_withGeogebraCommonKernelEquationSolverInterface_withDouble_(IOSDoubleArray *roots, id<GeogebraCommonKernelEquationSolverInterface> solver, jdouble epsilon);

__attribute__((unused)) static void GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_insertWithDoubleArray_(GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys *self, IOSDoubleArray *pair);

@implementation GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys

- (instancetype)initWithGeogebraCommonKernelConstruction:(GeogebraCommonKernelConstruction *)c
         withGeogebraCommonKernelImplicitGeoImplicitPoly:(GeogebraCommonKernelImplicitGeoImplicitPoly *)p1
                    withGeogebraCommonKernelGeosGeoConic:(GeogebraCommonKernelGeosGeoConic *)c1 {
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelGeosGeoConic_(self, c, p1, c1);
  return self;
}

- (instancetype)initWithGeogebraCommonKernelConstruction:(GeogebraCommonKernelConstruction *)c
                                       withNSStringArray:(IOSObjectArray *)labels
                                             withBoolean:(jboolean)setLabels
         withGeogebraCommonKernelImplicitGeoImplicitPoly:(GeogebraCommonKernelImplicitGeoImplicitPoly *)p1
                    withGeogebraCommonKernelGeosGeoConic:(GeogebraCommonKernelGeosGeoConic *)c1 {
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withNSStringArray_withBoolean_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelGeosGeoConic_(self, c, labels, setLabels, p1, c1);
  return self;
}

- (instancetype)initWithGeogebraCommonKernelConstruction:(GeogebraCommonKernelConstruction *)c
         withGeogebraCommonKernelImplicitGeoImplicitPoly:(GeogebraCommonKernelImplicitGeoImplicitPoly *)p1
         withGeogebraCommonKernelImplicitGeoImplicitPoly:(GeogebraCommonKernelImplicitGeoImplicitPoly *)p2 {
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelImplicitGeoImplicitPoly_(self, c, p1, p2);
  return self;
}

- (instancetype)initWithGeogebraCommonKernelConstruction:(GeogebraCommonKernelConstruction *)c
                                       withNSStringArray:(IOSObjectArray *)labels
                                             withBoolean:(jboolean)setLabels
         withGeogebraCommonKernelImplicitGeoImplicitPoly:(GeogebraCommonKernelImplicitGeoImplicitPoly *)p1
         withGeogebraCommonKernelImplicitGeoImplicitPoly:(GeogebraCommonKernelImplicitGeoImplicitPoly *)p2 {
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withNSStringArray_withBoolean_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelImplicitGeoImplicitPoly_(self, c, labels, setLabels, p1, p2);
  return self;
}

- (jdouble)getYValueWithDouble:(jdouble)t {
  return 0;
}

- (void)computeWithHigherPrecision {
  if (c1_ != nil) {
    GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_setAndConsume_p2_(self, new_GeogebraCommonKernelImplicitGeoImplicitPoly_initWithGeogebraCommonKernelKernelNDGeoConicND_(c1_));
  }
  if (valPairs_ == nil) {
    GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_setAndConsume_valPairs_(self, new_JavaUtilLinkedList_init());
  }
  else {
    [valPairs_ clear];
  }
  GeogebraCommonKernelImplicitGeoImplicitPoly *a = p1_, *b = p2_;
  if ([((GeogebraCommonKernelImplicitGeoImplicitPoly *) nil_chk(p1_)) getDegX] < [((GeogebraCommonKernelImplicitGeoImplicitPoly *) nil_chk(p2_)) getDegX]) {
    a = p2_;
    b = p1_;
  }
  jint m = [((GeogebraCommonKernelImplicitGeoImplicitPoly *) nil_chk(a)) getDegX];
  jint n = [((GeogebraCommonKernelImplicitGeoImplicitPoly *) nil_chk(b)) getDegX];
  jint precision = 50;
  IOSObjectArray *mat = [IOSObjectArray arrayWithDimensions:2 lengths:(jint[]){ n, n } type:GeogebraCommonKernelPolynomialBigPolynomial_class_()];
  IOSObjectArray *aNew = [IOSObjectArray arrayWithLength:m + n type:GeogebraCommonKernelPolynomialBigPolynomial_class_()];
  IOSObjectArray *bPolys = [IOSObjectArray arrayWithLength:n + 1 type:GeogebraCommonKernelPolynomialBigPolynomial_class_()];
  for (jint i = 0; i <= n; ++i) IOSObjectArray_SetAndConsume(bPolys, i, new_GeogebraCommonKernelPolynomialBigPolynomial_initWithDoubleArray_withInt_(IOSObjectArray_Get(nil_chk([b getCoeff]), i), precision));
  for (jint i = 0; i < n - 1; ++i) IOSObjectArray_SetAndConsume(aNew, i, new_GeogebraCommonKernelPolynomialBigPolynomial_initWithDouble_withInt_(0, precision));
  for (jint i = n - 1; i < n + m; ++i) IOSObjectArray_SetAndConsume(aNew, i, new_GeogebraCommonKernelPolynomialBigPolynomial_initWithDoubleArray_withInt_(IOSObjectArray_Get(nil_chk([a getCoeff]), i - n + 1), precision));
  jint leadIndex = n + m - 1;
  while (leadIndex >= 2 * n) {
    if (!([((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(IOSObjectArray_Get(aNew, leadIndex))) degree] == 0 && GeogebraCommonKernelKernel_isZeroWithDouble_([((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(IOSObjectArray_Get(aNew, leadIndex))) getCoeffDoubleWithInt:0]))) {
      for (jint j = n - 1; j < leadIndex - n; ++j) IOSObjectArray_Set(aNew, j, [((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(IOSObjectArray_Get(aNew, j))) multiplyWithGeogebraCommonKernelPolynomialBigPolynomial:IOSObjectArray_Get(bPolys, n)]);
      for (jint j = leadIndex - n; j < leadIndex; ++j) IOSObjectArray_Set(aNew, j, [((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk([((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(IOSObjectArray_Get(aNew, j))) multiplyWithGeogebraCommonKernelPolynomialBigPolynomial:IOSObjectArray_Get(bPolys, n)])) subtractWithGeogebraCommonKernelPolynomialBigPolynomial:[((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(IOSObjectArray_Get(bPolys, j - leadIndex + n))) multiplyWithGeogebraCommonKernelPolynomialBigPolynomial:IOSObjectArray_Get(aNew, leadIndex)]]);
    }
    --leadIndex;
  }
  while (leadIndex >= n) {
    if (!([((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(IOSObjectArray_Get(aNew, leadIndex))) degree] == 0 && GeogebraCommonKernelKernel_isZeroWithDouble_([((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(IOSObjectArray_Get(aNew, leadIndex))) getCoeffDoubleWithInt:0]))) {
      for (jint j = leadIndex - n; j < leadIndex; ++j) IOSObjectArray_Set(aNew, j, [((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk([((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(IOSObjectArray_Get(aNew, j))) multiplyWithGeogebraCommonKernelPolynomialBigPolynomial:IOSObjectArray_Get(bPolys, n)])) subtractWithGeogebraCommonKernelPolynomialBigPolynomial:[((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(IOSObjectArray_Get(bPolys, j - leadIndex + n))) multiplyWithGeogebraCommonKernelPolynomialBigPolynomial:IOSObjectArray_Get(aNew, leadIndex)]]);
    }
    for (jint j = 0; j < n; ++j) IOSObjectArray_Set(nil_chk(IOSObjectArray_Get(mat, 2 * n - 1 - leadIndex)), j, [((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(IOSObjectArray_Get(aNew, leadIndex - n + j))) copy__]);
    --leadIndex;
  }
  GeogebraCommonKernelPolynomialBigPolynomial *c = [new_GeogebraCommonKernelPolynomialBigPolynomial_initWithDouble_withInt_(1, precision) autorelease];
  GeogebraCommonKernelPolynomialBigPolynomial *det = nil;
  for (jint k = 0; k < n - 1; k++) {
    jint r = 0;
    jdouble glc = -1;
    for (jint i = k; i < n; i++) {
      jdouble lc = [((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, i)), k))) getCoeffDoubleWithInt:[((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, i)), k))) degree]];
      if (![((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, i)), k))) isZeroPolynomial]) {
        if (JavaLangMath_absWithDouble_(lc) > glc) {
          glc = JavaLangMath_absWithDouble_(lc);
          r = i;
        }
      }
    }
    if (glc <= -1) {
      det = [new_GeogebraCommonKernelPolynomialBigPolynomial_initWithDouble_withInt_(0, precision) autorelease];
      break;
    }
    else if (r > k) {
      for (jint j = k; j < n; j++) {
        GeogebraCommonKernelPolynomialBigPolynomial *temp = IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, r)), j);
        IOSObjectArray_Set(nil_chk(IOSObjectArray_Get(mat, r)), j, IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, k)), j));
        IOSObjectArray_Set(nil_chk(IOSObjectArray_Get(mat, k)), j, temp);
      }
    }
    for (jint i = k + 1; i < n; i++) {
      for (jint j = k + 1; j < n; j++) {
        GeogebraCommonKernelPolynomialBigPolynomial *t1 = [((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, i)), j))) multiplyWithGeogebraCommonKernelPolynomialBigPolynomial:IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, k)), k)];
        GeogebraCommonKernelPolynomialBigPolynomial *t2 = [((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, i)), k))) multiplyWithGeogebraCommonKernelPolynomialBigPolynomial:IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, k)), j)];
        GeogebraCommonKernelPolynomialBigPolynomial *t = [((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(t1)) subtractWithGeogebraCommonKernelPolynomialBigPolynomial:t2];
        IOSObjectArray_Set(nil_chk(IOSObjectArray_Get(mat, i)), j, [((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(t)) divideWithGeogebraCommonKernelPolynomialBigPolynomial:c]);
      }
    }
    c = IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, k)), k);
  }
  if (det == nil) det = IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, n - 1)), n - 1);
  univarType_ = GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_PolyY;
  IOSDoubleArray *roots = [((GeogebraCommonKernelPolynomialBigPolynomial *) nil_chk(det)) getRealRootsDoubleWithInt:precision];
  jint nrRealRoots = ((IOSDoubleArray *) nil_chk(roots))->size_;
  if (nrRealRoots == 0) {
    GeogebraCommonUtilDebugLog_debugWithId_(det);
  }
  IOSObjectArray *coeff;
  IOSDoubleArray *newCoeff;
  if (univarType_ == GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_PolyX) {
    if ([p1_ getDegY] < [p2_ getDegY]) {
      coeff = [p1_ getCoeff];
      newCoeff = [IOSDoubleArray arrayWithLength:[p1_ getDegY] + 1];
    }
    else {
      coeff = [p2_ getCoeff];
      newCoeff = [IOSDoubleArray arrayWithLength:[p2_ getDegY] + 1];
    }
  }
  else {
    if ([p1_ getDegX] < [p2_ getDegX]) {
      coeff = [p1_ getCoeff];
      newCoeff = [IOSDoubleArray arrayWithLength:[p1_ getDegX] + 1];
    }
    else {
      coeff = [p2_ getCoeff];
      newCoeff = [IOSDoubleArray arrayWithLength:[p2_ getDegX] + 1];
    }
  }
  for (jint k = 0; k < nrRealRoots; k++) {
    jdouble t = IOSDoubleArray_Get(roots, k);
    if (univarType_ == GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_PolyX) {
      for (jint j = 0; j < ((IOSDoubleArray *) nil_chk(newCoeff))->size_; j++) {
        *IOSDoubleArray_GetRef(newCoeff, j) = 0;
      }
      for (jint i = ((IOSObjectArray *) nil_chk(coeff))->size_ - 1; i >= 0; i--) {
        for (jint j = 0; j < ((IOSDoubleArray *) nil_chk(IOSObjectArray_Get(coeff, i)))->size_; j++) {
          *IOSDoubleArray_GetRef(newCoeff, j) = IOSDoubleArray_Get(newCoeff, j) * t + IOSDoubleArray_Get(nil_chk(IOSObjectArray_Get(coeff, i)), j);
        }
        for (jint j = ((IOSDoubleArray *) nil_chk(IOSObjectArray_Get(coeff, i)))->size_; j < newCoeff->size_; j++) {
          *IOSDoubleArray_GetRef(newCoeff, j) = IOSDoubleArray_Get(newCoeff, j) * t;
        }
      }
    }
    else {
      for (jint i = 0; i < ((IOSObjectArray *) nil_chk(coeff))->size_; i++) {
        *IOSDoubleArray_GetRef(nil_chk(newCoeff), i) = 0;
        for (jint j = ((IOSDoubleArray *) nil_chk(IOSObjectArray_Get(coeff, i)))->size_ - 1; j >= 0; j--) {
          *IOSDoubleArray_GetRef(newCoeff, i) = IOSDoubleArray_Get(newCoeff, i) * t + IOSDoubleArray_Get(nil_chk(IOSObjectArray_Get(coeff, i)), j);
        }
      }
    }
    jint nr = GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_getNearRootsWithDoubleArray_withGeogebraCommonKernelEquationSolverInterface_withDouble_(newCoeff, eqnSolver_, 1E-1);
    for (jint i = 0; i < nr; i++) {
      IOSDoubleArray *pair = [IOSDoubleArray arrayWithLength:2];
      if (univarType_ == GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_PolyX) {
        *IOSDoubleArray_GetRef(pair, 0) = t;
        *IOSDoubleArray_GetRef(pair, 1) = IOSDoubleArray_Get(nil_chk(newCoeff), i);
      }
      else {
        *IOSDoubleArray_GetRef(pair, 0) = IOSDoubleArray_Get(nil_chk(newCoeff), i);
        *IOSDoubleArray_GetRef(pair, 1) = t;
      }
      if (GeogebraCommonKernelImplicitPolynomialUtils_rootPolishingWithDoubleArray_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelImplicitGeoImplicitPoly_(pair, p1_, p2_)) GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_insertWithDoubleArray_(self, pair);
      else {
      }
    }
  }
  if (hints_ != nil) {
    for (jint i = 0; i < [hints_ size]; i++) {
      IOSDoubleArray *pair = [IOSDoubleArray arrayWithLength:2];
      GeogebraCommonKernelGeosGeoPoint *g = [hints_ getWithInt:i];
      if ([((GeogebraCommonKernelGeosGeoPoint *) nil_chk(g)) isDefined] && !GeogebraCommonKernelKernel_isZeroWithDouble_([g getZ])) {
        *IOSDoubleArray_GetRef(pair, 0) = [g getX] / [g getZ];
        *IOSDoubleArray_GetRef(pair, 1) = [g getY] / [g getZ];
      }
    }
  }
  [self setPointsWithJavaUtilList:valPairs_];
}

- (void)compute {
  if (c1_ != nil) {
    GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_setAndConsume_p2_(self, new_GeogebraCommonKernelImplicitGeoImplicitPoly_initWithGeogebraCommonKernelKernelNDGeoConicND_(c1_));
  }
  if (valPairs_ == nil) {
    GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_setAndConsume_valPairs_(self, new_JavaUtilLinkedList_init());
  }
  else {
    [valPairs_ clear];
  }
  GeogebraCommonKernelImplicitGeoImplicitPoly *a = p1_, *b = p2_;
  if ([((GeogebraCommonKernelImplicitGeoImplicitPoly *) nil_chk(p1_)) getDegX] < [((GeogebraCommonKernelImplicitGeoImplicitPoly *) nil_chk(p2_)) getDegX]) {
    a = p2_;
    b = p1_;
  }
  jint m = [((GeogebraCommonKernelImplicitGeoImplicitPoly *) nil_chk(a)) getDegX];
  jint n = [((GeogebraCommonKernelImplicitGeoImplicitPoly *) nil_chk(b)) getDegX];
  IOSObjectArray *mat = [IOSObjectArray arrayWithDimensions:2 lengths:(jint[]){ n, n } type:OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction_class_()];
  IOSObjectArray *aNew = [IOSObjectArray arrayWithLength:m + n type:OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction_class_()];
  IOSObjectArray *bPolys = [IOSObjectArray arrayWithLength:n + 1 type:OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction_class_()];
  for (jint i = 0; i <= n; ++i) IOSObjectArray_SetAndConsume(bPolys, i, new_OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction_initWithDoubleArray_(IOSObjectArray_Get(nil_chk([b getCoeff]), i)));
  for (jint i = 0; i < n - 1; ++i) IOSObjectArray_SetAndConsume(aNew, i, new_OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction_initWithDoubleArray_([IOSDoubleArray arrayWithDoubles:(jdouble[]){ 0 } count:1]));
  for (jint i = n - 1; i < n + m; ++i) IOSObjectArray_SetAndConsume(aNew, i, new_OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction_initWithDoubleArray_(IOSObjectArray_Get(nil_chk([a getCoeff]), i - n + 1)));
  jint leadIndex = n + m - 1;
  while (leadIndex >= 2 * n) {
    if (!([((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(IOSObjectArray_Get(aNew, leadIndex))) degree] == 0 && IOSDoubleArray_Get(nil_chk([((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(IOSObjectArray_Get(aNew, leadIndex))) getCoefficients]), 0) == 0)) {
      for (jint j = n - 1; j < leadIndex - n; ++j) IOSObjectArray_Set(aNew, j, [((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(IOSObjectArray_Get(aNew, j))) multiplyWithOrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction:IOSObjectArray_Get(bPolys, n)]);
      for (jint j = leadIndex - n; j < leadIndex; ++j) IOSObjectArray_Set(aNew, j, [((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk([((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(IOSObjectArray_Get(aNew, j))) multiplyWithOrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction:IOSObjectArray_Get(bPolys, n)])) subtractWithOrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction:[((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(IOSObjectArray_Get(bPolys, j - leadIndex + n))) multiplyWithOrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction:IOSObjectArray_Get(aNew, leadIndex)]]);
    }
    --leadIndex;
  }
  while (leadIndex >= n) {
    if (!([((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(IOSObjectArray_Get(aNew, leadIndex))) degree] == 0 && IOSDoubleArray_Get(nil_chk([((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(IOSObjectArray_Get(aNew, leadIndex))) getCoefficients]), 0) == 0)) {
      for (jint j = leadIndex - n; j < leadIndex; ++j) IOSObjectArray_Set(aNew, j, [((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk([((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(IOSObjectArray_Get(aNew, j))) multiplyWithOrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction:IOSObjectArray_Get(bPolys, n)])) subtractWithOrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction:[((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(IOSObjectArray_Get(bPolys, j - leadIndex + n))) multiplyWithOrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction:IOSObjectArray_Get(aNew, leadIndex)]]);
    }
    for (jint j = 0; j < n; ++j) IOSObjectArray_SetAndConsume(nil_chk(IOSObjectArray_Get(mat, 2 * n - 1 - leadIndex)), j, new_OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction_initWithDoubleArray_([((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(IOSObjectArray_Get(aNew, leadIndex - n + j))) getCoefficients]));
    --leadIndex;
  }
  for (jint i = 0; i < n; ++i) {
    jdouble largestCoeff = 0;
    jdouble reduceFactor = 1;
    for (jint j = 0; j < n; ++j) {
      for (jint k = 0; k < ((IOSDoubleArray *) nil_chk([((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, i)), j))) getCoefficients]))->size_; ++k) {
        largestCoeff = JavaLangMath_maxWithDouble_withDouble_(JavaLangMath_absWithDouble_(IOSDoubleArray_Get(nil_chk([((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, i)), j))) getCoefficients]), k)), largestCoeff);
      }
    }
    while (largestCoeff > 10) {
      reduceFactor *= 0.1;
      largestCoeff *= 0.1;
    }
    if (reduceFactor != 1) {
      for (jint j = 0; j < n; ++j) {
        IOSObjectArray_Set(nil_chk(IOSObjectArray_Get(mat, i)), j, [((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, i)), j))) multiplyWithOrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction:[new_OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction_initWithDoubleArray_([IOSDoubleArray arrayWithDoubles:(jdouble[]){ reduceFactor } count:1]) autorelease]]);
      }
    }
  }
  OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *c = [new_OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction_initWithDoubleArray_([IOSDoubleArray arrayWithDoubles:(jdouble[]){ 1 } count:1]) autorelease];
  OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *det = nil;
  for (jint k = 0; k < n - 1; k++) {
    jint r = 0;
    jdouble glc = 0;
    for (jint i = k; i < n; i++) {
      jdouble lc = GeogebraCommonKernelImplicitPolynomialUtils_getLeadingCoeffWithOrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction_(IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, i)), k));
      if (!GeogebraCommonKernelKernel_isZeroWithDouble_(lc)) {
        if (JavaLangMath_absWithDouble_(lc) > JavaLangMath_absWithDouble_(glc)) {
          glc = lc;
          r = i;
        }
      }
    }
    if (GeogebraCommonKernelKernel_isZeroWithDouble_(glc)) {
      det = [new_OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction_initWithDoubleArray_([IOSDoubleArray arrayWithDoubles:(jdouble[]){ 0 } count:1]) autorelease];
      break;
    }
    else if (r > k) {
      for (jint j = k; j < n; j++) {
        OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *temp = IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, r)), j);
        IOSObjectArray_Set(nil_chk(IOSObjectArray_Get(mat, r)), j, IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, k)), j));
        IOSObjectArray_Set(nil_chk(IOSObjectArray_Get(mat, k)), j, temp);
      }
    }
    for (jint i = k + 1; i < n; i++) {
      for (jint j = k + 1; j < n; j++) {
        OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *t1 = [((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, i)), j))) multiplyWithOrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction:IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, k)), k)];
        OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *t2 = [((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, i)), k))) multiplyWithOrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction:IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, k)), j)];
        OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *t = [((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(t1)) subtractWithOrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction:t2];
        IOSObjectArray_Set(nil_chk(IOSObjectArray_Get(mat, i)), j, GeogebraCommonKernelImplicitPolynomialUtils_polynomialDivisionWithOrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction_withOrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction_(t, c));
      }
    }
    c = IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, k)), k);
  }
  if (det == nil) det = IOSObjectArray_Get(nil_chk(IOSObjectArray_Get(mat, n - 1)), n - 1);
  univarType_ = GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_PolyY;
  IOSDoubleArray *roots = [((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(det)) getCoefficients];
  jint nrRealRoots = 0;
  if (((IOSDoubleArray *) nil_chk(roots))->size_ > 1) nrRealRoots = GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_getNearRootsWithDoubleArray_withGeogebraCommonKernelEquationSolverInterface_withDouble_(roots, eqnSolver_, 1E-1);
  IOSObjectArray *coeff;
  IOSDoubleArray *newCoeff;
  if (univarType_ == GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_PolyX) {
    if ([p1_ getDegY] < [p2_ getDegY]) {
      coeff = [p1_ getCoeff];
      newCoeff = [IOSDoubleArray arrayWithLength:[p1_ getDegY] + 1];
    }
    else {
      coeff = [p2_ getCoeff];
      newCoeff = [IOSDoubleArray arrayWithLength:[p2_ getDegY] + 1];
    }
  }
  else {
    if ([p1_ getDegX] < [p2_ getDegX]) {
      coeff = [p1_ getCoeff];
      newCoeff = [IOSDoubleArray arrayWithLength:[p1_ getDegX] + 1];
    }
    else {
      coeff = [p2_ getCoeff];
      newCoeff = [IOSDoubleArray arrayWithLength:[p2_ getDegX] + 1];
    }
  }
  for (jint k = 0; k < nrRealRoots; k++) {
    jdouble t = IOSDoubleArray_Get(roots, k);
    if (univarType_ == GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_PolyX) {
      for (jint j = 0; j < ((IOSDoubleArray *) nil_chk(newCoeff))->size_; j++) {
        *IOSDoubleArray_GetRef(newCoeff, j) = 0;
      }
      for (jint i = ((IOSObjectArray *) nil_chk(coeff))->size_ - 1; i >= 0; i--) {
        for (jint j = 0; j < ((IOSDoubleArray *) nil_chk(IOSObjectArray_Get(coeff, i)))->size_; j++) {
          *IOSDoubleArray_GetRef(newCoeff, j) = IOSDoubleArray_Get(newCoeff, j) * t + IOSDoubleArray_Get(nil_chk(IOSObjectArray_Get(coeff, i)), j);
        }
        for (jint j = ((IOSDoubleArray *) nil_chk(IOSObjectArray_Get(coeff, i)))->size_; j < newCoeff->size_; j++) {
          *IOSDoubleArray_GetRef(newCoeff, j) = IOSDoubleArray_Get(newCoeff, j) * t;
        }
      }
    }
    else {
      for (jint i = 0; i < ((IOSObjectArray *) nil_chk(coeff))->size_; i++) {
        *IOSDoubleArray_GetRef(nil_chk(newCoeff), i) = 0;
        for (jint j = ((IOSDoubleArray *) nil_chk(IOSObjectArray_Get(coeff, i)))->size_ - 1; j >= 0; j--) {
          *IOSDoubleArray_GetRef(newCoeff, i) = IOSDoubleArray_Get(newCoeff, i) * t + IOSDoubleArray_Get(nil_chk(IOSObjectArray_Get(coeff, i)), j);
        }
      }
    }
    jint nr = GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_getNearRootsWithDoubleArray_withGeogebraCommonKernelEquationSolverInterface_withDouble_(newCoeff, eqnSolver_, 1E-1);
    for (jint i = 0; i < nr; i++) {
      IOSDoubleArray *pair = [IOSDoubleArray arrayWithLength:2];
      if (univarType_ == GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_PolyX) {
        *IOSDoubleArray_GetRef(pair, 0) = t;
        *IOSDoubleArray_GetRef(pair, 1) = IOSDoubleArray_Get(nil_chk(newCoeff), i);
      }
      else {
        *IOSDoubleArray_GetRef(pair, 0) = IOSDoubleArray_Get(nil_chk(newCoeff), i);
        *IOSDoubleArray_GetRef(pair, 1) = t;
      }
      if (GeogebraCommonKernelImplicitPolynomialUtils_rootPolishingWithDoubleArray_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelImplicitGeoImplicitPoly_(pair, p1_, p2_)) GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_insertWithDoubleArray_(self, pair);
    }
  }
  if (hints_ != nil) {
    for (jint i = 0; i < [hints_ size]; i++) {
      IOSDoubleArray *pair = [IOSDoubleArray arrayWithLength:2];
      GeogebraCommonKernelGeosGeoPoint *g = [hints_ getWithInt:i];
      if ([((GeogebraCommonKernelGeosGeoPoint *) nil_chk(g)) isDefined] && !GeogebraCommonKernelKernel_isZeroWithDouble_([g getZ])) {
        *IOSDoubleArray_GetRef(pair, 0) = [g getX] / [g getZ];
        *IOSDoubleArray_GetRef(pair, 1) = [g getY] / [g getZ];
      }
    }
  }
  [self setPointsWithJavaUtilList:valPairs_];
}

+ (jint)getNearRootsWithDoubleArray:(IOSDoubleArray *)roots
withGeogebraCommonKernelEquationSolverInterface:(id<GeogebraCommonKernelEquationSolverInterface>)solver
                         withDouble:(jdouble)epsilon {
  return GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_getNearRootsWithDoubleArray_withGeogebraCommonKernelEquationSolverInterface_withDouble_(roots, solver, epsilon);
}

- (void)insertWithDoubleArray:(IOSDoubleArray *)pair {
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_insertWithDoubleArray_(self, pair);
}

- (GeogebraCommonKernelCommandsCommandsEnum *)getClassName {
  return GeogebraCommonKernelCommandsCommandsEnum_get_Intersect();
}

- (jint)getRelatedModeID {
  return GeogebraCommonEuclidianEuclidianConstants_MODE_INTERSECT;
}

- (void)addSolutionHintWithGeogebraCommonKernelGeosGeoPoint:(GeogebraCommonKernelGeosGeoPoint *)point {
  if (hints_ == nil) {
    GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_setAndConsume_hints_(self, new_JavaUtilArrayList_init());
  }
  [((id<JavaUtilList>) nil_chk(hints_)) addWithId:point];
}

- (void)dealloc {
  RELEASE_(p1_);
  RELEASE_(p2_);
  RELEASE_(c1_);
  RELEASE_(valPairs_);
  RELEASE_(hints_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithGeogebraCommonKernelConstruction:withGeogebraCommonKernelImplicitGeoImplicitPoly:withGeogebraCommonKernelGeosGeoConic:", "AlgoIntersectImplicitpolys", NULL, 0x1, NULL, NULL },
    { "initWithGeogebraCommonKernelConstruction:withNSStringArray:withBoolean:withGeogebraCommonKernelImplicitGeoImplicitPoly:withGeogebraCommonKernelGeosGeoConic:", "AlgoIntersectImplicitpolys", NULL, 0x1, NULL, NULL },
    { "initWithGeogebraCommonKernelConstruction:withGeogebraCommonKernelImplicitGeoImplicitPoly:withGeogebraCommonKernelImplicitGeoImplicitPoly:", "AlgoIntersectImplicitpolys", NULL, 0x1, NULL, NULL },
    { "initWithGeogebraCommonKernelConstruction:withNSStringArray:withBoolean:withGeogebraCommonKernelImplicitGeoImplicitPoly:withGeogebraCommonKernelImplicitGeoImplicitPoly:", "AlgoIntersectImplicitpolys", NULL, 0x1, NULL, NULL },
    { "getYValueWithDouble:", "getYValue", "D", 0x4, NULL, NULL },
    { "computeWithHigherPrecision", NULL, "V", 0x4, NULL, NULL },
    { "compute", NULL, "V", 0x1, NULL, NULL },
    { "getNearRootsWithDoubleArray:withGeogebraCommonKernelEquationSolverInterface:withDouble:", "getNearRoots", "I", 0xa, NULL, NULL },
    { "insertWithDoubleArray:", "insert", "V", 0x2, NULL, NULL },
    { "getClassName", NULL, "Lgeogebra.common.kernel.commands.Commands;", 0x1, NULL, NULL },
    { "getRelatedModeID", NULL, "I", 0x1, NULL, NULL },
    { "addSolutionHintWithGeogebraCommonKernelGeosGeoPoint:", "addSolutionHint", "V", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "p1_", NULL, 0x2, "Lgeogebra.common.kernel.implicit.GeoImplicitPoly;", NULL, NULL,  },
    { "p2_", NULL, 0x2, "Lgeogebra.common.kernel.implicit.GeoImplicitPoly;", NULL, NULL,  },
    { "c1_", NULL, 0x2, "Lgeogebra.common.kernel.geos.GeoConic;", NULL, NULL,  },
    { "valPairs_", NULL, 0x2, "Ljava.util.List;", NULL, "Ljava/util/List<L[D;>;",  },
    { "PolyX_", NULL, 0x1a, "I", NULL, NULL, .constantValue.asInt = GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_PolyX },
    { "PolyY_", NULL, 0x1a, "I", NULL, NULL, .constantValue.asInt = GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_PolyY },
    { "univarType_", NULL, 0x2, "I", NULL, NULL,  },
    { "hints_", NULL, 0x2, "Ljava.util.List;", NULL, "Ljava/util/List<Lgeogebra/common/kernel/geos/GeoPoint;>;",  },
  };
  static const J2ObjcClassInfo _GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys = { 2, "AlgoIntersectImplicitpolys", "geogebra.common.kernel.implicit", NULL, 0x1, 12, methods, 8, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys;
}

@end

void GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelGeosGeoConic_(GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys *self, GeogebraCommonKernelConstruction *c, GeogebraCommonKernelImplicitGeoImplicitPoly *p1, GeogebraCommonKernelGeosGeoConic *c1) {
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withNSStringArray_withBoolean_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelGeosGeoConic_(self, c, nil, NO, p1, c1);
}

GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys *new_GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelGeosGeoConic_(GeogebraCommonKernelConstruction *c, GeogebraCommonKernelImplicitGeoImplicitPoly *p1, GeogebraCommonKernelGeosGeoConic *c1) {
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys *self = [GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys alloc];
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelGeosGeoConic_(self, c, p1, c1);
  return self;
}

void GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withNSStringArray_withBoolean_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelGeosGeoConic_(GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys *self, GeogebraCommonKernelConstruction *c, IOSObjectArray *labels, jboolean setLabels, GeogebraCommonKernelImplicitGeoImplicitPoly *p1, GeogebraCommonKernelGeosGeoConic *c1) {
  GeogebraCommonKernelAlgosAlgoSimpleRootsPolynomial_initWithGeogebraCommonKernelConstruction_withGeogebraCommonKernelGeosGeoElementArray_(self, c, [IOSObjectArray arrayWithObjects:(id[]){ p1, c1 } count:2 type:GeogebraCommonKernelGeosGeoElement_class_()]);
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_set_p1_(self, p1);
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_set_c1_(self, c1);
  [self initForNearToRelationship];
  [self compute];
}

GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys *new_GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withNSStringArray_withBoolean_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelGeosGeoConic_(GeogebraCommonKernelConstruction *c, IOSObjectArray *labels, jboolean setLabels, GeogebraCommonKernelImplicitGeoImplicitPoly *p1, GeogebraCommonKernelGeosGeoConic *c1) {
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys *self = [GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys alloc];
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withNSStringArray_withBoolean_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelGeosGeoConic_(self, c, labels, setLabels, p1, c1);
  return self;
}

void GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelImplicitGeoImplicitPoly_(GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys *self, GeogebraCommonKernelConstruction *c, GeogebraCommonKernelImplicitGeoImplicitPoly *p1, GeogebraCommonKernelImplicitGeoImplicitPoly *p2) {
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withNSStringArray_withBoolean_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelImplicitGeoImplicitPoly_(self, c, nil, NO, p1, p2);
}

GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys *new_GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelImplicitGeoImplicitPoly_(GeogebraCommonKernelConstruction *c, GeogebraCommonKernelImplicitGeoImplicitPoly *p1, GeogebraCommonKernelImplicitGeoImplicitPoly *p2) {
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys *self = [GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys alloc];
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelImplicitGeoImplicitPoly_(self, c, p1, p2);
  return self;
}

void GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withNSStringArray_withBoolean_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelImplicitGeoImplicitPoly_(GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys *self, GeogebraCommonKernelConstruction *c, IOSObjectArray *labels, jboolean setLabels, GeogebraCommonKernelImplicitGeoImplicitPoly *p1, GeogebraCommonKernelImplicitGeoImplicitPoly *p2) {
  GeogebraCommonKernelAlgosAlgoSimpleRootsPolynomial_initWithGeogebraCommonKernelConstruction_withGeogebraCommonKernelGeosGeoElementArray_(self, c, [IOSObjectArray arrayWithObjects:(id[]){ p1, p2 } count:2 type:GeogebraCommonKernelGeosGeoElement_class_()]);
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_set_p1_(self, p1);
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_set_p2_(self, p2);
  [self initForNearToRelationship];
  [self compute];
}

GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys *new_GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withNSStringArray_withBoolean_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelImplicitGeoImplicitPoly_(GeogebraCommonKernelConstruction *c, IOSObjectArray *labels, jboolean setLabels, GeogebraCommonKernelImplicitGeoImplicitPoly *p1, GeogebraCommonKernelImplicitGeoImplicitPoly *p2) {
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys *self = [GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys alloc];
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initWithGeogebraCommonKernelConstruction_withNSStringArray_withBoolean_withGeogebraCommonKernelImplicitGeoImplicitPoly_withGeogebraCommonKernelImplicitGeoImplicitPoly_(self, c, labels, setLabels, p1, p2);
  return self;
}

jint GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_getNearRootsWithDoubleArray_withGeogebraCommonKernelEquationSolverInterface_withDouble_(IOSDoubleArray *roots, id<GeogebraCommonKernelEquationSolverInterface> solver, jdouble epsilon) {
  GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_initialize();
  OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *poly = [new_OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction_initWithDoubleArray_(roots) autorelease];
  IOSDoubleArray *rootsDerivative = [((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk([poly polynomialDerivative])) getCoefficients];
  jint nrRoots = GeogebraCommonKernelAlgosAlgoSimpleRootsPolynomial_getRootsWithDoubleArray_withGeogebraCommonKernelEquationSolverInterface_(roots, solver);
  jint nrDeRoots = GeogebraCommonKernelAlgosAlgoSimpleRootsPolynomial_getRootsWithDoubleArray_withGeogebraCommonKernelEquationSolverInterface_(rootsDerivative, solver);
  for (jint i = 0; i < nrDeRoots; i++) {
    if (GeogebraCommonKernelKernel_isEqualWithDouble_withDouble_withDouble_([poly valueWithDouble:IOSDoubleArray_Get(nil_chk(rootsDerivative), i)], 0, epsilon)) {
      if (nrRoots < ((IOSDoubleArray *) nil_chk(roots))->size_) {
        *IOSDoubleArray_GetRef(roots, nrRoots++) = IOSDoubleArray_Get(rootsDerivative, i);
      }
    }
  }
  if (nrRoots == 0) {
    IOSDoubleArray *c = [poly getCoefficients];
    jint n = ((IOSDoubleArray *) nil_chk(c))->size_ - 1;
    if (n > 0) {
      jdouble x = -IOSDoubleArray_Get(c, n - 1) / n / IOSDoubleArray_Get(c, n);
      if (GeogebraCommonKernelKernel_isEqualWithDouble_withDouble_([poly valueWithDouble:x], 0)) {
        *IOSDoubleArray_GetRef(nil_chk(roots), 0) = x;
        return 1;
      }
    }
  }
  if (nrRoots == 0) {
    OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *derivative = [poly polynomialDerivative];
    jdouble x = 0;
    jdouble err = JavaLangMath_absWithDouble_([poly valueWithDouble:x]);
    jdouble lastErr = err * 2;
    while (err < lastErr && err > GeogebraCommonKernelKernel_STANDARD_PRECISION) {
      jdouble devVal = [((OrgApacheCommonsMathAnalysisPolynomialsPolynomialFunction *) nil_chk(derivative)) valueWithDouble:x];
      if (!GeogebraCommonKernelKernel_isZeroWithDouble_(devVal)) x = x - [poly valueWithDouble:x] / devVal;
      else break;
      lastErr = err;
      err = JavaLangMath_absWithDouble_([poly valueWithDouble:x]);
    }
    if (GeogebraCommonKernelKernel_isEqualWithDouble_withDouble_withDouble_([poly valueWithDouble:x], 0, epsilon)) {
      *IOSDoubleArray_GetRef(nil_chk(roots), 0) = x;
      return 1;
    }
  }
  JavaUtilArrays_sortWithDoubleArray_withInt_withInt_(roots, 0, nrRoots);
  return nrRoots;
}

void GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys_insertWithDoubleArray_(GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys *self, IOSDoubleArray *pair) {
  id<JavaUtilListIterator> it = [((id<JavaUtilList>) nil_chk(self->valPairs_)) listIterator];
  jdouble eps = 1E-3;
  while ([((id<JavaUtilListIterator>) nil_chk(it)) hasNext]) {
    IOSDoubleArray *p = [it next];
    if (GeogebraCommonKernelKernel_isGreaterWithDouble_withDouble_withDouble_(IOSDoubleArray_Get(nil_chk(p), 0), IOSDoubleArray_Get(nil_chk(pair), 0), eps)) {
      [it previous];
      break;
    }
    if (GeogebraCommonKernelKernel_isEqualWithDouble_withDouble_withDouble_(IOSDoubleArray_Get(p, 0), IOSDoubleArray_Get(pair, 0), eps)) {
      if (GeogebraCommonKernelKernel_isGreaterWithDouble_withDouble_withDouble_(IOSDoubleArray_Get(p, 1), IOSDoubleArray_Get(pair, 1), eps)) {
        [it previous];
        break;
      }
      if (GeogebraCommonKernelKernel_isEqualWithDouble_withDouble_withDouble_(IOSDoubleArray_Get(p, 1), IOSDoubleArray_Get(pair, 1), eps)) return;
    }
  }
  [it addWithId:pair];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(GeogebraCommonKernelImplicitAlgoIntersectImplicitpolys)
