//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/geogebra_iOS/geogebra/geogebra/common/src/geogebra/common/kernel/advanced/AlgoFinancial.java
//


#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "geogebra/common/kernel/Construction.h"
#include "geogebra/common/kernel/Kernel.h"
#include "geogebra/common/kernel/advanced/AlgoFinancial.h"
#include "geogebra/common/kernel/algos/AlgoElement.h"
#include "geogebra/common/kernel/commands/Commands.h"
#include "geogebra/common/kernel/geos/GeoElement.h"
#include "geogebra/common/kernel/geos/GeoNumeric.h"
#include "geogebra/common/main/App.h"
#include "java/lang/Double.h"
#include "java/lang/Enum.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/Math.h"
#include "java/util/ArrayList.h"

@interface GeogebraCommonKernelAdvancedAlgoFinancial () {
 @public
  GeogebraCommonKernelGeosGeoNumeric *geoRate_, *geoNper_, *geoPmt_, *geoPV_, *geoFV_, *geoPmtType_, *geoGuess_;
  GeogebraCommonKernelGeosGeoNumeric *result_;
  GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum *calcType_;
  jdouble rate_, nper_, pmt_, pv_, fv_, pmtType_, guess_;
}

- (void)debug;

- (jdouble)pmtFactor;

- (jboolean)computeRate;

- (jdouble)fWithDouble:(jdouble)x;

- (jdouble)dfWithDouble:(jdouble)x;

- (jboolean)computeRate2;

- (jboolean)setRate;

- (jboolean)setNper;

- (jboolean)setPmt;

- (jboolean)setPV;

- (jboolean)setFV;

- (jboolean)setPmtType;

- (jboolean)setGuess;

@end

J2OBJC_FIELD_SETTER(GeogebraCommonKernelAdvancedAlgoFinancial, geoRate_, GeogebraCommonKernelGeosGeoNumeric *)
J2OBJC_FIELD_SETTER(GeogebraCommonKernelAdvancedAlgoFinancial, geoNper_, GeogebraCommonKernelGeosGeoNumeric *)
J2OBJC_FIELD_SETTER(GeogebraCommonKernelAdvancedAlgoFinancial, geoPmt_, GeogebraCommonKernelGeosGeoNumeric *)
J2OBJC_FIELD_SETTER(GeogebraCommonKernelAdvancedAlgoFinancial, geoPV_, GeogebraCommonKernelGeosGeoNumeric *)
J2OBJC_FIELD_SETTER(GeogebraCommonKernelAdvancedAlgoFinancial, geoFV_, GeogebraCommonKernelGeosGeoNumeric *)
J2OBJC_FIELD_SETTER(GeogebraCommonKernelAdvancedAlgoFinancial, geoPmtType_, GeogebraCommonKernelGeosGeoNumeric *)
J2OBJC_FIELD_SETTER(GeogebraCommonKernelAdvancedAlgoFinancial, geoGuess_, GeogebraCommonKernelGeosGeoNumeric *)
J2OBJC_FIELD_SETTER(GeogebraCommonKernelAdvancedAlgoFinancial, result_, GeogebraCommonKernelGeosGeoNumeric *)
J2OBJC_FIELD_SETTER(GeogebraCommonKernelAdvancedAlgoFinancial, calcType_, GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum *)

__attribute__((unused)) static void GeogebraCommonKernelAdvancedAlgoFinancial_compute(GeogebraCommonKernelAdvancedAlgoFinancial *self);

__attribute__((unused)) static jdouble GeogebraCommonKernelAdvancedAlgoFinancial_pmtFactor(GeogebraCommonKernelAdvancedAlgoFinancial *self);

__attribute__((unused)) static jboolean GeogebraCommonKernelAdvancedAlgoFinancial_computeRate(GeogebraCommonKernelAdvancedAlgoFinancial *self);

__attribute__((unused)) static jdouble GeogebraCommonKernelAdvancedAlgoFinancial_fWithDouble_(GeogebraCommonKernelAdvancedAlgoFinancial *self, jdouble x);

__attribute__((unused)) static jdouble GeogebraCommonKernelAdvancedAlgoFinancial_dfWithDouble_(GeogebraCommonKernelAdvancedAlgoFinancial *self, jdouble x);

__attribute__((unused)) static jboolean GeogebraCommonKernelAdvancedAlgoFinancial_setRate(GeogebraCommonKernelAdvancedAlgoFinancial *self);

__attribute__((unused)) static jboolean GeogebraCommonKernelAdvancedAlgoFinancial_setNper(GeogebraCommonKernelAdvancedAlgoFinancial *self);

__attribute__((unused)) static jboolean GeogebraCommonKernelAdvancedAlgoFinancial_setPmt(GeogebraCommonKernelAdvancedAlgoFinancial *self);

__attribute__((unused)) static jboolean GeogebraCommonKernelAdvancedAlgoFinancial_setPV(GeogebraCommonKernelAdvancedAlgoFinancial *self);

__attribute__((unused)) static jboolean GeogebraCommonKernelAdvancedAlgoFinancial_setFV(GeogebraCommonKernelAdvancedAlgoFinancial *self);

__attribute__((unused)) static jboolean GeogebraCommonKernelAdvancedAlgoFinancial_setPmtType(GeogebraCommonKernelAdvancedAlgoFinancial *self);

__attribute__((unused)) static jboolean GeogebraCommonKernelAdvancedAlgoFinancial_setGuess(GeogebraCommonKernelAdvancedAlgoFinancial *self);

__attribute__((unused)) static void GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_initWithNSString_withInt_(GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum *self, NSString *__name, jint __ordinal);

__attribute__((unused)) static GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum *new_GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_initWithNSString_withInt_(NSString *__name, jint __ordinal) NS_RETURNS_RETAINED;

@implementation GeogebraCommonKernelAdvancedAlgoFinancial

- (instancetype)initWithGeogebraCommonKernelConstruction:(GeogebraCommonKernelConstruction *)cons
                                            withNSString:(NSString *)label
                  withGeogebraCommonKernelGeosGeoNumeric:(GeogebraCommonKernelGeosGeoNumeric *)rate
                  withGeogebraCommonKernelGeosGeoNumeric:(GeogebraCommonKernelGeosGeoNumeric *)nper
                  withGeogebraCommonKernelGeosGeoNumeric:(GeogebraCommonKernelGeosGeoNumeric *)pmt
                  withGeogebraCommonKernelGeosGeoNumeric:(GeogebraCommonKernelGeosGeoNumeric *)pv
                  withGeogebraCommonKernelGeosGeoNumeric:(GeogebraCommonKernelGeosGeoNumeric *)fv
                  withGeogebraCommonKernelGeosGeoNumeric:(GeogebraCommonKernelGeosGeoNumeric *)pmtType
withGeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum:(GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum *)calcType {
  GeogebraCommonKernelAdvancedAlgoFinancial_initWithGeogebraCommonKernelConstruction_withNSString_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_(self, cons, label, rate, nper, pmt, pv, fv, pmtType, calcType);
  return self;
}

- (instancetype)initWithGeogebraCommonKernelConstruction:(GeogebraCommonKernelConstruction *)cons
                                            withNSString:(NSString *)label
                  withGeogebraCommonKernelGeosGeoNumeric:(GeogebraCommonKernelGeosGeoNumeric *)rate
                  withGeogebraCommonKernelGeosGeoNumeric:(GeogebraCommonKernelGeosGeoNumeric *)nper
                  withGeogebraCommonKernelGeosGeoNumeric:(GeogebraCommonKernelGeosGeoNumeric *)pmt
                  withGeogebraCommonKernelGeosGeoNumeric:(GeogebraCommonKernelGeosGeoNumeric *)pv
                  withGeogebraCommonKernelGeosGeoNumeric:(GeogebraCommonKernelGeosGeoNumeric *)fv
                  withGeogebraCommonKernelGeosGeoNumeric:(GeogebraCommonKernelGeosGeoNumeric *)pmtType
                  withGeogebraCommonKernelGeosGeoNumeric:(GeogebraCommonKernelGeosGeoNumeric *)guess
withGeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum:(GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum *)calcType {
  GeogebraCommonKernelAdvancedAlgoFinancial_initWithGeogebraCommonKernelConstruction_withNSString_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_(self, cons, label, rate, nper, pmt, pv, fv, pmtType, guess, calcType);
  return self;
}

- (GeogebraCommonKernelCommandsCommandsEnum *)getClassName {
  switch ([calcType_ ordinal]) {
    case GeogebraCommonKernelAdvancedAlgoFinancial_CalculationType_RATE:
    return GeogebraCommonKernelCommandsCommandsEnum_get_Rate();
    case GeogebraCommonKernelAdvancedAlgoFinancial_CalculationType_NPER:
    return GeogebraCommonKernelCommandsCommandsEnum_get_Periods();
    case GeogebraCommonKernelAdvancedAlgoFinancial_CalculationType_PMT:
    return GeogebraCommonKernelCommandsCommandsEnum_get_Payment();
    case GeogebraCommonKernelAdvancedAlgoFinancial_CalculationType_PV:
    return GeogebraCommonKernelCommandsCommandsEnum_get_PresentValue();
    case GeogebraCommonKernelAdvancedAlgoFinancial_CalculationType_FV:
    return GeogebraCommonKernelCommandsCommandsEnum_get_FutureValue();
    default:
    return GeogebraCommonKernelCommandsCommandsEnum_get_Rate();
  }
}

- (void)setInputOutput {
  JavaUtilArrayList *tempList = [new_JavaUtilArrayList_init() autorelease];
  if (geoRate_ != nil) {
    [tempList addWithId:geoRate_];
  }
  if (geoNper_ != nil) {
    [tempList addWithId:geoNper_];
  }
  if (geoPmt_ != nil) {
    [tempList addWithId:geoPmt_];
  }
  if (geoPV_ != nil) {
    [tempList addWithId:geoPV_];
  }
  if (geoFV_ != nil) {
    [tempList addWithId:geoFV_];
  }
  if (geoPmtType_ != nil) {
    [tempList addWithId:geoPmtType_];
  }
  GeogebraCommonKernelAlgosAlgoElement_setAndConsume_input_(self, [IOSObjectArray newArrayWithLength:[tempList size] type:GeogebraCommonKernelGeosGeoElement_class_()]);
  GeogebraCommonKernelAlgosAlgoElement_set_input_(self, [tempList toArrayWithNSObjectArray:input_]);
  [self setOutputLengthWithInt:1];
  [self setOutputWithInt:0 withGeogebraCommonKernelGeosGeoElement:result_];
  [self setDependencies];
}

- (GeogebraCommonKernelGeosGeoNumeric *)getResult {
  return result_;
}

- (void)compute {
  GeogebraCommonKernelAdvancedAlgoFinancial_compute(self);
}

- (void)debug {
  GeogebraCommonMainApp_debugWithNSString_(JreStrcat("$D", @" rate: ", rate_));
  GeogebraCommonMainApp_debugWithNSString_(JreStrcat("$D", @" nper: ", nper_));
  GeogebraCommonMainApp_debugWithNSString_(JreStrcat("$D", @" pmt: ", pmt_));
  GeogebraCommonMainApp_debugWithNSString_(JreStrcat("$D", @" pv: ", pv_));
  GeogebraCommonMainApp_debugWithNSString_(JreStrcat("$D", @" fv: ", fv_));
}

- (jdouble)pmtFactor {
  return GeogebraCommonKernelAdvancedAlgoFinancial_pmtFactor(self);
}

- (jboolean)computeRate {
  return GeogebraCommonKernelAdvancedAlgoFinancial_computeRate(self);
}

- (jdouble)fWithDouble:(jdouble)x {
  return GeogebraCommonKernelAdvancedAlgoFinancial_fWithDouble_(self, x);
}

- (jdouble)dfWithDouble:(jdouble)x {
  return GeogebraCommonKernelAdvancedAlgoFinancial_dfWithDouble_(self, x);
}

- (jboolean)computeRate2 {
  jdouble financialPrecision = 1.0e-08;
  jdouble maxIterations = 128;
  jdouble f = 0;
  jdouble i;
  jdouble y;
  jdouble y0;
  jdouble y1;
  jdouble x0;
  jdouble x1;
  rate_ = guess_;
  if (JavaLangMath_absWithDouble_(rate_) < financialPrecision) {
    y = pv_ * (1 + nper_ * rate_) + pmt_ * (1 + rate_ * pmtType_) * nper_ + fv_;
  }
  else {
    f = JavaLangMath_expWithDouble_(nper_ * JavaLangMath_logWithDouble_(1 + rate_));
    y = pv_ * f + pmt_ * (1 / rate_ + pmtType_) * (f - 1) + fv_;
  }
  y0 = pv_ + pmt_ * nper_ + fv_;
  y1 = pv_ * f + pmt_ * (1 / rate_ + pmtType_) * (f - 1) + fv_;
  i = 0.0;
  x0 = 0.0;
  x1 = rate_;
  while ((JavaLangMath_absWithDouble_(y0 - y1) > financialPrecision) && (i < maxIterations)) {
    rate_ = (y1 * x0 - y0 * x1) / (y1 - y0);
    x0 = x1;
    x1 = rate_;
    if (JavaLangMath_absWithDouble_(rate_) < financialPrecision) {
      y = pv_ * (1 + nper_ * rate_) + pmt_ * (1 + rate_ * pmtType_) * nper_ + fv_;
    }
    else {
      f = JavaLangMath_expWithDouble_(nper_ * JavaLangMath_logWithDouble_(1 + rate_));
      y = pv_ * f + pmt_ * (1 / rate_ + pmtType_) * (f - 1) + fv_;
    }
    y0 = y1;
    y1 = y;
    jdouble unseq$1 = i++;
    i = unseq$1;
  }
  return YES;
}

- (jboolean)setRate {
  return GeogebraCommonKernelAdvancedAlgoFinancial_setRate(self);
}

- (jboolean)setNper {
  return GeogebraCommonKernelAdvancedAlgoFinancial_setNper(self);
}

- (jboolean)setPmt {
  return GeogebraCommonKernelAdvancedAlgoFinancial_setPmt(self);
}

- (jboolean)setPV {
  return GeogebraCommonKernelAdvancedAlgoFinancial_setPV(self);
}

- (jboolean)setFV {
  return GeogebraCommonKernelAdvancedAlgoFinancial_setFV(self);
}

- (jboolean)setPmtType {
  return GeogebraCommonKernelAdvancedAlgoFinancial_setPmtType(self);
}

- (jboolean)setGuess {
  return GeogebraCommonKernelAdvancedAlgoFinancial_setGuess(self);
}

- (void)dealloc {
  RELEASE_(geoRate_);
  RELEASE_(geoNper_);
  RELEASE_(geoPmt_);
  RELEASE_(geoPV_);
  RELEASE_(geoFV_);
  RELEASE_(geoPmtType_);
  RELEASE_(geoGuess_);
  RELEASE_(result_);
  RELEASE_(calcType_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithGeogebraCommonKernelConstruction:withNSString:withGeogebraCommonKernelGeosGeoNumeric:withGeogebraCommonKernelGeosGeoNumeric:withGeogebraCommonKernelGeosGeoNumeric:withGeogebraCommonKernelGeosGeoNumeric:withGeogebraCommonKernelGeosGeoNumeric:withGeogebraCommonKernelGeosGeoNumeric:withGeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum:", "AlgoFinancial", NULL, 0x1, NULL, NULL },
    { "initWithGeogebraCommonKernelConstruction:withNSString:withGeogebraCommonKernelGeosGeoNumeric:withGeogebraCommonKernelGeosGeoNumeric:withGeogebraCommonKernelGeosGeoNumeric:withGeogebraCommonKernelGeosGeoNumeric:withGeogebraCommonKernelGeosGeoNumeric:withGeogebraCommonKernelGeosGeoNumeric:withGeogebraCommonKernelGeosGeoNumeric:withGeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum:", "AlgoFinancial", NULL, 0x1, NULL, NULL },
    { "getClassName", NULL, "Lgeogebra.common.kernel.commands.Commands;", 0x1, NULL, NULL },
    { "setInputOutput", NULL, "V", 0x4, NULL, NULL },
    { "getResult", NULL, "Lgeogebra.common.kernel.geos.GeoNumeric;", 0x1, NULL, NULL },
    { "compute", NULL, "V", 0x11, NULL, NULL },
    { "debug", NULL, "V", 0x2, NULL, NULL },
    { "pmtFactor", NULL, "D", 0x2, NULL, NULL },
    { "computeRate", NULL, "Z", 0x2, NULL, NULL },
    { "fWithDouble:", "f", "D", 0x2, NULL, NULL },
    { "dfWithDouble:", "df", "D", 0x2, NULL, NULL },
    { "computeRate2", NULL, "Z", 0x2, NULL, NULL },
    { "setRate", NULL, "Z", 0x2, NULL, NULL },
    { "setNper", NULL, "Z", 0x2, NULL, NULL },
    { "setPmt", NULL, "Z", 0x2, NULL, NULL },
    { "setPV", NULL, "Z", 0x2, NULL, NULL },
    { "setFV", NULL, "Z", 0x2, NULL, NULL },
    { "setPmtType", NULL, "Z", 0x2, NULL, NULL },
    { "setGuess", NULL, "Z", 0x2, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "geoRate_", NULL, 0x2, "Lgeogebra.common.kernel.geos.GeoNumeric;", NULL, NULL,  },
    { "geoNper_", NULL, 0x2, "Lgeogebra.common.kernel.geos.GeoNumeric;", NULL, NULL,  },
    { "geoPmt_", NULL, 0x2, "Lgeogebra.common.kernel.geos.GeoNumeric;", NULL, NULL,  },
    { "geoPV_", NULL, 0x2, "Lgeogebra.common.kernel.geos.GeoNumeric;", NULL, NULL,  },
    { "geoFV_", NULL, 0x2, "Lgeogebra.common.kernel.geos.GeoNumeric;", NULL, NULL,  },
    { "geoPmtType_", NULL, 0x2, "Lgeogebra.common.kernel.geos.GeoNumeric;", NULL, NULL,  },
    { "geoGuess_", NULL, 0x2, "Lgeogebra.common.kernel.geos.GeoNumeric;", NULL, NULL,  },
    { "result_", NULL, 0x2, "Lgeogebra.common.kernel.geos.GeoNumeric;", NULL, NULL,  },
    { "calcType_", NULL, 0x2, "Lgeogebra.common.kernel.advanced.AlgoFinancial$CalculationType;", NULL, NULL,  },
    { "rate_", NULL, 0x2, "D", NULL, NULL,  },
    { "nper_", NULL, 0x2, "D", NULL, NULL,  },
    { "pmt_", NULL, 0x2, "D", NULL, NULL,  },
    { "pv_", NULL, 0x2, "D", NULL, NULL,  },
    { "fv_", NULL, 0x2, "D", NULL, NULL,  },
    { "pmtType_", NULL, 0x2, "D", NULL, NULL,  },
    { "guess_", NULL, 0x2, "D", NULL, NULL,  },
  };
  static const char *inner_classes[] = {"Lgeogebra.common.kernel.advanced.AlgoFinancial$CalculationType;"};
  static const J2ObjcClassInfo _GeogebraCommonKernelAdvancedAlgoFinancial = { 2, "AlgoFinancial", "geogebra.common.kernel.advanced", NULL, 0x1, 19, methods, 16, fields, 0, NULL, 1, inner_classes, NULL, NULL };
  return &_GeogebraCommonKernelAdvancedAlgoFinancial;
}

@end

void GeogebraCommonKernelAdvancedAlgoFinancial_initWithGeogebraCommonKernelConstruction_withNSString_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_(GeogebraCommonKernelAdvancedAlgoFinancial *self, GeogebraCommonKernelConstruction *cons, NSString *label, GeogebraCommonKernelGeosGeoNumeric *rate, GeogebraCommonKernelGeosGeoNumeric *nper, GeogebraCommonKernelGeosGeoNumeric *pmt, GeogebraCommonKernelGeosGeoNumeric *pv, GeogebraCommonKernelGeosGeoNumeric *fv, GeogebraCommonKernelGeosGeoNumeric *pmtType, GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum *calcType) {
  GeogebraCommonKernelAdvancedAlgoFinancial_initWithGeogebraCommonKernelConstruction_withNSString_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_(self, cons, label, rate, nper, pmt, pv, fv, pmtType, nil, calcType);
}

GeogebraCommonKernelAdvancedAlgoFinancial *new_GeogebraCommonKernelAdvancedAlgoFinancial_initWithGeogebraCommonKernelConstruction_withNSString_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_(GeogebraCommonKernelConstruction *cons, NSString *label, GeogebraCommonKernelGeosGeoNumeric *rate, GeogebraCommonKernelGeosGeoNumeric *nper, GeogebraCommonKernelGeosGeoNumeric *pmt, GeogebraCommonKernelGeosGeoNumeric *pv, GeogebraCommonKernelGeosGeoNumeric *fv, GeogebraCommonKernelGeosGeoNumeric *pmtType, GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum *calcType) {
  GeogebraCommonKernelAdvancedAlgoFinancial *self = [GeogebraCommonKernelAdvancedAlgoFinancial alloc];
  GeogebraCommonKernelAdvancedAlgoFinancial_initWithGeogebraCommonKernelConstruction_withNSString_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_(self, cons, label, rate, nper, pmt, pv, fv, pmtType, calcType);
  return self;
}

void GeogebraCommonKernelAdvancedAlgoFinancial_initWithGeogebraCommonKernelConstruction_withNSString_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_(GeogebraCommonKernelAdvancedAlgoFinancial *self, GeogebraCommonKernelConstruction *cons, NSString *label, GeogebraCommonKernelGeosGeoNumeric *rate, GeogebraCommonKernelGeosGeoNumeric *nper, GeogebraCommonKernelGeosGeoNumeric *pmt, GeogebraCommonKernelGeosGeoNumeric *pv, GeogebraCommonKernelGeosGeoNumeric *fv, GeogebraCommonKernelGeosGeoNumeric *pmtType, GeogebraCommonKernelGeosGeoNumeric *guess, GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum *calcType) {
  GeogebraCommonKernelAlgosAlgoElement_initWithGeogebraCommonKernelConstruction_(self, cons);
  GeogebraCommonKernelAdvancedAlgoFinancial_set_geoRate_(self, rate);
  GeogebraCommonKernelAdvancedAlgoFinancial_set_geoNper_(self, nper);
  GeogebraCommonKernelAdvancedAlgoFinancial_set_geoPmt_(self, pmt);
  GeogebraCommonKernelAdvancedAlgoFinancial_set_geoPV_(self, pv);
  GeogebraCommonKernelAdvancedAlgoFinancial_set_geoFV_(self, fv);
  GeogebraCommonKernelAdvancedAlgoFinancial_set_geoPmtType_(self, pmtType);
  GeogebraCommonKernelAdvancedAlgoFinancial_set_geoGuess_(self, guess);
  GeogebraCommonKernelAdvancedAlgoFinancial_set_calcType_(self, calcType);
  GeogebraCommonKernelAdvancedAlgoFinancial_setAndConsume_result_(self, new_GeogebraCommonKernelGeosGeoNumeric_initWithGeogebraCommonKernelConstruction_(cons));
  [self setInputOutput];
  GeogebraCommonKernelAdvancedAlgoFinancial_compute(self);
  [self->result_ setLabelWithNSString:label];
}

GeogebraCommonKernelAdvancedAlgoFinancial *new_GeogebraCommonKernelAdvancedAlgoFinancial_initWithGeogebraCommonKernelConstruction_withNSString_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_(GeogebraCommonKernelConstruction *cons, NSString *label, GeogebraCommonKernelGeosGeoNumeric *rate, GeogebraCommonKernelGeosGeoNumeric *nper, GeogebraCommonKernelGeosGeoNumeric *pmt, GeogebraCommonKernelGeosGeoNumeric *pv, GeogebraCommonKernelGeosGeoNumeric *fv, GeogebraCommonKernelGeosGeoNumeric *pmtType, GeogebraCommonKernelGeosGeoNumeric *guess, GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum *calcType) {
  GeogebraCommonKernelAdvancedAlgoFinancial *self = [GeogebraCommonKernelAdvancedAlgoFinancial alloc];
  GeogebraCommonKernelAdvancedAlgoFinancial_initWithGeogebraCommonKernelConstruction_withNSString_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelGeosGeoNumeric_withGeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_(self, cons, label, rate, nper, pmt, pv, fv, pmtType, guess, calcType);
  return self;
}

void GeogebraCommonKernelAdvancedAlgoFinancial_compute(GeogebraCommonKernelAdvancedAlgoFinancial *self) {
  switch ([self->calcType_ ordinal]) {
    case GeogebraCommonKernelAdvancedAlgoFinancial_CalculationType_RATE:
    if (!(GeogebraCommonKernelAdvancedAlgoFinancial_setNper(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setPmt(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setPV(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setFV(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setPmtType(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setGuess(self))) {
      [((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->result_)) setUndefined];
      return;
    }
    if (GeogebraCommonKernelAdvancedAlgoFinancial_computeRate(self)) {
      [((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->result_)) setValueWithDouble:self->rate_];
    }
    else {
      [((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->result_)) setUndefined];
    }
    break;
    case GeogebraCommonKernelAdvancedAlgoFinancial_CalculationType_NPER:
    if (!(GeogebraCommonKernelAdvancedAlgoFinancial_setRate(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setPmt(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setPV(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setFV(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setPmtType(self))) {
      [((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->result_)) setUndefined];
      return;
    }
    if (self->rate_ == 0) {
      self->nper_ = -(self->pv_ + self->fv_) / self->pmt_;
    }
    else {
      jdouble pmt2 = self->pmt_ * (1 + self->rate_ * self->pmtType_);
      self->nper_ = JavaLangMath_logWithDouble_((pmt2 - self->rate_ * self->fv_) / (pmt2 + self->rate_ * self->pv_)) / JavaLangMath_logWithDouble_(1 + self->rate_);
    }
    [((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->result_)) setValueWithDouble:self->nper_];
    break;
    case GeogebraCommonKernelAdvancedAlgoFinancial_CalculationType_PMT:
    if (!(GeogebraCommonKernelAdvancedAlgoFinancial_setRate(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setNper(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setPV(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setFV(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setPmtType(self))) {
      [((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->result_)) setUndefined];
      return;
    }
    if (self->rate_ == 0) {
      self->pmt_ = -(self->pv_ + self->fv_) / self->nper_;
    }
    else {
      self->pmt_ = (-self->fv_ - self->pv_ * JavaLangMath_powWithDouble_withDouble_(1 + self->rate_, self->nper_)) / GeogebraCommonKernelAdvancedAlgoFinancial_pmtFactor(self);
    }
    [((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->result_)) setValueWithDouble:self->pmt_];
    break;
    case GeogebraCommonKernelAdvancedAlgoFinancial_CalculationType_PV:
    if (!(GeogebraCommonKernelAdvancedAlgoFinancial_setRate(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setNper(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setPmt(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setFV(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setPmtType(self))) {
      [((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->result_)) setUndefined];
      return;
    }
    if (self->rate_ == 0) {
      self->pv_ = -self->pmt_ * self->nper_ - self->fv_;
    }
    else {
      self->pv_ = (-self->fv_ - self->pmt_ * GeogebraCommonKernelAdvancedAlgoFinancial_pmtFactor(self)) / JavaLangMath_powWithDouble_withDouble_(1 + self->rate_, self->nper_);
    }
    [((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->result_)) setValueWithDouble:self->pv_];
    break;
    case GeogebraCommonKernelAdvancedAlgoFinancial_CalculationType_FV:
    if (!(GeogebraCommonKernelAdvancedAlgoFinancial_setRate(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setNper(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setPmt(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setPV(self) && GeogebraCommonKernelAdvancedAlgoFinancial_setPmtType(self))) {
      [((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->result_)) setUndefined];
      return;
    }
    if (self->rate_ == 0) {
      self->fv_ = -self->pmt_ * self->nper_ - self->pv_;
    }
    else {
      self->fv_ = -self->pmt_ * GeogebraCommonKernelAdvancedAlgoFinancial_pmtFactor(self) - self->pv_ * JavaLangMath_powWithDouble_withDouble_(1 + self->rate_, self->nper_);
    }
    [((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->result_)) setValueWithDouble:self->fv_];
    break;
  }
}

jdouble GeogebraCommonKernelAdvancedAlgoFinancial_pmtFactor(GeogebraCommonKernelAdvancedAlgoFinancial *self) {
  return (1 + self->rate_ * self->pmtType_) * (JavaLangMath_powWithDouble_withDouble_(1 + self->rate_, self->nper_) - 1) / (self->rate_);
}

jboolean GeogebraCommonKernelAdvancedAlgoFinancial_computeRate(GeogebraCommonKernelAdvancedAlgoFinancial *self) {
  jint maxIterations = 20;
  jdouble y, yPrime;
  self->rate_ = self->guess_;
  for (jint i = 0; i < maxIterations; i++) {
    y = GeogebraCommonKernelAdvancedAlgoFinancial_fWithDouble_(self, self->rate_);
    if (JavaLangMath_absWithDouble_(y) < GeogebraCommonKernelKernel_STANDARD_PRECISION) {
      return YES;
    }
    yPrime = GeogebraCommonKernelAdvancedAlgoFinancial_dfWithDouble_(self, self->rate_);
    if (JavaLangMath_absWithDouble_(yPrime) < GeogebraCommonKernelKernel_MAX_DOUBLE_PRECISION) {
      return NO;
    }
    jdouble rate2 = self->rate_ - (y / GeogebraCommonKernelAdvancedAlgoFinancial_dfWithDouble_(self, self->rate_));
    if (JavaLangMath_absWithDouble_(rate2 - self->rate_) < GeogebraCommonKernelKernel_STANDARD_PRECISION) {
      self->rate_ = rate2;
      return YES;
    }
    self->rate_ = rate2;
  }
  return NO;
}

jdouble GeogebraCommonKernelAdvancedAlgoFinancial_fWithDouble_(GeogebraCommonKernelAdvancedAlgoFinancial *self, jdouble x) {
  return self->pv_ * JavaLangMath_powWithDouble_withDouble_(1 + x, self->nper_) + self->pmt_ * (1 + self->pmtType_ * x) * (JavaLangMath_powWithDouble_withDouble_(1 + x, self->nper_) - 1) / x + self->fv_;
}

jdouble GeogebraCommonKernelAdvancedAlgoFinancial_dfWithDouble_(GeogebraCommonKernelAdvancedAlgoFinancial *self, jdouble x) {
  jdouble a = self->pv_;
  jdouble n = self->nper_;
  jdouble b = self->pmt_;
  jdouble c = self->pmtType_;
  jdouble d = self->fv_;
  jdouble p = JavaLangMath_powWithDouble_withDouble_(1 + x, n);
  jdouble num = a * n * x * x * p + b * (c * n * x * x * p + n * x * p - x * p - p + x + 1);
  return num / (x * x * (x + 1));
}

jboolean GeogebraCommonKernelAdvancedAlgoFinancial_setRate(GeogebraCommonKernelAdvancedAlgoFinancial *self) {
  if (self->geoRate_ == nil || ![self->geoRate_ isDefined]) {
    return NO;
  }
  self->rate_ = [((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->geoRate_)) evaluateDouble];
  return !JavaLangDouble_isNaNWithDouble_(self->rate_);
}

jboolean GeogebraCommonKernelAdvancedAlgoFinancial_setNper(GeogebraCommonKernelAdvancedAlgoFinancial *self) {
  if (self->geoNper_ == nil || ![self->geoNper_ isDefined]) {
    return NO;
  }
  self->nper_ = [((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->geoNper_)) evaluateDouble];
  return !(self->nper_ <= 0 && JavaLangDouble_isNaNWithDouble_(self->nper_));
}

jboolean GeogebraCommonKernelAdvancedAlgoFinancial_setPmt(GeogebraCommonKernelAdvancedAlgoFinancial *self) {
  if (self->geoPmt_ == nil || ![self->geoPmt_ isDefined]) {
    return NO;
  }
  self->pmt_ = [((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->geoPmt_)) evaluateDouble];
  return !JavaLangDouble_isNaNWithDouble_(self->pmt_);
}

jboolean GeogebraCommonKernelAdvancedAlgoFinancial_setPV(GeogebraCommonKernelAdvancedAlgoFinancial *self) {
  if (self->geoPV_ == nil) {
    if (self->calcType_ == GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_get_FV()) {
      self->pv_ = 0;
      return YES;
    }
    return NO;
  }
  if ([((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->geoPV_)) isDefined]) {
    self->pv_ = [self->geoPV_ evaluateDouble];
    return !JavaLangDouble_isNaNWithDouble_(self->pv_);
  }
  return NO;
}

jboolean GeogebraCommonKernelAdvancedAlgoFinancial_setFV(GeogebraCommonKernelAdvancedAlgoFinancial *self) {
  if (self->geoFV_ == nil) {
    self->fv_ = 0;
    return YES;
  }
  if ([((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->geoFV_)) isDefined]) {
    self->fv_ = [self->geoFV_ evaluateDouble];
    return !JavaLangDouble_isNaNWithDouble_(self->fv_);
  }
  return NO;
}

jboolean GeogebraCommonKernelAdvancedAlgoFinancial_setPmtType(GeogebraCommonKernelAdvancedAlgoFinancial *self) {
  if (self->geoPmtType_ == nil) {
    self->pmtType_ = 0;
    return YES;
  }
  if ([((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->geoPmtType_)) isDefined]) {
    if ([self->geoPmtType_ getDouble] == 1 || [self->geoPmtType_ getDouble] == 0) {
      self->pmtType_ = [self->geoPmtType_ getDouble];
      return YES;
    }
  }
  return NO;
}

jboolean GeogebraCommonKernelAdvancedAlgoFinancial_setGuess(GeogebraCommonKernelAdvancedAlgoFinancial *self) {
  if (self->geoGuess_ == nil) {
    self->guess_ = 0.1;
    return YES;
  }
  if ([((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(self->geoGuess_)) isDefined]) {
    self->guess_ = [self->geoGuess_ evaluateDouble];
    return !JavaLangDouble_isNaNWithDouble_(self->guess_);
  }
  return NO;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(GeogebraCommonKernelAdvancedAlgoFinancial)

J2OBJC_INITIALIZED_DEFN(GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum)

GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum *GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_values_[5];

@implementation GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum

- (instancetype)initWithNSString:(NSString *)__name
                         withInt:(jint)__ordinal {
  GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_initWithNSString_withInt_(self, __name, __ordinal);
  return self;
}

IOSObjectArray *GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_values() {
  GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_initialize();
  return [IOSObjectArray arrayWithObjects:GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_values_ count:5 type:GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_class_()];
}

+ (IOSObjectArray *)values {
  return GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_values();
}

+ (GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum *)valueOfWithNSString:(NSString *)name {
  return GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_valueOfWithNSString_(name);
}

GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum *GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_valueOfWithNSString_(NSString *name) {
  GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_initialize();
  for (int i = 0; i < 5; i++) {
    GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum *e = GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_values_[i];
    if ([name isEqual:[e name]]) {
      return e;
    }
  }
  @throw [[[JavaLangIllegalArgumentException alloc] initWithNSString:name] autorelease];
  return nil;
}

- (id)copyWithZone:(NSZone *)zone {
  return [self retain];
}

+ (void)initialize {
  if (self == [GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum class]) {
    GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_RATE = new_GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_initWithNSString_withInt_(@"RATE", 0);
    GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_NPER = new_GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_initWithNSString_withInt_(@"NPER", 1);
    GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_PMT = new_GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_initWithNSString_withInt_(@"PMT", 2);
    GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_PV = new_GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_initWithNSString_withInt_(@"PV", 3);
    GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_FV = new_GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_initWithNSString_withInt_(@"FV", 4);
    J2OBJC_SET_INITIALIZED(GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum)
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcFieldInfo fields[] = {
    { "RATE", "RATE", 0x4019, "Lgeogebra.common.kernel.advanced.AlgoFinancial$CalculationType;", &GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_RATE, NULL,  },
    { "NPER", "NPER", 0x4019, "Lgeogebra.common.kernel.advanced.AlgoFinancial$CalculationType;", &GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_NPER, NULL,  },
    { "PMT", "PMT", 0x4019, "Lgeogebra.common.kernel.advanced.AlgoFinancial$CalculationType;", &GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_PMT, NULL,  },
    { "PV", "PV", 0x4019, "Lgeogebra.common.kernel.advanced.AlgoFinancial$CalculationType;", &GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_PV, NULL,  },
    { "FV", "FV", 0x4019, "Lgeogebra.common.kernel.advanced.AlgoFinancial$CalculationType;", &GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_FV, NULL,  },
  };
  static const char *superclass_type_args[] = {"Lgeogebra.common.kernel.advanced.AlgoFinancial$CalculationType;"};
  static const J2ObjcClassInfo _GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum = { 2, "CalculationType", "geogebra.common.kernel.advanced", "AlgoFinancial", 0x4019, 0, NULL, 5, fields, 1, superclass_type_args, 0, NULL, NULL, "Ljava/lang/Enum<Lgeogebra/common/kernel/advanced/AlgoFinancial$CalculationType;>;" };
  return &_GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum;
}

@end

void GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_initWithNSString_withInt_(GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum *self, NSString *__name, jint __ordinal) {
  JavaLangEnum_initWithNSString_withInt_(self, __name, __ordinal);
}

GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum *new_GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_initWithNSString_withInt_(NSString *__name, jint __ordinal) {
  GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum *self = [GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum alloc];
  GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum_initWithNSString_withInt_(self, __name, __ordinal);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(GeogebraCommonKernelAdvancedAlgoFinancial_CalculationTypeEnum)
