//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/geogebra_iOS/geogebra/geogebra/common/src/geogebra/common/gui/dialog/ToolManagerDialogModel.java
//


#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "geogebra/common/euclidian/EuclidianConstants.h"
#include "geogebra/common/gui/dialog/ToolManagerDialogModel.h"
#include "geogebra/common/kernel/Kernel.h"
#include "geogebra/common/kernel/Macro.h"
#include "geogebra/common/kernel/geos/GeoElement.h"
#include "geogebra/common/main/App.h"
#include "geogebra/common/main/Localization.h"
#include "geogebra/common/main/SelectionManager.h"
#include "java/lang/Exception.h"
#include "java/util/ArrayList.h"
#include "java/util/Iterator.h"
#include "java/util/LinkedHashSet.h"
#include "java/util/List.h"

@interface GeogebraCommonGuiDialogToolManagerDialogModel () {
 @public
  GeogebraCommonMainApp *app_;
  id<JavaUtilList> deletedMacros_;
  id<GeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener> listener_;
}

@end

J2OBJC_FIELD_SETTER(GeogebraCommonGuiDialogToolManagerDialogModel, app_, GeogebraCommonMainApp *)
J2OBJC_FIELD_SETTER(GeogebraCommonGuiDialogToolManagerDialogModel, deletedMacros_, id<JavaUtilList>)
J2OBJC_FIELD_SETTER(GeogebraCommonGuiDialogToolManagerDialogModel, listener_, id<GeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener>)

@interface GeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener : NSObject
@end

@implementation GeogebraCommonGuiDialogToolManagerDialogModel

- (instancetype)initWithGeogebraCommonMainApp:(GeogebraCommonMainApp *)app
withGeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener:(id<GeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener>)listener {
  GeogebraCommonGuiDialogToolManagerDialogModel_initWithGeogebraCommonMainApp_withGeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener_(self, app, listener);
  return self;
}

- (void)addMacrosWithNSObjectArray:(IOSObjectArray *)macros {
  GeogebraCommonKernelKernel *kernel = [((GeogebraCommonMainApp *) nil_chk(app_)) getKernel];
  [((GeogebraCommonKernelKernel *) nil_chk(kernel)) removeAllMacros];
  {
    IOSObjectArray *a__ = macros;
    id const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    id const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      id obj = *b__++;
      [kernel addMacroWithGeogebraCommonKernelMacro:(GeogebraCommonKernelMacro *) check_class_cast(obj, [GeogebraCommonKernelMacro class])];
    }
  }
}

- (jboolean)deleteToolsWithNSObjectArray:(IOSObjectArray *)sel {
  if (sel == nil || sel->size_ == 0) return NO;
  jboolean didDeletion = NO;
  jboolean changeToolBar = NO;
  jboolean foundUsedMacro = NO;
  NSString *macroNames = @"";
  GeogebraCommonKernelKernel *kernel = [((GeogebraCommonMainApp *) nil_chk(app_)) getKernel];
  [((GeogebraCommonMainSelectionManager *) nil_chk([app_ getSelectionManager])) setSelectedGeosWithJavaUtilArrayList:[new_JavaUtilArrayList_init() autorelease]];
  [((id<JavaUtilList>) nil_chk(deletedMacros_)) clear];
  for (jint i = 0; i < ((IOSObjectArray *) nil_chk(sel))->size_; i++) {
    GeogebraCommonKernelMacro *macro = (GeogebraCommonKernelMacro *) check_class_cast(IOSObjectArray_Get(sel, i), [GeogebraCommonKernelMacro class]);
    if (![((GeogebraCommonKernelMacro *) nil_chk(macro)) isUsed]) {
      changeToolBar = (changeToolBar || [macro isShowInToolBar]);
      [((id<GeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener>) nil_chk(listener_)) removeMacroFromToolbarWithInt:[((GeogebraCommonKernelKernel *) nil_chk(kernel)) getMacroIDWithGeogebraCommonKernelMacro:macro] + GeogebraCommonEuclidianEuclidianConstants_MACRO_MODE_ID_OFFSET];
      [kernel removeMacroWithGeogebraCommonKernelMacro:macro];
      [listener_ refreshCustomToolsInToolBar];
      [deletedMacros_ addWithId:macro];
      didDeletion = YES;
    }
    else {
      JavaUtilArrayList *geos = [macro getDependentGeos];
      id<JavaUtilIterator> curr = [((JavaUtilArrayList *) nil_chk(geos)) iterator];
      while ([((id<JavaUtilIterator>) nil_chk(curr)) hasNext]) [((GeogebraCommonMainSelectionManager *) nil_chk([app_ getSelectionManager])) addSelectedGeoWithGeogebraCommonKernelGeosGeoElement:[curr next]];
      foundUsedMacro = YES;
      macroNames = JreStrcat("$$", macroNames, JreStrcat("C$$$", 0x000a, [macro getToolOrCommandName], @": ", [macro getNeededTypesString]));
    }
  }
  if (didDeletion) {
    [((GeogebraCommonKernelKernel *) nil_chk(kernel)) initUndoInfo];
  }
  if (foundUsedMacro) [app_ showErrorWithNSString:JreStrcat("$C$", [((GeogebraCommonMainLocalization *) nil_chk([app_ getLocalization])) getErrorWithNSString:@"Tool.DeleteUsed"], ' ', macroNames)];
  return changeToolBar;
}

- (id<JavaUtilList>)getDeletedMacros {
  return deletedMacros_;
}

- (void)uploadToGeoGebraTubeWithNSObjectArray:(IOSObjectArray *)sel {
  [((GeogebraCommonMainApp *) nil_chk(app_)) setWaitCursor];
  @try {
    [((GeogebraCommonMainSelectionManager *) nil_chk([app_ getSelectionManager])) clearSelectedGeosWithBoolean:YES withBoolean:NO];
    [app_ updateSelectionWithBoolean:NO];
    if (sel == nil || sel->size_ == 0) return;
    JavaUtilLinkedHashSet *tools = [new_JavaUtilLinkedHashSet_init() autorelease];
    for (jint i = 0; i < ((IOSObjectArray *) nil_chk(sel))->size_; i++) {
      GeogebraCommonKernelMacro *macro = (GeogebraCommonKernelMacro *) check_class_cast(IOSObjectArray_Get(sel, i), [GeogebraCommonKernelMacro class]);
      JavaUtilArrayList *macros = [((GeogebraCommonKernelMacro *) nil_chk(macro)) getUsedMacros];
      if (macros != nil) [tools addAllWithJavaUtilCollection:macros];
      [tools addWithId:macro];
    }
    JavaUtilArrayList *macros = [new_JavaUtilArrayList_initWithInt_([tools size]) autorelease];
    id<JavaUtilIterator> it = [tools iterator];
    while ([((id<JavaUtilIterator>) nil_chk(it)) hasNext]) {
      [macros addWithId:[it next]];
    }
    [((id<GeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener>) nil_chk(listener_)) uploadWorksheetWithJavaUtilArrayList:macros];
  }
  @catch (JavaLangException *e) {
    GeogebraCommonMainApp_debugWithNSString_(@"Uploading failed");
    [((JavaLangException *) nil_chk(e)) printStackTrace];
  }
  [app_ setDefaultCursor];
}

- (JavaUtilArrayList *)getAllToolsWithNSObjectArray:(IOSObjectArray *)sel {
  JavaUtilLinkedHashSet *tools = [new_JavaUtilLinkedHashSet_init() autorelease];
  for (jint i = 0; i < ((IOSObjectArray *) nil_chk(sel))->size_; i++) {
    GeogebraCommonKernelMacro *macro = (GeogebraCommonKernelMacro *) check_class_cast(IOSObjectArray_Get(sel, i), [GeogebraCommonKernelMacro class]);
    JavaUtilArrayList *macros = [((GeogebraCommonKernelMacro *) nil_chk(macro)) getUsedMacros];
    if (macros != nil) [tools addAllWithJavaUtilCollection:macros];
    [tools addWithId:macro];
  }
  JavaUtilArrayList *macros = [new_JavaUtilArrayList_initWithInt_([tools size]) autorelease];
  id<JavaUtilIterator> it = [tools iterator];
  while ([((id<JavaUtilIterator>) nil_chk(it)) hasNext]) {
    [macros addWithId:[it next]];
  }
  return macros;
}

- (void)dealloc {
  RELEASE_(app_);
  RELEASE_(loc_);
  RELEASE_(deletedMacros_);
  RELEASE_(listener_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithGeogebraCommonMainApp:withGeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener:", "ToolManagerDialogModel", NULL, 0x1, NULL, NULL },
    { "addMacrosWithNSObjectArray:", "addMacros", "V", 0x1, NULL, NULL },
    { "deleteToolsWithNSObjectArray:", "deleteTools", "Z", 0x1, NULL, NULL },
    { "getDeletedMacros", NULL, "Ljava.util.List;", 0x1, NULL, NULL },
    { "uploadToGeoGebraTubeWithNSObjectArray:", "uploadToGeoGebraTube", "V", 0x1, NULL, NULL },
    { "getAllToolsWithNSObjectArray:", "getAllTools", "Ljava.util.ArrayList;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "app_", NULL, 0x2, "Lgeogebra.common.main.App;", NULL, NULL,  },
    { "loc_", NULL, 0x10, "Lgeogebra.common.main.Localization;", NULL, NULL,  },
    { "deletedMacros_", NULL, 0x2, "Ljava.util.List;", NULL, "Ljava/util/List<Lgeogebra/common/kernel/Macro;>;",  },
    { "listener_", NULL, 0x2, "Lgeogebra.common.gui.dialog.ToolManagerDialogModel$ToolManagerDialogListener;", NULL, NULL,  },
  };
  static const char *inner_classes[] = {"Lgeogebra.common.gui.dialog.ToolManagerDialogModel$ToolManagerDialogListener;"};
  static const J2ObjcClassInfo _GeogebraCommonGuiDialogToolManagerDialogModel = { 2, "ToolManagerDialogModel", "geogebra.common.gui.dialog", NULL, 0x1, 6, methods, 4, fields, 0, NULL, 1, inner_classes, NULL, NULL };
  return &_GeogebraCommonGuiDialogToolManagerDialogModel;
}

@end

void GeogebraCommonGuiDialogToolManagerDialogModel_initWithGeogebraCommonMainApp_withGeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener_(GeogebraCommonGuiDialogToolManagerDialogModel *self, GeogebraCommonMainApp *app, id<GeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener> listener) {
  NSObject_init(self);
  GeogebraCommonGuiDialogToolManagerDialogModel_set_app_(self, app);
  GeogebraCommonGuiDialogToolManagerDialogModel_set_loc_(self, [((GeogebraCommonMainApp *) nil_chk(app)) getLocalization]);
  GeogebraCommonGuiDialogToolManagerDialogModel_set_listener_(self, listener);
  GeogebraCommonGuiDialogToolManagerDialogModel_setAndConsume_deletedMacros_(self, new_JavaUtilArrayList_init());
}

GeogebraCommonGuiDialogToolManagerDialogModel *new_GeogebraCommonGuiDialogToolManagerDialogModel_initWithGeogebraCommonMainApp_withGeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener_(GeogebraCommonMainApp *app, id<GeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener> listener) {
  GeogebraCommonGuiDialogToolManagerDialogModel *self = [GeogebraCommonGuiDialogToolManagerDialogModel alloc];
  GeogebraCommonGuiDialogToolManagerDialogModel_initWithGeogebraCommonMainApp_withGeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener_(self, app, listener);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(GeogebraCommonGuiDialogToolManagerDialogModel)

@implementation GeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "removeMacroFromToolbarWithInt:", "removeMacroFromToolbar", "V", 0x401, NULL, NULL },
    { "refreshCustomToolsInToolBar", NULL, "V", 0x401, NULL, NULL },
    { "uploadWorksheetWithJavaUtilArrayList:", "uploadWorksheet", "V", 0x401, NULL, NULL },
  };
  static const J2ObjcClassInfo _GeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener = { 2, "ToolManagerDialogListener", "geogebra.common.gui.dialog", "ToolManagerDialogModel", 0x609, 3, methods, 0, NULL, 0, NULL, 0, NULL, NULL, NULL };
  return &_GeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener;
}

@end

J2OBJC_INTERFACE_TYPE_LITERAL_SOURCE(GeogebraCommonGuiDialogToolManagerDialogModel_ToolManagerDialogListener)
