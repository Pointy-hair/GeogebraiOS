//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/geogebra_iOS/geogebra/geogebra/common/src/geogebra/common/move/ggtapi/models/AuthenticationModel.java
//


#include "IOSClass.h"
#include "J2ObjC_source.h"
#include "geogebra/common/move/events/BaseEvent.h"
#include "geogebra/common/move/ggtapi/events/LogOutEvent.h"
#include "geogebra/common/move/ggtapi/events/LoginEvent.h"
#include "geogebra/common/move/ggtapi/models/AuthenticationModel.h"
#include "geogebra/common/move/ggtapi/models/GeoGebraTubeAPI.h"
#include "geogebra/common/move/ggtapi/models/GeoGebraTubeUser.h"
#include "geogebra/common/move/models/BaseModel.h"

@interface GeogebraCommonMoveGgtapiModelsAuthenticationModel () {
 @public
  GeogebraCommonMoveGgtapiModelsGeoGebraTubeUser *loggedInUser_;
  jboolean stayLoggedOut__;
}

@end

J2OBJC_FIELD_SETTER(GeogebraCommonMoveGgtapiModelsAuthenticationModel, loggedInUser_, GeogebraCommonMoveGgtapiModelsGeoGebraTubeUser *)

NSString *GeogebraCommonMoveGgtapiModelsAuthenticationModel_GGB_TOKEN_KEY_NAME_ = @"token";

@implementation GeogebraCommonMoveGgtapiModelsAuthenticationModel

- (instancetype)init {
  GeogebraCommonMoveGgtapiModelsAuthenticationModel_init(self);
  return self;
}

- (void)onEventWithGeogebraCommonMoveEventsBaseEvent:(GeogebraCommonMoveEventsBaseEvent *)event {
  if ([event isKindOfClass:[GeogebraCommonMoveGgtapiEventsLoginEvent class]]) {
    GeogebraCommonMoveGgtapiEventsLoginEvent *loginEvent = (GeogebraCommonMoveGgtapiEventsLoginEvent *) check_class_cast(event, [GeogebraCommonMoveGgtapiEventsLoginEvent class]);
    if ([((GeogebraCommonMoveGgtapiEventsLoginEvent *) nil_chk(loginEvent)) isSuccessful]) {
      [self onLoginSuccessWithGeogebraCommonMoveGgtapiModelsGeoGebraTubeUser:[loginEvent getUser] withNSString:[loginEvent getJSON]];
    }
    else {
      [self onLoginErrorWithGeogebraCommonMoveGgtapiModelsGeoGebraTubeUser:[loginEvent getUser]];
    }
  }
  else if ([event isKindOfClass:[GeogebraCommonMoveGgtapiEventsLogOutEvent class]]) {
    [self clearLoginToken];
    GeogebraCommonMoveGgtapiModelsAuthenticationModel_set_loggedInUser_(self, nil);
  }
}

- (void)storeLoginTokenWithNSString:(NSString *)token {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
}

- (NSString *)getLoginToken {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (void)clearLoginToken {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
}

- (void)onLoginSuccessWithGeogebraCommonMoveGgtapiModelsGeoGebraTubeUser:(GeogebraCommonMoveGgtapiModelsGeoGebraTubeUser *)user
                                                            withNSString:(NSString *)json {
  self->stayLoggedOut__ = NO;
  GeogebraCommonMoveGgtapiModelsAuthenticationModel_set_loggedInUser_(self, user);
  [self storeLastUserWithNSString:json];
  if ([((GeogebraCommonMoveGgtapiModelsGeoGebraTubeUser *) nil_chk(user)) getLoginToken] != [self getLoginToken]) {
    [self storeLoginTokenWithNSString:[user getLoginToken]];
  }
}

- (void)storeLastUserWithNSString:(NSString *)s {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
}

- (void)onLoginErrorWithGeogebraCommonMoveGgtapiModelsGeoGebraTubeUser:(GeogebraCommonMoveGgtapiModelsGeoGebraTubeUser *)user {
  self->stayLoggedOut__ = NO;
  if ([self getLoginToken] != nil) {
    [self clearLoginToken];
  }
}

- (NSString *)getUserName {
  if (loggedInUser_ != nil) {
    return [loggedInUser_ getUserName];
  }
  return nil;
}

- (jint)getUserId {
  if (loggedInUser_ != nil) {
    return [loggedInUser_ getUserId];
  }
  return -1;
}

- (GeogebraCommonMoveGgtapiModelsGeoGebraTubeUser *)getLoggedInUser {
  return loggedInUser_;
}

- (jboolean)isLoggedIn {
  if (loggedInUser_ == nil) {
    return NO;
  }
  return YES;
}

- (void)startOfflineWithGeogebraCommonMoveGgtapiModelsGeoGebraTubeAPI:(GeogebraCommonMoveGgtapiModelsGeoGebraTubeAPI *)api {
  if ([self loadLastUser] != nil) {
    GeogebraCommonMoveGgtapiModelsGeoGebraTubeUser *offline = [new_GeogebraCommonMoveGgtapiModelsGeoGebraTubeUser_initWithNSString_(nil) autorelease];
    if ([((GeogebraCommonMoveGgtapiModelsGeoGebraTubeAPI *) nil_chk(api)) parseUserDataFromResponseWithGeogebraCommonMoveGgtapiModelsGeoGebraTubeUser:offline withNSString:[self loadLastUser]]) {
      GeogebraCommonMoveGgtapiModelsAuthenticationModel_set_loggedInUser_(self, offline);
    }
  }
}

- (NSString *)loadLastUser {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (void)stayLoggedOut {
  self->stayLoggedOut__ = YES;
}

- (jboolean)mayLogIn {
  return !stayLoggedOut__;
}

- (void)dealloc {
  RELEASE_(loggedInUser_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "init", "AuthenticationModel", NULL, 0x1, NULL, NULL },
    { "onEventWithGeogebraCommonMoveEventsBaseEvent:", "onEvent", "V", 0x1, NULL, NULL },
    { "storeLoginTokenWithNSString:", "storeLoginToken", "V", 0x401, NULL, NULL },
    { "getLoginToken", NULL, "Ljava.lang.String;", 0x401, NULL, NULL },
    { "clearLoginToken", NULL, "V", 0x401, NULL, NULL },
    { "onLoginSuccessWithGeogebraCommonMoveGgtapiModelsGeoGebraTubeUser:withNSString:", "onLoginSuccess", "V", 0x1, NULL, NULL },
    { "storeLastUserWithNSString:", "storeLastUser", "V", 0x404, NULL, NULL },
    { "onLoginErrorWithGeogebraCommonMoveGgtapiModelsGeoGebraTubeUser:", "onLoginError", "V", 0x1, NULL, NULL },
    { "getUserName", NULL, "Ljava.lang.String;", 0x1, NULL, NULL },
    { "getUserId", NULL, "I", 0x1, NULL, NULL },
    { "getLoggedInUser", NULL, "Lgeogebra.common.move.ggtapi.models.GeoGebraTubeUser;", 0x1, NULL, NULL },
    { "isLoggedIn", NULL, "Z", 0x1, NULL, NULL },
    { "startOfflineWithGeogebraCommonMoveGgtapiModelsGeoGebraTubeAPI:", "startOffline", "V", 0x1, NULL, NULL },
    { "loadLastUser", NULL, "Ljava.lang.String;", 0x401, NULL, NULL },
    { "stayLoggedOut", NULL, "V", 0x1, NULL, NULL },
    { "mayLogIn", NULL, "Z", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "loggedInUser_", NULL, 0x2, "Lgeogebra.common.move.ggtapi.models.GeoGebraTubeUser;", NULL, NULL,  },
    { "stayLoggedOut__", "stayLoggedOut", 0x2, "Z", NULL, NULL,  },
    { "GGB_TOKEN_KEY_NAME_", NULL, 0x9, "Ljava.lang.String;", &GeogebraCommonMoveGgtapiModelsAuthenticationModel_GGB_TOKEN_KEY_NAME_, NULL,  },
  };
  static const J2ObjcClassInfo _GeogebraCommonMoveGgtapiModelsAuthenticationModel = { 2, "AuthenticationModel", "geogebra.common.move.ggtapi.models", NULL, 0x401, 16, methods, 3, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_GeogebraCommonMoveGgtapiModelsAuthenticationModel;
}

@end

void GeogebraCommonMoveGgtapiModelsAuthenticationModel_init(GeogebraCommonMoveGgtapiModelsAuthenticationModel *self) {
  GeogebraCommonMoveModelsBaseModel_init(self);
  GeogebraCommonMoveGgtapiModelsAuthenticationModel_set_loggedInUser_(self, nil);
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(GeogebraCommonMoveGgtapiModelsAuthenticationModel)
