//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/jacky/GSoC/geogebra_iOS/geogebra/geogebra/common/src/geogebra/common/euclidian/draw/DrawUpperLowerSum.java
//


#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "geogebra/common/awt/GColor.h"
#include "geogebra/common/awt/GFont.h"
#include "geogebra/common/awt/GGraphics2D.h"
#include "geogebra/common/awt/GRectangle.h"
#include "geogebra/common/euclidian/Drawable.h"
#include "geogebra/common/euclidian/EuclidianView.h"
#include "geogebra/common/euclidian/GeneralPathClipped.h"
#include "geogebra/common/euclidian/draw/DrawUpperLowerSum.h"
#include "geogebra/common/kernel/algos/AlgoElement.h"
#include "geogebra/common/kernel/algos/AlgoFunctionAreaSums.h"
#include "geogebra/common/kernel/arithmetic/NumberValue.h"
#include "geogebra/common/kernel/geos/GeoElement.h"
#include "geogebra/common/kernel/geos/GeoNumeric.h"
#include "geogebra/common/main/App.h"
#include "java/lang/Exception.h"
#include "java/lang/Math.h"

@interface GeogebraCommonEuclidianDrawDrawUpperLowerSum () {
 @public
  GeogebraCommonKernelGeosGeoNumeric *sum_;
  id<GeogebraCommonKernelArithmeticNumberValue> a_, b_;
  jboolean isVisible_, labelVisible_;
  GeogebraCommonKernelAlgosAlgoFunctionAreaSums *algo_;
  GeogebraCommonEuclidianGeneralPathClipped *gp_;
  IOSDoubleArray *coords_;
  jboolean trapeziums_;
  jboolean histogram_;
  jboolean barchartFreqs_, barchartFreqsWidth_;
}

- (void)init__ OBJC_METHOD_FAMILY_NONE;

- (void)updateBarChart;

@end

J2OBJC_FIELD_SETTER(GeogebraCommonEuclidianDrawDrawUpperLowerSum, sum_, GeogebraCommonKernelGeosGeoNumeric *)
J2OBJC_FIELD_SETTER(GeogebraCommonEuclidianDrawDrawUpperLowerSum, a_, id<GeogebraCommonKernelArithmeticNumberValue>)
J2OBJC_FIELD_SETTER(GeogebraCommonEuclidianDrawDrawUpperLowerSum, b_, id<GeogebraCommonKernelArithmeticNumberValue>)
J2OBJC_FIELD_SETTER(GeogebraCommonEuclidianDrawDrawUpperLowerSum, algo_, GeogebraCommonKernelAlgosAlgoFunctionAreaSums *)
J2OBJC_FIELD_SETTER(GeogebraCommonEuclidianDrawDrawUpperLowerSum, gp_, GeogebraCommonEuclidianGeneralPathClipped *)
J2OBJC_FIELD_SETTER(GeogebraCommonEuclidianDrawDrawUpperLowerSum, coords_, IOSDoubleArray *)

__attribute__((unused)) static void GeogebraCommonEuclidianDrawDrawUpperLowerSum_init__(GeogebraCommonEuclidianDrawDrawUpperLowerSum *self);

__attribute__((unused)) static void GeogebraCommonEuclidianDrawDrawUpperLowerSum_update(GeogebraCommonEuclidianDrawDrawUpperLowerSum *self);

__attribute__((unused)) static void GeogebraCommonEuclidianDrawDrawUpperLowerSum_updateBarChart(GeogebraCommonEuclidianDrawDrawUpperLowerSum *self);

@implementation GeogebraCommonEuclidianDrawDrawUpperLowerSum

- (instancetype)initWithGeogebraCommonEuclidianEuclidianView:(GeogebraCommonEuclidianEuclidianView *)view
                      withGeogebraCommonKernelGeosGeoNumeric:(GeogebraCommonKernelGeosGeoNumeric *)n {
  GeogebraCommonEuclidianDrawDrawUpperLowerSum_initWithGeogebraCommonEuclidianEuclidianView_withGeogebraCommonKernelGeosGeoNumeric_(self, view, n);
  return self;
}

- (void)init__ {
  GeogebraCommonEuclidianDrawDrawUpperLowerSum_init__(self);
}

- (void)update {
  GeogebraCommonEuclidianDrawDrawUpperLowerSum_update(self);
}

- (void)updateBarChart {
  GeogebraCommonEuclidianDrawDrawUpperLowerSum_updateBarChart(self);
}

- (void)drawWithGeogebraCommonAwtGGraphics2D:(id<GeogebraCommonAwtGGraphics2D>)g2 {
  if (isVisible_) {
    @try {
      if ([((GeogebraCommonKernelGeosGeoElement *) nil_chk(geo_)) doHighlighting]) {
        [((id<GeogebraCommonAwtGGraphics2D>) nil_chk(g2)) setPaintWithGeogebraCommonAwtGPaint:[((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(sum_)) getSelColor]];
        [g2 setStrokeWithGeogebraCommonAwtGBasicStroke:selStroke_];
        [g2 drawWithGeogebraCommonAwtGShape:gp_];
      }
    }
    @catch (JavaLangException *e) {
      GeogebraCommonMainApp_debugWithNSString_([((JavaLangException *) nil_chk(e)) getMessage]);
    }
    @try {
      [self fillWithGeogebraCommonAwtGGraphics2D:g2 withGeogebraCommonAwtGShape:gp_ withBoolean:NO];
    }
    @catch (JavaLangException *e) {
      [((JavaLangException *) nil_chk(e)) printStackTrace];
    }
    @try {
      if (((GeogebraCommonKernelGeosGeoElement *) nil_chk(geo_))->lineThickness_ > 0) {
        [((id<GeogebraCommonAwtGGraphics2D>) nil_chk(g2)) setPaintWithGeogebraCommonAwtGPaint:[((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(sum_)) getObjectColor]];
        [g2 setStrokeWithGeogebraCommonAwtGBasicStroke:objStroke_];
        [g2 drawWithGeogebraCommonAwtGShape:gp_];
      }
    }
    @catch (JavaLangException *e) {
      GeogebraCommonMainApp_debugWithNSString_([((JavaLangException *) nil_chk(e)) getMessage]);
    }
    if (labelVisible_) {
      [((id<GeogebraCommonAwtGGraphics2D>) nil_chk(g2)) setFontWithGeogebraCommonAwtGFont:[((GeogebraCommonEuclidianEuclidianView *) nil_chk(view_)) getFontConic]];
      [g2 setPaintWithGeogebraCommonAwtGPaint:[((GeogebraCommonKernelGeosGeoElement *) nil_chk(geo_)) getLabelColor]];
      [self drawLabelWithGeogebraCommonAwtGGraphics2D:g2];
    }
  }
}

- (jboolean)hitWithInt:(jint)x
               withInt:(jint)y
               withInt:(jint)hitThreshold {
  return gp_ != nil && ([gp_ containsWithInt:x withInt:y] || [gp_ intersectsWithInt:x - 3 withInt:y - 3 withInt:6 withInt:6]);
}

- (jboolean)isInsideWithGeogebraCommonAwtGRectangle:(id<GeogebraCommonAwtGRectangle>)rect {
  return NO;
}

- (jboolean)intersectsRectangleWithGeogebraCommonAwtGRectangle:(id<GeogebraCommonAwtGRectangle>)rect {
  return gp_ != nil && [gp_ intersectsWithGeogebraCommonAwtGRectangle2D:rect];
}

- (GeogebraCommonKernelGeosGeoElement *)getGeoElement {
  return geo_;
}

- (void)setGeoElementWithGeogebraCommonKernelGeosGeoElement:(GeogebraCommonKernelGeosGeoElement *)geo {
  GeogebraCommonEuclidianDrawable_set_geo_(self, geo);
}

- (id<GeogebraCommonAwtGRectangle>)getBounds {
  if (![((GeogebraCommonKernelGeosGeoElement *) nil_chk(geo_)) isDefined] || ![geo_ isEuclidianVisible]) {
    return nil;
  }
  return [((GeogebraCommonEuclidianGeneralPathClipped *) nil_chk(gp_)) getBounds];
}

- (void)dealloc {
  RELEASE_(sum_);
  RELEASE_(a_);
  RELEASE_(b_);
  RELEASE_(algo_);
  RELEASE_(gp_);
  RELEASE_(coords_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithGeogebraCommonEuclidianEuclidianView:withGeogebraCommonKernelGeosGeoNumeric:", "DrawUpperLowerSum", NULL, 0x1, NULL, NULL },
    { "init__", "init", "V", 0x2, NULL, NULL },
    { "update", NULL, "V", 0x11, NULL, NULL },
    { "updateBarChart", NULL, "V", 0x2, NULL, NULL },
    { "drawWithGeogebraCommonAwtGGraphics2D:", "draw", "V", 0x11, NULL, NULL },
    { "hitWithInt:withInt:withInt:", "hit", "Z", 0x11, NULL, NULL },
    { "isInsideWithGeogebraCommonAwtGRectangle:", "isInside", "Z", 0x11, NULL, NULL },
    { "intersectsRectangleWithGeogebraCommonAwtGRectangle:", "intersectsRectangle", "Z", 0x1, NULL, NULL },
    { "getGeoElement", NULL, "Lgeogebra.common.kernel.geos.GeoElement;", 0x1, NULL, NULL },
    { "setGeoElementWithGeogebraCommonKernelGeosGeoElement:", "setGeoElement", "V", 0x1, NULL, NULL },
    { "getBounds", NULL, "Lgeogebra.common.awt.GRectangle;", 0x11, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "sum_", NULL, 0x2, "Lgeogebra.common.kernel.geos.GeoNumeric;", NULL, NULL,  },
    { "a_", NULL, 0x2, "Lgeogebra.common.kernel.arithmetic.NumberValue;", NULL, NULL,  },
    { "b_", NULL, 0x2, "Lgeogebra.common.kernel.arithmetic.NumberValue;", NULL, NULL,  },
    { "isVisible_", NULL, 0x2, "Z", NULL, NULL,  },
    { "labelVisible_", NULL, 0x2, "Z", NULL, NULL,  },
    { "algo_", NULL, 0x2, "Lgeogebra.common.kernel.algos.AlgoFunctionAreaSums;", NULL, NULL,  },
    { "gp_", NULL, 0x2, "Lgeogebra.common.euclidian.GeneralPathClipped;", NULL, NULL,  },
    { "coords_", NULL, 0x2, "[D", NULL, NULL,  },
    { "trapeziums_", NULL, 0x2, "Z", NULL, NULL,  },
    { "histogram_", NULL, 0x2, "Z", NULL, NULL,  },
    { "barchartFreqs_", NULL, 0x2, "Z", NULL, NULL,  },
    { "barchartFreqsWidth_", NULL, 0x2, "Z", NULL, NULL,  },
  };
  static const J2ObjcClassInfo _GeogebraCommonEuclidianDrawDrawUpperLowerSum = { 2, "DrawUpperLowerSum", "geogebra.common.euclidian.draw", NULL, 0x1, 11, methods, 12, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_GeogebraCommonEuclidianDrawDrawUpperLowerSum;
}

@end

void GeogebraCommonEuclidianDrawDrawUpperLowerSum_initWithGeogebraCommonEuclidianEuclidianView_withGeogebraCommonKernelGeosGeoNumeric_(GeogebraCommonEuclidianDrawDrawUpperLowerSum *self, GeogebraCommonEuclidianEuclidianView *view, GeogebraCommonKernelGeosGeoNumeric *n) {
  GeogebraCommonEuclidianDrawable_init(self);
  GeogebraCommonEuclidianDrawDrawUpperLowerSum_setAndConsume_coords_(self, [IOSDoubleArray newArrayWithLength:2]);
  GeogebraCommonEuclidianDrawable_set_view_(self, view);
  GeogebraCommonEuclidianDrawDrawUpperLowerSum_set_sum_(self, n);
  GeogebraCommonEuclidianDrawable_set_geo_(self, n);
  [((GeogebraCommonKernelGeosGeoNumeric *) nil_chk(n)) setDrawableWithBoolean:YES];
  GeogebraCommonEuclidianDrawDrawUpperLowerSum_init__(self);
  GeogebraCommonEuclidianDrawDrawUpperLowerSum_update(self);
}

GeogebraCommonEuclidianDrawDrawUpperLowerSum *new_GeogebraCommonEuclidianDrawDrawUpperLowerSum_initWithGeogebraCommonEuclidianEuclidianView_withGeogebraCommonKernelGeosGeoNumeric_(GeogebraCommonEuclidianEuclidianView *view, GeogebraCommonKernelGeosGeoNumeric *n) {
  GeogebraCommonEuclidianDrawDrawUpperLowerSum *self = [GeogebraCommonEuclidianDrawDrawUpperLowerSum alloc];
  GeogebraCommonEuclidianDrawDrawUpperLowerSum_initWithGeogebraCommonEuclidianEuclidianView_withGeogebraCommonKernelGeosGeoNumeric_(self, view, n);
  return self;
}

void GeogebraCommonEuclidianDrawDrawUpperLowerSum_init__(GeogebraCommonEuclidianDrawDrawUpperLowerSum *self) {
  GeogebraCommonEuclidianDrawDrawUpperLowerSum_set_algo_(self, (GeogebraCommonKernelAlgosAlgoFunctionAreaSums *) check_class_cast([((GeogebraCommonKernelGeosGeoElement *) nil_chk(self->geo_)) getDrawAlgorithm], [GeogebraCommonKernelAlgosAlgoFunctionAreaSums class]));
  self->trapeziums_ = [((GeogebraCommonKernelAlgosAlgoFunctionAreaSums *) nil_chk(self->algo_)) useTrapeziums];
  self->histogram_ = [self->algo_ isHistogram];
  self->barchartFreqs_ = ([self->algo_ getType] == GeogebraCommonKernelAlgosAlgoFunctionAreaSums_SumTypeEnum_get_BARCHART_FREQUENCY_TABLE());
  self->barchartFreqsWidth_ = ([self->algo_ getType] == GeogebraCommonKernelAlgosAlgoFunctionAreaSums_SumTypeEnum_get_BARCHART_FREQUENCY_TABLE_WIDTH());
  GeogebraCommonEuclidianDrawDrawUpperLowerSum_set_a_(self, [self->algo_ getA]);
  GeogebraCommonEuclidianDrawDrawUpperLowerSum_set_b_(self, [self->algo_ getB]);
}

void GeogebraCommonEuclidianDrawDrawUpperLowerSum_update(GeogebraCommonEuclidianDrawDrawUpperLowerSum *self) {
  self->isVisible_ = [((GeogebraCommonKernelGeosGeoElement *) nil_chk(self->geo_)) isEuclidianVisible];
  if (!self->isVisible_) return;
  if (![((GeogebraCommonKernelAlgosAlgoElement *) nil_chk([self->geo_ getDrawAlgorithm])) isEqual:[self->geo_ getParentAlgorithm]]) GeogebraCommonEuclidianDrawDrawUpperLowerSum_init__(self);
  self->labelVisible_ = [self->geo_ isLabelVisible];
  [self updateStrokesWithGeogebraCommonKernelKernelNDGeoElementND:self->sum_];
  if (self->gp_ == nil) GeogebraCommonEuclidianDrawDrawUpperLowerSum_setAndConsume_gp_(self, new_GeogebraCommonEuclidianGeneralPathClipped_initWithGeogebraCommonEuclidianEuclidianViewInterfaceSlim_(self->view_));
  if (self->barchartFreqs_ || self->histogram_) {
    GeogebraCommonEuclidianDrawDrawUpperLowerSum_updateBarChart(self);
    return;
  }
  [((GeogebraCommonEuclidianGeneralPathClipped *) nil_chk(self->gp_)) reset];
  jdouble aRW = [((id<GeogebraCommonKernelArithmeticNumberValue>) nil_chk(self->a_)) getDouble];
  jdouble bRW = [((id<GeogebraCommonKernelArithmeticNumberValue>) nil_chk(self->b_)) getDouble];
  jdouble ax = [((GeogebraCommonEuclidianEuclidianView *) nil_chk(self->view_)) toScreenCoordXdWithDouble:aRW];
  jdouble bx = [self->view_ toScreenCoordXdWithDouble:bRW];
  jdouble y0 = [self->view_ getyZero];
  jint N = [((GeogebraCommonKernelAlgosAlgoFunctionAreaSums *) nil_chk(self->algo_)) getIntervals];
  IOSDoubleArray *leftBorder = [self->algo_ getLeftBorder];
  IOSDoubleArray *yval = [self->algo_ getValues];
  jdouble x = ax;
  jdouble y = y0;
  [self->gp_ moveToWithDouble:x withDouble:y];
  for (jint i = 0; i < N; i++) {
    *IOSDoubleArray_GetRef(nil_chk(self->coords_), 0) = IOSDoubleArray_Get(nil_chk(leftBorder), i);
    *IOSDoubleArray_GetRef(self->coords_, 1) = IOSDoubleArray_Get(nil_chk(yval), i);
    [self->view_ toScreenCoordsWithDoubleArray:self->coords_];
    x = IOSDoubleArray_Get(self->coords_, 0);
    if (self->trapeziums_) [self->gp_ lineToWithDouble:x withDouble:IOSDoubleArray_Get(self->coords_, 1)];
    else [self->gp_ lineToWithDouble:x withDouble:y];
    [self->gp_ lineToWithDouble:x withDouble:y0];
    [self->gp_ moveToWithDouble:x withDouble:y];
    y = IOSDoubleArray_Get(self->coords_, 1);
    [self->gp_ moveToWithDouble:x withDouble:y0];
    [self->gp_ lineToWithDouble:x withDouble:y];
  }
  if (self->trapeziums_) {
    *IOSDoubleArray_GetRef(nil_chk(self->coords_), 0) = IOSDoubleArray_Get(nil_chk(leftBorder), N);
    *IOSDoubleArray_GetRef(self->coords_, 1) = IOSDoubleArray_Get(nil_chk(yval), N);
    [self->view_ toScreenCoordsWithDoubleArray:self->coords_];
    [self->gp_ lineToWithDouble:bx withDouble:IOSDoubleArray_Get(self->coords_, 1)];
  }
  else if (!self->barchartFreqsWidth_) {
    [self->gp_ lineToWithDouble:bx withDouble:y];
  }
  if (self->histogram_) [self->gp_ moveToWithDouble:bx withDouble:y0];
  else if (!self->barchartFreqsWidth_) [self->gp_ lineToWithDouble:bx withDouble:y0];
  [self->gp_ lineToWithDouble:ax withDouble:y0];
  if (![self->gp_ intersectsWithInt:0 withInt:0 withInt:[self->view_ getWidth] withInt:[self->view_ getHeight]]) {
    self->isVisible_ = NO;
  }
  if (self->labelVisible_) {
    self->xLabel_ = (jint) JavaLangMath_roundWithDouble_((ax + bx) / 2) - 6;
    self->yLabel_ = J2ObjCFpToInt([self->view_ getyZero]) - [self->view_ getFontSize];
    GeogebraCommonEuclidianDrawable_set_labelDesc_(self, [self->geo_ getLabelDescription]);
    [self addLabelOffset];
  }
}

void GeogebraCommonEuclidianDrawDrawUpperLowerSum_updateBarChart(GeogebraCommonEuclidianDrawDrawUpperLowerSum *self) {
  [((GeogebraCommonEuclidianGeneralPathClipped *) nil_chk(self->gp_)) reset];
  jdouble base = [((GeogebraCommonEuclidianEuclidianView *) nil_chk(self->view_)) getyZero];
  jint N = [((GeogebraCommonKernelAlgosAlgoFunctionAreaSums *) nil_chk(self->algo_)) getIntervals];
  IOSDoubleArray *leftBorder = [self->algo_ getLeftBorder];
  IOSDoubleArray *yval = [self->algo_ getValues];
  [self->gp_ moveToWithDouble:[self->view_ toScreenCoordXdWithDouble:IOSDoubleArray_Get(nil_chk(leftBorder), 0)] withDouble:base];
  for (jint i = 0; i < N - 1; i++) {
    jdouble x0 = [self->view_ toScreenCoordXdWithDouble:IOSDoubleArray_Get(leftBorder, i)];
    jdouble height = [self->view_ toScreenCoordYdWithDouble:IOSDoubleArray_Get(nil_chk(yval), i)];
    jdouble x1 = [self->view_ toScreenCoordXdWithDouble:IOSDoubleArray_Get(leftBorder, i + 1)];
    [self->gp_ lineToWithDouble:x0 withDouble:height];
    [self->gp_ lineToWithDouble:x1 withDouble:height];
    [self->gp_ lineToWithDouble:x1 withDouble:base];
  }
  [self->gp_ lineToWithDouble:[self->view_ toScreenCoordXdWithDouble:IOSDoubleArray_Get(leftBorder, 0)] withDouble:base];
  if (![self->gp_ intersectsWithInt:0 withInt:0 withInt:[self->view_ getWidth] withInt:[self->view_ getHeight]]) {
    self->isVisible_ = NO;
  }
  if (self->labelVisible_) {
    self->xLabel_ = ([self->view_ toScreenCoordXWithDouble:IOSDoubleArray_Get(leftBorder, 0)] + [self->view_ toScreenCoordXWithDouble:IOSDoubleArray_Get(leftBorder, N - 1)]) / 2 - 6;
    self->yLabel_ = J2ObjCFpToInt([self->view_ getyZero]) - [self->view_ getFontSize];
    GeogebraCommonEuclidianDrawable_set_labelDesc_(self, [((GeogebraCommonKernelGeosGeoElement *) nil_chk(self->geo_)) getLabelDescription]);
    [self addLabelOffset];
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(GeogebraCommonEuclidianDrawDrawUpperLowerSum)
